<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SQL | Notes of Tan</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="https://v1.vuepress.vuejs.org/hero.png">
    <meta name="description" content="Tan's notes.">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/notes-of-tan/assets/css/0.styles.9802d8bc.css" as="style"><link rel="preload" href="/notes-of-tan/assets/js/app.5f580515.js" as="script"><link rel="preload" href="/notes-of-tan/assets/js/2.33f31c9b.js" as="script"><link rel="preload" href="/notes-of-tan/assets/js/18.0d515c6a.js" as="script"><link rel="prefetch" href="/notes-of-tan/assets/js/10.2f572410.js"><link rel="prefetch" href="/notes-of-tan/assets/js/11.95d04f86.js"><link rel="prefetch" href="/notes-of-tan/assets/js/12.ef1d3621.js"><link rel="prefetch" href="/notes-of-tan/assets/js/13.a4adee88.js"><link rel="prefetch" href="/notes-of-tan/assets/js/14.c09755c2.js"><link rel="prefetch" href="/notes-of-tan/assets/js/15.34e0d1b9.js"><link rel="prefetch" href="/notes-of-tan/assets/js/16.3a783d6c.js"><link rel="prefetch" href="/notes-of-tan/assets/js/17.ed547b98.js"><link rel="prefetch" href="/notes-of-tan/assets/js/19.e33438b9.js"><link rel="prefetch" href="/notes-of-tan/assets/js/20.31497e17.js"><link rel="prefetch" href="/notes-of-tan/assets/js/21.146edf7a.js"><link rel="prefetch" href="/notes-of-tan/assets/js/22.b0acc279.js"><link rel="prefetch" href="/notes-of-tan/assets/js/23.7e43ade0.js"><link rel="prefetch" href="/notes-of-tan/assets/js/24.1ec9070f.js"><link rel="prefetch" href="/notes-of-tan/assets/js/25.fb06ec42.js"><link rel="prefetch" href="/notes-of-tan/assets/js/26.50dc7d2f.js"><link rel="prefetch" href="/notes-of-tan/assets/js/27.01533c2a.js"><link rel="prefetch" href="/notes-of-tan/assets/js/28.d9dbf10c.js"><link rel="prefetch" href="/notes-of-tan/assets/js/29.9de9cb08.js"><link rel="prefetch" href="/notes-of-tan/assets/js/3.f2118d7b.js"><link rel="prefetch" href="/notes-of-tan/assets/js/30.e497781c.js"><link rel="prefetch" href="/notes-of-tan/assets/js/31.e73197b9.js"><link rel="prefetch" href="/notes-of-tan/assets/js/32.061cf937.js"><link rel="prefetch" href="/notes-of-tan/assets/js/33.40fadf29.js"><link rel="prefetch" href="/notes-of-tan/assets/js/34.1cb87aa7.js"><link rel="prefetch" href="/notes-of-tan/assets/js/35.ffb66b35.js"><link rel="prefetch" href="/notes-of-tan/assets/js/36.5b4a09a3.js"><link rel="prefetch" href="/notes-of-tan/assets/js/37.4e57a711.js"><link rel="prefetch" href="/notes-of-tan/assets/js/4.379a9a10.js"><link rel="prefetch" href="/notes-of-tan/assets/js/5.b772f594.js"><link rel="prefetch" href="/notes-of-tan/assets/js/6.8136b6d3.js"><link rel="prefetch" href="/notes-of-tan/assets/js/7.1140570f.js"><link rel="prefetch" href="/notes-of-tan/assets/js/8.bd5a1ed5.js"><link rel="prefetch" href="/notes-of-tan/assets/js/9.98e24ffb.js">
    <link rel="stylesheet" href="/notes-of-tan/assets/css/0.styles.9802d8bc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notes-of-tan/" class="home-link router-link-active"><!----> <span class="site-name">Notes of Tan</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes-of-tan/backend/java/javaBasics.html" class="nav-link">
  Java Basics
</a></li><li class="dropdown-item"><!----> <a href="/notes-of-tan/backend/java/javaUtils.html" class="nav-link">
  Java Utilities
</a></li><li class="dropdown-item"><!----> <a href="/notes-of-tan/backend/java/javaConcurrency.html" class="nav-link">
  Java Concurrency
</a></li><li class="dropdown-item"><!----> <a href="/notes-of-tan/backend/java/javaIO.html" class="nav-link">
  IO
</a></li><li class="dropdown-item"><!----> <a href="/notes-of-tan/backend/java/javaMisc.html" class="nav-link">
  Java Miscellanea
</a></li><li class="dropdown-item"><!----> <a href="/notes-of-tan/backend/java/JVM.html" class="nav-link">
  Java Virtual Machine
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Backend" class="dropdown-title"><span class="title">Backend</span> <span class="arrow down"></span></button> <button type="button" aria-label="Backend" class="mobile-dropdown-title"><span class="title">Backend</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes-of-tan/backend/SpringNotes.html" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/notes-of-tan/backend/OS-notes.html" class="nav-link">
  OS
</a></li><li class="dropdown-item"><!----> <a href="/notes-of-tan/backend/database.html" class="nav-link">
  Database
</a></li><li class="dropdown-item"><!----> <a href="/notes-of-tan/backend/SQL_notes.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  SQL
</a></li><li class="dropdown-item"><!----> <a href="/notes-of-tan/backend/distributed.html" class="nav-link">
  Distributed System
</a></li><li class="dropdown-item"><!----> <a href="/notes-of-tan/backend/redis-notes.html" class="nav-link">
  Redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Frontend" class="dropdown-title"><span class="title">Frontend</span> <span class="arrow down"></span></button> <button type="button" aria-label="Frontend" class="mobile-dropdown-title"><span class="title">Frontend</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes-of-tan/CSS-notes.html" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/notes-of-tan/html-notes.html" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/notes-of-tan/todo/jsNotes.html" class="nav-link">
  JS, TS
</a></li><li class="dropdown-item"><!----> <a href="/notes-of-tan/BOM_DOM_notes.html" class="nav-link">
  BOM, DOM, Web API
</a></li><li class="dropdown-item"><!----> <a href="/notes-of-tan/todo/react_notes.html" class="nav-link">
  React
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Other" class="dropdown-title"><span class="title">Other</span> <span class="arrow down"></span></button> <button type="button" aria-label="Other" class="mobile-dropdown-title"><span class="title">Other</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes-of-tan/algo_notes.html" class="nav-link">
  Algorithm
</a></li><li class="dropdown-item"><!----> <a href="/notes-of-tan/git_notes.html" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/notes-of-tan/DesignPatternNotes.html" class="nav-link">
  Design Pattern
</a></li><li class="dropdown-item"><!----> <a href="/notes-of-tan/HTTP.html" class="nav-link">
  HTTP
</a></li><li class="dropdown-item"><!----> <a href="/notes-of-tan/mac-notes.html" class="nav-link">
  MacOS
</a></li></ul></div></div> <a href="https://github.com/tangentyh/notes-of-tan" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes-of-tan/backend/java/javaBasics.html" class="nav-link">
  Java Basics
</a></li><li class="dropdown-item"><!----> <a href="/notes-of-tan/backend/java/javaUtils.html" class="nav-link">
  Java Utilities
</a></li><li class="dropdown-item"><!----> <a href="/notes-of-tan/backend/java/javaConcurrency.html" class="nav-link">
  Java Concurrency
</a></li><li class="dropdown-item"><!----> <a href="/notes-of-tan/backend/java/javaIO.html" class="nav-link">
  IO
</a></li><li class="dropdown-item"><!----> <a href="/notes-of-tan/backend/java/javaMisc.html" class="nav-link">
  Java Miscellanea
</a></li><li class="dropdown-item"><!----> <a href="/notes-of-tan/backend/java/JVM.html" class="nav-link">
  Java Virtual Machine
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Backend" class="dropdown-title"><span class="title">Backend</span> <span class="arrow down"></span></button> <button type="button" aria-label="Backend" class="mobile-dropdown-title"><span class="title">Backend</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes-of-tan/backend/SpringNotes.html" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/notes-of-tan/backend/OS-notes.html" class="nav-link">
  OS
</a></li><li class="dropdown-item"><!----> <a href="/notes-of-tan/backend/database.html" class="nav-link">
  Database
</a></li><li class="dropdown-item"><!----> <a href="/notes-of-tan/backend/SQL_notes.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  SQL
</a></li><li class="dropdown-item"><!----> <a href="/notes-of-tan/backend/distributed.html" class="nav-link">
  Distributed System
</a></li><li class="dropdown-item"><!----> <a href="/notes-of-tan/backend/redis-notes.html" class="nav-link">
  Redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Frontend" class="dropdown-title"><span class="title">Frontend</span> <span class="arrow down"></span></button> <button type="button" aria-label="Frontend" class="mobile-dropdown-title"><span class="title">Frontend</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes-of-tan/CSS-notes.html" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/notes-of-tan/html-notes.html" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/notes-of-tan/todo/jsNotes.html" class="nav-link">
  JS, TS
</a></li><li class="dropdown-item"><!----> <a href="/notes-of-tan/BOM_DOM_notes.html" class="nav-link">
  BOM, DOM, Web API
</a></li><li class="dropdown-item"><!----> <a href="/notes-of-tan/todo/react_notes.html" class="nav-link">
  React
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Other" class="dropdown-title"><span class="title">Other</span> <span class="arrow down"></span></button> <button type="button" aria-label="Other" class="mobile-dropdown-title"><span class="title">Other</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes-of-tan/algo_notes.html" class="nav-link">
  Algorithm
</a></li><li class="dropdown-item"><!----> <a href="/notes-of-tan/git_notes.html" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/notes-of-tan/DesignPatternNotes.html" class="nav-link">
  Design Pattern
</a></li><li class="dropdown-item"><!----> <a href="/notes-of-tan/HTTP.html" class="nav-link">
  HTTP
</a></li><li class="dropdown-item"><!----> <a href="/notes-of-tan/mac-notes.html" class="nav-link">
  MacOS
</a></li></ul></div></div> <a href="https://github.com/tangentyh/notes-of-tan" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>SQL</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes-of-tan/backend/SQL_notes.html#Docs" class="sidebar-link">Docs</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/backend/SQL_notes.html#CLI" class="sidebar-link">CLI</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/backend/SQL_notes.html#Data-Types" class="sidebar-link">Data Types</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/backend/SQL_notes.html#Statements" class="sidebar-link">Statements</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes-of-tan/backend/SQL_notes.html#Inspection" class="sidebar-link">Inspection</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/backend/SQL_notes.html#SHOW" class="sidebar-link" style="padding-left:3rem;">SHOW</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/backend/SQL_notes.html#EXPLAIN" class="sidebar-link" style="padding-left:3rem;">EXPLAIN</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/backend/SQL_notes.html#DDL" class="sidebar-link">DDL</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/backend/SQL_notes.html#CREATE-TABLE" class="sidebar-link" style="padding-left:3rem;">CREATE TABLE</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/backend/SQL_notes.html#ALTER-TABLE-DROP-TABLE" class="sidebar-link" style="padding-left:3rem;">ALTER TABLE, DROP TABLE</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/backend/SQL_notes.html#CREATE-VIEW-PROCEDURE-FUNCTION-TRIGGER" class="sidebar-link" style="padding-left:3rem;">CREATE VIEW, PROCEDURE, FUNCTION, TRIGGER</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/backend/SQL_notes.html#DML" class="sidebar-link">DML</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/backend/SQL_notes.html#SELECT" class="sidebar-link" style="padding-left:3rem;">SELECT</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/backend/SQL_notes.html#FROM-JOIN" class="sidebar-link" style="padding-left:4rem;">FROM, JOIN</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/backend/SQL_notes.html#UNION" class="sidebar-link" style="padding-left:4rem;">UNION</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/backend/SQL_notes.html#Filtering-Ordering-Grouping-Limiting" class="sidebar-link" style="padding-left:3rem;">Filtering, Ordering, Grouping, Limiting</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/backend/SQL_notes.html#WINDOW" class="sidebar-link" style="padding-left:4rem;">WINDOW</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/backend/SQL_notes.html#Subqueries" class="sidebar-link" style="padding-left:3rem;">Subqueries</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/backend/SQL_notes.html#WITH" class="sidebar-link" style="padding-left:3rem;">WITH</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/backend/SQL_notes.html#DELETE" class="sidebar-link" style="padding-left:3rem;">DELETE</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/backend/SQL_notes.html#UPDATE" class="sidebar-link" style="padding-left:3rem;">UPDATE</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/backend/SQL_notes.html#INSERT" class="sidebar-link" style="padding-left:3rem;">INSERT</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/backend/SQL_notes.html#TCL" class="sidebar-link">TCL</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/backend/SQL_notes.html#Transactions" class="sidebar-link" style="padding-left:3rem;">Transactions</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/backend/SQL_notes.html#SET-TRANSACTION" class="sidebar-link" style="padding-left:3rem;">SET TRANSACTION</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/backend/SQL_notes.html#Locks" class="sidebar-link" style="padding-left:3rem;">Locks</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/backend/SQL_notes.html#Dynamic-SQL" class="sidebar-link">Dynamic SQL</a></li></ul></li><li><a href="/notes-of-tan/backend/SQL_notes.html#Language-Structure" class="sidebar-link">Language Structure</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes-of-tan/backend/SQL_notes.html#Basics" class="sidebar-link">Basics</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/backend/SQL_notes.html#Identifiers-User-Variables-and-Comments" class="sidebar-link">Identifiers, User Variables and Comments</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/backend/SQL_notes.html#Literals" class="sidebar-link">Literals</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/backend/SQL_notes.html#Operators-and-Functions" class="sidebar-link">Operators and Functions</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/backend/SQL_notes.html#Cast-Math-Date-Time-and-String-Functions" class="sidebar-link">Cast, Math, Date, Time and String Functions</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/backend/SQL_notes.html#Aggregate-and-Window-Functions" class="sidebar-link">Aggregate and Window Functions</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/backend/SQL_notes.html#Other-Functions" class="sidebar-link">Other Functions</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/backend/SQL_notes.html#Expressions" class="sidebar-link">Expressions</a></li></ul></li><li><a href="/notes-of-tan/backend/SQL_notes.html#Distributed-MySQL" class="sidebar-link">Distributed MySQL</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes-of-tan/backend/SQL_notes.html#Partition" class="sidebar-link">Partition</a></li></ul></li><li><a href="/notes-of-tan/backend/SQL_notes.html#System-Variables" class="sidebar-link">System Variables</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="SQL"><a href="#SQL" class="header-anchor">#</a> SQL</h1> <p>Based on MySQL</p> <h2 id="Docs"><a href="#Docs" class="header-anchor">#</a> Docs</h2> <ol><li><p>docs</p> <ul><li><a href="https://dev.mysql.com/doc/refman/8.0/en/" target="_blank" rel="noopener noreferrer">MySQL :: MySQL 8.0 Reference Manual<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>man pages</li></ul></li> <li><p>help</p> <div class="language- extra-class"><pre class="language-text"><code>help
HELP 'search_string'
</code></pre></div><ul><li>corresponding table in <code>mysql</code> — <code>help_category</code>, <code>help_keyword</code>, <code>help_relation</code>, <code>help_topic</code></li> <li>the top-level help categories<div class="language- extra-class"><pre class="language-text"><code>HELP 'contents'
</code></pre></div></li> <li>topics in help categories — use the category name<div class="language- extra-class"><pre class="language-text"><code>HELP 'data types'
</code></pre></div></li> <li>keywords<div class="language- extra-class"><pre class="language-text"><code>HELP 'ascii'
HELP 'create table'
</code></pre></div></li></ul></li> <li><p>after <code>brew install</code></p> <ul><li>secure with a root password — <code>mysql_secure_installation</code></li> <li>connect<div class="language-shell extra-class"><pre class="language-shell"><code>mysql -uroot
</code></pre></div></li> <li>start with <code>launchd</code><div class="language-shell extra-class"><pre class="language-shell"><code>brew services start mysql
</code></pre></div></li> <li>start without a background service<div class="language-shell extra-class"><pre class="language-shell"><code>mysql.server start
</code></pre></div></li></ul></li></ol> <h2 id="CLI"><a href="#CLI" class="header-anchor">#</a> CLI</h2> <ol><li><p>mycli — A Terminal Client for MySQL with AutoCompletion and Syntax Highlighting</p> <ul><li><a href="https://github.com/dbcli/mycli" target="_blank" rel="noopener noreferrer">mycli at GitHub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.mycli.net/docs" target="_blank" rel="noopener noreferrer">mycli docs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>pager — <code>nopager</code>, <code>pager less</code>, <code>pager more</code></li></ul></li> <li><p><code>mysql</code></p> <div class="language- extra-class"><pre class="language-text"><code>mysql [options] [db_name]
</code></pre></div><ul><li>authentication
<ul><li><code>--user=user_name</code>, <code>-u user_name</code></li> <li><code>--password[=password]</code>, <code>-p[password]</code></li></ul></li> <li>privileges
<ul><li><code>--skip-show-database</code> — sets the <code>skip_show_database</code> system variable that controls who is permitted to use</li></ul></li> <li>case sensitivity — see <a href="#Basics">Language Basics</a> <ul><li><code>--lower-case-table-names[=#]</code></li></ul></li> <li>autocomplete — <code>--auto-rehash</code>, <code>mysql&gt; \#</code>, <code>mysql&gt; rehash</code></li> <li>output format
<ul><li><code>--xml</code></li> <li><code>--html</code></li></ul></li></ul></li> <li><p>at <code>mysql&gt;</code> — statements should end with <code>;</code> if accidentally enters multiline mode</p> <ul><li><code>quit</code>, <code>exit</code></li> <li>help<div class="language- extra-class"><pre class="language-text"><code>HELP COMMAND
HELP STATEMENT
</code></pre></div></li> <li>open file<div class="language- extra-class"><pre class="language-text"><code>\. &lt;filename&gt; | source &lt;filename&gt;
</code></pre></div></li></ul></li> <li><p><code>mysqlshow</code></p> <ul><li><code>mysqlshow</code> — <code>SHOW DATABASES</code>, <code>SHOW SCHEMAS</code></li> <li><code>mysqlshow db_name</code> — <code>SHOW TABLES</code></li></ul></li> <li><p><code>mysqladmin</code></p></li> <li><p><code>mysqlsh</code> — mysql shell, with JavaScript and Python support</p> <ul><li><a href="https://dev.mysql.com/doc/mysql-shell/8.0/en/mysql-shell-features.html" target="_blank" rel="noopener noreferrer">MySQL :: MySQL Shell 8.0 :: 1 MySQL Shell Features<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>APIs
<ul><li>The X DevAPI — work with both relational and document data</li> <li>The AdminAPI — work with InnoDB cluster</li></ul></li></ul></li></ol> <h2 id="Data-Types"><a href="#Data-Types" class="header-anchor">#</a> Data Types</h2> <p>See <a href="#Literals">Literals</a> for syntax.</p> <ol><li><p>numeric</p> <ul><li>attributes
<ul><li>arithmetic operations — all arithmetic is done using signed <code>BIGINT</code> or <code>DOUBLE</code> values, bear overflow awareness in mind</li> <li>string-to-number conversion — automatically, to <code>DOUBLE</code> or <code>BIGINT</code></li> <li><code>SIGNED</code> by default, no effect when using</li> <li><code>UNSIGNED</code> — deprecated for columns of type <code>FLOAT</code>, <code>DOUBLE</code>, and <code>DECIMAL</code> (and any synonyms), use <code>CHECK</code> instead
<ul><li>subtraction between integer values — the result is unsigned if one of the two is <code>UNSIGNED</code>, unless <code>sql_mode</code> <code>NO_UNSIGNED_SUBTRACTION</code></li></ul></li> <li><code>ZEROFILL</code> — deprecated, automatically <code>UNSIGNED</code> if used, use <code>LPAD()</code> or <code>CHAR</code> instead</li></ul></li> <li><code>TINYINT</code>, <code>SMALLINT</code>, <code>MEDIUMINT</code>, <code>INT</code> or <code>INTEGER</code>, <code>BIGINT</code> — 1 B, 2 B, 3 B, 4 B, 8 B<div class="language- extra-class"><pre class="language-text"><code>TINYINT[(M)] [UNSIGNED] [ZEROFILL]
</code></pre></div><ul><li><code>M</code> like in <code>TINYINT(1)</code> — the maximum display width, unrelated to the range of values a type can store</li> <li><code>SERIAL</code> — equivalent to <code>BIGINT UNSIGNED NOT NULL AUTO_INCREMENT UNIQUE</code></li></ul></li> <li><code>BOOL</code>, <code>BOOLEAN</code> — <code>TINYINT(1)</code>, zero for <code>FALSE</code>, nonzero for true, <code>TRUE</code> is 1</li> <li><code>DECIMAL</code>, <code>NUMERIC</code>, <code>DEC</code>, <code>FIXED</code> — <code>M</code> for precision (total digits) up to 65 and defaults to 10, <code>D</code> for scale (fraction digits, no decimal point if 0), up to 30 and defaults to 0<div class="language- extra-class"><pre class="language-text"><code>DECIMAL[(M[,D])] [ZEROFILL]
</code></pre></div><ul><li>arithmetic operations — done with <code>M</code> of 65</li> <li>when more digits than permitted — generally truncation</li></ul></li> <li><code>FLOAT</code>, <code>DOUBLE</code>, <code>DOUBLE PRECISION</code> <ul><li>deprecated — <code>FLOAT(p)</code>, <code>FLOAT(M,D)</code>, <code>DOUBLE(M,D)</code>, <code>DOUBLE PRECISION[(M,D)]</code></li></ul></li> <li><code>BIT[(M)]</code> — <code>M</code> indicates the number of bits from 1 (default) to 64
<ul><li>literal syntax — see <a href="#Literals">Literals</a></li></ul></li></ul></li> <li><p>date and time</p> <ul><li>attribute
<ul><li>invalid value — zero value, out of range or otherwise invalid values are converted to zero value, except <code>TIME</code>, controlled by <code>sql_mode</code> <code>NO_ZERO_DATE</code></li> <li>zero date — useful for applications that need to store birthdays for which you may not know the exact date, like <code>2009-00-00</code>, controlled by <code>sql_mode</code> <code>NO_ZERO_IN_DATE</code> <ul><li>dummy date <code>0000-00-00</code> (zero value) — sometimes more convenient than using <code>NULL</code> values, and uses less data and index space</li></ul></li> <li><code>fsp</code> fractional seconds part — defaults to 0, up to 6 (microsecond, ANSI SQL default), rounded for excessive values, controlled by <code>sql_mode</code> <code>TIME_TRUNCATE_FRACTIONAL</code></li> <li>automatic initialization and updating — for <code>TIMESTAMP</code> or <code>DATETIME</code></li> <li>string and number — accept both string and number when assigning, but need to convert to numbers (<code>TIME_TO_SEC()</code>, <code>TO_DAYS()</code>) before <code>SUM()</code> and <code>AVG()</code></li> <li>conversion — missing date as <code>CURRENT_DATE()</code>, missing time part as <code>00:00:00</code>, rounding</li></ul></li> <li><code>DATE</code> — from <code>'1000-01-01'</code> to <code>'9999-12-31'</code></li> <li><code>DATETIME[(fsp)]</code> — from <code>1000-01-01 00:00:00.000000'</code> to <code>'9999-12-31 23:59:59.999999'</code> <ul><li>automatic initialization and updating — <code>DEFAULT CURRENT_TIMESTAMP</code> and <code>ON UPDATE CURRENT_TIMESTAMP</code>, also synonyms of <code>CURRENT_TIMESTAMP</code>, the parameter as <code>fsp</code></li></ul></li> <li><code>TIMESTAMP[(fsp)]</code> — in UTC, from <code>'1970-01-01 00:00:01.000000'</code> to <code>'2038-01-19 03:14:07.999999'</code> <ul><li>automatic initialization and updating — <code>DEFAULT CURRENT_TIMESTAMP</code> and <code>ON UPDATE CURRENT_TIMESTAMP</code>, also synonyms of <code>CURRENT_TIMESTAMP</code>, the parameter as <code>fsp</code></li> <li><code>explicit_defaults_for_timestamp</code> system variable — controls nonstandard behaviors for default values and <code>NULL</code>-value handling in <code>TIMESTAMP</code> columns</li></ul></li> <li><code>TIME[(fsp)]</code> — from <code>'-838:59:59.000000'</code> to <code>'838:59:59.000000'</code>, can also used for elapsed time or a time interval
<ul><li>out of range value — clipped to the closest endpoint</li> <li>invalid values — converted to the zero value which itself is valid</li> <li>number values — as left padded with zero, like <code>1111</code> to <code>00:11:11</code></li></ul></li> <li><code>YEAR</code> — from <code>1901</code> to <code>2155</code>, 1 byte</li></ul></li> <li><p>string</p> <ul><li>attribute
<ul><li><code>CHARACTER SET</code>, <code>CHARSET</code> — see <a href="#SHOW"><code>SHOW CHARACTER SET</code></a>, defaults to <code>utf8mb4</code> from version 8, <code>latin1</code> previously<div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t
<span class="token punctuation">(</span>
    c1 <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8<span class="token punctuation">,</span>
    c2 <span class="token keyword">TEXT</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> latin1 <span class="token keyword">COLLATE</span> latin1_general_cs
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> european_sales <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> latin1<span class="token punctuation">;</span>
</code></pre></div><ul><li><code>ASCII</code> attribute — shorthand for <code>CHARACTER SET latin1</code></li></ul></li> <li><code>COLLATE</code> <ul><li><code>CHAR BINARY</code> and <code>VARCHAR BINARY</code> — use the binary (<code>_bin</code>) collation, like <code>utf8mb4_bin</code></li> <li><code>PAD_ATTRIBUTE</code> — many collation with <code>PAD SPACE</code>, with which strings are compared without regard to any trailing spaces (<code>LIKE</code> excluded), possible cause of duplicate-key errors<div class="language- extra-class"><pre class="language-text"><code>mysql&gt; SELECT myname = 'Jones', myname = 'Jones  ' FROM names;
+--------------------+--------------------+
| myname = 'Jones'   | myname = 'Jones  ' |
+--------------------+--------------------+
|                  1 |                  1 |
+--------------------+--------------------+
</code></pre></div></li></ul></li></ul></li> <li><code>CHAR</code> — space right padded, width <code>M</code> from 0 to 255 default 1<div class="language- extra-class"><pre class="language-text"><code>CHAR[(M)] [CHARACTER SET charset_name] [COLLATE collation_name]
</code></pre></div><ul><li><code>CHAR(0)</code> — only <code>NULL</code> and <code>''</code></li> <li>trailing spaces removed upon retrieval
<ul><li>no trailing space removal — <code>sql_mode</code> <code>PAD_CHAR_TO_FULL_LENGTH</code></li></ul></li> <li>when assigning size exceeded values — truncated with warning if not in strict mode, error in strict mode for truncation of non-space characters
<ul><li>excessive trailing spaces — truncated silently regardless of strict mode</li></ul></li> <li>variable-length off-page storage when ≥ 768 B — InnoDB encodes fixed-length fields greater than or equal to 768 bytes in length as variable-length fields, which can be stored off-page, for example, <code>CHAR(255)</code> with <code>utf8mb4</code></li></ul></li> <li><code>VARCHAR</code> — variable length with <code>M</code> from 0 to 65535, but actual effective maximum length subject to charset and maximum row size (65535 B)<div class="language- extra-class"><pre class="language-text"><code>VARCHAR(M) [CHARACTER SET charset_name] [COLLATE collation_name]
</code></pre></div><ul><li>length information — stored with length prefix, 1 or 2 byte</li> <li>when assigning size exceeded values — truncated with warning if not in strict mode, error in strict mode for truncation of non-space characters
<ul><li>excessive trailing spaces — truncated with warning regardless of strict mode</li></ul></li></ul></li> <li><code>MEDIUMTEXT</code>, and <code>LONGTEXT</code> — variable length up to: 16 MB, 4 GB<div class="language- extra-class"><pre class="language-text"><code>TINYTEXT [CHARACTER SET charset_name] [COLLATE collation_name]
</code></pre></div><ul><li><code>TINYTEXT</code>, <code>TEXT</code> — up to: 255 B, 65535 B; use <code>CHAR</code> and <code>VARCHAR</code> instead</li> <li><code>TEXT(M)</code> — creates the column as the smallest type large enough to hold values <code>M</code> bytes long</li> <li>length information — stored with length prefix</li> <li>when assigning size exceeded values — truncated with warning if not in strict mode, error in strict mode for truncation of non-space characters
<ul><li>excessive trailing spaces — truncated with warning regardless of strict mode</li></ul></li> <li>padded for index comparisons — index entry comparisons are space-padded at the end</li> <li>engine <code>MEMORY</code> does not support <code>TEXT</code> and <code>BLOB</code> — forced to use on-disk temporary tables when temporary tables with columns of these types being used</li> <li>separately allocated object — represented internally by a separately allocated object, whereas for all other data types storage is allocated once per column when the table is opened</li></ul></li> <li>binary strings
<ul><li><code>CHARACTER SET binary</code> make character strings binary — <code>CHAR</code> becomes <code>BINARY</code>, <code>VARCHAR</code> becomes <code>VARBINARY</code>, and <code>TEXT</code> becomes <code>BLOB</code></li> <li><code>BINARY[(M)]</code> — <code>CHAR CHARACTER SET binary</code>, <code>0x00</code> (<code>\0</code>) right padded, and as integral part of the value (being compared and no removal upon retrieval)</li> <li><code>VARBINARY(M)</code> — <code>VARCHAR</code> binary version</li> <li><code>MEDIUMBLOB</code>, <code>LONGBLOB</code> — no padded index comparisons
<ul><li><code>TINYBLOB</code>, <code>BLOB[(M)]</code></li></ul></li></ul></li> <li><code>ENUM</code> — a string object that can have only one value, can be <code>NULL</code> or the special <code>''</code> error value, up to 65535 distinct elements<div class="language- extra-class"><pre class="language-text"><code>ENUM('value1','value2',...) [CHARACTER SET charset_name] [COLLATE collation_name]
</code></pre></div><ul><li>ordinal — represented internally as integers starting from 1, <code>NULL</code> as <code>NULL</code> and <code>''</code> as 0</li> <li>maximum element length — <code>M &lt;= 255</code> and another constraint, where <code>M</code> is the element literal length</li></ul></li> <li><code>SET</code> — <code>ENUM</code> but a string object that can have zero or more values, <code>NULL</code> or <code>''</code> not permitted, and up to 64 distinct members
<ul><li>bit vectors internally</li> <li>literal — comma separated string, like <code>'a,b'</code></li></ul></li></ul></li> <li><p>spatial</p></li> <li><p>JSON</p></li></ol> <h2 id="Statements"><a href="#Statements" class="header-anchor">#</a> Statements</h2> <ol><li><p>statements</p> <ul><li>DDL — Data Definition Language</li> <li>DML — Data Manipulation Language</li> <li>TCL — Transaction Control Language</li> <li>DCL — Data Control Language, <code>GRANT</code>, <code>REVOKE</code></li></ul></li> <li><p><code>USE db_name</code> — use the named database as the default (current) database for subsequent statements</p> <ul><li>currently using — <code>DATABASE()</code></li></ul></li></ol> <h3 id="Inspection"><a href="#Inspection" class="header-anchor">#</a> Inspection</h3> <h4 id="SHOW"><a href="#SHOW" class="header-anchor">#</a> SHOW</h4> <ol><li><p><code>SHOW</code> — provide information about databases, tables, columns, or status information about the server</p> <ul><li>correspond to tables in <code>INFORMATION_SCHEMA</code> — <code>SELECT</code> corresponding tables yields the same result</li> <li><code>WHERE</code> clause — evaluated against the column names in the result</li></ul></li> <li><p>show server information</p> <ul><li><code>SHOW ENGINE</code></li> <li><code>SHOW VARIABLES</code> — see <a href="#System-Variables">System Variables</a></li> <li><code>SHOW CHARACTER SET</code> <ul><li>corresponding table in <code>INFORMATION_SCHEMA</code> — <code>INFORMATION_SCHEMA.CHARACTER_SETS</code></li> <li>hidden character set — <code>filename</code>, internal use only</li></ul></li></ul></li> <li><p>show database information</p> <ul><li><code>SHOW DATABASES</code>, <code>SHOW SCHEMAS</code> — lists the databases on the MySQL server host<div class="language- extra-class"><pre class="language-text"><code>SHOW {DATABASES | SCHEMAS}
    [LIKE 'pattern' | WHERE expr]
</code></pre></div><ul><li>CLI
<ul><li><code>mysqlshow</code></li> <li><code>mysql</code> option <code>--skip-show-database</code> — sets the <code>skip_show_database</code> system variable that controls who is permitted to use</li></ul></li> <li>corrsponding table in <code>INFORMATION_SCHEMA</code> — <code>INFORMATION_SCHEMA.SCHEMATA</code></li></ul></li> <li><code>SHOW CREATE DATABASE</code><div class="language- extra-class"><pre class="language-text"><code>SHOW CREATE {DATABASE | SCHEMA} [IF NOT EXISTS] db_name
</code></pre></div></li></ul></li> <li><p>show table information</p> <ul><li><code>SHOW TABLES</code> — lists the non-<code>TEMPORARY</code> tables in a given database<div class="language- extra-class"><pre class="language-text"><code>SHOW [EXTENDED] [FULL] TABLES
    [{FROM | IN} db_name]
    [LIKE 'pattern' | WHERE expr]
</code></pre></div><ul><li><code>EXTENDED</code> — list hidden tables prefixed with <code>#sq1</code> created by failed <code>ALTER TABLE</code> statements</li> <li><code>FULL</code> — an additional <code>Table_type</code> column, with values <code>BASE TABLE</code>, <code>VIEW</code> and <code>SYSTEM VIEW</code> (only for <code>INFORMATION_SCHEMA</code>)</li> <li>corresponding table in <code>INFORMATION_SCHEMA</code> — <code>INFORMATION_SCHEMA.TABLES</code></li> <li>CLI — <code>mysqlshow db_name</code></li></ul></li> <li><code>SHOW TABLE STATUS</code> — works likes <code>SHOW TABLES</code>, but provides a lot of information<div class="language- extra-class"><pre class="language-text"><code>SHOW TABLE STATUS
    [{FROM | IN} db_name]
    [LIKE 'pattern' | WHERE expr]
</code></pre></div><ul><li>CLI — <code>mysqlshow --status db_name command</code></li> <li>corresponding table in <code>INFORMATION_SCHEMA</code> — <code>INFORMATION_SCHEMA.TABLES</code></li></ul></li> <li><code>SHOW INDEX</code><div class="language- extra-class"><pre class="language-text"><code>SHOW [EXTENDED] {INDEX | INDEXES | KEYS}
    {FROM | IN} tbl_name
    [{FROM | IN} db_name]
    [WHERE expr]
</code></pre></div></li></ul></li> <li><p><code>SHOW COLUMNS</code></p> <div class="language- extra-class"><pre class="language-text"><code>SHOW [EXTENDED] [FULL] {COLUMNS | FIELDS}
    {FROM | IN} tbl_name
    [{FROM | IN} db_name]
    [LIKE 'pattern' | WHERE expr]
</code></pre></div><ul><li><code>EXTENDED</code> — include information about hidden columns that MySQL uses internally and are not accessible by users</li> <li><code>FULL</code> — include the column collation and comments, as well as the privileges</li> <li>corresponding table in <code>INFORMATION_SCHEMA</code> — <code>INFORMATION_SCHEMA.COLUMNS</code></li> <li>CLI — <code>mysqlshow db_name tbl_name</code></li> <li><code>SHOW CREATE TABLE</code><div class="language- extra-class"><pre class="language-text"><code>SHOW CREATE TABLE tbl_name
</code></pre></div></li> <li><code>EXPLAIN</code>, <code>DESCRIBE</code>, <code>DESC</code><div class="language- extra-class"><pre class="language-text"><code>{EXPLAIN | DESCRIBE | DESC}
    tbl_name [col_name | wild]
</code></pre></div></li></ul></li></ol> <h4 id="EXPLAIN"><a href="#EXPLAIN" class="header-anchor">#</a> EXPLAIN</h4> <ol><li><p><code>EXPLAIN</code>, <code>DESCRIBE</code>, <code>DESC</code></p> <ul><li>also can be used as <a href="#SHOW"><code>SHOW COLUMNS</code></a></li> <li>execution plan, usually <code>EXPLAIN</code> — displays information from the optimizer, i.e. how it would process the statement, including information about how tables are joined and in which order<div class="language- extra-class"><pre class="language-text"><code>{EXPLAIN | DESCRIBE | DESC}
    [FORMAT = {TRADITIONAL | JSON | TREE}]
    {explainable_stmt | FOR CONNECTION connection_id}
</code></pre></div><ul><li><code>explainable_stmt</code> — <code>SELECT</code>, <code>DELETE</code>, <code>INSERT</code>, <code>REPLACE</code>, and <code>UPDATE</code>; also <code>TABLE</code> from MySQL 8.0.19</li> <li><code>FOR CONNECTION connection_id</code> — the last statement in the named connection
<ul><li><code>connection_id</code> — <code>CONNECTION_ID()</code> for current session</li></ul></li> <li><code>FORMAT</code> <ul><li><code>TRADITIONAL</code> — tabular</li> <li><code>TREE</code> — the only format which shows hash join usage</li></ul></li> <li>ouput — see <a href="https://dev.mysql.com/doc/refman/8.0/en/explain-output.html#explain_ref" target="_blank" rel="noopener noreferrer">8.8.2 EXPLAIN Output Format<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <ul><li><code>type</code> (JSON name: <code>access_type</code>) in output, see docs for details
<ul><li><code>system</code>, <code>const</code></li> <li><code>eq_ref</code>, <code>unique_subquery</code></li> <li><code>ref</code>, <code>ref_or_null</code>, <code>index_subquery</code></li> <li><code>range</code> <code>index_merge</code></li> <li><code>index</code>, <code>ALL</code></li></ul></li></ul></li></ul></li> <li><code>EXPLAIN ANALYZE</code> — execution plan along with timing and additional, iterator-based, information about how the optimizer's expectations matched the actual execution<div class="language- extra-class"><pre class="language-text"><code>{EXPLAIN | DESCRIBE | DESC} ANALYZE select_statement
</code></pre></div><ul><li><code>select_statement</code> — besides <code>SELECT</code>, also multi-table <code>UPDATE</code> and <code>DELETE</code> statements; also <code>TABLE</code> from MySQL 8.0.19</li></ul></li></ul></li> <li><p>performance benchmark profiling</p> <ul><li>system variable <code>profiling</code><div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">SET</span> profiling<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> SQL_NO_CACHE <span class="token operator">*</span> <span class="token keyword">FROM</span> my_table<span class="token punctuation">;</span>
<span class="token comment">-- ...</span>
<span class="token keyword">SHOW</span> PROFILE<span class="token punctuation">;</span>
<span class="token keyword">SET</span> profiling<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><code>STATUS</code> starting with <code>Select</code><div class="language-SQL extra-class"><pre class="language-sql"><code>FLUSH <span class="token keyword">STATUS</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> SQL_NO_CACHE <span class="token operator">*</span> <span class="token keyword">FROM</span> my_table<span class="token punctuation">;</span>
<span class="token keyword">SHOW</span> <span class="token keyword">SESSION</span> <span class="token keyword">STATUS</span> <span class="token operator">LIKE</span> <span class="token string">'Select%'</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><code>STATUS</code> <code>last_query_cost</code><div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">SHOW</span> <span class="token keyword">STATUS</span> <span class="token operator">LIKE</span> <span class="token string">'last_query_cost'</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li> <li><p>select optimization</p> <ul><li>more tbd</li> <li>big query refactor
<ul><li>切分大查询 — 一个大查询如果一次性执行的话，可能一次锁住很多数据、占满整个事务日志、耗尽系统资源、阻塞很多小的但重要的查询。</li> <li>分解大连接查询 — 将一个大连接查询分解成对每一个表进行一次单表查询，然后在应用程序中进行关联，这样做的好处有：
<ul><li>让缓存更高效。对于连接查询，如果其中一个表发生变化，那么整个查询缓存就无法使用。而分解后的多个查询，即使其中一个表发生变化，对其它表的查询缓存依然可以使用。</li> <li>分解成多个单表查询，这些单表查询的缓存结果更可能被其它查询使用到，从而减少冗余记录的查询。</li> <li>减少锁竞争；</li> <li>在应用层进行连接，可以更容易对数据库进行拆分，从而更容易做到高性能和可伸缩。</li></ul></li></ul></li></ul></li></ol> <h3 id="DDL"><a href="#DDL" class="header-anchor">#</a> DDL</h3> <ol><li>DDL statements, atomic or otherwise, implicitly end any transaction that is active in the current session</li></ol> <h4 id="CREATE-TABLE"><a href="#CREATE-TABLE" class="header-anchor">#</a> CREATE TABLE</h4> <ol><li><p><code>CREATE TABLE</code></p> <div class="language- extra-class"><pre class="language-text"><code>CREATE [TEMPORARY] TABLE [IF NOT EXISTS] tbl_name
    (create_definition,...)
    [table_options]
    [partition_options]
</code></pre></div><ul><li><code>TEMPORARY</code> — tbd, temporary tables kept until the end of transaction or session</li> <li><code>table_options</code><div class="language- extra-class"><pre class="language-text"><code>table_option [[,] table_option] ...
</code></pre></div><ul><li><code>table_option</code> <ul><li><code>AUTO_INCREMENT [=] value</code></li> <li><code>COMMENT [=] 'string'</code></li> <li>more</li></ul></li></ul></li> <li>more</li></ul></li> <li><p><code>create_definition</code> in <code>CREATE TABLE</code>, <code>ALTER TABLE</code></p> <div class="language- extra-class"><pre class="language-text"><code>  col_name column_definition
| {INDEX|KEY} [index_name] [index_type] (key_part,...)
    [index_option] ...
| {FULLTEXT|SPATIAL} [INDEX|KEY] [index_name] (key_part,...)
    [index_option] ...
| [CONSTRAINT [symbol]] PRIMARY KEY
    [index_type] (key_part,...)
    [index_option] ...
| [CONSTRAINT [symbol]] UNIQUE [INDEX|KEY]
    [index_name] [index_type] (key_part,...)
    [index_option] ...
| [CONSTRAINT [symbol]] FOREIGN KEY
    [index_name] (col_name,...)
    reference_definition
| check_constraint_definition
</code></pre></div><ul><li>syntax — column definition with constraint attributes or a sole constraint or index definition</li> <li><code>key_part</code> — <code>{col_name [(length)] | (expr)} [ASC | DESC]</code>, order matters
<ul><li><code>length</code> — up to 767 bytes long for InnoDB tables that use the <code>REDUNDANT</code> or <code>COMPACT</code> row format, 3072 bytes for <code>DYNAMIC</code> or <code>COMPRESSED</code> row format</li></ul></li> <li><code>check_constraint_definition</code> — also used in <code>column_definition</code><div class="language- extra-class"><pre class="language-text"><code>[CONSTRAINT [symbol]] CHECK (expr) [[NOT] ENFORCED]
</code></pre></div></li></ul></li> <li><p><code>column_definition</code> in <code>CREATE TABLE</code>, <code>ALTER TABLE</code></p> <ul><li>vanilla column<div class="language- extra-class"><pre class="language-text"><code>data_type [NOT NULL | NULL] [DEFAULT {literal | (expr)} ]
  [AUTO_INCREMENT] [UNIQUE [KEY]] [[PRIMARY] KEY]
  [COMMENT 'string']
  [COLLATE collation_name]
  [COLUMN_FORMAT {FIXED|DYNAMIC|DEFAULT}]
  [STORAGE {DISK|MEMORY}]
  [reference_definition]
  [check_constraint_definition]
</code></pre></div></li> <li>generated column — support secondary indexes and partition but not subqueries, stored procedures and more<div class="language- extra-class"><pre class="language-text"><code>data_type
  [COLLATE collation_name]
  [GENERATED ALWAYS] AS (expr)
  [VIRTUAL | STORED] [NOT NULL | NULL]
  [UNIQUE [KEY]] [[PRIMARY] KEY]
  [COMMENT 'string']
  [reference_definition]
  [check_constraint_definition]
</code></pre></div><ul><li>example — <code>col1 LIKE '%xxx'</code> dose not use index search, create a reversed generated column to utilize index: <code>loc1 VARCHAR(200) GENERATED ALWAYS AS (REVERSE(col1))</code>, create index on this generated column to hit index with <code>loc1 LIKE REVERSE('%xxx')</code></li></ul></li></ul></li> <li><p>key/index creation options</p> <div class="language- extra-class"><pre class="language-text"><code>index_type:
    USING {BTREE | HASH}
index_option:
    KEY_BLOCK_SIZE [=] value
  | index_type
  | WITH PARSER parser_name
  | COMMENT 'string'
  | {VISIBLE | INVISIBLE}
</code></pre></div><ul><li><code>KEY | INDEX</code> — as index</li> <li><code>PRIMARY KEY</code> — implicitly <code>NOT NULL</code>, name is <code>PRIMARY</code></li> <li><code>UNIQUE [INDEX|KEY]</code> — error when duplicate</li> <li><code>FOREIGN KEY</code> — only InnoDB and NDB tables support checking of foreign key constraints<div class="language- extra-class"><pre class="language-text"><code>reference_definition:
    REFERENCES tbl_name (col_name,...)
    [ON DELETE reference_option]
    [ON UPDATE reference_option]
reference_option:
    RESTRICT | CASCADE | SET NULL | NO ACTION
</code></pre></div><ul><li>switch — system variable <code>foreign_key_checks</code></li> <li><code>CASCADE</code> — delete or update from the parent table is cascaded to the matching rows in the child table; cascaded actions do not activate triggers</li> <li><code>SET NULL</code> — literally</li> <li><code>RESTRICT</code> or <code>NO ACTION</code> (default) — rejects the delete or update operation for the parent table if there is a related foreign key value in the referenced table</li> <li>corresponding tables in <code>INFORMATION_SCHEMA</code> — <code>INFORMATION_SCHEMA.KEY_COLUMN_USAGE</code>, <code>INFORMATION_SCHEMA.INNODB_FOREIGN</code>, <code>INFORMATION_SCHEMA.INNODB_FOREIGN_COLS</code></li></ul></li> <li><code>FULLTEXT</code>, <code>SPATIAL</code> keys — tbd</li> <li>inspect — <a href="#SHOW"><code>SHOW INDEX</code></a></li></ul></li></ol> <h4 id="ALTER-TABLE-DROP-TABLE"><a href="#ALTER-TABLE-DROP-TABLE" class="header-anchor">#</a> ALTER TABLE, DROP TABLE</h4> <ol><li><p><code>ALTER TABLE</code></p> <div class="language- extra-class"><pre class="language-text"><code>ALTER TABLE tbl_name
    [alter_specification [, alter_specification] ...]
    [partition_options]
</code></pre></div><ul><li><code>alter_specification</code> — one of below, see docs
<ul><li><code>table_options</code></li> <li>add
<ul><li>add column<div class="language- extra-class"><pre class="language-text"><code>  ADD [COLUMN] col_name column_definition [FIRST | AFTER col_name]
| ADD [COLUMN] (col_name column_definition,...)
</code></pre></div></li> <li>add index key<div class="language- extra-class"><pre class="language-text"><code>  ADD {INDEX|KEY} [index_name] [index_type] (key_part,...) [index_option] ...
| ADD [CONSTRAINT [symbol]] PRIMARY KEY [index_type] (key_part,...) [index_option] ...
| ADD [CONSTRAINT [symbol]] UNIQUE [INDEX|KEY] [index_name] [index_type] (key_part,...) [index_option] ...
| ADD [CONSTRAINT [symbol]] FOREIGN KEY [index_name] (col_name,...) reference_definition
</code></pre></div></li></ul></li> <li>delete<div class="language- extra-class"><pre class="language-text"><code>  DROP {CHECK|CONSTRAINT} symbol
| DROP [COLUMN] col_name
| DROP {INDEX|KEY} index_name
| DROP PRIMARY KEY
| DROP FOREIGN KEY fk_symbol
</code></pre></div></li></ul></li></ul></li> <li><p><code>DROP TABLE</code></p> <ul><li><code>TRUNCATE [TABLE] tbl_name</code> — empties a table completely, no trigger</li></ul></li></ol> <h4 id="CREATE-VIEW-PROCEDURE-FUNCTION-TRIGGER"><a href="#CREATE-VIEW-PROCEDURE-FUNCTION-TRIGGER" class="header-anchor">#</a> CREATE VIEW, PROCEDURE, FUNCTION, TRIGGER</h4> <ol><li><p><code>CREATE VIEW</code></p> <div class="language- extra-class"><pre class="language-text"><code>CREATE
    [OR REPLACE]
    [ALGORITHM = {UNDEFINED | MERGE | TEMPTABLE}]
    [DEFINER = user]
    [SQL SECURITY { DEFINER | INVOKER }]
    VIEW view_name [(column_list)]
    AS select_statement
    [WITH [CASCADED | LOCAL] CHECK OPTION]
</code></pre></div><ul><li><code>OR REPLACE</code> — literally</li> <li>frozen after creation — for a <code>SELECT *</code> view on a table, new columns added to the table are unknown to the view, and errors when selecting from the view if relevent columns dropped from the table</li> <li>updatable and insertable views — see docs</li> <li>more</li></ul></li> <li><p><code>CREATE PROCEDURE</code></p> <div class="language- extra-class"><pre class="language-text"><code>CREATE
    [DEFINER = user]
    PROCEDURE sp_name ([proc_parameter[,...]])
    [characteristic ...] routine_body
</code></pre></div><ul><li><code>CURSOR</code> — MySQL supports cursors inside stored programs</li></ul></li> <li><p><code>CREATE FUNCTION</code></p> <div class="language- extra-class"><pre class="language-text"><code>CREATE
    [DEFINER = user]
    FUNCTION sp_name ([func_parameter[,...]])
    RETURNS type
    [characteristic ...] routine_body
</code></pre></div></li> <li><p><code>CREATE TRIGGER</code></p></li></ol> <h3 id="DML"><a href="#DML" class="header-anchor">#</a> DML</h3> <h4 id="SELECT"><a href="#SELECT" class="header-anchor">#</a> SELECT</h4> <ol><li><p><code>SELECT</code></p> <div class="language- extra-class"><pre class="language-text"><code>SELECT
    [ALL | DISTINCT | DISTINCTROW ]
    [other_modifiers]
  select_expr [, select_expr] ...
    [FROM table_references [PARTITION partition_list]]
    [WHERE where_condition]
    [GROUP BY {col_name | expr | position}, ... [WITH ROLLUP]]
    [HAVING where_condition]
    [WINDOW window_name AS (window_spec) [, window_name AS (window_spec)] ...]
    [ORDER BY {col_name | expr | position} [ASC | DESC], ... [WITH ROLLUP]]
    [LIMIT {[offset,] row_count | row_count OFFSET offset}]
    [FOR {UPDATE | SHARE} [OF tbl_name [, tbl_name] ...]
        [NOWAIT | SKIP LOCKED] | LOCK IN SHARE MODE]
    [into_option]
</code></pre></div><ul><li>in CTE — <code>SELECT</code> can start with a <code>WITH</code> clause to define common table expressions accessible within the <code>SELECT</code></li> <li>modifiers — affect the operation of the statement
<ul><li><code>ALL</code> (default), <code>DISTINCT</code> — <code>DISTINCT</code> implicitly sorts the data, <code>DISTINCTROW</code> is an alias</li> <li><code>other_modifiers</code> tbd, modifiers beginning with <code>SQL_</code> are MySQL extensions — <code>HIGH_PRIORITY</code>, <code>STRAIGHT_JOIN</code>, <code>SQL_SMALL_RESULT</code>, <code>SQL_BIG_RESULT</code>, <code>SQL_BUFFER_RESULT</code>, <code>SQL_NO_CACHE</code>, <code>SQL_CALC_FOUND_ROWS</code></li></ul></li> <li><code>position</code> — column index, non-standard, deprecated</li> <li><code>FOR UPDATE</code>, <code>FOR SHARE</code> — locking reads</li></ul></li> <li><p><code>select_expr</code> in <code>SELECT</code> — the select list that indicates which columns to retrieve</p> <div class="language- extra-class"><pre class="language-text"><code>col_name [[AS] alias_name]
</code></pre></div><ul><li><code>col_name</code> — <code>col_name</code>, <code>tbl_name.col_name</code>, or <code>db_name.tbl_name.col_name</code>, <code>*</code>, <code>tbl_name.*</code> <ul><li>single <code>*</code> — all columns from all tables, probable error when used with other items</li> <li><code>tbl_name.*</code> — all columns from the named table</li></ul></li> <li>alias and position scope — can be used in <code>GROUP BY</code>, <code>ORDER BY</code>, or <code>HAVING</code> clauses, but cannot be used in <code>WHERE</code> clause, because the column value might not yet be determined when the <code>WHERE</code> clause is executed<div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> college<span class="token punctuation">,</span> region <span class="token keyword">AS</span> r<span class="token punctuation">,</span> seed <span class="token keyword">AS</span> s <span class="token keyword">FROM</span> tournament <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> r<span class="token punctuation">,</span> s<span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> college<span class="token punctuation">,</span> region<span class="token punctuation">,</span> seed <span class="token keyword">FROM</span> tournament <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><code>OVER</code> — see <a href="#WINDOW"><code>WINDOW</code></a></li></ul></li> <li><p><code>into_option</code> in <code>SELECT</code>, <code>INTO</code></p> <div class="language- extra-class"><pre class="language-text"><code>{
    INTO OUTFILE 'file_name' [CHARACTER SET charset_name] export_options
  | INTO DUMPFILE 'file_name'
  | INTO var_name [, var_name] ...
}
</code></pre></div><ul><li><code>var_list</code> — the number of variables must match the number of columns; the query should return a single row</li> <li><code>OUTFILE</code></li> <li><code>DUMPFILE</code> — writes a single row to a file without any formatting</li> <li>more</li></ul></li> <li><p>execution order — below is gross, the actual subject to optimizer</p> <div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">SET</span> <span class="token variable">@mysql_order</span> :<span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token variable">@mysql_order</span> :<span class="token operator">=</span> CONCAT<span class="token punctuation">(</span><span class="token variable">@mysql_order</span><span class="token punctuation">,</span><span class="token string">&quot; SELECT &quot;</span><span class="token punctuation">)</span>
<span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token variable">@mysql_order</span> :<span class="token operator">=</span> CONCAT<span class="token punctuation">(</span><span class="token variable">@mysql_order</span><span class="token punctuation">,</span><span class="token string">&quot; FROM &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> t1
    <span class="token keyword">JOIN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token variable">@mysql_order</span> :<span class="token operator">=</span> CONCAT<span class="token punctuation">(</span><span class="token variable">@mysql_order</span><span class="token punctuation">,</span><span class="token string">&quot; JOIN1 &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> t <span class="token keyword">ON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token variable">@mysql_order</span> :<span class="token operator">=</span> CONCAT<span class="token punctuation">(</span><span class="token variable">@mysql_order</span><span class="token punctuation">,</span><span class="token string">&quot; ON1 &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">JOIN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token variable">@mysql_order</span> :<span class="token operator">=</span> CONCAT<span class="token punctuation">(</span><span class="token variable">@mysql_order</span><span class="token punctuation">,</span><span class="token string">&quot; JOIN2 &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> t2 <span class="token keyword">ON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token variable">@mysql_order</span> :<span class="token operator">=</span> CONCAT<span class="token punctuation">(</span><span class="token variable">@mysql_order</span><span class="token punctuation">,</span><span class="token string">&quot; ON2 &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">WHERE</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token variable">@mysql_order</span> :<span class="token operator">=</span> CONCAT<span class="token punctuation">(</span><span class="token variable">@mysql_order</span><span class="token punctuation">,</span><span class="token string">&quot; WHERE &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token variable">@mysql_order</span> :<span class="token operator">=</span> CONCAT<span class="token punctuation">(</span><span class="token variable">@mysql_order</span><span class="token punctuation">,</span><span class="token string">&quot; GROUP_BY &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">HAVING</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token variable">@mysql_order</span> :<span class="token operator">=</span> CONCAT<span class="token punctuation">(</span><span class="token variable">@mysql_order</span><span class="token punctuation">,</span><span class="token string">&quot; HAVING &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token variable">@mysql_order</span> :<span class="token operator">=</span> CONCAT<span class="token punctuation">(</span><span class="token variable">@mysql_order</span><span class="token punctuation">,</span><span class="token string">&quot; ORDER_BY &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token variable">@mysql_order</span><span class="token punctuation">;</span>
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>FROM  JOIN1  JOIN2  WHERE  ON2  ON1  SELECT  ORDER_BY  GROUP_BY  HAVING
</code></pre></div><ul><li>execution order defined in ANSI SQL — <code>FROM</code>, <code>WHERE</code>, <code>GROUP BY</code>, <code>HAVING</code>, <code>SELECT</code>, <code>ORDER BY</code></li></ul></li></ol> <h5 id="FROM-JOIN"><a href="#FROM-JOIN" class="header-anchor">#</a> FROM, JOIN</h5> <ol><li><p><code>FROM</code> — the table or tables from which to retrieve rows</p> <div class="language- extra-class"><pre class="language-text"><code>[FROM table_references [PARTITION partition_list]]
</code></pre></div><ul><li><code>PARTITION</code> — partition selection</li> <li><code>table_references</code><div class="language- extra-class"><pre class="language-text"><code>table_reference [, table_reference] ...
</code></pre></div></li></ul></li> <li><p><code>table_reference</code> in <code>FROM</code>, simplified</p> <div class="language- extra-class"><pre class="language-text"><code>tbl_name [[AS] alias] [index_hint_list]
</code></pre></div><ul><li><code>tbl_name</code> — <code>tbl_name</code>, or <code>db_name.tbl_name</code> <ul><li>derived tables<div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> first_name<span class="token punctuation">,</span> last_name<span class="token punctuation">,</span> email
 <span class="token keyword">FROM</span> customer <span class="token keyword">WHERE</span> first_name <span class="token operator">=</span> <span class="token string">'JESSIE'</span>
<span class="token punctuation">)</span> <span class="token keyword">AS</span> cust<span class="token punctuation">;</span>
</code></pre></div></li></ul></li> <li><code>JOIN</code> — join if more than one table specified</li> <li><code>DUAL</code> — dummy table name, for rows computed without reference to any table</li> <li><code>index_hint_list</code> — give the optimizer information about how to choose indexes during query processing</li></ul></li> <li><p><code>table_reference</code> in <code>FROM</code></p> <div class="language- extra-class"><pre class="language-text"><code>table_factor | joined_table
</code></pre></div><ul><li><code>table_factor</code><div class="language- extra-class"><pre class="language-text"><code>tbl_name [PARTITION (partition_names)]
    [[AS] alias] [index_hint_list]
| table_subquery [AS] alias [(col_list)]
| ( table_references )
</code></pre></div><ul><li><code>( table_references )</code> — MySQL extension to allow a list instead of a single <code>table_reference</code>, each comma is considered as equivalent to an inner join</li> <li><code>index_hint_list</code><div class="language- extra-class"><pre class="language-text"><code>index_hint_list:
    index_hint [, index_hint] ...
index_hint:
    USE {INDEX|KEY}
      [FOR {JOIN|ORDER BY|GROUP BY}] ([index_list])
  | {IGNORE|FORCE} {INDEX|KEY}
      [FOR {JOIN|ORDER BY|GROUP BY}] (index_list)
index_list:
    index_name [, index_name] ...
</code></pre></div></li> <li><code>col_list</code> — a list of names for the derived table columns</li></ul></li></ul></li> <li><p><code>joined_table</code> in <code>table_reference</code></p> <div class="language- extra-class"><pre class="language-text"><code>joined_table:
    table_reference {[INNER | CROSS] JOIN | STRAIGHT_JOIN} table_factor [join_specification]
  | table_reference LEFT [OUTER] JOIN table_reference join_specification
  | table_reference NATURAL [INNER | LEFT [OUTER]] JOIN table_factor
</code></pre></div><ul><li>special joins
<ul><li>tables joined multiple times — use alias for name resolving</li> <li>self joins — when self-referencing foreign keys exist, like a prequel column in a film table</li></ul></li> <li>cross join or inner join, order of <code>table_reference</code> or <code>table_factor</code> does not matter
<ul><li><code>CROSS JOIN</code> — Cartesian product, all permutations, no <code>join_specification</code></li> <li><code>INNER JOIN</code> — only matches matching <code>join_specification</code>, multiple records if multiple matches</li> <li>MySQL extension — <code>JOIN</code>, <code>INNER JOIN</code>, <code>CROSS JOIN</code> are equivalent syntactically, although not semantically</li> <li><code>STRAIGHT_JOIN</code> — like <code>JOIN</code>, but the left table is always read before the right table</li></ul></li> <li><code>LEFT [OUTER] JOIN</code> — <code>NULL</code> if no matching</li> <li><code>NATURAL [...] JOIN</code> — equivalent to an <code>INNER JOIN</code> or a <code>LEFT JOIN</code> with a <code>USING</code> clause that names all columns that exist in both tables</li> <li><code>join_specification</code><div class="language- extra-class"><pre class="language-text"><code>ON search_condition | USING (join_column_list)
</code></pre></div><ul><li><code>search_condition</code> — filtering like <code>WHERE</code></li> <li><code>join_column_list</code> — list of columns that must exist in both tables<div class="language- extra-class"><pre class="language-text"><code>column_name [, column_name] ...
</code></pre></div></li> <li><code>USING</code> vs <code>ON</code> — <code>USING</code> with redundant column elimination, <code>ON</code> without
<ul><li>redundant column elimination — by <code>COALESCE()</code> columns with the same name, as in outer joins <code>NULL</code> if no matching<div class="language- extra-class"><pre class="language-text"><code>COALESCE(a.c1, b.c1), COALESCE(a.c2, b.c2), COALESCE(a.c3, b.c3)
a.c1, a.c2, a.c3, b.c1, b.c2, b.c3
</code></pre></div></li></ul></li></ul></li></ul></li></ol> <h5 id="UNION"><a href="#UNION" class="header-anchor">#</a> UNION</h5> <ol><li><p><code>UNION</code></p> <div class="language- extra-class"><pre class="language-text"><code>SELECT ...
UNION [ALL | DISTINCT] SELECT ...
[UNION [ALL | DISTINCT] SELECT ...]
</code></pre></div><ul><li>order — unordered, intermediate <code>ORDER BY</code> are optimized out when without <code>LIMIT</code></li> <li>column name and type — names taken from the first <code>SELECT</code>; corresponding columns should be the same type, otherwise determined by all values of the column</li> <li><code>ALL</code> or <code>DISTINCT</code> — <code>DISTINCT</code> by default, duplicate rows removed; when mixed, a <code>DISTINCT</code> union overrides any <code>ALL</code> union to its left</li> <li>additional column — help determine which <code>SELECT</code> each row comes from, and by which optionally order<div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token number">1</span> <span class="token keyword">AS</span> sort_col<span class="token punctuation">,</span> col1a<span class="token punctuation">,</span> col1b<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">FROM</span> t1<span class="token punctuation">)</span>
<span class="token keyword">UNION</span>
<span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token number">2</span><span class="token punctuation">,</span> col2a<span class="token punctuation">,</span> col2b<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">FROM</span> t2<span class="token punctuation">)</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> sort_col<span class="token punctuation">;</span>
</code></pre></div></li></ul></li> <li><p><code>INTERSECT</code> — ANSI SQL but not in MySQL</p></li> <li><p><code>EXCEPT</code> — ANSI SQL but not in MySQL</p></li></ol> <h4 id="Filtering-Ordering-Grouping-Limiting"><a href="#Filtering-Ordering-Grouping-Limiting" class="header-anchor">#</a> Filtering, Ordering, Grouping, Limiting</h4> <ol><li><p><code>WHERE</code> <code>where_condition</code> — an expression that evaluates to true for each row to be selected</p> <ul><li>no aggregate functions — can use any of the functions and operators, except for aggregate (summary) functions</li> <li>see <a href="#Operators-and-Functions">Operators and Functions</a></li></ul></li> <li><p><code>GROUP BY</code>, <code>ORDER BY</code></p> <div class="language- extra-class"><pre class="language-text"><code>[GROUP BY {col_name | expr | position}, ... [WITH ROLLUP]]
[ORDER BY {col_name | expr | position} [ASC | DESC], ... [WITH ROLLUP]]
</code></pre></div><ul><li><code>ORDER BY</code> — defaults to <code>ACS</code>, outermost one take precedence if used in nested multiple subqueries
<ul><li>resolve unqualified column or alias — by searching in the <code>select_expr</code> values, then in the columns of the tables in the <code>FROM</code> clause</li></ul></li> <li><code>GROUP BY</code> <ul><li>resolve unqualified column or alias — reverse order of <code>ORDER BY</code></li> <li>implicit groups — all rows as a implicit group when no <code>GROUP BY</code> clause present</li> <li><code>sql_mode</code> <code>ONLY_FULL_GROUP_BY</code> — reject queries for which the select list, <code>HAVING</code> condition, or <code>ORDER BY</code> list refer to non-aggregated columns that are neither named in the <code>GROUP BY</code> clause nor are functionally dependent on (uniquely determined by) <code>GROUP BY</code> columns</li> <li><code>ANY_VALUE(arg)</code> — suppress the test for nondeterminism, equivalent to disable <code>sql_mode</code> <code>ONLY_FULL_GROUP_BY</code>; use when a selected non-aggregated column is effectively functionally dependent on a <code>GROUP BY</code> column by MySQL cannot determine it</li> <li><code>WITH ROLLUP</code> — produce another (super-aggregate) row for each <code>GROUP BY</code> column<div class="language- extra-class"><pre class="language-text"><code>mysql&gt; SELECT year, SUM(profit) AS profit
       FROM sales
       GROUP BY year WITH ROLLUP;
+------+--------+
| year | profit |
+------+--------+
| 2000 |   4525 |
| 2001 |   3010 |
| NULL |   7535 |
+------+--------+
</code></pre></div><ul><li>name super-aggregate row — <code>GROUPING(expr [, expr] ...)</code> return a bit vector, big endian, 1 when super-aggregate<div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span>
  <span class="token keyword">IF</span><span class="token punctuation">(</span>GROUPING<span class="token punctuation">(</span><span class="token keyword">year</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'All years'</span><span class="token punctuation">,</span> <span class="token keyword">year</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token keyword">year</span><span class="token punctuation">,</span>
  <span class="token keyword">IF</span><span class="token punctuation">(</span>GROUPING<span class="token punctuation">(</span>country<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'All countries'</span><span class="token punctuation">,</span> country<span class="token punctuation">)</span> <span class="token keyword">AS</span> country<span class="token punctuation">,</span>
  <span class="token keyword">IF</span><span class="token punctuation">(</span>GROUPING<span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'All products'</span><span class="token punctuation">,</span> product<span class="token punctuation">)</span> <span class="token keyword">AS</span> product<span class="token punctuation">,</span>
  <span class="token function">SUM</span><span class="token punctuation">(</span>profit<span class="token punctuation">)</span> <span class="token keyword">AS</span> profit
<span class="token keyword">FROM</span> sales
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">year</span><span class="token punctuation">,</span> country<span class="token punctuation">,</span> product <span class="token keyword">WITH ROLLUP</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li> <li>no aggregation in <code>SELECT</code> clause — return first row of a group<div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> Email <span class="token keyword">FROM</span> Person <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> Email <span class="token keyword">HAVING</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>Email<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li> <li><code>max_sort_length</code> system variable — only <code>max_sort_length</code> bytes compared, defaults to 1024 bytes</li></ul></li> <li><p><code>HAVING</code></p> <div class="language- extra-class"><pre class="language-text"><code>[HAVING where_condition]
</code></pre></div><ul><li>for filter after <code>GROUP BY</code> — must reference only columns in the <code>GROUP BY</code> clause or columns used in aggregate functions
<ul><li>extended in MySQL — permits <code>HAVING</code> to refer to columns in the <code>SELECT</code> list and columns in outer subqueries as well</li> <li>applied nearly last (before <code>LIMIT</code>), with no optimization</li></ul></li></ul></li> <li><p><code>LIMIT</code> — outermost one take precedence if used in nested multiple subqueries</p> <div class="language- extra-class"><pre class="language-text"><code>[LIMIT {[offset,] row_count | row_count OFFSET offset}]
</code></pre></div><ul><li><code>offset</code> — use 0 to include first row</li> <li>up to end — use a large number <code>row_count</code></li></ul></li></ol> <h5 id="WINDOW"><a href="#WINDOW" class="header-anchor">#</a> WINDOW</h5> <ol><li><p><code>WINDOW</code> — windows for window functions</p> <ul><li><code>WINDOW</code> clause in <code>SELECT</code><div class="language- extra-class"><pre class="language-text"><code>[WINDOW window_name AS (window_spec) [, window_name AS (window_spec)] ...]
</code></pre></div></li> <li><code>over_clause</code> in aggregation and window functions<div class="language- extra-class"><pre class="language-text"><code>over_clause:
    {OVER (window_spec) | OVER window_name}
</code></pre></div><ul><li><code>window_spec</code><div class="language- extra-class"><pre class="language-text"><code>window_spec:
    [window_name] [partition_clause] [order_clause] [frame_clause]
</code></pre></div><ul><li>empty — all rows</li> <li><code>partition_clause</code> — like <code>GROUP BY</code>, differs from table partitioning<div class="language- extra-class"><pre class="language-text"><code>PARTITION BY expr [, expr] ...
</code></pre></div></li> <li><code>order_clause</code> — applies within individual partitions<div class="language- extra-class"><pre class="language-text"><code>ORDER BY expr [ASC|DESC] [, expr [ASC|DESC]] ...
</code></pre></div></li> <li><code>frame_clause</code> — a subset of the current partition, see below</li></ul></li></ul></li></ul></li> <li><p><code>frame_clause</code> — a subset of the current partition, enabling move within a partition depending on the location of the current row</p> <div class="language- extra-class"><pre class="language-text"><code>frame_clause:
    frame_units frame_extent
</code></pre></div><ul><li>limitation — some window functions operate on the entire partition, frames are ignored for them</li> <li><code>frame_units</code><div class="language- extra-class"><pre class="language-text"><code>{ROWS | RANGE}
</code></pre></div><ul><li><code>ROWS</code> — the frame is defined by beginning and ending row positions</li> <li><code>RANGE</code> — the frame is defined by rows within a value range</li></ul></li> <li><code>frame_extent</code><div class="language- extra-class"><pre class="language-text"><code>frame_extent:
    {frame_start | BETWEEN frame_start AND frame_end}
frame_start, frame_end: {
    CURRENT ROW
  | UNBOUNDED PRECEDING
  | UNBOUNDED FOLLOWING
  | expr PRECEDING
  | expr FOLLOWING
}
</code></pre></div><ul><li>single <code>frame_start</code> — <code>CURRENT ROW</code> is implicitly the end</li> <li><code>BETWEEN</code> — <code>frame_start</code> must not occur later than <code>frame_end</code></li></ul></li> <li>default frame depends on <code>ORDER BY</code> <ul><li>with <code>ORDER BY</code><div class="language- extra-class"><pre class="language-text"><code>RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
</code></pre></div></li> <li>without <code>ORDER BY</code><div class="language- extra-class"><pre class="language-text"><code>RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
</code></pre></div></li></ul></li> <li>example<div class="language- extra-class"><pre class="language-text"><code>ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING
</code></pre></div></li></ul></li> <li><p>example</p> <div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span>
  val<span class="token punctuation">,</span>
  ROW_NUMBER<span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token keyword">OVER</span> w <span class="token keyword">AS</span> <span class="token string">'row_number'</span><span class="token punctuation">,</span>
  CUME_DIST<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">OVER</span> w <span class="token keyword">AS</span> <span class="token string">'cume_dist'</span><span class="token punctuation">,</span>
  PERCENT_RANK<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> w <span class="token keyword">AS</span> <span class="token string">'percent_rank'</span><span class="token punctuation">,</span>
  <span class="token function">SUM</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>       <span class="token keyword">OVER</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> total_profit
<span class="token keyword">FROM</span> numbers
WINDOW w <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ol> <h4 id="Subqueries"><a href="#Subqueries" class="header-anchor">#</a> Subqueries</h4> <ol><li><p>subqueries</p> <ul><li>return type — scalar, column, row, and table</li> <li>parentheses — even in functions, like <code>UPPER((SELECT s1 FROM t1))</code></li> <li>correlated subquery — a subquery that contains a reference to a table that also appears in the outer query</li> <li>limitations — see docs</li></ul></li> <li><p>row constructors — <code>(1, 2)</code> or <code>ROW(1, 2)</code>, scalar if only one column</p></li> <li><p>comparaison subqueries</p> <ul><li>subquery type when no modifiers — correspondent. For a comparison of the subquery to a scalar, the subquery must return a scalar. For a comparison of the subquery to a row constructor, the subquery must be a row subquery that returns a row with the same number of values as the row constructor<div class="language- extra-class"><pre class="language-text"><code>non_subquery_operand comparison_operator (subquery)
</code></pre></div><ul><li><code>NULL</code> when empty</li></ul></li> <li><code>ANY</code>, <code>IN</code>, <code>SOME</code><div class="language- extra-class"><pre class="language-text"><code>operand comparison_operator { ANY | SOME } (subquery)
operand IN (subquery)
</code></pre></div></li> <li><code>ALL</code> — <code>TRUE</code> when empty subquery, <code>UNKNOWN</code> when containing <code>NULL</code><div class="language- extra-class"><pre class="language-text"><code>operand comparison_operator ALL (subquery)
</code></pre></div><ul><li><code>NULL</code> when empty and aggregated<div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> t1 <span class="token keyword">WHERE</span> <span class="token number">1</span> <span class="token operator">&gt;</span> <span class="token keyword">ALL</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token keyword">FROM</span> t2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li></ul></li> <li><p><code>EXISTS</code> or <code>NOT EXISTS</code> — whether a subquery is empty</p> <ul><li>example: What kind of store is present in all cities?<div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> store_type <span class="token keyword">FROM</span> stores s1
  <span class="token keyword">WHERE</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> cities <span class="token keyword">WHERE</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">(</span>
      <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> cities_stores
       <span class="token keyword">WHERE</span> cities_stores<span class="token punctuation">.</span>city <span class="token operator">=</span> cities<span class="token punctuation">.</span>city
<span class="token operator">AND</span> cities_stores<span class="token punctuation">.</span>store_type <span class="token operator">=</span> stores<span class="token punctuation">.</span>store_type<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li> <li><p>derived table</p> <div class="language- extra-class"><pre class="language-text"><code>SELECT ... FROM (subquery) [AS] tbl_name [(col_list)] ...
</code></pre></div><ul><li>alias — mandatory, because every table in a <code>FROM</code> clause must have a name</li> <li><code>col_list</code> — names for the derived table, must cover all columns</li> <li>limitation — prior to MySQL 8.0.14, a derived table cannot contain outer references</li> <li>example<div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> Num <span class="token keyword">as</span> <span class="token string">'ConsecutiveNums'</span> <span class="token keyword">from</span>
    <span class="token punctuation">`</span>Logs<span class="token punctuation">`</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token variable">@cnt</span> :<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">@prev</span> :<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">as</span> _init
<span class="token keyword">where</span> <span class="token punctuation">(</span><span class="token variable">@cnt</span> :<span class="token operator">=</span> <span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token variable">@prev</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">@prev</span> :<span class="token operator">=</span> Num<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">@cnt</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><code>LATERAL</code> — can refer to columns from other tables, “this derived table depends on previous tables on its left side”
<ul><li>example — solve the problem that max value would be calculated twice if using subqueries in <code>SELECT</code> clause, because a subquery in <code>SELECT</code> clause can only produce one column<div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span>
  salesperson<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
  max_sale<span class="token punctuation">.</span>amount<span class="token punctuation">,</span>
  max_sale_customer<span class="token punctuation">.</span>customer_name
<span class="token keyword">FROM</span>
  salesperson<span class="token punctuation">,</span>
  <span class="token comment">-- calculate maximum size, cache it in transient derived table max_sale</span>
  LATERAL
  <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span> <span class="token keyword">AS</span> amount
    <span class="token keyword">FROM</span> all_sales
    <span class="token keyword">WHERE</span> all_sales<span class="token punctuation">.</span>salesperson_id <span class="token operator">=</span> salesperson<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
  <span class="token keyword">AS</span> max_sale<span class="token punctuation">,</span>
  <span class="token comment">-- find customer, reusing cached maximum size</span>
  LATERAL
  <span class="token punctuation">(</span><span class="token keyword">SELECT</span> customer_name
    <span class="token keyword">FROM</span> all_sales
    <span class="token keyword">WHERE</span> all_sales<span class="token punctuation">.</span>salesperson_id <span class="token operator">=</span> salesperson<span class="token punctuation">.</span>id
    <span class="token operator">AND</span> all_sales<span class="token punctuation">.</span>amount <span class="token operator">=</span>
        <span class="token comment">-- the cached maximum size</span>
        max_sale<span class="token punctuation">.</span>amount<span class="token punctuation">)</span>
  <span class="token keyword">AS</span> max_sale_customer<span class="token punctuation">;</span>
</code></pre></div></li></ul></li></ul></li></ol> <h4 id="WITH"><a href="#WITH" class="header-anchor">#</a> WITH</h4> <ol><li><p>Common Table Expressions, CTE — a named temporary result set that exists within the scope of a single statement, from MySQL 8.0</p></li> <li><p>CTE positions</p> <ul><li>at the beginning of <code>SELECT</code>, <code>UPDATE</code>, and <code>DELETE</code> statements<div class="language- extra-class"><pre class="language-text"><code>WITH ... SELECT ...
WITH ... UPDATE ...
WITH ... DELETE ...
</code></pre></div><ul><li>CTE not updatable — need to refer to the original table to update / delete rows, use CTE in other clauses or joining CTE with original table one-to-one as workaround</li></ul></li> <li>at the beginning of subqueries<div class="language- extra-class"><pre class="language-text"><code>SELECT ... WHERE id IN (WITH ... SELECT ...) ...
SELECT * FROM (WITH ... SELECT ...) AS dt ...
</code></pre></div></li> <li>immediately preceding <code>SELECT</code> for statements that include a <code>SELECT</code> statement<div class="language- extra-class"><pre class="language-text"><code>INSERT ... WITH ... SELECT ...
REPLACE ... WITH ... SELECT ...
CREATE TABLE ... WITH ... SELECT ...
CREATE VIEW ... WITH ... SELECT ...
DECLARE CURSOR ... WITH ... SELECT ...
EXPLAIN ... WITH ... SELECT ...
</code></pre></div></li></ul></li> <li><p><code>WITH</code></p> <div class="language- extra-class"><pre class="language-text"><code>with_clause:
    WITH [RECURSIVE]
        cte_name [(col_name [, col_name] ...)] AS (subquery)
        [, cte_name [(col_name [, col_name] ...)] AS (subquery)] ...
</code></pre></div><ul><li>more tbd</li> <li>example<div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">WITH</span>
  cte1 <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> a<span class="token punctuation">,</span> b <span class="token keyword">FROM</span> table1<span class="token punctuation">)</span><span class="token punctuation">,</span>
  cte2 <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> c<span class="token punctuation">,</span> d <span class="token keyword">FROM</span> table2<span class="token punctuation">)</span>
<span class="token keyword">SELECT</span> b<span class="token punctuation">,</span> d <span class="token keyword">FROM</span> cte1 <span class="token keyword">JOIN</span> cte2
<span class="token keyword">WHERE</span> cte1<span class="token punctuation">.</span>a <span class="token operator">=</span> cte2<span class="token punctuation">.</span>c<span class="token punctuation">;</span>
</code></pre></div></li></ul></li></ol> <h4 id="DELETE"><a href="#DELETE" class="header-anchor">#</a> DELETE</h4> <ol><li><p><code>DELETE</code> syntax</p> <ul><li>single table delete<div class="language- extra-class"><pre class="language-text"><code>DELETE [LOW_PRIORITY] [QUICK] [IGNORE]
    FROM tbl_name [[AS] tbl_alias]
    [PARTITION (partition_name [, partition_name] ...)]
    [WHERE where_condition]
    [ORDER BY ...]
    [LIMIT row_count]
</code></pre></div><ul><li><code>ORDER BY</code> — delete by the order specified</li></ul></li> <li>multiple table delete<div class="language- extra-class"><pre class="language-text"><code>DELETE [LOW_PRIORITY] [QUICK] [IGNORE]
    tbl_name[.*] [, tbl_name[.*]] ...
    FROM table_references
    [WHERE where_condition]
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>DELETE [LOW_PRIORITY] [QUICK] [IGNORE]
    FROM tbl_name[.*] [, tbl_name[.*]] ...
    USING table_references
    [WHERE where_condition]
</code></pre></div><ul><li>target — matching rows</li> <li>alias coerced when declared, can only be declared in <code>table_references</code><div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">DELETE</span> t1 <span class="token keyword">FROM</span> test <span class="token keyword">AS</span> t1<span class="token punctuation">,</span> test2 <span class="token keyword">WHERE</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre></div></li></ul></li></ul></li> <li><p><code>DELETE</code> attributes</p> <ul><li>subqueries — cannot delete from a table and select from the same table in a subquery
<ul><li>workaround — intermediate cache<div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> Person <span class="token keyword">WHERE</span> Person<span class="token punctuation">.</span>Id <span class="token operator">NOT</span> <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span>Id<span class="token punctuation">)</span> <span class="token keyword">FROM</span> Person <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> Email<span class="token punctuation">)</span> <span class="token keyword">AS</span> _temp<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>still error if optimizer optimize out the subquery — see <a href="https://dev.mysql.com/doc/relnotes/mysql/5.7/en/news-5-7-6.html#mysqld-5-7-6-optimizer" target="_blank" rel="noopener noreferrer">release notes<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for details and workarounds</li></ul></li> <li>workaround — use CTE<div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">WITH</span>
    rem <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span>Id<span class="token punctuation">)</span> <span class="token keyword">AS</span> id <span class="token keyword">FROM</span> Person <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> Email<span class="token punctuation">)</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> Person <span class="token keyword">WHERE</span> Person<span class="token punctuation">.</span>Id <span class="token operator">NOT</span> <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> rem<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li> <li>modifiers — <code>LOW_PRIORITY</code>, <code>QUICK</code>, <code>IGNORE</code>, see docs</li> <li>keep desired in lieu of delete unwanted<div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> t_copy <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> t <span class="token keyword">WHERE</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">;</span>
<span class="token keyword">RENAME</span> <span class="token keyword">TABLE</span> t <span class="token keyword">TO</span> t_old<span class="token punctuation">,</span> t_copy <span class="token keyword">TO</span> t<span class="token punctuation">;</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> t_old<span class="token punctuation">;</span>
</code></pre></div></li></ul></li></ol> <h4 id="UPDATE"><a href="#UPDATE" class="header-anchor">#</a> UPDATE</h4> <ol><li><code>UPDATE</code> <ul><li>single table <code>UPDATE</code><div class="language- extra-class"><pre class="language-text"><code>UPDATE [LOW_PRIORITY] [IGNORE] table_reference
    SET assignment_list
    [WHERE where_condition]
    [ORDER BY ...]
    [LIMIT row_count]
</code></pre></div></li> <li>multi-table update — each matching row is updated once<div class="language- extra-class"><pre class="language-text"><code>UPDATE [LOW_PRIORITY] [IGNORE] table_references
    SET assignment_list
    [WHERE where_condition]
</code></pre></div></li> <li><code>assignment_list</code><div class="language- extra-class"><pre class="language-text"><code>assignment_list:
    assignment [, assignment] ...
assignment:
    col_name = {expr | DEFAULT}
</code></pre></div></li></ul></li></ol> <h4 id="INSERT"><a href="#INSERT" class="header-anchor">#</a> INSERT</h4> <ol><li><p><code>INSERT</code> syntax</p> <ul><li><code>INSERT ... VALUES</code><div class="language- extra-class"><pre class="language-text"><code>INSERT [LOW_PRIORITY | HIGH_PRIORITY] [IGNORE]
    [INTO] tbl_name
    [PARTITION (partition_name [, partition_name] ...)]
    [(col_name [, col_name] ...)]
    { VALUES (value_list) [, (value_list)] ...
      |
      VALUES ROW(value_list)[, ROW(value_list)][, ...]
    }
    [AS row_alias[(col_alias [, col_alias] ...)]]
    [ON DUPLICATE KEY UPDATE assignment_list]
</code></pre></div></li> <li><code>INSERT ... SET</code><div class="language- extra-class"><pre class="language-text"><code>INSERT [LOW_PRIORITY | HIGH_PRIORITY] [IGNORE]
    [INTO] tbl_name
    [PARTITION (partition_name [, partition_name] ...)]
    [AS row_alias[(col_alias [, col_alias] ...)]]
    SET assignment_list
    [ON DUPLICATE KEY UPDATE assignment_list]
</code></pre></div></li> <li><code>INSERT ... SELECT</code> — insert many rows into a table from the result of a <code>SELECT</code> statement<div class="language- extra-class"><pre class="language-text"><code>INSERT [LOW_PRIORITY | HIGH_PRIORITY] [IGNORE]
    [INTO] tbl_name
    [PARTITION (partition_name [, partition_name] ...)]
    [(col_name [, col_name] ...)]
    [AS row_alias[(col_alias [, col_alias] ...)]]
    {SELECT ... | TABLE table_name}
    [ON DUPLICATE KEY UPDATE assignment_list]
</code></pre></div></li> <li><code>value_list</code> and <code>assignment_list</code><div class="language- extra-class"><pre class="language-text"><code>value_list:
    value [, value] ...
value:
    {expr | DEFAULT}
assignment_list:
    assignment [, assignment] ...
assignment:
    col_name = [row_alias.]value
</code></pre></div></li></ul></li> <li><p>clauses in <code>INSERT</code></p> <ul><li>resort to update when not permitted duplicates — update using <code>assignment_list</code> when a duplicate value in a <code>UNIQUE</code> index or <code>PRIMARY KEY</code><div class="language- extra-class"><pre class="language-text"><code>[ON DUPLICATE KEY UPDATE assignment_list]
</code></pre></div></li> <li>refer to previous columns<div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tbl_name <span class="token punctuation">(</span>col1<span class="token punctuation">,</span>col2<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span>col1<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li> <li><p><code>REPLACE</code> — MySQL extension, <code>INSERT</code> but if an old row in the table has the same value as a new row for a <code>PRIMARY KEY</code> or a <code>UNIQUE</code> index, the old row is deleted before the new row is inserted</p></li></ol> <h3 id="TCL"><a href="#TCL" class="header-anchor">#</a> TCL</h3> <h4 id="Transactions"><a href="#Transactions" class="header-anchor">#</a> Transactions</h4> <ol><li><p><code>START TRANSACTION</code> or <code>BEGIN</code> — start a new transaction</p> <div class="language- extra-class"><pre class="language-text"><code>START TRANSACTION
    [transaction_characteristic [, transaction_characteristic] ...]
transaction_characteristic: {
    WITH CONSISTENT SNAPSHOT
  | READ WRITE
  | READ ONLY
}
</code></pre></div><ul><li><code>WITH CONSISTENT SNAPSHOT</code> — starts a consistent read; the effect is the same as issuing a <code>START TRANSACTION</code> followed by a <code>SELECT</code> from any InnoDB table</li> <li><code>READ WRITE</code>, <code>READ ONLY</code> — set the transaction access mode; in <code>READ ONLY</code> mode, MySQL enables extra optimizations for queries on InnoDB tables, the transaction can still modify or lock <code>TEMPORARY</code> tables</li> <li>implicit commits — beginning a transaction and some statements including DDLs causes any pending transaction to be committed</li> <li>implicit unlock — beginning a transaction also causes table locks acquired with <code>LOCK TABLES</code> to be released, as though you had executed <code>UNLOCK TABLES</code></li> <li><code>BEGIN [WORK]</code> — aliases of <code>START TRANSACTION</code></li></ul></li> <li><p><code>COMMIT</code>, and <code>ROLLBACK</code> statements</p> <div class="language- extra-class"><pre class="language-text"><code>COMMIT [WORK] [AND [NO] CHAIN] [[NO] RELEASE]
ROLLBACK [WORK] [AND [NO] CHAIN] [[NO] RELEASE]
SET autocommit = {0 | 1}
</code></pre></div><ul><li><code>COMMIT</code> — commits the current transaction, making its changes permanent, stored in the binary log in one chunk??</li> <li><code>ROLLBACK</code> — rolls back the current transaction, canceling its changes
<ul><li>DDL cannot be rolled back</li></ul></li> <li><code>SET autocommit</code> — disables or enables the default autocommit mode for the current session
<ul><li>defaults to <code>1</code> — each statement is atomic, as if it were surrounded by <code>START TRANSACTION</code> and <code>COMMIT</code></li></ul></li> <li><code>WORK</code> — optional</li> <li>after completion
<ul><li><code>AND CHAIN</code> — a new transaction to begin with the same isolation level and access mode as soon as the current one ends</li> <li><code>RELEASE</code> — causes the server to disconnect the current client session after terminating the current transaction</li> <li><code>NO</code> — negate</li> <li>system variable <code>completion_type</code></li></ul></li></ul></li> <li><p><code>SAVEPOINT</code></p> <div class="language- extra-class"><pre class="language-text"><code>SAVEPOINT identifier
ROLLBACK [WORK] TO [SAVEPOINT] identifier
RELEASE SAVEPOINT identifier
</code></pre></div><ul><li><code>identifier</code> — overwrite when collison</li> <li><code>ROLLBACK TO</code> — without terminating the transaction, changes are undone, but InnoDB does not release the row locks that were stored in memory after the savepoint, except new insert rows; later save points discarded</li> <li><code>RELEASE SAVEPOINT</code> — delete a save point</li> <li>deconstruction — all deleted after single <code>COMMIT</code> or <code>ROLLBACK</code></li></ul></li></ol> <h4 id="SET-TRANSACTION"><a href="#SET-TRANSACTION" class="header-anchor">#</a> SET TRANSACTION</h4> <ol><li><p><code>SET TRANSACTION</code></p> <div class="language- extra-class"><pre class="language-text"><code>SET [GLOBAL | SESSION] TRANSACTION
    transaction_characteristic [, transaction_characteristic] ...
transaction_characteristic: {
    ISOLATION LEVEL level
  | access_mode
}
</code></pre></div><ul><li><code>GLOBAL</code> or <code>SESSION</code> — global scope, or session scope, defaults to only next transaction within the same session</li> <li><code>access_mode</code> <ul><li><code>READ WRITE</code> (default)</li> <li><code>READ ONLY</code></li></ul></li></ul></li> <li><p><code>level</code> — isolation levels for InnoDB, relax to minimize the amount of overhead for locking</p> <ul><li><code>SERIALIZABLE</code> — like <code>REPEATABLE READ</code>, but all reads are implicitly locking reads</li> <li><code>REPEATABLE READ</code> (default)
<ul><li>consistent read — read the snapshot established by the first read</li> <li>for locking reads (<code>SELECT</code> with <code>FOR UPDATE</code> or <code>FOR SHARE</code>), <code>UPDATE</code>, and <code>DELETE</code> statements — next-key locks, record locks, gap locks, see docs</li></ul></li> <li><code>READ COMMITTED</code> <ul><li>consistent read — read the snapshot that is reset to the time of each consistent read operation</li> <li>for locking reads (<code>SELECT</code> with <code>FOR UPDATE</code> or <code>FOR SHARE</code>), <code>UPDATE</code>, and <code>DELETE</code> statements — record locks; gap locking is only used for foreign-key constraint checking and duplicate-key checking, see docs</li></ul></li> <li><code>READ UNCOMMITTED</code> — no consistent read; otherwise like <code>READ COMMITTED</code></li></ul></li> <li><p>check current <code>level</code> — <code>SHOW VARIABLES LIKE '%iso%'</code></p></li></ol> <h4 id="Locks"><a href="#Locks" class="header-anchor">#</a> Locks</h4> <ol><li><p>instance lock — prevents files from being created, renamed, or removed</p> <div class="language- extra-class"><pre class="language-text"><code>LOCK INSTANCE FOR BACKUP
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>UNLOCK INSTANCE
</code></pre></div></li> <li><p>table lock — explicitly acquires table locks for the current client session</p> <div class="language- extra-class"><pre class="language-text"><code>LOCK TABLES
    tbl_name [[AS] alias] lock_type
    [, tbl_name [[AS] alias] lock_type] ...
lock_type: {
    READ [LOCAL]
  | [LOW_PRIORITY] WRITE
}
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>UNLOCK TABLES
</code></pre></div><ul><li>more</li></ul></li> <li><p>other locks — see <a href="/notes-of-tan/backend/database.html#Locks">Locks</a></p></li> <li><p>show lock</p> <ul><li><code>SHOW ENGINE INNODB STATUS</code></li> <li><code>SHOW OPEN TABLES</code></li></ul></li></ol> <h3 id="Dynamic-SQL"><a href="#Dynamic-SQL" class="header-anchor">#</a> Dynamic SQL</h3> <ol><li><p>prepared statements</p> <ul><li>merits
<ul><li>less overhead for parsing the statement each time it is executed</li> <li>protection against SQL injection attacks</li></ul></li> <li>scope — session specific if created in a session, global if created in a stored routine</li> <li>control — system variable <code>max_prepared_stmt_count</code></li> <li>allowed statements — see docs</li></ul></li> <li><p><code>PREPARE</code></p> <div class="language- extra-class"><pre class="language-text"><code>PREPARE stmt_name FROM preparable_stmt
</code></pre></div><ul><li><code>preparable_stmt</code> — string literal or a user variable of a single SQL statement, <code>?</code> as parameter markers, keywords and identifiers cannot be parameters</li> <li>implicit <code>DEALLOCATE</code> — prepared statements with the same <code>stmt_name</code> are deallocated implicitly</li></ul></li> <li><p><code>EXECUTE</code></p> <div class="language- extra-class"><pre class="language-text"><code>EXECUTE stmt_name [USING @var_name [, @var_name] ...]
</code></pre></div></li> <li><p><code>DEALLOCATE PREPARE</code></p> <div class="language- extra-class"><pre class="language-text"><code>{DEALLOCATE | DROP} PREPARE stmt_name
</code></pre></div></li></ol> <h2 id="Language-Structure"><a href="#Language-Structure" class="header-anchor">#</a> Language Structure</h2> <h3 id="Basics"><a href="#Basics" class="header-anchor">#</a> Basics</h3> <ol><li><p>case sensitivity</p> <ul><li>SQL statements — case insensitive</li> <li>database, trigger, table names — depends on file system and CLI option <code>--lower-case-table-names[=#]</code> or system variable <code>lower_case_table_names</code>, <code>1</code> suggested with lowercase storing and insensitive comparisons</li> <li>table aliases — platform dependent</li></ul></li> <li><p>index — start from 1</p></li></ol> <h3 id="Identifiers-User-Variables-and-Comments"><a href="#Identifiers-User-Variables-and-Comments" class="header-anchor">#</a> Identifiers, User Variables and Comments</h3> <ol><li><p>comment</p> <ul><li>inline comment — <code>--</code>, <code>#</code> (less commonly supported)</li> <li>comment block: <code>/**/</code> <ul><li><code>/*! */</code> — MySQL-specific code<div class="language- extra-class"><pre class="language-text"><code>/*![version] MySQL-specific code */
</code></pre></div></li> <li><code>/*+ */</code> — optimizer hints</li></ul></li></ul></li> <li><p>identifiers
</p> <ul><li>identifier quote — the <code>`</code> character
<ul><li>also <code>&quot;</code> if <code>sql_mode</code> <code>ANSI_QUOTES</code> — Treat <code>&quot;</code> as an identifier quote character and not as a string quote character</li> <li>escape backtick — <code>``</code></li></ul></li> <li>identifier characters
<ul><li>permitted characters when unquoted — <code>[$_0-9a-zA-Z\x80-\uFFFF]</code>, cannot be all numbers</li> <li>permitted characters when quoted — <code>[\x01-\uFFFF]</code></li> <li>space — database, table, and column names cannot end with space characters</li></ul></li> <li>qualifier — <code>schema_name.func_name()</code>, <code>`my-table`.`my-column`</code></li> <li>mapping to filenames — refer to docs</li></ul></li> <li><p>user defined variables — session specific</p> <div class="language- extra-class"><pre class="language-text"><code>SET @var_name = expr [, @var_name = expr] ...
SET @var_name := expr [, @var_name = expr] ...
</code></pre></div><ul><li><code>@var_name</code>, <code>@'my-var'</code>, <code>@&quot;my-var&quot;</code>, or <code>@`my-var`</code></li> <li>corresponding table in <code>PERFORMANCE_SCHEMA</code> — <code>PERFORMANCE_SCHEMA.user_variables_by_thread</code></li> <li>supported data types — integer, decimal (no precision), floating-point, binary or nonbinary string, or <code>NULL</code> <ul><li>auto conversion — other types are converted</li> <li>defaults to <code>NULL</code>, as string when selected in a result set</li></ul></li> <li>use in expressions — <code>@var_name</code>, intended to provide data values, cannot be used directly as identifiers</li> <li>evaluated on the client — a variable that is assigned a value in the select expression list, does not work in <code>HAVING</code>, <code>GROUP BY</code>, and <code>ORDER BY</code></li> <li>example<div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> Num <span class="token keyword">as</span> <span class="token string">'ConsecutiveNums'</span> <span class="token keyword">from</span>
    <span class="token punctuation">`</span>Logs<span class="token punctuation">`</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token variable">@cnt</span> :<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">@prev</span> :<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">as</span> _init
<span class="token keyword">where</span> <span class="token punctuation">(</span><span class="token variable">@cnt</span> :<span class="token operator">=</span> <span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token variable">@prev</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">@prev</span> :<span class="token operator">=</span> Num<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">@cnt</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li></ol> <h3 id="Literals"><a href="#Literals" class="header-anchor">#</a> Literals</h3> <ol><li><p><code>NULL</code></p></li> <li><p>strings literals — <code>'</code>, or <code>&quot;</code> if not in <code>sql_mode</code> <code>ANSI_QUOTES</code></p> <div class="language- extra-class"><pre class="language-text"><code>[_charset_name]'string' [COLLATE collation_name]
</code></pre></div><div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> _utf8mb4<span class="token string">'abc'</span> <span class="token keyword">COLLATE</span> utf8mb4_danish_ci<span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> _utf8mb4 <span class="token number">0x4D7953514C</span> <span class="token keyword">COLLATE</span> utf8mb4_danish_ci<span class="token punctuation">;</span>
</code></pre></div><ul><li>escape sequences - <code>\0</code>, <code>\'</code>, <code>\&quot;</code>, <code>\b</code> (backspace), <code>\n</code>, <code>\r</code>, <code>\t</code>, <code>\Z</code> (ASCII 26 (Control+Z)), <code>\\</code>, <code>\%</code>, <code>\_</code> <ul><li><code>\'</code>, <code>\&quot;</code> — also <code>&quot;'&quot;</code>, <code>'&quot;'</code>, <code>''</code> enclosed in single quotes, <code>&quot;&quot;</code> enclosed in double quotes</li> <li><code>\%</code>, <code>\_</code> — only in in pattern-matching contexts, otherwise just the strings <code>\%</code> and <code>\_</code>, not to <code>%</code> and <code>_</code></li> <li>backslash ignored for all other escape sequences — <code>\x</code> is just <code>x</code></li> <li>raw string — <code>QUOTE(str)</code></li> <li>controlled by <code>sql_mode</code> <code>NO_BACKSLASH_ESCAPES</code></li></ul></li> <li><code>SET</code> type — comma separated string, like <code>'a,b'</code></li></ul></li> <li><p>numbers literals</p> <ul><li>(fixed-point) number<div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">.2</span><span class="token punctuation">,</span> <span class="token number">3.4</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">6.78</span><span class="token punctuation">,</span> <span class="token operator">+</span><span class="token number">9.10</span>
</code></pre></div></li> <li>approximate-value (floating-point) number<div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token number">1.2</span>E3<span class="token punctuation">,</span> <span class="token number">1.2</span>E<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.2</span>E3<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.2</span>E<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span>e3
</code></pre></div></li> <li><code>TRUE</code>, <code>FALSE</code> — 1, 0</li></ul></li> <li><p><code>BIT</code>, number or binary string literals</p> <ul><li>hexidecimal<div class="language- extra-class"><pre class="language-text"><code>[_charset_name] X'val' [COLLATE collation_name]
</code></pre></div><ul><li><code>X'val'</code>, <code>x'val'</code>, <code>val</code> must contain an even number of digits</li> <li><code>0xval</code>, case sensitive, not <code>0X</code></li> <li><code>charset_name</code> — defaults to <code>binary</code></li> <li>numeric contexts — treated like <code>BIGINT</code>, to ensure numeric treatment, <code>+0</code> or <code>CAST(X'41' AS UNSIGNED)</code></li> <li>bit operators — defaults to numeric context, for binary string context, use a <code>_binary</code> introducer for at least one of the arguments</li> <li>get hex — <code>HEX(str)</code>, <code>HEX(N)</code></li></ul></li> <li>binary — like hexidecimal, but no constraint on number of digits<div class="language- extra-class"><pre class="language-text"><code>[_charset_name] b'val' [COLLATE collation_name]
</code></pre></div></li></ul></li> <li><p>date and time literals</p> <ul><li>quoted strings and numbers — like <code>'2015-07-21'</code>, <code>'20150721'</code>, and <code>20150721</code> <ul><li><code>'YYYY-MM-DD'</code> or <code>'YY-MM-DD'</code>, <code>'YYYY-MM-DD hh:mm:ss'</code> or <code>'YY-MM-DD hh:mm:ss'</code>, any punctuation character may be used as the delimiter</li> <li><code>'YYYYMMDD'</code> or <code>'YYMMDD'</code>, <code>'YYYYMMDDhhmmss'</code> or <code>'YYMMDDhhmmss'</code>, <code>'hhmmss'</code></li> <li><code>YYYYMMDD</code> or <code>YYMMDD</code>, <code>YYYYMMDDhhmmss</code>, <code>YYMMDDhhmmss</code>, <code>ss</code>, <code>mmss</code>, or <code>hhmmss</code> formatted numbers</li> <li>timezone offset — suffices like <code>+08:00</code>, from <code>-14:00</code> to <code>+14:00</code><div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> ts <span class="token punctuation">(</span>col<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'2020-01-01 10:10:10'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'2020-01-01 10:10:10+05:30'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'2020-01-01 10:10:10-08:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li>trailing fractional seconds</li> <li>preceding zeros in delimited strings — optional</li> <li><code>TIME</code> with or without days — <code>'D hh:mm:ss'</code>, <code>'hh:mm:ss'</code>, <code>'hh:mm'</code>, <code>'D hh:mm'</code>, <code>'D hh'</code>, or <code>'ss'</code>, <code>D</code> from 0 to 34 days</li></ul></li> <li>ANSI SQL — space delimiter is optional<div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">DATE</span> <span class="token string">'str'</span>
<span class="token keyword">TIME</span> <span class="token string">'str'</span>
<span class="token keyword">TIMESTAMP</span> <span class="token string">'str'</span>
</code></pre></div></li></ul></li></ol> <h3 id="Operators-and-Functions"><a href="#Operators-and-Functions" class="header-anchor">#</a> Operators and Functions</h3> <ol><li><p>implicit type conversion — use <code>CAST()</code> for explict conversion</p> <ul><li>between strings and numbers — <code>1+'1'</code>, <code>CONCAT(1)</code> <ul><li>character set and collation when implicitly converted to string — by <code>character_set_connection</code> and <code>collation_connection</code></li></ul></li> <li>when comparing
<ul><li><code>NULL</code> — result in <code>NULL</code> if one or both arguments are <code>NULL</code>, except <code>&lt;=&gt;</code></li> <li>hexidecimal values — as binary strings if not compared to a number</li> <li>when <code>TIMESTAMP</code> or <code>DATETIME</code> compared to constants — constants converted</li> <li>when comparing strings to numbers — convert to floating point numbers</li></ul></li> <li>when arithmetic — see below</li></ul></li> <li><p>operator priority</p> <ol><li>unary operators — <code>-</code>, <code>~</code> (bit inversion)</li> <li><code>^</code>, arithmetic operators</li> <li>bitwise operators</li> <li>comparison operators</li> <li>logical operators</li> <li>assignment operators — <code>:=</code>, <code>=</code> (in <code>SET</code> statements and <code>SET</code> clauses of <code>UPDATE</code>); support multiple assignments</li></ol></li> <li><p>numeric operators and functions</p> <ul><li><code>+</code>, <code>-</code>, <code>*</code> — result is floating-point if any operand is floating-point, otherwise <code>UNSIGNED</code> if any operand is <code>UNSIGNED</code></li> <li><code>/</code> <ul><li>scale of the result — when using two exact-value operands, the scale of the result is the scale of the first operand plus the value of the <code>div_precision_increment</code> (defaults to 4) system variable</li> <li>division by zero — <code>NULL</code> or error, controlled by <code>sql_mode</code> <code>ERROR_FOR_DIVISION_BY_ZERO</code></li></ul></li> <li><code>DIV</code> — integer division returning <code>BIGINT</code>, non-integer types are converted to <code>DECIMAL</code> and use <code>DECIMAL</code> arithmetic, error when overflow</li> <li><code>%</code>, <code>MOD</code>, <code>MOD(N,M)</code></li></ul></li> <li><p>bitwise operators and functions</p> <ul><li><code>&amp;</code>, <code>&gt;&gt;</code>, <code>&lt;&lt;</code>, <code>^</code>, <code>|</code>, <code>~</code></li> <li><code>BIT_COUNT(N)</code></li></ul></li> <li><p>comparison operators and functions — result in a value of <code>1</code> (<code>TRUE</code>), <code>0</code> (<code>FALSE</code>), or <code>NULL</code></p> <ul><li>L, E and G, also row operands — for example, <code>(a, b) &lt;= (x, y)</code><div class="language- extra-class"><pre class="language-text"><code>=  &gt;  &lt;  &gt;=  &lt;=  &lt;&gt;  !=  &lt;=&gt;
</code></pre></div><ul><li><code>&lt;=&gt;</code> — <code>NULL</code>-safe equal, equivalent to the ANSI SQL <code>IS NOT DISTINCT FROM</code></li> <li><code>&lt;&gt;</code> or <code>!=</code> — not equal</li></ul></li> <li><code>expr [NOT] IN (value,...)</code> — also as row operands, use <code>CAST()</code> for best results, <code>NULL</code> if left value is <code>NULL</code> or <code>NULL</code> among right values when not found</li> <li><code>IS</code> <ul><li><code>IS [NOT] boolean_value</code> — <code>boolean_value</code>: <code>TRUE</code>, <code>FALSE</code>, or <code>UNKNOWN</code> (for <code>NULL</code>)</li> <li><code>IS [NOT] NULL</code>, <code>ISNULL(expr)</code> <ul><li><code>AUTO_INCREMENT</code> columns — controlled by system variable <code>sql_auto_is_null</code></li> <li>zero values for <code>DATE</code> nad <code>DATETIME</code> columns — zero values <code>IS NULL</code> when the column defined as <code>NOT NULL</code></li></ul></li></ul></li> <li>string related — <code>NULL</code> if any parameter is <code>NULL</code> <ul><li><code>expr1 SOUNDS LIKE expr2</code> — <code>SOUNDEX(expr1) = SOUNDEX(expr2)</code></li> <li><code>expr [NOT] LIKE pat [ESCAPE 'escape_char']</code> <ul><li>matching on a per-character basis — some collate rules may not work, trailing space significant</li> <li>wildcard — <code>%</code> for any number of characters, <code>_</code> for one character</li> <li>escape — defaults to use <code>\</code> as escape character</li></ul></li> <li><code>expr [NOT] REGEXP pat</code>, <code>expr [NOT] RLIKE pat</code> — <code>REGEXP_LIKE()</code></li> <li><code>REGEXP_LIKE(expr, pat[, match_type])</code> <ul><li>compatibility — not multibyte safe prior to 8.0.4, and more</li> <li><code>match_type</code> options — <code>c</code> case sensitive, <code>i</code> case insensitive, more</li> <li>regex syntax — limited support, see docs</li></ul></li> <li><code>STRCMP(expr1,expr2)</code></li></ul></li> <li><code>expr [NOT] BETWEEN min AND max</code> — inclusive, equivalent to the expression <code>(min &lt;= expr AND expr &lt;= max)</code> if of same type, use <code>CAST()</code> for best results</li> <li><code>CASE</code> — control flow, <code>NULL</code> if no else, different when use inside stored programs
<ul><li>switch case<div class="language- extra-class"><pre class="language-text"><code>CASE value
    WHEN [compare_value] THEN result
    [WHEN [compare_value] THEN result ...]
    [ELSE result]
END
</code></pre></div></li> <li>if else<div class="language- extra-class"><pre class="language-text"><code>CASE
    WHEN [condition] THEN result
    [WHEN [condition] THEN result ...]
    [ELSE result]
END
</code></pre></div></li> <li><code>result</code> — the aggregated type of all result values, see docs for details</li> <li>in tandem — <code>ELT()</code>, <code>FIELD()</code></li></ul></li> <li>pick value or index
<ul><li><code>COALESCE(value,...)</code> — the first non-<code>NULL</code> argument</li> <li><code>GREATEST(value1,value2,...)</code>, <code>LEAST(value1,value2,...)</code> — with implicit type conversion, <code>NULL</code> if any <code>NULL</code> argument</li> <li><code>INTERVAL(N,N1,N2,N3,...)</code> — binary search <code>N</code>, <code>N_i</code> required to be incremental, arguments treated as integers, <code>-1</code> if <code>N</code> is <code>NULL</code>, <code>0</code> if <code>N &lt; N1</code>, <code>1</code> if <code>N1 &lt;= N &lt; N2</code> and so on</li> <li><code>IF(expr1,expr2,expr3)</code> — ternary <code>expr1 ? expr2 : expr3</code> in other languages, return type is aggregated</li> <li><code>IFNULL(expr1,expr2)</code> — <code>expr1 ?? expr2</code> in other languages, <code>NULL</code> coalescing, return type is the generalized type</li> <li><code>NULLIF(expr1,expr2)</code> — <code>IF(expr1 = expr2, NULL, expr1)</code>, return type as <code>expr1</code>, <code>expr1</code> may be evaluated twice</li></ul></li></ul></li> <li><p>logical operators</p> <ul><li>short circuit — undefined and should not rely on, use <code>CASE</code> for guaranteed order or bitwise operator to ensure execution</li> <li><code>NOT</code> — <code>NOT NULL</code> is <code>NULL</code></li> <li><code>AND</code> — <code>1 AND NULL</code> and <code>NULL AND 1</code> is <code>NULL</code></li> <li><code>OR</code> — <code>1 OR NULL</code> and <code>NULL or 1</code> is <code>NULL</code> <ul><li><code>||</code> — deprecated as <code>OR</code>, when in <code>sql_mode</code> <code>PIPES_AS_CONCAT</code>, <code>||</code> is SQL-standard string concatenation</li></ul></li> <li><code>XOR</code> — <code>NULL</code> if any <code>NULL</code></li></ul></li></ol> <h3 id="Cast-Math-Date-Time-and-String-Functions"><a href="#Cast-Math-Date-Time-and-String-Functions" class="header-anchor">#</a> Cast, Math, Date, Time and String Functions</h3> <ol><li><p>cast</p> <ul><li>use extract functions for date times</li> <li>string to number — use arithmetic, like <code>'1' | 0</code></li> <li>convert between character sets<div class="language- extra-class"><pre class="language-text"><code>CONVERT(expr USING transcoding_name) [COLLATE collation_name]
CONVERT(string, CHAR[(N)] CHARACTER SET charset_name) [COLLATE collation_name]
CAST(string AS CHAR[(N)] CHARACTER SET charset_name) [COLLATE collation_name]
</code></pre></div></li> <li><code>BINARY expr</code> — to a binary string, force byte comparaison and trailing spaces significant</li> <li><code>CAST(expr AS type [ARRAY])</code>, <code>CONVERT(expr,type)</code> <ul><li><code>type</code> — see docs, some data types and <code>SIGNED</code>, <code>UNSIGNED</code></li></ul></li></ul></li> <li><p>mathmatical functions — <code>NULL</code> when error</p> <ul><li>sign
<ul><li><code>ABS(X)</code></li> <li><code>SIGN(X)</code></li></ul></li> <li>rounding
<ul><li><code>CEIL(X)</code>, <code>CEILING(X)</code>, <code>FLOOR(X)</code> — return floating type when string or floating-point arguments</li> <li><code>ROUND(X)</code>, <code>ROUND(X,D)</code> — precision <code>D</code> can be negative</li> <li><code>TRUNCATE(X,D)</code></li></ul></li> <li><code>RAND([N])</code> — <code>Math.random()</code> in Java, <code>N</code> for seed
<ul><li>retrieve in random order — <code>ORDER BY RAND()</code></li></ul></li> <li><code>POW(X,Y)</code>, <code>POWER(X,Y)</code>, <code>SQRT(X)</code></li> <li><code>EXP(X)</code>, <code>LN(X)</code>, <code>LOG(X)</code>, <code>LOG(B,X)</code>, <code>LOG2(X)</code>, <code>LOG10(X)</code>, <code>LOG2(X)</code>, <code>LOG10(X)</code></li> <li>trigonometric — in radian
<ul><li><code>PI()</code></li> <li><code>DEGREES(X)</code>, <code>RADIANS(X)</code> — conversion between radians and degrees</li> <li><code>ACOS(X)</code>, <code>ASIN(X)</code></li> <li><code>ATAN(X)</code>, <code>ATAN(Y,X)</code>, <code>ATAN2(Y,X)</code> — the latter two as <code>Y/X</code></li> <li><code>COT(X)</code> — cotangent</li> <li><code>COS(X)</code>, <code>SIN(X)</code>, <code>TAN(X)</code></li></ul></li> <li><code>CRC32(expr)</code></li></ul></li> <li><p>date and time functions</p> <ul><li>excess information ignored — ignore the time part if expect date values and vice versa</li> <li>current date or time evaluated at start — functions like <code>NOW()</code> evaluated only once per query at the start of query execution, except <code>SYSDATE()</code> <ul><li><code>NOW([fsp])</code>, <code>CURRENT_TIMESTAMP</code>, <code>CURRENT_TIMESTAMP([fsp])</code>, <code>LOCALTIME</code>, <code>LOCALTIME([fsp])</code>, <code>LOCALTIMESTAMP</code>, <code>LOCALTIMESTAMP([fsp])</code></li> <li><code>SYSDATE([fsp])</code> — nondeterministic, evaluated to the time at which executed</li> <li><code>CURDATE()</code>, <code>CURRENT_DATE</code>, <code>CURRENT_DATE()</code></li> <li><code>CURTIME([fsp])</code>, <code>CURRENT_TIME</code>, <code>CURRENT_TIME([fsp])</code></li> <li><code>UNIX_TIMESTAMP([date])</code> — when without parameters</li> <li><code>UTC_DATE</code>, <code>UTC_DATE()</code>; <code>UTC_TIME</code>, <code>UTC_TIME([fsp])</code>; <code>UTC_TIMESTAMP</code>, <code>UTC_TIMESTAMP([fsp])</code></li></ul></li> <li>arithmetic
<ul><li><code>ADDDATE(date,INTERVAL expr unit)</code>, <code>DATE_ADD(date,INTERVAL expr unit)</code></li> <li><code>SUBDATE(date,INTERVAL expr unit)</code>, <code>DATE_SUB(date,INTERVAL expr unit)</code></li> <li><code>ADDDATE(expr,days)</code>; <code>SUBDATE(expr,days)</code></li> <li><code>FROM_DAYS(N)</code></li> <li><code>ADDTIME(expr1,expr2)</code>; <code>SUBTIME(expr1,expr2)</code></li> <li><code>TIMEDIFF(expr1,expr2)</code></li> <li><code>DATEDIFF(expr1,expr2)</code></li> <li><code>PERIOD_ADD(P,N)</code></li> <li><code>PERIOD_DIFF(P1,P2)</code></li> <li><code>TIMESTAMP(expr1,expr2)</code></li> <li><code>TIMESTAMPADD(unit,interval,datetime_expr)</code>, <code>TIMESTAMPDIFF(unit,datetime_expr1,datetime_expr2)</code></li></ul></li> <li>of
<ul><li><code>LAST_DAY(date)</code> — last day of the month</li> <li><code>MAKEDATE(year,dayofyear)</code></li> <li><code>MAKETIME(hour,minute,second)</code></li> <li><code>SEC_TO_TIME(seconds)</code></li> <li><code>STR_TO_DATE(str,format)</code></li> <li><code>FROM_UNIXTIME(unix_timestamp[,format])</code></li> <li><code>TIMESTAMP(expr)</code></li></ul></li> <li>timezone
<ul><li><code>CONVERT_TZ(dt,from_tz,to_tz)</code></li></ul></li> <li>format
<ul><li>with format
<ul><li><code>DATE_FORMAT(date,format)</code> — see docs for formats, <code>STR_TO_DATE(str,format)</code> for inversion</li> <li><code>TIME_FORMAT(time,format)</code></li> <li><code>FROM_UNIXTIME(unix_timestamp[,format])</code></li> <li><code>GET_FORMAT({DATE|TIME|DATETIME}, {'EUR'|'USA'|'JIS'|'ISO'|'INTERNAL'})</code></li></ul></li> <li>name
<ul><li><code>DAYNAME(date)</code> — Saturday, etc.</li> <li><code>MONTHNAME(date)</code></li></ul></li> <li>extract
<ul><li><code>EXTRACT(unit FROM date)</code></li> <li><code>MICROSECOND(expr)</code></li> <li><code>SECOND(time)</code></li> <li><code>MINUTE(time)</code></li> <li><code>HOUR(time)</code></li> <li><code>TIME(expr)</code></li> <li><code>DAY(date)</code>, <code>DAYOFMONTH(date)</code></li> <li><code>MONTH(date)</code></li> <li><code>YEAR(date)</code></li> <li><code>DATE(expr)</code></li></ul></li> <li>index
<ul><li><code>DAYOFMONTH(date)</code>, <code>DAY(date)</code></li> <li><code>DAYOFYEAR(date)</code></li> <li><code>DAYOFWEEK(date)</code> — start from 1 = Sunday
-<code>WEEKDAY(date)</code> — start from 0 = Monday</li> <li><code>QUARTER(date)</code></li> <li><code>WEEK(date[,mode])</code></li> <li><code>WEEKOFYEAR(date)</code> — <code>WEEK(date,3)</code></li> <li><code>YEARWEEK(date)</code>, <code>YEARWEEK(date,mode)</code> — return year and week</li></ul></li> <li>conversion
<ul><li><code>TIME_TO_SEC(time)</code></li> <li><code>TO_DAYS(date)</code> — since year 0</li> <li><code>TO_SECONDS(expr)</code></li> <li><code>UNIX_TIMESTAMP([date])</code></li></ul></li></ul></li></ul></li> <li><p>string functions</p> <ul><li>char at
<ul><li><code>ASCII(str)</code></li> <li><code>ORD(str)</code> — byte representation</li></ul></li> <li>length
<ul><li><code>BIT_LENGTH(str)</code></li> <li><code>OCTET_LENGTH(str)</code>, <code>LENGTH(str)</code> — byte length</li> <li><code>CHAR_LENGTH(str)</code>, CHARACTER_LENGTH(str)</li></ul></li> <li>to string, of
<ul><li><code>BIN(N)</code></li> <li><code>OCT(N)</code></li> <li><code>HEX(N)</code></li> <li><code>CONV(N,from_base,to_base)</code> — <code>N</code> treated as unsigned unless <code>from_base</code> is negative</li> <li><code>EXPORT_SET(bits,on,off[,separator[,number_of_bits]])</code> — <code>BIN()</code> but <code>on</code> as 1 and <code>off</code> as 0</li> <li><code>MAKE_SET(bits,str1,str2,...)</code> — choose from bit vector <code>bits</code>, little endian</li> <li><code>CHAR(N,... [USING charset_name])</code> — from byte array</li> <li><code>FORMAT(X,D[,locale])</code> — localization</li> <li><code>LOAD_FILE(file_name)</code></li></ul></li> <li>find — 0 if not found
<ul><li><code>INSTR(str,substr)</code></li> <li><code>REGEXP_INSTR(expr, pat[, pos[, occurrence[, return_option[, match_type]]]])</code> <ul><li><code>REGEXP_SUBSTR(expr, pat[, pos[, occurrence[, match_type]]])</code> — <code>REGEXP_INSTR()</code> but return matched result</li></ul></li> <li><code>LOCATE(substr,str)</code>, <code>LOCATE(substr,str,pos)</code>, <code>POSITION(substr IN str)</code></li></ul></li> <li>transform
<ul><li><code>CONCAT(str1,str2,...)</code></li> <li><code>CONCAT_WS(separator,str1,str2,...)</code></li> <li><code>INSERT(str,pos,len,newstr)</code></li> <li><code>REPLACE(str,from_str,to_str)</code></li> <li><code>REPEAT(str,count)</code></li> <li><code>SPACE(N)</code> — <code>REPEAT(' ', N)</code></li> <li><code>REVERSE(str)</code></li> <li>case
<ul><li><code>LOWER(str)</code>, <code>LCASE(str)</code> — for a binary string, first convert it to a non-binary string</li> <li><code>UPPER(str)</code>, <code>UCASE(str)</code></li></ul></li> <li>substring — multibyte safe
<ul><li><code>LEFT(str,len)</code> — from start</li> <li><code>RIGHT(str,len)</code> — from end</li> <li><code>SUBSTRING(str,pos,len)</code>, <code>MID(str,pos,len)</code></li> <li><code>SUBSTR(str,pos)</code>, <code>SUBSTR(str FROM pos)</code>, <code>SUBSTR(str,pos,len)</code>, <code>SUBSTR(str FROM pos FOR len)</code></li> <li><code>SUBSTRING(str,pos)</code>, <code>SUBSTRING(str FROM pos)</code>, <code>SUBSTRING(str,pos,len)</code>, <code>SUBSTRING(str FROM pos FOR len)</code></li> <li><code>SUBSTRING_INDEX(str,delim,count)</code> — start from end if <code>count</code> is negative</li></ul></li> <li>padding
<ul><li><code>LPAD(str,len,padstr)</code></li> <li><code>RPAD(str,len,padstr)</code></li></ul></li> <li>trim
<ul><li><code>LTRIM(str)</code></li> <li><code>RTRIM(str)</code></li> <li><code>TRIM([{BOTH | LEADING | TRAILING} [remstr] FROM] str)</code>, <code>TRIM([remstr FROM] str)</code></li></ul></li></ul></li> <li>mapping
<ul><li><code>ELT(N,str1,str2,str3,...)</code> — select <code>strN</code> from string array starting from <code>str1</code></li> <li><code>FIELD(str,str1,str2,str3,...)</code> — ordinal in the string array starting from <code>str1</code></li></ul></li> <li>encoding
<ul><li><code>HEX(str)</code> — hex representation</li> <li><code>UNHEX(str)</code></li> <li><code>TO_BASE64(str)</code></li> <li><code>FROM_BASE64(str)</code></li> <li><code>QUOTE(str)</code></li> <li><code>SOUNDEX(str)</code></li> <li><code>CHARSET(str)</code></li> <li><code>COLLATION(str)</code></li></ul></li></ul></li></ol> <h3 id="Aggregate-and-Window-Functions"><a href="#Aggregate-and-Window-Functions" class="header-anchor">#</a> Aggregate and Window Functions</h3> <ol><li><p>group functions</p> <ul><li>ignore <code>NULL</code> values</li> <li>return type — <code>DOUBLE</code> or <code>DECIMAL</code> if exact-value arguments, <code>BIGINT</code> (or binary strings) for bitwise</li> <li><code>over_clause</code> — use as window functions</li></ul></li> <li><p>statistic group functions</p> <ul><li><code>SUM([DISTINCT] expr) [over_clause]</code></li> <li><code>AVG([DISTINCT] expr) [over_clause]</code></li> <li><code>MAX([DISTINCT] expr) [over_clause]</code></li> <li><code>MIN([DISTINCT] expr) [over_clause]</code></li> <li><code>STDDEV_POP(expr) [over_clause]</code>, <code>STDDEV(expr) [over_clause]</code>, <code>STD(expr) [over_clause]</code></li> <li><code>STDDEV_SAMP(expr) [over_clause]</code></li> <li><code>VAR_POP(expr) [over_clause]</code>, <code>VARIANCE(expr) [over_clause]</code></li> <li><code>VAR_SAMP(expr) [over_clause]</code></li></ul></li> <li><p>bitwise group functions</p> <ul><li><code>BIT_AND(expr) [over_clause]</code></li> <li><code>BIT_OR(expr) [over_clause]</code></li> <li><code>BIT_XOR(expr) [over_clause]</code></li></ul></li> <li><p>other group functions</p> <ul><li><code>COUNT(expr) [over_clause]</code> — non-<code>NULL</code> values, also <code>NULL</code> if <code>COUNT(*)</code> <ul><li>secondary index traversing — InnoDB processes <code>SELECT COUNT(*)</code> statements by traversing the smallest available secondary index unless an index or optimizer hint directs the optimizer to use a different index. If a secondary index is not present, InnoDB processes <code>SELECT COUNT(*)</code> statements by scanning the clustered index.</li></ul></li> <li><code>COUNT(DISTINCT expr,[expr...])</code></li> <li><code>GROUP_CONCAT(expr)</code><div class="language- extra-class"><pre class="language-text"><code>GROUP_CONCAT([DISTINCT] expr [,expr ...]
             [ORDER BY {unsigned_integer | col_name | expr}
                 [ASC | DESC] [,col_name ...]]
             [SEPARATOR str_val])
</code></pre></div></li></ul></li> <li><p>window functions — tbd</p> <ul><li><code>null_treatment</code> — for ANSI SQL conformance, permits only <code>RESPECT NULLS</code></li> <li><code>LEAD(expr [, N[, default]]) [null_treatment] over_clause</code></li> <li><code>LAG(expr [, N[, default]]) [null_treatment] over_clause</code></li> <li><code>NTILE</code></li> <li><code>CUME_DIST</code></li> <li><code>DENSE_RANK() over_clause</code> — consecutive even when duplicates</li> <li><code>PERCENT_RANK</code></li> <li><code>RANK() over_clause</code> — not consecutive when duplicate</li> <li><code>ROW_NUMBER() over_clause</code></li></ul></li></ol> <h3 id="Other-Functions"><a href="#Other-Functions" class="header-anchor">#</a> Other Functions</h3> <ol><li><p>full-text search functions — for <code>FULLTEXT</code> index types, tbd</p> <div class="language- extra-class"><pre class="language-text"><code>MATCH (col1,col2,...) AGAINST (expr [search_modifier])
search_modifier:
  {
       IN NATURAL LANGUAGE MODE
     | IN NATURAL LANGUAGE MODE WITH QUERY EXPANSION
     | IN BOOLEAN MODE
     | WITH QUERY EXPANSION
  }
</code></pre></div></li> <li><p>encryption and compression</p> <ul><li><code>SHA1()</code>, <code>SHA2()</code>, <code>SHA()</code></li> <li><code>MD5()</code></li> <li>more</li></ul></li> <li><p>lock functions</p></li> <li><p>information functions</p> <ul><li><code>BENCHMARK(count,expr)</code> — executes the expression <code>expr</code> repeatedly <code>count</code> times, scalar expressions only</li> <li>last query
<ul><li><code>FOUND_ROWS()</code> — for last <code>LIMIT</code></li> <li><code>ROW_COUNT()</code></li> <li><code>LAST_INSERT_ID()</code>, <code>LAST_INSERT_ID(expr)</code></li></ul></li> <li>client, current session
<ul><li><code>VERSION()</code></li> <li><code>USER()</code>, <code>SESSION_USER()</code>, <code>SYSTEM_USER()</code></li> <li><code>CONNECTION_ID()</code></li> <li><code>CURRENT_ROLE()</code></li> <li><code>CURRENT_USER</code>, <code>CURRENT_USER()</code></li> <li><code>DATABASE()</code>, <code>SCHEMA()</code></li></ul></li></ul></li> <li><p>miscellaneous functions</p> <ul><li>UUID — see docs for arguments
<ul><li><code>BIN_TO_UUID()</code></li> <li><code>IS_UUID()</code></li> <li><code>UUID()</code></li> <li><code>UUID_SHORT()</code></li> <li><code>UUID_TO_BIN()</code></li></ul></li> <li>column related during statements
<ul><li><code>DEFAULT(col_name)</code> — <code>DEFAULT</code> value for <code>col_name</code></li> <li><code>GROUPING(expr [, expr] ...)</code> — see <code>GROUP BY</code></li> <li><code>ANY_VALUE(arg)</code> — see <code>GROUP BY</code></li></ul></li></ul></li></ol> <h3 id="Expressions"><a href="#Expressions" class="header-anchor">#</a> Expressions</h3> <ol><li><p>expression</p> <div class="language- extra-class"><pre class="language-text"><code>expr:
    expr OR expr
  | expr || expr
  | expr XOR expr
  | expr AND expr
  | expr &amp;&amp; expr
  | NOT expr
  | ! expr
  | boolean_primary IS [NOT] {TRUE | FALSE | UNKNOWN}
  | boolean_primary
</code></pre></div></li> <li><p><code>boolean_primary</code></p> <div class="language- extra-class"><pre class="language-text"><code>boolean_primary:
    boolean_primary IS [NOT] NULL
  | boolean_primary &lt;=&gt; predicate
  | boolean_primary comparison_operator predicate
  | boolean_primary comparison_operator {ALL | ANY} (subquery)
  | predicate
</code></pre></div><ul><li><code>comparison_operator</code><div class="language- extra-class"><pre class="language-text"><code>comparison_operator: = | &gt;= | &gt; | &lt;= | &lt; | &lt;&gt; | !=
</code></pre></div></li></ul></li> <li><p><code>predicate</code></p> <div class="language- extra-class"><pre class="language-text"><code>predicate:
    bit_expr [NOT] IN (subquery)
  | bit_expr [NOT] IN (expr [, expr] ...)
  | bit_expr [NOT] BETWEEN bit_expr AND predicate
  | bit_expr SOUNDS LIKE bit_expr
  | bit_expr [NOT] LIKE simple_expr [ESCAPE simple_expr]
  | bit_expr [NOT] REGEXP bit_expr
  | bit_expr
</code></pre></div></li> <li><p><code>bit_expr</code></p> <div class="language- extra-class"><pre class="language-text"><code>bit_expr:
    bit_expr | bit_expr
  | bit_expr &amp; bit_expr
  | bit_expr &lt;&lt; bit_expr
  | bit_expr &gt;&gt; bit_expr
  | bit_expr + bit_expr
  | bit_expr - bit_expr
  | bit_expr * bit_expr
  | bit_expr / bit_expr
  | bit_expr DIV bit_expr
  | bit_expr MOD bit_expr
  | bit_expr % bit_expr
  | bit_expr ^ bit_expr
  | bit_expr + interval_expr
  | bit_expr - interval_expr
  | simple_expr
</code></pre></div></li> <li><p><code>simple_expr</code></p> <div class="language- extra-class"><pre class="language-text"><code>simple_expr:
    literal
  | identifier
  | function_call
  | simple_expr COLLATE collation_name
  | param_marker
  | variable
  | simple_expr || simple_expr
  | + simple_expr
  | - simple_expr
  | ~ simple_expr
  | ! simple_expr
  | BINARY simple_expr
  | (expr [, expr] ...)
  | ROW (expr, expr [, expr] ...)
  | (subquery)
  | EXISTS (subquery)
  | match_expr
  | case_expr
  | interval_expr
</code></pre></div><ul><li><code>variable</code> — user variables, system variables, or stored program local variables or parameters</li> <li><code>param_marker</code> — <code>?</code> in <code>PREPARE</code></li></ul></li> <li><p><code>interval_expr</code> — represents a temporal interval, for <code>+</code>, <code>-</code> and functions like <code>DATE_ADD()</code> and <code>DATE_SUB()</code></p> <div class="language- extra-class"><pre class="language-text"><code>INTERVAL expr unit
</code></pre></div><ul><li><code>expr</code> here — quantity in <code>unit</code>, should be in the format according to <code>unit</code></li> <li><code>unit</code> <ul><li><code>MICROSECOND</code>, <code>SECOND</code>, <code>MINUTE</code>, <code>HOUR</code>, <code>DAY</code>, <code>WEEK</code>, <code>MONTH</code>, <code>QUARTER</code>, <code>YEAR</code> — expect number</li> <li><code>SECOND_MICROSECOND</code>, <code>MINUTE_MICROSECOND</code>, <code>MINUTE_SECOND</code>, <code>HOUR_MICROSECOND</code>, <code>HOUR_SECOND</code>, <code>HOUR_MINUTE</code> — from left part to right part, expect any punctuation delimited string</li> <li><code>DAY_MICROSECOND</code>, <code>DAY_SECOND</code>, <code>DAY_MINUTE</code>, <code>DAY_HOUR</code> — like above but with days spaced: <code>'DAYS HOURS:MINUTES:SECONDS.MICROSECONDS'</code></li> <li><code>YEAR_MONTH</code> — <code>'YEARS-MONTHS'</code></li></ul></li></ul></li></ol> <h2 id="Distributed-MySQL"><a href="#Distributed-MySQL" class="header-anchor">#</a> Distributed MySQL</h2> <h3 id="Partition"><a href="#Partition" class="header-anchor">#</a> Partition</h3> <ol><li><p>partition in MySQL</p> <ul><li>partitioning types — horizontal, error when cannot decide partition
<ul><li><code>RANGE</code> partitioning — partitions based on column values falling within a given range
<ul><li><code>RANGE COLUMNS</code> partitioning — enables the use of multiple columns in partitioning keys</li></ul></li> <li><code>LIST</code> partitioning — partitions based on column values matching one of a set of discrete values
<ul><li><code>LIST COLUMNS</code> partitioning — enables the use of multiple columns in partitioning keys</li></ul></li> <li><code>HASH</code> partitioning — partitions based on user provided hash function on column values
<ul><li><code>LINEAR HASH</code> — data is less likely to be evenly distributed, but adding, dropping, merging, and splitting of partitions is made much faster</li> <li><code>KEY</code> partitioning — similar to <code>HASH</code>, except that MySQL supplies the hashing function</li></ul></li></ul></li> <li>composite partitioning — with <code>SUBPARTITION</code></li> <li>limitation — all columns used in the table's partitioning expression must be part of every unique key that the table may have, including any primary key, see docs for more</li> <li>corresponding table in <code>INFORMATION_SCHEMA</code> — <code>INFORMATION_SCHEMA.PARTITIONS</code></li></ul></li> <li><p><code>partition_options</code> in <code>CREATE TABLE</code></p> <div class="language- extra-class"><pre class="language-text"><code>PARTITION BY
    { [LINEAR] HASH(expr)
    | [LINEAR] KEY [ALGORITHM={1|2}] (column_list)
    | RANGE{(expr) | COLUMNS(column_list)}
    | LIST{(expr) | COLUMNS(column_list)} }
[PARTITIONS num]
[SUBPARTITION BY
    { [LINEAR] HASH(expr)
    | [LINEAR] KEY [ALGORITHM={1|2}] (column_list) }
  [SUBPARTITIONS num]
]
[(partition_definition [, partition_definition] ...)]
</code></pre></div><ul><li><code>partition_definition</code><div class="language- extra-class"><pre class="language-text"><code>PARTITION partition_name
    [VALUES
        {LESS THAN {(expr | value_list) | MAXVALUE}
        |
        IN (value_list)}]
    [[STORAGE] ENGINE [=] engine_name]
    [COMMENT [=] 'string' ]
    [DATA DIRECTORY [=] 'data_dir']
    [INDEX DIRECTORY [=] 'index_dir']
    [MAX_ROWS [=] max_number_of_rows]
    [MIN_ROWS [=] min_number_of_rows]
    [TABLESPACE [=] tablespace_name]
    [(subpartition_definition [, subpartition_definition] ...)]
</code></pre></div><ul><li><code>subpartition_definition</code><div class="language- extra-class"><pre class="language-text"><code>SUBPARTITION logical_name
    [[STORAGE] ENGINE [=] engine_name]
    [COMMENT [=] 'string' ]
    [DATA DIRECTORY [=] 'data_dir']
    [INDEX DIRECTORY [=] 'index_dir']
    [MAX_ROWS [=] max_number_of_rows]
    [MIN_ROWS [=] min_number_of_rows]
    [TABLESPACE [=] tablespace_name]
</code></pre></div></li></ul></li></ul></li> <li><p><code>partition_options</code> in <code>ALTER TABLE</code></p> <div class="language- extra-class"><pre class="language-text"><code>partition_options:
    partition_option [partition_option] ...
partition_option:
    ADD PARTITION (partition_definition)
  | DROP PARTITION partition_names
  | DISCARD PARTITION {partition_names | ALL} TABLESPACE
  | IMPORT PARTITION {partition_names | ALL} TABLESPACE
  | TRUNCATE PARTITION {partition_names | ALL}
  | COALESCE PARTITION number
  | REORGANIZE PARTITION partition_names INTO (partition_definitions)
  | EXCHANGE PARTITION partition_name WITH TABLE tbl_name [{WITH|WITHOUT} VALIDATION]
  | ANALYZE PARTITION {partition_names | ALL}
  | CHECK PARTITION {partition_names | ALL}
  | OPTIMIZE PARTITION {partition_names | ALL}
  | REBUILD PARTITION {partition_names | ALL}
  | REPAIR PARTITION {partition_names | ALL}
  | REMOVE PARTITIONING
</code></pre></div><ul><li>see <code>partition_options</code> in <code>CREATE TABLE</code> for other syntax</li></ul></li> <li><p><code>PARTITION</code> clause in DML — see corresponding DML</p></li></ol> <h2 id="System-Variables"><a href="#System-Variables" class="header-anchor">#</a> System Variables</h2> <ol><li><p><code>SHOW VARIABLES</code></p> <div class="language- extra-class"><pre class="language-text"><code>SHOW [GLOBAL | SESSION] VARIABLES
    [LIKE 'pattern' | WHERE expr]
</code></pre></div><ul><li>corresponding table in <code>PERFORMANCE_SCHEMA</code> — <code>PERFORMANCE_SCHEMA.global_variables</code>, <code>PERFORMANCE_SCHEMA.session_variables</code>, <code>PERFORMANCE_SCHEMA.persisted_variables</code>, <code>PERFORMANCE_SCHEMA.variables_by_thread</code>, <code>PERFORMANCE_SCHEMA.variables_info</code></li> <li>CLI — <code>mysqladmin variables</code></li></ul></li> <li><p><code>SET</code></p> <div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">SET</span> sql_mode<span class="token operator">=</span><span class="token string">'TIME_TRUNCATE_FRACTIONAL'</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> @<span class="token variable">@sql_mode</span><span class="token operator">=</span><span class="token string">'TIME_TRUNCATE_FRACTIONAL'</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><code>@@</code> — indicate explicitly that a variable is a session variable</li> <li><code>@@global.</code>, <code>@@session.</code> prefixes</li></ul></li> <li><p><code>sql_mode</code>, separated by <code>,</code></p> <div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">SET</span> @<span class="token variable">@sql_mode</span> <span class="token operator">=</span> sys<span class="token punctuation">.</span>list_add<span class="token punctuation">(</span>@<span class="token variable">@sql_mode</span><span class="token punctuation">,</span> <span class="token string">'TIME_TRUNCATE_FRACTIONAL'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>strict mode —  <code>STRICT_ALL_TABLES</code> or <code>STRICT_TRANS_TABLES</code> <ul><li>effects — warnings become errors, see docs <a href="https://dev.mysql.com/doc/refman/8.0/en/sql-mode.html#sql-mode-strict" target="_blank" rel="noopener noreferrer">5.1.11 Server SQL Modes<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>temporarily non-strict — <code>INSERT IGNORE</code> or <code>UPDATE IGNORE</code></li></ul></li> <li><code>NO_UNSIGNED_SUBTRACTION</code></li> <li><code>PAD_CHAR_TO_FULL_LENGTH</code></li> <li><code>NO_ZERO_IN_DATE</code></li> <li><code>ANSI_QUOTES</code> — Treat <code>&quot;</code> as an identifier quote character (like the <code>`</code> quote character) and not as a string quote character
</li> <li><code>NO_BACKSLASH_ESCAPES</code> — Disable the use of the backslash character (<code>\</code>) as an escape character within strings and identifiers</li> <li><code>PIPES_AS_CONCAT</code></li></ul></li> <li><p>system variables — tbd</p> <ul><li><code>time_zone</code></li> <li><code>max_sort_length</code></li> <li><code>sql_auto_is_null</code></li> <li>character set
<ul><li><code>character_set_connection</code></li></ul></li></ul></li></ol></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/tangentyh/notes-of-tan/edit/master/docs/backend/SQL_notes.md" target="_blank" rel="noopener noreferrer">Edit This Page On GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2/9/2021, 4:33:59 AM</span></div></footer> <!----> </main></div><div class="global-ui"><!----><div class="vuepress-eqn"></div><span class="vuepress-eq"></span></div></div>
    <script src="/notes-of-tan/assets/js/app.5f580515.js" defer></script><script src="/notes-of-tan/assets/js/2.33f31c9b.js" defer></script><script src="/notes-of-tan/assets/js/18.0d515c6a.js" defer></script>
  </body>
</html>
