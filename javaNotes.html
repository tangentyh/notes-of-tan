<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Docs | Notes of Tan</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="https://v1.vuepress.vuejs.org/hero.png">
    <meta name="description" content="Tan's notes.">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/notes-of-tan/assets/css/0.styles.f8fd4e37.css" as="style"><link rel="preload" href="/notes-of-tan/assets/js/app.e6faf742.js" as="script"><link rel="preload" href="/notes-of-tan/assets/js/2.82b804b0.js" as="script"><link rel="preload" href="/notes-of-tan/assets/js/30.17337f4d.js" as="script"><link rel="prefetch" href="/notes-of-tan/assets/js/10.57f9ec2b.js"><link rel="prefetch" href="/notes-of-tan/assets/js/11.d2c43f8a.js"><link rel="prefetch" href="/notes-of-tan/assets/js/12.728f631e.js"><link rel="prefetch" href="/notes-of-tan/assets/js/13.f9139ce0.js"><link rel="prefetch" href="/notes-of-tan/assets/js/14.27526f21.js"><link rel="prefetch" href="/notes-of-tan/assets/js/15.a7eef278.js"><link rel="prefetch" href="/notes-of-tan/assets/js/16.cb845c55.js"><link rel="prefetch" href="/notes-of-tan/assets/js/17.ddb48f13.js"><link rel="prefetch" href="/notes-of-tan/assets/js/18.694f98be.js"><link rel="prefetch" href="/notes-of-tan/assets/js/19.d6921d49.js"><link rel="prefetch" href="/notes-of-tan/assets/js/20.16d48c16.js"><link rel="prefetch" href="/notes-of-tan/assets/js/21.074c3f9e.js"><link rel="prefetch" href="/notes-of-tan/assets/js/22.35ef7c3a.js"><link rel="prefetch" href="/notes-of-tan/assets/js/23.027ea32f.js"><link rel="prefetch" href="/notes-of-tan/assets/js/24.c1519d8b.js"><link rel="prefetch" href="/notes-of-tan/assets/js/25.814d8043.js"><link rel="prefetch" href="/notes-of-tan/assets/js/26.926a92d0.js"><link rel="prefetch" href="/notes-of-tan/assets/js/27.94e4428d.js"><link rel="prefetch" href="/notes-of-tan/assets/js/28.175070e9.js"><link rel="prefetch" href="/notes-of-tan/assets/js/29.5d06ed42.js"><link rel="prefetch" href="/notes-of-tan/assets/js/3.14cc1947.js"><link rel="prefetch" href="/notes-of-tan/assets/js/31.834ae95e.js"><link rel="prefetch" href="/notes-of-tan/assets/js/32.94aab8c5.js"><link rel="prefetch" href="/notes-of-tan/assets/js/33.0bbadca7.js"><link rel="prefetch" href="/notes-of-tan/assets/js/34.373857b6.js"><link rel="prefetch" href="/notes-of-tan/assets/js/35.4828d9ff.js"><link rel="prefetch" href="/notes-of-tan/assets/js/36.86f91b8f.js"><link rel="prefetch" href="/notes-of-tan/assets/js/37.fae9b563.js"><link rel="prefetch" href="/notes-of-tan/assets/js/4.bab622cd.js"><link rel="prefetch" href="/notes-of-tan/assets/js/5.b3fa97d8.js"><link rel="prefetch" href="/notes-of-tan/assets/js/6.f90d50ad.js"><link rel="prefetch" href="/notes-of-tan/assets/js/7.ff83a28e.js"><link rel="prefetch" href="/notes-of-tan/assets/js/8.9978b48b.js"><link rel="prefetch" href="/notes-of-tan/assets/js/9.96d16d2f.js">
    <link rel="stylesheet" href="/notes-of-tan/assets/css/0.styles.f8fd4e37.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notes-of-tan/" class="home-link router-link-active"><!----> <span class="site-name">Notes of Tan</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/notes-of-tan/backend/java/javaBasics.html" class="nav-link">
  Java
</a></div> <a href="https://github.com/tangentyh/notes-of-tan" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/notes-of-tan/backend/java/javaBasics.html" class="nav-link">
  Java
</a></div> <a href="https://github.com/tangentyh/notes-of-tan" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Docs</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes-of-tan/javaNotes.html#jar" class="sidebar-link">JAR</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/javaNotes.html#control-flow" class="sidebar-link">Control Flow</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/javaNotes.html#package" class="sidebar-link">Package</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/javaNotes.html#data-types" class="sidebar-link">Data Types</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes-of-tan/javaNotes.html#primitive-types" class="sidebar-link">primitive types</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/javaNotes.html#other-types" class="sidebar-link">other types</a></li></ul></li><li><a href="/notes-of-tan/javaNotes.html#classes-and-modifiers" class="sidebar-link">Classes and Modifiers</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/javaNotes.html#math" class="sidebar-link">Math</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/javaNotes.html#built-in-classes" class="sidebar-link">Built-In Classes</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes-of-tan/javaNotes.html#system" class="sidebar-link">System</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/javaNotes.html#string" class="sidebar-link">String</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/javaNotes.html#object-wrappers" class="sidebar-link">Object Wrappers</a></li></ul></li><li><a href="/notes-of-tan/javaNotes.html#interfaces" class="sidebar-link">Interfaces</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes-of-tan/javaNotes.html#common-interfaces" class="sidebar-link">Common Interfaces</a></li></ul></li><li><a href="/notes-of-tan/javaNotes.html#lambdas" class="sidebar-link">Lambdas</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes-of-tan/javaNotes.html#common-functional-interfaces" class="sidebar-link">Common Functional Interfaces</a></li></ul></li><li><a href="/notes-of-tan/javaNotes.html#inner-class" class="sidebar-link">Inner Class</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/javaNotes.html#proxy" class="sidebar-link">Proxy</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/javaNotes.html#arrays" class="sidebar-link">Arrays</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/javaNotes.html#event-handling" class="sidebar-link">Event Handling</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/javaNotes.html#collections-and-maps" class="sidebar-link">Collections and Maps</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes-of-tan/javaNotes.html#list" class="sidebar-link">List</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/javaNotes.html#queue" class="sidebar-link">Queue</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/javaNotes.html#set" class="sidebar-link">Set</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/javaNotes.html#maps" class="sidebar-link">Maps</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/javaNotes.html#views-and-wrappers" class="sidebar-link">Views and Wrappers</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/javaNotes.html#legacy-collections" class="sidebar-link">Legacy Collections</a></li></ul></li><li><a href="/notes-of-tan/javaNotes.html#preferences" class="sidebar-link">Preferences</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/javaNotes.html#stream" class="sidebar-link">Stream</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/javaNotes.html#spi-service-loader" class="sidebar-link">SPI (Service Loader)</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/javaNotes.html#other-utils" class="sidebar-link">Other Utils</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/javaNotes.html#zip-checksum-and-encryption" class="sidebar-link">ZIP, Checksum and Encryption</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/javaNotes.html#debugging" class="sidebar-link">Debugging</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/javaNotes.html#exceptions" class="sidebar-link">Exceptions</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/javaNotes.html#exception-handling" class="sidebar-link">Exception Handling</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/javaNotes.html#assertion" class="sidebar-link">Assertion</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/javaNotes.html#logging" class="sidebar-link">Logging</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes-of-tan/javaNotes.html#logger" class="sidebar-link">Logger</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/javaNotes.html#log-levels-and-records" class="sidebar-link">Log Levels and Records</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/javaNotes.html#handlers" class="sidebar-link">Handlers</a></li></ul></li><li><a href="/notes-of-tan/javaNotes.html#standard-annotations" class="sidebar-link">Standard Annotations</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/javaNotes.html#source-level-annotation-processing" class="sidebar-link">Source-Level Annotation Processing</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/javaNotes.html#thread" class="sidebar-link">Thread</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/javaNotes.html#synchronization-and-locks" class="sidebar-link">Synchronization and Locks</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/javaNotes.html#volatile-and-atomics" class="sidebar-link">volatile and Atomics</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/javaNotes.html#thread-safe-collections" class="sidebar-link">Thread-Safe Collections</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes-of-tan/javaNotes.html#blocking-queues" class="sidebar-link">Blocking Queues</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/javaNotes.html#concurrent-collections" class="sidebar-link">Concurrent Collections</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/javaNotes.html#copy-on-write-collections" class="sidebar-link">Copy on Write Collections</a></li></ul></li><li><a href="/notes-of-tan/javaNotes.html#callable-and-future" class="sidebar-link">Callable and Future</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/javaNotes.html#executors" class="sidebar-link">Executors</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes-of-tan/javaNotes.html#fork-join" class="sidebar-link">Fork-Join</a></li></ul></li><li><a href="/notes-of-tan/javaNotes.html#synchronizers" class="sidebar-link">Synchronizers</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes-of-tan/javaNotes.html#count-synchronizers" class="sidebar-link">Count Synchronizers</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/javaNotes.html#data-exchange-synchronizers" class="sidebar-link">Data Exchange Synchronizers</a></li></ul></li><li><a href="/notes-of-tan/javaNotes.html#regex" class="sidebar-link">Regex</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes-of-tan/javaNotes.html#regex-syntax" class="sidebar-link">Regex Syntax</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/javaNotes.html#regex-classes" class="sidebar-link">Regex Classes</a></li></ul></li><li><a href="/notes-of-tan/javaNotes.html#format" class="sidebar-link">Format</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/javaNotes.html#console" class="sidebar-link">Console</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/javaNotes.html#basic-io-stream" class="sidebar-link">Basic IO Stream</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/javaNotes.html#filter-stream" class="sidebar-link">Filter Stream</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes-of-tan/javaNotes.html#zip-streams" class="sidebar-link">ZIP Streams</a></li></ul></li><li><a href="/notes-of-tan/javaNotes.html#print-stream" class="sidebar-link">Print Stream</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/javaNotes.html#other-streams" class="sidebar-link">Other Streams</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/javaNotes.html#serialization" class="sidebar-link">Serialization</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/javaNotes.html#files" class="sidebar-link">Files</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes-of-tan/javaNotes.html#file-classes" class="sidebar-link">File Classes</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/javaNotes.html#file-options-and-attributes" class="sidebar-link">File Options and Attributes</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/javaNotes.html#file-stream" class="sidebar-link">File Stream</a></li></ul></li><li><a href="/notes-of-tan/javaNotes.html#nio-buffers" class="sidebar-link">NIO Buffers</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/javaNotes.html#nio-channels" class="sidebar-link">NIO Channels</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes-of-tan/javaNotes.html#channel-interfaces" class="sidebar-link">Channel Interfaces</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/javaNotes.html#selector" class="sidebar-link">Selector</a></li><li class="sidebar-sub-header"><a href="/notes-of-tan/javaNotes.html#channel-implementations" class="sidebar-link">Channel Implementations</a></li></ul></li><li><a href="/notes-of-tan/javaNotes.html#address" class="sidebar-link">Address</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/javaNotes.html#sockets" class="sidebar-link">Sockets</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/javaNotes.html#uri-and-url" class="sidebar-link">URI and URL</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes-of-tan/javaNotes.html#http-cookie" class="sidebar-link">HTTP Cookie</a></li></ul></li><li><a href="/notes-of-tan/javaNotes.html#jdbc-properties" class="sidebar-link">JDBC Properties</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/javaNotes.html#jdbc-classes" class="sidebar-link">JDBC Classes</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes-of-tan/javaNotes.html#row-sets" class="sidebar-link">Row Sets</a></li></ul></li><li><a href="/notes-of-tan/javaNotes.html#number-format" class="sidebar-link">Number Format</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/javaNotes.html#collator-and-normalizer" class="sidebar-link">Collator and Normalizer</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/javaNotes.html#resource-bundles" class="sidebar-link">Resource Bundles</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/javaNotes.html#reference" class="sidebar-link">Reference</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes-of-tan/javaNotes.html#class-loading" class="sidebar-link">Class Loading</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="docs"><a href="#docs" class="header-anchor">#</a> Docs</h1> <ol><li><p>docs</p> <ul><li><a href="https://docs.oracle.com/javase/8/docs/api/index.html" target="_blank" rel="noopener noreferrer">oracle JDK 1.8<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://docs.oracle.com/javase/9/jshell/toc.htm" target="_blank" rel="noopener noreferrer">jshell<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://docs.oracle.com/javase/8/docs/technotes/tools/unix/toc.html" target="_blank" rel="noopener noreferrer">Java Platform, Standard Edition Tools Reference for Oracle JDK on Solaris, Linux, and OS X, Release 8<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://download.oracle.com/otndocs/jcp/jdbc-4_3-mrel3-spec/index.html" target="_blank" rel="noopener noreferrer">JSR-000221 JDBC API 4.3 Maintenance Release 3<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://stackoverflow.com/questions/6986993/how-to-download-javadoc-to-read-offline/36497090" target="_blank" rel="noopener noreferrer">download<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <ul><li><a href="https://www.oracle.com/technetwork/java/javase/documentation/jdk8-doc-downloads-2133158.html" target="_blank" rel="noopener noreferrer">Java Development Kit 8 Documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></li> <li><p><a href="http://docs.oracle.com/javase/specs" target="_blank" rel="noopener noreferrer">specification<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li><a href="https://docs.oracle.com/javase/specs/jvms/se8/html/" target="_blank" rel="noopener noreferrer">The Java® Virtual Machine Specification<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ol> <h1 id="cli"><a href="#cli" class="header-anchor">#</a> CLI</h1> <ol><li><p><code>javac</code> — compile</p> <ul><li>timestamps aware — auto compile dependencies and recompile when source file updated according to timestamps</li> <li>extra options — <code>--help-extra</code>, <code>-X</code></li> <li><code>-Xlint:&lt;key&gt;(,&lt;key&gt;)*</code> — enable warnings
<ul><li><code>-Xlint</code> or <code>-Xlint:all</code> — all checks</li> <li><code>-Xlint:deprecation</code> — Same as <code>-deprecation</code>, checks for deprecated methods</li> <li><code>-Xlint:fallthrough</code> — Checks for missing <code>break</code> statements in <code>switch</code> statements</li> <li><code>-Xlint:finally</code> — Warns about finally clauses that cannot complete normally</li> <li><code>-Xlint:none</code> — Carries out none of the checks</li> <li><code>-Xlint:path</code> — Checks that all directories on the class path and source path exist</li> <li><code>-Xlint:serial</code> — Warns about serializable classes without <code>serialVersionUID</code></li> <li><code>-Xlint:unchecked</code> — Warns of unsafe conversions between generic and raw types</li></ul></li></ul></li> <li><p><code>java</code> — execute</p> <ul><li>synopsis<div class="language- extra-class"><pre class="language-text"><code>java [options] &lt;mainclass&gt; [args...]
    (to execute a class)
java [options] -m &lt;module&gt;[/&lt;mainclass&gt;] [args...]
java [options] --module &lt;module&gt;[/&lt;mainclass&gt;] [args...]
    (to execute the main class in a module)
</code></pre></div><ul><li>args in <code>public static void main(String[] args)</code> — class name is not included<div class="language-shell extra-class"><pre class="language-shell"><code>java Message -g cruel world
<span class="token comment"># args: [&quot;-g&quot;, &quot;cruel&quot;, &quot;world&quot;]</span>
</code></pre></div></li> <li>jar — <code>java -jar MyProgram.jar</code>, see <a href="#JAR">Jar</a><div class="language- extra-class"><pre class="language-text"><code>java [options] -jar &lt;jarfile&gt; [args...]
</code></pre></div></li> <li>single source file program — compile and run, no <code>.class</code> file generated<div class="language- extra-class"><pre class="language-text"><code>java [options] &lt;sourcefile&gt; [args]
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>java ClassName.java
</code></pre></div></li></ul></li> <li><code>-cp</code> or <code>-classpath</code> — specify the class path<div class="language-shell extra-class"><pre class="language-shell"><code>java -classpath /home/user/classdir:.:/home/user/archives/archive.jar MyProg
</code></pre></div></li> <li><code>-verbose</code> — watch class loading</li> <li><code>java -X</code> — a listing of all nonstandard options
<ul><li><code>-Xprof</code> — profiling, support was removed in 10.0</li> <li><code>-XshowSettings:properties</code>, <code>-XshowSettings:locale</code></li> <li><code>-Xverify:none</code>, or <code>-noverify</code> — turn off verification when loading classes</li></ul></li> <li>enable and disable assertion — see <a href="#Assertion">Assertion</a></li> <li>system properties — <code>-D</code>, <code>System::getProperty</code>, <code>System::getProperties</code> <ul><li>log related — see <a href="#Logging">Logging</a> <ul><li>log configuration file location — <code>-Djava.util.logging.config.file=configFile</code></li></ul></li> <li>see <a href="#Legacy%20Collections"><code>Properties</code></a> for list of system properties</li></ul></li> <li>remote debug<div class="language-shell extra-class"><pre class="language-shell"><code>java -Xdebug -Xrunjdwp:server<span class="token operator">=</span>y,transport<span class="token operator">=</span>dt_socket,address<span class="token operator">=</span><span class="token number">8000</span>,suspend<span class="token operator">=</span>n <span class="token punctuation">\</span>
  -jar target/myapplication-0.0.1-SNAPSHOT.jar <span class="token comment"># remote debug</span>
</code></pre></div></li></ul></li> <li><p><code>javaw</code> — <code>java</code> without a shell window</p></li> <li><p><code>javadoc</code> — generates HTML documentation from your source files</p> <ul><li>information source
<ul><li>Packages</li> <li>Public classes and interfaces</li> <li>Public and protected fields</li> <li>Public and protected constructors and methods</li></ul></li> <li>assets directory — <code>/doc-files</code> directory for assets</li> <li>syntax
<ul><li><code>/** ... */</code></li> <li>tags <code>@</code> <ul><li><code>@param variable description</code></li> <li><code>@return description</code></li> <li><code>@throws class description</code></li> <li>more</li></ul></li> <li>HTML tags
<ul><li>use <code>{@code ... }</code> instead of <code>&lt;code&gt;...&lt;/code&gt;</code> to cope with escaping of <code>^</code></li></ul></li></ul></li> <li>example<div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * Raises the salary of an employee.
 * @param byPercent the percentage by which to raise the salary (e.g. 10 means 10%)
 * @return the amount of the raise
 */</span>
<span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">raiseSalary</span><span class="token punctuation">(</span><span class="token keyword">double</span> byPercent<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div></li> <li>more</li></ul></li> <li><p><code>javap</code> — print java class information</p> <ul><li><code>-v</code> — verbose</li> <li><code>-c</code> — Disassemble the code
<ul><li>can be used to inspect if atomic</li></ul></li></ul></li> <li><p><code>jshell</code> — REPL from Java 9</p></li> <li><p><code>jconsole</code> — Java Monitoring and Management Console</p></li> <li><p><code>jmap</code> and <code>jhat</code> (deprecated) for heap dump and examining dump — see <a href="#Debugging">Debugging</a></p></li> <li><p><code>serialver</code> — get serial version ID</p></li> <li><p>sign</p> <ul><li><code>keytool</code> — signatures, certificates
<ul><li>password for cacerts — <code>changeit</code></li></ul></li> <li><code>jarsigner</code> — add a signature to a (jar) file</li></ul></li> <li><p><code>javah</code> — produces a C header file from class files for <code>native</code> methods</p></li></ol> <h2 id="jar"><a href="#jar" class="header-anchor">#</a> JAR</h2> <ol><li><p><code>jar</code> — creates an archive for classes and resources, and can manipulate or restore individual classes or resources from an archive</p> <div class="language-shell extra-class"><pre class="language-shell"><code>jar <span class="token punctuation">[</span>OPTION<span class="token punctuation">..</span>.<span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token punctuation">[</span>--release VERSION<span class="token punctuation">]</span> <span class="token punctuation">[</span>-C dir<span class="token punctuation">]</span> files<span class="token punctuation">]</span> <span class="token punctuation">..</span>.
</code></pre></div><ul><li><a href="https://docs.oracle.com/javase/8/docs/technotes/guides/jar/" target="_blank" rel="noopener noreferrer">docs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>compression — ZIP</li> <li>similar to <code>tar</code><div class="language-shell extra-class"><pre class="language-shell"><code>jar cvf JARFileName File1 File2 <span class="token punctuation">..</span>.
</code></pre></div></li> <li><code>.exe</code> wrapper — Launch4J, IzPack, etc.</li> <li>resources
<ul><li>resources finding — delegates to class loader, which remembers how to locate the class, so it can then search for the associated resource in the same location</li> <li><code>URL Class::getResource(String name)</code>, <code>InputStream Class::getResourceAsStream(String name)</code></li> <li>resource name
<ul><li>absolute — starts with <code>/</code></li> <li>relative — <code>data/text/about.txt</code></li></ul></li></ul></li></ul></li> <li><p>manifest</p> <div class="language-manifest extra-class"><pre class="language-text"><code>Manifest-Version: 1.0
lines describing this archive

Name: Woozle.class
lines describing this file
Name: com/mycompany/mypkg/
lines describing this package
</code></pre></div><ul><li>each jar file contains a <code>META-INF/MANIFEST.MF</code> manifest file</li> <li>syntax — key-value entries
<ul><li>main section — starts with <code>Manifest-Version</code>, applies to the whole JAR file</li> <li>Subsequent entries — starts with <code>Name</code>, can specify properties of named entities such as individual files, packages, or URLs</li> <li>section delimiter — blank lines</li> <li>file end — the file must end with a newline</li></ul></li> <li>edit manifest<div class="language-shell extra-class"><pre class="language-shell"><code>jar cfm JARFileName ManifestFileName <span class="token punctuation">..</span>. <span class="token comment"># create</span>
jar ufm MyArchive.jar manifest-additions.mf <span class="token comment"># update</span>
</code></pre></div></li> <li>specify entry point for execution
<ul><li><code>jar -e</code> option</li> <li><code>Main-Class</code> in manifest</li> <li>execution — <code>java -jar MyProgram.jar</code></li></ul></li> <li>sealing — a package can have no more classes, <code>Sealed: boolean</code>, <code>false</code> by default<div class="language-manifest extra-class"><pre class="language-text"><code>Name: com/mycompany/util/
Sealed: true
</code></pre></div><ul><li>global default defined in main section</li></ul></li></ul></li></ol> <h1 id="philosophy"><a href="#philosophy" class="header-anchor">#</a> Philosophy</h1> <ol><li><p>class based</p> <ul><li>everything inside class</li></ul></li> <li><p>camelCase naming</p> <ul><li><code>Character.isJavaIdentifierStart()</code> and <code>Character.isJavaIdentifierPart()</code></li> <li><code>$</code> is intended for names that are generated by the Java compiler and other tools</li></ul></li> <li><p>curly braces and semicolons</p></li> <li><p>initialize local variables before read otherwise compilation error</p></li> <li><p>does not have operator overloading</p></li></ol> <h2 id="control-flow"><a href="#control-flow" class="header-anchor">#</a> Control Flow</h2> <ol><li><p>no block variable shadowing — may not declare identically named variables in two nested blocks</p> <ul><li>in JS and C++ inner one shadows outer one</li></ul></li> <li><p><code>switch</code></p> <ul><li>A case label can be
<ul><li>primitive type expressions — a constant expression of type <code>char</code> , <code>byte</code> , <code>short</code> , or <code>int</code></li> <li><code>Enum</code> — like <code>with</code> in JS<div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Size</span> sz <span class="token operator">=</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">;</span>
<span class="token keyword">switch</span> <span class="token punctuation">(</span>sz<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">case</span> SMALL<span class="token operator">:</span> <span class="token comment">// no need to use Size.SMALL</span>
        <span class="token comment">// . . .</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token comment">// . . .</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li>strings — Starting with Java SE 7, a string literal, uses <code>hashCode()</code> behind scenes</li></ul></li></ul></li> <li><p>labeled <code>break</code> and <code>continue</code> — for labeled blocks, can only jump out of a block, never into a block</p></li> <li><p>iterator — <code>for (variable : collection) statement</code></p> <ul><li><code>collection</code> — an array or an object of a class that implements the <code>Iterable</code> interface</li> <li>see <a href="#Collections">Collections</a></li></ul></li> <li><p>vararg parameter — <code>...</code></p> <ul><li>if only an array passed, then that array is used, without nesting</li></ul></li></ol> <h2 id="package"><a href="#package" class="header-anchor">#</a> Package</h2> <ol><li><p>package</p> <ul><li>package name — reversely ordered domain</li> <li>package availability — A class can use all classes from its own package and all public classes from other packages.</li> <li>package at runtime
<ul><li>locating classes is done by compiler — the only benefit of the <code>import</code> statement is convenience</li> <li>canonical name after compilation — the byte codes in class files always canonical names to refer to other classes</li></ul></li></ul></li> <li><p>class importation</p> <ul><li>built-in — <code>java.lang</code></li> <li>without <code>import</code> — use canonical name</li> <li><code>import</code> statement<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">LocalDate</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>import a class — canonical name</li> <li>import a package — <code>*</code></li> <li>import a inner class — <code>java.util.AbstractMap.SimpleEntry</code></li> <li>solve name conflict — import the specific class, or use canonical name<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token comment">// compile-time error when use `Date` class</span>
</code></pre></div></li></ul></li> <li>static imports — the importing of static methods and fields<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span><span class="token class-name">System</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">;</span>
</code></pre></div></li></ul></li> <li><p>add to package — put the name of the package at the top of a source file</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>directory — match the canonical name<div class="language-shell extra-class"><pre class="language-shell"><code>javac com/mycompany/PayrollApp.java
java com.mycompany.PayrollApp
</code></pre></div></li> <li>default package — classes belong to the default package if no <code>package</code> statement</li> <li>no custom <code>java.</code> prefixed packages — disallow loading of user-defined classes whose package name starts with &quot;<code>java.</code>&quot;</li></ul></li> <li><p>class path</p> <div class="language- extra-class"><pre class="language-text"><code>/home/user/classdir:.:/home/user/archives/archive.jar
c:\classdir;.;c:\archives\archive.jar
</code></pre></div><ul><li>system property — <code>java.class.path</code></li> <li>possible components<div class="language-shell extra-class"><pre class="language-shell"><code>/home/user/classdir:.:/home/user/archives/<span class="token string">'*'</span>
<span class="token comment"># - In UNIX, the `*` must be escaped to prevent shell expansion.</span>
<span class="token comment"># c:\classdir;.;c:\archives\*</span>
</code></pre></div><ul><li>base directory for the package tree</li> <li>jar files</li> <li>jar file directory</li> <li>do not add runtime libary files — <code>rt.jar</code> and the other JAR files in the <code>jre/lib</code> and <code>jre/lib/ext</code> directories are always searched for classes (modules from JDK 9, and no more <code>ext</code>)</li></ul></li> <li>used by <code>java</code> but not <code>javac</code> <ul><li>the <code>javac</code> compiler — always looks for files in the current directory</li> <li>the <code>java</code> virtual machine — launcher only looks into the class path, default class path is <code>.</code></li></ul></li> <li>class search order
<ul><li>for <code>javac</code> — from <code>java.lang</code> to imports to current package</li> <li>for <code>java</code> — from runtime libary to the class path</li></ul></li> <li>set class path
<ul><li><code>-cp</code> or <code>-classpath</code> option<div class="language-shell extra-class"><pre class="language-shell"><code>java -classpath /home/user/classdir:.:/home/user/archives/archive.jar MyProg
<span class="token comment"># java -classpath c:\classdir;.;c:\archives\archive.jar MyProg</span>
</code></pre></div></li> <li>the <code>CLASSPATH</code> environment variable</li></ul></li></ul></li></ol> <h1 id="fundamentals"><a href="#fundamentals" class="header-anchor">#</a> Fundamentals</h1> <h2 id="data-types"><a href="#data-types" class="header-anchor">#</a> Data Types</h2> <h3 id="primitive-types"><a href="#primitive-types" class="header-anchor">#</a> primitive types</h3> <ol><li><p>integer types</p> <ul><li>types
<ul><li><code>byte</code></li> <li><code>short</code> — 2 bytes</li> <li><code>int</code></li> <li><code>long</code></li></ul></li> <li>number literals
<ul><li><code>long</code> — <code>l</code> or <code>L</code> suffix for <code>long</code> type</li> <li>hexadecimal, octal and binary — <code>0x</code>, <code>0</code>, <code>0b</code> or <code>0B</code></li> <li>friendly underscores — <code>1_000_000</code>, <code>0b1111_0100_0010_0100_0000</code></li></ul></li> <li>no <code>unsigned</code></li></ul></li> <li><p>float point types</p> <ul><li>types
<ul><li><code>float</code> — 4 bytes</li> <li><code>double</code></li></ul></li> <li>number literals
<ul><li><code>float</code> — <code>f</code> or <code>F</code> suffix</li> <li><code>double</code> — <code>d</code>, <code>D</code> suffix or no suffix</li> <li>exponent — <code>e</code></li> <li>binary exponent — <code>p</code>, e.g. <code>0x1.0p-3</code> (2^-3)</li></ul></li> <li>overflows and errors
<ul><li><code>Double.POSITIVE_INFINITY</code>, <code>Double.NEGATIVE_INFINITY</code>, and <code>Double.NaN</code></li> <li><code>Double.isNaN()</code></li></ul></li></ul></li> <li><p><code>char</code> — describes a code unit in the UTF-16 BE encoding</p> <ul><li>syntax — single quote</li> <li>Unicode escaping, e.g. <code>\u0fff</code> — inside and outside quotes<div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span>\u005B\u005D args<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token string">&quot;\u0022+\u0022&quot;</span> <span class="token comment">// yielding &quot;&quot;+&quot;&quot;</span>
<span class="token comment">// \u000A is a newline // syntax error</span>
<span class="token comment">// since \u000A is replaced with a newline when the program is read</span>
<span class="token comment">// Look inside c:\users // syntax error</span>
</code></pre></div><ul><li>processing — Unicode escape sequences are processed before the code is parsed</li> <li>other escapes — <code>\b</code>, <code>\t</code>, <code>\n</code>, <code>\r</code></li> <li><code>native2ascii</code> — CLI for converting the native character encoding to plain ASCII, removed in JDK 9 due to the ability to support UTF-8 based properties resource bundles</li></ul></li> <li>code unit — a 16-bit value
<ul><li>supplementary characters — whose code points are greater than <code>U+FFFF</code>, encoded as consecutive pairs of code units, a range of 2048 unused values of the basic multilingual plane</li> <li>surrogates area — high-surrogates range <code>U+D800</code> to <code>U+DBFF</code> for the first code unit, low-surrogates range <code>U+DC00</code> to <code>U+DFFF</code> for the second code unit</li></ul></li> <li>usage
<ul><li>use <code>String</code> — recommendation is not to use the <code>char</code> type unless you are actually manipulating UTF-16 code units</li></ul></li></ul></li> <li><p><code>boolean</code></p> <ul><li>cannot convert between integers and boolean values</li> <li><code>if (x = 0)</code> does not compile</li> <li>stored as <code>int</code></li></ul></li></ol> <h4 id="primitive-type-conversion"><a href="#primitive-type-conversion" class="header-anchor">#</a> primitive type conversion</h4> <ol><li><p>conversion</p> <ul><li>legal conversion — types with less information to types with more information, but not vice versa</li> <li>type priority — <code>double</code> &gt; <code>float</code> &gt; <code>long</code> &gt; <code>int</code> &gt; <code>char</code></li> <li>implicit conversion using operators — converted to a common type before the operation is carried out
<ul><li>example — for <code>int x</code>, <code>x += 3.5</code> is <code>x = (int)(x + 3.5)</code></li></ul></li></ul></li> <li><p>casts</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">double</span> x <span class="token operator">=</span> <span class="token number">9.997</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> nx <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> x<span class="token punctuation">;</span>
<span class="token keyword">int</span> nx2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Math.round() return long for double, int for float</span>
</code></pre></div><ul><li>truncate when out of range — <code>(byte) 300</code> is 44</li> <li>not between <code>boolean</code> and number — cannot cast between <code>boolean</code> values and any numeric type</li></ul></li></ol> <h3 id="other-types"><a href="#other-types" class="header-anchor">#</a> other types</h3> <ol><li><p><code>enum</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">enum</span> <span class="token class-name">Size</span> <span class="token punctuation">{</span> SMALL<span class="token punctuation">,</span> MEDIUM<span class="token punctuation">,</span> LARGE<span class="token punctuation">,</span> EXTRA_LARGE <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">Size</span> s <span class="token operator">=</span> <span class="token class-name">Size</span><span class="token punctuation">.</span>MEDIUM<span class="token punctuation">;</span> <span class="token comment">// s can be null</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">Size</span> <span class="token punctuation">{</span>
    <span class="token function">SMALL</span><span class="token punctuation">(</span><span class="token string">&quot;S&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">MEDIUM</span><span class="token punctuation">(</span><span class="token string">&quot;M&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">LARGE</span><span class="token punctuation">(</span><span class="token string">&quot;L&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">EXTRA_LARGE</span><span class="token punctuation">(</span><span class="token string">&quot;XL&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> abbreviation<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Size</span><span class="token punctuation">(</span><span class="token class-name">String</span> abbreviation<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>abbreviation <span class="token operator">=</span> abbreviation<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getAbbreviation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> abbreviation<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><code>enum</code> extends <code>Enum</code> — <code>Size</code> is actually a subclass of <code>Enum</code>, having exactly four instances (static field)
<ul><li>?? — not possible to construct new objects, <code>==</code> can be used</li></ul></li> <li>implicitly defined methods (i.e. added by the compiler)
<ul><li><code>static E[] values()</code></li> <li><code>static E valueOf(String name)</code></li></ul></li></ul></li> <li><p><code>Enum</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span> <span class="token keyword">extends</span> <span class="token class-name">Enum</span><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span>
</code></pre></div><ul><li><code>String toString()</code></li> <li><code>static &lt;T extends Enum&lt;T&gt;&gt; T valueOf(Class&lt;T&gt; enumType, String name)</code></li> <li><code>int ordinal()</code></li> <li><code>int compareTo(E other)</code> — order comparaison, result &lt;0, 0 or &gt;0</li></ul></li> <li><p>arrays</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> smallPrimes <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">13</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> smallPrimes2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">37</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">37</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// anonymous array</span>
</code></pre></div><ul><li>arrays are objects — extends <code>Object</code> and implements <code>Cloneable</code>, <code>Serializable</code> <ul><li><code>final int length</code></li> <li><code>T[] clone()</code></li> <li><code>Object</code> methods</li></ul></li> <li>initialization
<ul><li>all elements are initialized with zero or <code>false</code></li> <li>Arrays of objects are initialized with the special value <code>null</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> names <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li> <li>two dimensional<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> balances<span class="token punctuation">;</span>
balances <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">double</span><span class="token punctuation">[</span>NYEARS<span class="token punctuation">]</span><span class="token punctuation">[</span>NRATES<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> magicSquare <span class="token operator">=</span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">{</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></li> <li>ragged<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> odds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span>NMAX <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> n <span class="token operator">&lt;=</span> NMAX<span class="token punctuation">;</span> n<span class="token operator">++</span><span class="token punctuation">)</span>
    odds<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li></ol> <h2 id="classes-and-modifiers"><a href="#classes-and-modifiers" class="header-anchor">#</a> Classes and Modifiers</h2> <ol><li><p><code>public class</code></p> <ul><li>filename and class name — the name of the file must match the name of the <code>public</code> class</li> <li>unique in a file — can only have one <code>public</code> class in a source file</li> <li>when run <code>java ClassName</code> in CLI, the <code>main</code> method in <code>ClassName</code> is run</li></ul></li> <li><p><code>class</code></p> <ul><li><code>this</code> <ul><li>field variable shadowing — <code>this.</code> is optional, local variables can shadow instance fields</li> <li>implicit parameter — implicit parameter <code>this</code> does not appear in the method declaration
<ul><li>can be explicitly declared as the first parameter, usually for annotations</li></ul></li> <li>as constructor — the form <code>this(...)</code>, constructor call must be the first statement in a constructor</li></ul></li> <li>initialization
<ul><li>implicit field initialization — fields automatically set to a default zero</li> <li>explicit field initialization — initialize with constant value or an expression</li> <li>initialization block
<ul><li>can be <code>static</code> — static initialization block</li> <li>can set fields but cannot read later fields — legal to set fields defined later in the class. However, to avoid circular definitions, not legal to read from fields initialized later</li></ul></li> <li>execution order — runs after <code>super()</code> call or other constructor call, but before the rest of the constructor, see below</li></ul></li> <li>constructors
<ul><li>method name — same as the class</li> <li><code>new</code> — must be called with <code>new</code></li> <li>default no-arg constructor — when no constructor present, a no-argument constructor is provided</li> <li>call another constructor — see <code>this</code> above</li></ul></li> <li>execution order when a constructor is called
<ol><li>other constructor call — if the first line of the constructor calls a second constructor, then the second constructor runs before the body of this constructor.</li> <li>implicit field initialization — all data fields are initialized to their default values (0 , <code>false</code> , or <code>null</code>)</li> <li>explicit field initialization and initialization blocks — all field initializers and initialization blocks are executed, in the order in which they occur in the class declaration</li> <li>the rest — The body of the constructor is executed.</li></ol></li> <li>encapsulation
<ul><li>getter, setter — <code>private</code> data field with <code>public</code> accessor and mutator</li> <li>return clone for mutable objects — If you need to return a reference to a mutable object, return a clone</li></ul></li> <li>destructor
<ul><li>garbage collection — Java does automatic garbage collection, does not support destructors</li> <li><code>Object::finalize</code> — The <code>finalize</code> method will be called before the garbage collector sweeps away the object, but do not rely on, since cannot know when this method will be called, deprecated in JDK 9</li> <li><code>Runtime::addShutdownHook</code></li></ul></li></ul></li> <li><p>access modifiers</p> <ul><li><code>public</code> — no access limit</li> <li><code>private</code> — accessible only when the class is the same</li> <li><code>protected</code> — can be accessed by subclasses and within the same package
<ul><li>limitation to subclasses — when not within the same package, <code>SuperType.protectedField</code> are not accessible to subclass</li></ul></li> <li>default package access — when no access modifiers specified, can be accessed within the same package</li> <li>use in fields — <code>private</code> is recommended</li> <li>access privileges when overriding — no more restrictive access privileges when overriding</li></ul></li> <li><p>other modifiers</p> <ul><li><code>final</code> <ul><li><code>final</code> fields — must be initialized when the object is constructed (can be initialized in constructor) and cannot be modified</li> <li><code>final</code> methods — cannot be overloaded</li> <li><code>final class</code> — cannot be inherited, and only the methods, not the fields, are automatically <code>final</code></li> <li><code>final</code> parameters — cannot be modified</li></ul></li> <li><code>static</code> <ul><li>call by instance — static methods can be invoked by object call, but not recommended</li> <li>execution order — static initialization occurs when the class is first loaded</li> <li>get class from static method (<code>this.getClass()</code> will not work in static methods) besides <code>.class</code> property<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEnclosingClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li> <li><code>strictfp</code> — methods tagged with the <code>strictfp</code> keyword must use strict rules for floating-point computations that yield reproducible results</li></ul></li></ol> <h2 id="math"><a href="#math" class="header-anchor">#</a> Math</h2> <ol><li><p><code>Math</code> — elementary exponential, logarithm, square root, and trigonometric functions</p> <ul><li><code>Math.E</code>, <code>Math.PI</code></li> <li><code>static double random()</code> — uses <code>java.util.Random</code> behind scenes</li> <li><code>min</code>, <code>max</code></li> <li>double
<ul><li><code>public static double ulp(double d)</code> — An ulp, unit in the last place, of a double value is the positive distance between this floating-point value and the double value next larger in magnitude</li></ul></li> <li>rounding
<ul><li><code>static double ceil(double a)</code></li> <li><code>static long round(double a)</code><br> <code>static int round(float a)</code></li> <li><code>static double floor(double a)</code></li> <li><code>Math.floorDiv()</code></li> <li><code>Math.floorMod(x, y)</code> — <code>x - Math.floorDiv(x, y) * y</code> <ul><li>compared to <code>x % y</code> — <code>x - x / y * y</code></li></ul></li></ul></li> <li><code>-Exact</code> suffixed methods — <code>ArithmeticException</code> if overflow
<ul><li><code>static int addExact(int x, int y)</code><br> <code>static long addExact(long x, long y)</code></li> <li><code>addExact</code>, <code>subtractExact</code>, <code>multiplyExact</code>, <code>decrementExact</code>, <code>incrementExact</code>, <code>negateExact</code></li> <li><code>static int toIntExact(long value)</code></li></ul></li> <li>more</li></ul></li> <li><p><code>java.util.Random</code> — generate a stream of pseudorandom numbers, of which <code>Math.random()</code> uses an <code>static final</code> instance</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Random</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Serializable</span>
</code></pre></div><ul><li>creation
<ul><li><code>Random()</code></li> <li><code>Random(long seed)</code></li></ul></li> <li>thread-safe — use <code>ThreadLocalRandom</code> to avoid <code>AtomicLong::compareAndSet</code></li> <li>set — <code>void setSeed(long seed)</code></li> <li>next — for <code>boolean</code>, <code>byte</code>, <code>double</code>, <code>float</code>, <code>int</code>, <code>long</code> <ul><li><code>int nextInt()</code></li> <li><code>int nextInt(int bound)</code></li> <li>more</li> <li><code>double nextGaussian()</code></li></ul></li> <li>stream</li> <li><code>java.security.SecureRandom</code></li></ul></li> <li><p><code>StrictMath</code> — guaranteeing identical results on all platforms</p></li> <li><p><code>java.math.BigInteger</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BigInteger</span>
<span class="token keyword">extends</span> <span class="token class-name">Number</span>
<span class="token keyword">implements</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BigInteger</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>creation
<ul><li><code>static BigInteger valueOf(long val)</code></li> <li><code>static BigInteger ONE</code></li> <li><code>static BigInteger TEN</code></li> <li><code>static BigInteger ZERO</code></li></ul></li> <li>arithmetic
<ul><li><code>BigInteger add(BigInteger other)</code></li> <li><code>BigInteger subtract(BigInteger other)</code></li> <li><code>BigInteger multiply(BigInteger other)</code></li> <li><code>BigInteger divide(BigInteger other)</code></li> <li><code>BigInteger mod(BigInteger other)</code></li> <li><code>BigInteger modInverse(BigInteger m)</code></li> <li><code>BigInteger modPow(BigInteger exponent, BigInteger m)</code></li> <li>more</li></ul></li></ul></li> <li><p><code>java.math.BigDecimal</code> — Immutable, arbitrary-precision signed decimal numbers, decimal version of <code>BigInteger</code></p></li></ol> <h2 id="built-in-classes"><a href="#built-in-classes" class="header-anchor">#</a> Built-In Classes</h2> <ol><li>inside <code>java.lang</code> package</li></ol> <h3 id="system"><a href="#system" class="header-anchor">#</a> System</h3> <ol><li><p><code>System</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">System</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
</code></pre></div><ul><li>std
<ul><li><code>static InputStream in</code> — instance of <code>BufferedInputStream</code></li> <li><code>static PrintStream err</code></li> <li><code>static PrintStream out</code></li> <li><code>static Console console()</code></li> <li><code>static void setErr(PrintStream err)</code></li> <li><code>static void setIn(InputStream in)</code></li> <li><code>static void setOut(PrintStream out)</code></li></ul></li> <li>util
<ul><li><code>static native void arraycopy(Object src, int srcPos, Object dest, int destPos, int length)</code></li> <li><code>static long currentTimeMillis()</code></li> <li><code>static long nanoTime()</code></li> <li><code>static native int identityHashCode(Object x)</code> — <code>Object::hashCode</code> regardless of overriden or not, 0 for <code>null</code></li></ul></li> <li>system property — see <a href="#Legacy-Collections">Legacy Collections</a> for the list of system properties
<ul><li><code>static Properties getProperties()</code></li> <li><code>static String getProperty(String key)</code><br> <code>static String getProperty(String key, String def)</code></li> <li><code>Integer::getInteger</code>, <code>Long::getLong</code></li> <li><code>static void setProperties(Properties props)</code><br> <code>static String setProperty(String key, String value)</code></li> <li><code>static String clearProperty(String key)</code></li> <li><code>static String lineSeparator()</code> — equivalent to <code>System.getProperty(&quot;line.separator&quot;)</code> <ul><li>see <a href="#File-Classes"><code>File</code></a> for other separators</li></ul></li></ul></li> <li>environment
<ul><li><code>static Map&lt;String,String&gt; getenv()</code></li> <li><code>static String getenv(String name)</code></li></ul></li> <li>JVM
<ul><li><code>static void exit(int status)</code></li> <li><code>static void gc()</code> — run garbage collector</li> <li><code>static SecurityManager getSecurityManager()</code></li> <li><code>static Channel inheritedChannel()</code> — the channel inherited from the entity that created this Java virtual machine</li> <li><code>static void load(String filename)</code></li> <li><code>static void loadLibrary(String libname)</code></li> <li><code>static String mapLibraryName(String libname)</code></li> <li><code>static void runFinalization()</code></li> <li><code>static void setSecurityManager(SecurityManager s)</code></li></ul></li></ul></li> <li><p><code>SecurityManager</code> — check permissions, like read / write on certain files</p></li></ol> <h3 id="string"><a href="#string" class="header-anchor">#</a> String</h3> <ol><li><p><code>CharSequence</code> — provides uniform, read-only access to many different kinds of char sequences</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CharSequence</span>
</code></pre></div><ul><li><code>char charAt(int index)</code></li> <li><code>default IntStream chars()</code></li> <li><code>default IntStream codePoints()</code></li> <li><code>int length()</code></li> <li><code>CharSequence subSequence(int start, int end)</code></li> <li><code>String toString()</code></li></ul></li> <li><p><code>String</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">String</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Serializable</span><span class="token punctuation">,</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">CharSequence</span>
</code></pre></div><ul><li>length
<ul><li><code>int length()</code></li> <li><code>boolean isEmpty()</code></li> <li><code>int codePointCount(int startIndex, int endIndex)</code> — the number of code points<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">int</span> cpCount <span class="token operator">=</span> greeting<span class="token punctuation">.</span><span class="token function">codePointCount</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> greeting<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li> <li>substring or transform
<ul><li><code>char charAt(int index)</code>, <code>int codePointAt(int index)</code>, <code>codePointBefore</code></li> <li>conversion methods to and from <code>bytes[]</code>, <code>char[]</code></li> <li><code>String substring(int beginIndex)</code> <code>String substring(int beginIndex, int endIndex)</code></li> <li><code>String replace(char oldChar, char newChar)</code><br> <code>String replace(CharSequence target, CharSequence replacement)</code><br> <code>String replaceAll(String regex, String replacement)</code><br> <code>String replaceFirst(String regex, String replacement)</code></li> <li><code>String toLowerCase()</code> <code>String toUpperCase()</code></li> <li><code>String trim()</code></li> <li><code>String[] split(String regex)</code><br> <code>String[] split(String regex, int limit)</code></li></ul></li> <li>creation
<ul><li><code>static String format(String format, Object... args)</code><br> <code>static String format(Locale l, String format, Object... args)</code></li> <li><code>static String join(CharSequence delimiter, CharSequence... elements)</code><br> <code>static String join(CharSequence delimiter, Iterable&lt;? extends CharSequence&gt; elements)</code><br> <code>Collectors::joining</code><br> <code>StringJoiner</code></li> <li><code>valueOf</code> <ul><li><code>static String valueOf(type c)</code> — from various types</li> <li><code>static String copyValueOf(char[] data)</code> — <code>valueOf</code> equivalent<br> <code>static String copyValueOf(char[] data, int offset, int count)</code></li></ul></li> <li><code>String concat(String str)</code></li> <li><code>String(byte[] bytes)</code><br> <code>String(byte[] bytes, Charset charset)</code><br> <code>String(byte[] bytes, int offset, int length)</code><br> <code>String(byte[] bytes, int offset, int length, Charset charset)</code></li> <li><code>String(int[] codePoints, int offset, int count)</code></li> <li><code>String(char[] value)</code><br> <code>String(char[] value, int offset, int count)</code></li> <li><code>String(String original)</code></li> <li><code>String(StringBuffer buffer)</code></li> <li><code>String(StringBuilder builder)</code></li></ul></li> <li>comparaison
<ul><li><code>int hashCode()</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">int</span> hash <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    hash <span class="token operator">=</span> <span class="token number">31</span> <span class="token operator">*</span> hash <span class="token operator">+</span> <span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><code>boolean equals(Object other)</code>, <code>boolean equalsIgnoreCase(String other)</code> <ul><li>reference type — do not use the <code>==</code> operator to test whether two strings are equal</li> <li>string pool — only string literals are shared, not strings that are the result of operations like <code>+</code> or <code>substring</code></li></ul></li> <li><code>int compareToIgnoreCase(String str)</code></li> <li><code>boolean startsWith(String prefix)</code>, <code>boolean endsWith(String suffix)</code></li> <li><code>boolean contentEquals(CharSequence cs)</code>, <code>boolean contentEquals(StringBuffer sb)</code></li> <li><code>String intern()</code> — determined by <code>equals</code>, return the string from string pool, add to the pool if not contained already</li></ul></li> <li>transverse
<ul><li>with index <code>i</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// incremental</span>
<span class="token keyword">int</span> cp <span class="token operator">=</span> sentence<span class="token punctuation">.</span><span class="token function">codePointAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Character</span><span class="token punctuation">.</span><span class="token function">isSupplementaryCodePoint</span><span class="token punctuation">(</span>cp<span class="token punctuation">)</span><span class="token punctuation">)</span> i <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">else</span> i<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token comment">// decreasing</span>
i<span class="token operator">--</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Character</span><span class="token punctuation">.</span><span class="token function">isSurrogate</span><span class="token punctuation">(</span>sentence<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> i<span class="token operator">--</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> cp <span class="token operator">=</span> sentence<span class="token punctuation">.</span><span class="token function">codePointAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><code>int offsetByCodePoints()</code> — get at the i^th^ code point</li> <li><code>int offsetByCodePoints(int index, int codePointOffset)</code> — the resulted index by moving given number of code points from given index</li> <li><code>str.codePoints().toArray()</code></li></ul></li> <li>find
<ul><li><code>boolean contains(CharSequence s)</code></li> <li><code>boolean matches(String regex)</code></li> <li><code>boolean regionMatches(boolean ignoreCase, int toffset, String other, int ooffset, int len)</code> — Tests if two string regions are equal<br> <code>boolean regionMatches(int toffset, String other, int ooffset, int len)</code></li> <li><code>int indexOf(String str)</code><br> <code>int indexOf(String str, int fromIndex)</code><br> <code>int indexOf(int cp)</code><br> <code>int indexOf(int cp, int fromIndex)</code></li> <li><code>int lastIndexOf(String str)</code><br> <code>int lastIndexOf(String str, int fromIndex)</code><br> <code>int lastIndexOf(int cp)</code><br> <code>int lastIndexOf(int cp, int fromIndex)</code></li></ul></li></ul></li> <li><p><code>StringBuilder</code> — mutable, not synchronized <code>StringBuffer</code>, build a string from many small pieces</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">StringBuilder</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Serializable</span><span class="token punctuation">,</span> <span class="token class-name">CharSequence</span>
</code></pre></div><ul><li>constructors
<ul><li><code>StringBuilder()</code></li> <li><code>StringBuilder(CharSequence seq)</code></li> <li><code>StringBuilder(int capacity)</code></li> <li><code>StringBuilder(String str)</code></li></ul></li> <li>modify
<ul><li><code>StringBuilder append(String str)</code></li> <li><code>StringBuilder append(char c)</code></li> <li><code>StringBuilder appendCodePoint(int cp)</code></li> <li><code>void setCharAt(int i, char c)</code></li> <li><code>StringBuilder insert(int offset, String str)</code></li> <li><code>StringBuilder insert(int offset, char c)</code></li> <li><code>StringBuilder delete(int startIndex, int endIndex)</code></li> <li><code>StringBuilder deleteCharAt(int index)</code></li> <li>more</li></ul></li> <li>output — <code>String toString()</code></li></ul></li> <li><p><code>StringBuffer</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">StringBuffer</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Serializable</span><span class="token punctuation">,</span> <span class="token class-name">CharSequence</span>
</code></pre></div></li> <li><p><code>java.util.StringJoiner</code> — store components in <code>String[]</code> with doubling strategy when expanding capability, used by <code>Collectors::joining</code> and <code>String::join</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">StringJoiner</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
</code></pre></div><ul><li>constructors
<ul><li><code>StringJoiner(CharSequence delimiter)</code></li> <li><code>StringJoiner(CharSequence delimiter, CharSequence prefix, CharSequence suffix)</code></li></ul></li> <li>use
<ul><li><code>StringJoiner add(CharSequence newElement)</code></li> <li><code>int length()</code></li> <li><code>StringJoiner merge(StringJoiner other)</code></li> <li><code>StringJoiner setEmptyValue(CharSequence emptyValue)</code></li> <li><code>String toString()</code></li></ul></li></ul></li></ol> <h3 id="object-wrappers"><a href="#object-wrappers" class="header-anchor">#</a> Object Wrappers</h3> <ol><li><p>wrappers</p> <ul><li><code>Integer</code> , <code>Long</code> , <code>Float</code> , <code>Double</code> , <code>Short</code> , <code>Byte</code> , <code>Character</code> , and <code>Boolean</code></li> <li>all extends <code>Number</code> except <code>Boolean</code> — no arithmetic operations and number conversions for boolean</li> <li>immutable and <code>final</code></li> <li>autowrapping (autoboxing) — done by compiler, nothing related to VM
<ul><li><code>valueOf</code> — example: <code>list.add(3);</code> is automatically translated to <code>list.add(Integer.valueOf(3));</code></li> <li><code>typeValue()</code> — example: the compiler translates <code>int n = list.get(i);</code> into <code>int n = list.get(i).intValue();</code></li> <li>arithmetic operations — example: <code>Integer n = 3; n++;</code> compiler automatically inserts instructions to unbox the object, increment the resulting value, and box it back.</li></ul></li> <li>fixed wrapping — wrapped into fixed objects
<ul><li><code>boolean , byte , char &lt;= 127</code></li> <li><code>short</code> , and <code>int</code> between -128 and 127</li></ul></li> <li>wrapper class references can be <code>null</code> — possible <code>NullPointerException</code></li> <li>conditional promotion — <code>Integer</code> to <code>Double</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Integer</span> n <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token class-name">Double</span> x <span class="token operator">=</span> <span class="token number">2.0</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token boolean">true</span> <span class="token operator">?</span> n <span class="token operator">:</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Prints 1.0</span>
</code></pre></div></li></ul></li> <li><p><code>Number</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Number</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span>
</code></pre></div><ul><li><code>byte byteValue()</code></li> <li><code>abstract double doubleValue()</code></li> <li><code>abstract float floatValue()</code></li> <li><code>abstract int intValue()</code></li> <li><code>abstract long longValue()</code></li> <li><code>short shortValue()</code></li></ul></li> <li><p><code>Integer</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Integer</span>
<span class="token keyword">extends</span> <span class="token class-name">Number</span>
<span class="token keyword">implements</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>fields
<ul><li><code>static int BYTES</code> — usually 4</li> <li><code>static int MAX_VALUE</code></li> <li><code>static int MIN_VALUE</code></li> <li><code>static int SIZE</code> — usually 32</li> <li><code>static Class&lt;Integer&gt; TYPE</code> — <code>int.class</code></li></ul></li> <li>creation
<ul><li><code>Integer(int value)</code> — deprecated since JDK 9</li> <li><code>Integer(String s)</code> — uses <code>parseInt</code> internally, deprecated since JDK 9</li> <li><code>static Integer decode(String nm)</code> — accepts decimal, hexadecimal (<code>0x</code>, <code>0X</code>, <code>#</code> prefixed), octal (<code>0</code> prefixed), can be negative</li> <li><code>static Integer valueOf(int i)</code><br> <code>static Integer valueOf(String s)</code> — uses <code>parseInt</code> internally<br> <code>static Integer valueOf(String s, int radix)</code></li></ul></li> <li>conversion to primitive types
<ul><li>methods in <code>Number</code> <ul><li><code>int intValue()</code></li></ul></li> <li><code>static int parseInt(String s)</code><br> <code>static int parseInt(String s, int radix)</code></li></ul></li> <li>arithmetic operations
<ul><li><code>static int signum(int i)</code></li> <li><code>static int sum(int a, int b)</code></li></ul></li> <li>unsigned
<ul><li><code>static int parseUnsignedInt(String s)</code></li> <li><code>static int parseUnsignedInt(String s, int radix)</code></li> <li><code>static int divideUnsigned(int dividend, int divisor)</code></li> <li><code>static int compareUnsigned(int x, int y)</code></li> <li><code>static int remainderUnsigned(int dividend, int divisor)</code></li> <li><code>static String toBinaryString(int i)</code> — two's complement representation</li> <li><code>static String toHexString(int i)</code></li> <li><code>static String toOctalString(int i)</code></li> <li><code>static String toUnsignedString(int i)</code></li> <li><code>static String toUnsignedString(int i, int radix)</code></li> <li><code>static long toUnsignedLong(int x)</code></li></ul></li> <li>bits in the two's complement
<ul><li><code>static int bitCount(int i)</code> — the number of one-bits</li> <li><code>static int highestOneBit(int i)</code></li> <li><code>static int lowestOneBit(int i)</code></li> <li><code>static int numberOfLeadingZeros(int i)</code></li> <li><code>static int numberOfTrailingZeros(int i)</code></li> <li><code>static int reverse(int i)</code></li> <li><code>static int reverseBytes(int i)</code></li> <li><code>static int rotateLeft(int i, int distance)</code></li> <li><code>static int rotateRight(int i, int distance)</code></li></ul></li> <li>for <code>int</code> and <code>null</code> compatible
<ul><li><code>static int compare(int x, int y)</code></li> <li><code>static int hashCode(int value)</code></li> <li><code>static String toString(int i)</code></li> <li><code>static String toString(int i, int radix)</code></li></ul></li></ul></li> <li><p><code>Double</code></p> <ul><li>counterparts of fields and methods in <code>Integer</code></li> <li>IEEE 754
<ul><li><code>static int MAX_EXPONENT</code></li> <li><code>static int MIN_EXPONENT</code></li> <li><code>static double MIN_NORMAL</code></li></ul></li> <li>infinite and not a number
<ul><li><code>static double NaN</code></li> <li><code>static double NEGATIVE_INFINITY</code></li> <li><code>static double POSITIVE_INFINITY</code></li> <li><code>static boolean isFinite(double d)</code></li> <li><code>boolean isInfinite()</code></li> <li><code>static boolean isInfinite(double v)</code></li> <li><code>boolean isNaN()</code></li> <li><code>static boolean isNaN(double v)</code></li></ul></li></ul></li> <li><p><code>Character</code> — see after</p></li> <li><p><code>Boolean</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Boolean</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Serializable</span><span class="token punctuation">,</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ol> <h1 id="inheritance"><a href="#inheritance" class="header-anchor">#</a> Inheritance</h1> <ol><li><p>inheritance</p> <ul><li><code>extends</code></li> <li><code>super</code></li> <li><code>super()</code> <ul><li>first statement — the call using <code>super</code> must be the first statement in the constructor for the subclass</li> <li>default no-arg constructor — if the subclass constructor does not call a superclass constructor explicitly, the no-argument <code>super()</code> is invoked</li> <li>order — invoked before initializers</li></ul></li> <li>polymorphism
<ul><li>object variables are polymorphic — a variable can be assigned subclasses of its type</li> <li>no polymorphism exploit in arrays — all arrays remember the element type with which they were created (<code>new</code>ed)<div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Manager</span><span class="token punctuation">[</span><span class="token punctuation">]</span> managers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Manager</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token class-name">Employee</span><span class="token punctuation">[</span><span class="token punctuation">]</span> staff <span class="token operator">=</span> managers<span class="token punctuation">;</span> <span class="token comment">// OK</span>
staff<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token string">&quot;Harry Hacker&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ArrayStoreException</span>
</code></pre></div></li></ul></li></ul></li> <li><p>method call</p> <ul><li>overriding resolution — according to function signatures, done by compiler
<ul><li>function signature
<ul><li>return type — return type is not a part of the signature (but is in JVM so bridge methods work)</li> <li>bridge method — when return another type, a bridge method is synthesized</li></ul></li></ul></li> <li>static binding — for <code>private</code>, <code>static</code>, <code>final</code> methods or constructors, done by compiler</li> <li>dynamic binding — JVM resolving the implicit parameter with method table lookup
<ul><li>method table — method table lists all method signatures and the actual methods to be called, computed by VM for each class in advance</li> <li>order of method table lookup — from actual type to superclasses to <code>Object</code></li> <li>overhead of dynamic binding — no need to use static binding to avoid the overhead, JIT does the inlining optimization</li></ul></li></ul></li> <li><p>casting</p> <ul><li>direct assign to more general — cast to more general, a subclass reference to a superclass variable, direct assign</li> <li>cast needed for more specific — cast to more specific, a superclass reference to a subclass variable, use the same syntax as primitive type cast, check at runtime
<ul><li>exception — <code>ClassCastException</code> when cannot cast</li> <li>check — use <code>instanceof</code> to check before casting</li> <li>cast range — can cast only within an inheritance hierarchy</li> <li>minimal usage — best to minimize the use of casts and the <code>instanceof</code> operator</li></ul></li></ul></li> <li><p>abstract class</p> <ul><li>no instance — cannot be instantiated, but can be super type</li> <li>abstract methods — any class can be tagged <code>abstract</code>, but not vice versa
<ul><li>can be none — abstract classes can have no abstract methods, abstract classes can have fields and concrete methods</li> <li>none in concrete class — a class with one or more <code>abstract</code> methods must itself be declared <code>abstract</code></li></ul></li></ul></li> <li><p><code>Object</code> — the cosmic superclass</p> <ul><li>for all reference type — only the values of primitive types (numbers, characters, and boolean values) are not objects</li> <li><code>boolean equals(Object otherObject)</code> — determines whether two object references are identical
<ul><li>override — template as below, need to override <code>hashCode</code> also if <code>equals</code> overriden<div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> otherObject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// super.equals(other)</span>
    <span class="token comment">// a quick test to see if the objects are identical, may be unnecessary if covered in `super.equals(other)`</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">==</span> otherObject<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token comment">// must return false if the explicit parameter is null</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>otherObject <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token comment">// if the classes don't match, they can't be equal</span>
    <span class="token comment">// alternative — use instanceof and tagging final to allow objects of different subclasses to be equal to one another</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> otherObject<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token comment">// now we know otherObject is a non-null Employee</span>
    <span class="token class-name">Employee</span> other <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Employee</span><span class="token punctuation">)</span> otherObject<span class="token punctuation">;</span>
    <span class="token comment">// test whether the fields have identical values</span>
    <span class="token keyword">return</span> name<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
        <span class="token operator">&amp;&amp;</span> salary <span class="token operator">==</span> other<span class="token punctuation">.</span>salary
        <span class="token operator">&amp;&amp;</span> hireDay<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span>hireDay<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul></li> <li><code>native int hashCode()</code> — derived from the memory address, recommended to be compatible with <code>equals()</code></li> <li><code>String toString()</code> — <code>getClass().getName() + &quot;@&quot; + Integer.toHexString(hashCode());</code> <ul><li>for arrays — arrays will come up with something like <code>&quot;[I@1a46e30&quot;</code>, where <code>[I</code> denotes an array of integers </li></ul></li> <li><code>Class&lt;?&gt; getClass()</code></li> <li><code>protected Object clone()</code></li> <li><code>protected void finalize()</code> — deprecated in JDK 9</li> <li>concurrency related — see after</li> <li>methods in <code>Objects</code> and object wrappers</li></ul></li></ol> <h1 id="interfaces-lambdas-and-inner-classes"><a href="#interfaces-lambdas-and-inner-classes" class="header-anchor">#</a> Interfaces, Lambdas and Inner Classes</h1> <h2 id="interfaces"><a href="#interfaces" class="header-anchor">#</a> Interfaces</h2> <ol><li><p>interface</p> <ul><li>methods in interfaces
<ul><li>non-static methods — all methods are implicitly <code>abstract public</code>, redundancy is discouraged
<ul><li>when implementing — <code>public</code> still required when implementing</li></ul></li> <li>static methods — supported as of Java SE 8, need explicit access modifier</li> <li>prohibited modifiers — an interface method may not be declared with <code>protected</code> or package access, or with the modifiers <code>final</code>, <code>synchronized</code>, or <code>native</code></li></ul></li> <li>inner classes in interfaces — automatically <code>static public</code></li> <li>constant fields — implicitly <code>public static final</code>, automatically inherited when implementing</li> <li>no instance fields</li> <li><code>implements</code>, <code>SuperInterface.super</code> — examples below</li> <li>can be generic — <code>class Employee implements Comparable&lt;Employee&gt;</code></li> <li>use as super type — supports <code>instanceof</code>, <code>extend</code>, multiple inheritance
<ul><li>diamond problem — see below</li></ul></li> <li>initialization time point — initialized when they are first accessed, typically by reading a field that is not a compile time constant</li></ul></li> <li><p>default methods</p> <ul><li><code>default</code> implementation<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">default</span> <span class="token keyword">int</span> <span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token class-name">T</span> other<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// By default, all elements are the same</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><code>default</code> method conflict resolving — interface vs superclass vs another interface
<ul><li>superclasses take precedence — default methods are ignored if implemented in superclasses
<ul><li>no default <code>Object</code> methods — not possible to make a default method that redefines one of the methods in the <code>Object</code> class</li> <li>no abstract <code>Object</code> methods — redeclaring methods from the <code>Object</code> class do not make the methods abstract, no effect to function interfaces</li> <li>attach javadoc by <code>Object</code> methods — some interfaces redeclare <code>Object</code> methods in order to attach javadoc comments, like <code>Comparator</code></li></ul></li> <li>interface clash — if clashes, even only one of the methods is <code>default</code>, the method must be overriden
<ul><li><code>SuperInterface.super</code> — choose one when interface clash<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">interface</span> <span class="token class-name">Named</span> <span class="token punctuation">{</span> <span class="token keyword">default</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;_&quot;</span> <span class="token operator">+</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token keyword">interface</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span> <span class="token keyword">default</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token keyword">implements</span> <span class="token class-name">Person</span><span class="token punctuation">,</span> <span class="token class-name">Named</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul></li></ul></li></ul></li> <li><p>companion class</p> <ul><li>used to place static methods — it has been common to place static methods in companion classes, like <code>Collection</code> / <code>Collections</code> or <code>Path</code> / <code>Paths</code></li> <li>used to implement some or all of methods of an interface — such as <code>Collection</code> / <code>AbstractCollection</code> or <code>MouseListener</code> / <code>MouseAdapter</code></li> <li><code>default</code> and <code>static</code> methods in interfaces — with Java SE 8, this technique of companion class is obsolete, as the support of default methods and static methods</li></ul></li> <li><p>some use of interface</p> <ul><li>callback — pass an object of a class implementing a callback interface, methods in the interface will be called when the event fires</li> <li>tagging interface — <code>Cloneable</code></li></ul></li></ol> <h3 id="common-interfaces"><a href="#common-interfaces" class="header-anchor">#</a> Common Interfaces</h3> <ol><li><p><code>Interface Comparable&lt;T&gt;</code> — <code>int compareTo(T o)</code></p> <ul><li>overflow when implementing with subtraction — make sure absolute values of operands are at most <code>(Integer.MAX_VALUE - 1) / 2</code> <ul><li>otherwise use <code>Integer.compare()</code></li></ul></li> <li><code>equals()</code> compliance — strongly recommended (though not required) to comply with <code>equals()</code> <ul><li><code>BigDecimal</code> violates — <code>new BigDecimal(&quot;1.0&quot;).equals(new BigDecimal(&quot;1.00&quot;))</code> is <code>false</code> because the numbers differ in precision</li></ul></li> <li>associative — to make <code>x.compareTo(y)</code> compatible with <code>y.compareTo(x)</code>, start with below when implementing<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> other<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ClassCastException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li> <li><p><code>Interface java.util.Comparator&lt;T&gt;</code> — <code>int compare(T o1, T o2)</code></p> <ul><li>nature and reversed order
<ul><li><code>static &lt;T extends Comparable&lt;? super T&gt;&gt; Comparator&lt;T&gt; naturalOrder()</code></li> <li><code>static &lt;T extends Comparable&lt;? super T&gt;&gt; Comparator&lt;T&gt; reverseOrder()</code> — uses <code>Collections::reverseOrder</code> under the hood</li></ul></li> <li>key extract<div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// sort people by name</span>
<span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>people<span class="token punctuation">,</span> <span class="token class-name">Comparator</span><span class="token punctuation">.</span><span class="token function">comparing</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token operator">::</span><span class="token function">getName</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><code>static &lt;T,U extends Comparable&lt;? super U&gt;&gt; Comparator&lt;T&gt; comparing(Function&lt;? super T,? extends U&gt; keyExtractor)</code></li> <li><code>static &lt;T,U&gt; Comparator&lt;T&gt; comparing(Function&lt;? super T,? extends U&gt; keyExtractor, Comparator&lt;? super U&gt; keyComparator)</code></li> <li><code>static &lt;T&gt; Comparator&lt;T&gt; comparingDouble(ToDoubleFunction&lt;? super T&gt; keyExtractor)</code></li> <li><code>static &lt;T&gt; Comparator&lt;T&gt; comparingInt(ToIntFunction&lt;? super T&gt; keyExtractor)</code></li> <li><code>static &lt;T&gt; Comparator&lt;T&gt; comparingLong(ToLongFunction&lt;? super T&gt; keyExtractor)</code></li></ul></li> <li>comparator chaining<div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>people<span class="token punctuation">,</span> <span class="token class-name">Comparator</span>
    <span class="token punctuation">.</span><span class="token function">comparing</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token operator">::</span><span class="token function">getLastName</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">thenComparing</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token operator">::</span><span class="token function">getFirstName</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><code>default Comparator&lt;T&gt; thenComparing(Comparator&lt;? super T&gt; other)</code><br> <code>default &lt;U extends Comparable&lt;? super U&gt;&gt; Comparator&lt;T&gt; thenComparing(Function&lt;? super T,? extends U&gt; keyExtractor)</code><br> <code>default &lt;U&gt; Comparator&lt;T&gt; thenComparing(Function&lt;? super T,? extends U&gt; keyExtractor, Comparator&lt;? super U&gt; keyComparator)</code></li> <li><code>default Comparator&lt;T&gt; thenComparingType(ToTypeFunction&lt;? super T&gt; keyExtractor)</code> — <code>type</code> for <code>int</code>, <code>double</code> and <code>long</code></li> <li><code>default Comparator&lt;T&gt; reversed()</code> — uses <code>Collections::reverseOrder</code> under the hood</li></ul></li> <li>comparing <code>null</code> <ul><li><code>static &lt;T&gt; Comparator&lt;T&gt; nullsFirst(Comparator&lt;? super T&gt; comparator)</code></li> <li><code>static &lt;T&gt; Comparator&lt;T&gt; nullsLast(Comparator&lt;? super T&gt; comparator)</code></li></ul></li></ul></li> <li><p><code>Interface Cloneable</code></p> <ul><li>mark interface — serves as a tag, a checked <code>CloneNotSupportedException</code> if an object requests cloning but does not implement that interface</li> <li>make a class cloneable — implement this interface, redefine <code>clone</code> to be <code>public</code> <ul><li><code>Object::clone</code> — protected, and does a shallow copy</li> <li>use <code>Object::clone</code> — <code>(T) super.clone()</code></li></ul></li> <li>return <code>Object</code> by convention — Up to Java SE 1.4, the clone method always had return type <code>Object</code>, but now the correct return type can be specified
<ul><li>inconsistency — <code>HashMap::clone</code> and <code>ArrayList::clone</code> etc. return <code>Object</code>, whereas <code>int[]::clone</code> and <code>ArrayDeque::clone</code> etc. return specific type</li></ul></li></ul></li></ol> <h2 id="lambdas"><a href="#lambdas" class="header-anchor">#</a> Lambdas</h2> <ol><li><p>closure</p> <ul><li>effectively final — any captured variable in a lambda expression must be effectively final: no difference if declared <code>final</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ActionListener</span> listener <span class="token operator">=</span> event <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token string">&quot;: &quot;</span> <span class="token operator">+</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Error: Cannot refer to changing i</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">new</span> <span class="token class-name">Timer</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> listener<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>no mutation outside — illegal to refer to a variable in a lambda expression that is mutated outside</li> <li>no mutation inside — cannot mutate captured value</li> <li>access mutable data — use an array of length 1</li></ul></li> <li>no block variable shadowing — illegal to declare a parameter or a local variable in the lambda that has the same name as a local variable</li> <li>block scope — the same scope as a nested block</li> <li>same <code>this</code> — <code>this</code> is the same as what outside the lambda</li> <li>number of instantiations -- only one instantiation inside loops when no closure<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token class-name">IntUnaryOperator</span> oper <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">int</span> opCounter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">lambdaTest</span><span class="token punctuation">(</span><span class="token class-name">IntUnaryOperator</span> op<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>op <span class="token operator">!=</span> oper<span class="token punctuation">)</span> <span class="token operator">++</span>opCounter<span class="token punctuation">;</span>
    oper <span class="token operator">=</span> op<span class="token punctuation">;</span>
    <span class="token keyword">return</span> op<span class="token punctuation">.</span><span class="token function">applyAsInt</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">lambdaTest</span><span class="token punctuation">(</span>j <span class="token operator">-&gt;</span> j <span class="token operator">*</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>opCounter<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
<span class="token punctuation">}</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">lambdaTest</span><span class="token punctuation">(</span>j <span class="token operator">-&gt;</span> j <span class="token operator">*</span> j <span class="token operator">*</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>opCounter<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 100</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul></li> <li><p>lambda expression syntax</p> <ul><li>inline<div class="language-java extra-class"><pre class="language-java"><code><span class="token punctuation">(</span><span class="token class-name">String</span> first<span class="token punctuation">,</span> <span class="token class-name">String</span> second<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> first<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> second<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li>block with explicit <code>return</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token punctuation">(</span><span class="token class-name">String</span> first<span class="token punctuation">,</span> <span class="token class-name">String</span> second<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>first<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> second<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>first<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> second<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li>type inference<div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> comp <span class="token operator">=</span> <span class="token punctuation">(</span>first<span class="token punctuation">,</span> second<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> first<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> second<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li>type inference without parentheses<div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ActionListener</span> listener <span class="token operator">=</span> event <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;The time is &quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>&quot;<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li>inferred return type — return type is always inferred, cannot be specified</li></ul></li> <li><p>functional interface — an interface with a single abstract method, like <code>Comparator&lt;T&gt;</code></p> <ul><li>for conversion from lambdas — conversion to a functional interface is the only function for lambdas</li> <li>object instance used behind the scenes — methods like <code>Arrays::sort</code> receives an object of some class that implements the interface, lambda is executed when invoking the method of that interface</li> <li><code>@FunctionalInterface</code> — optional annotation</li> <li>lambda expression holders (also function interface) — see <a href="#Common-Functional-Interfaces">Common Functional Interfaces</a> for <code>java.util.function</code></li></ul></li> <li><p>method reference — use as lambdas</p> <div class="language-java extra-class"><pre class="language-java"><code>object<span class="token operator">::</span><span class="token function">instanceMethod</span>
<span class="token keyword">this</span><span class="token operator">::</span><span class="token function">instanceMethod</span>
<span class="token keyword">super</span><span class="token operator">::</span><span class="token function">instanceMethod</span> <span class="token comment">// uses `this` as the target and invokes the superclass version of the given method</span>
<span class="token class-name">Class</span><span class="token operator">::</span><span class="token function">staticMethod</span>
<span class="token class-name">Class</span><span class="token operator">::</span><span class="token function">instanceMethod</span> <span class="token comment">// the implicit parameter becomes explicit</span>
<span class="token class-name">Class</span><span class="token operator">::</span><span class="token keyword">new</span> <span class="token comment">// constructor reference</span>
<span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">::</span><span class="token keyword">new</span>
</code></pre></div><ul><li>object instance used behind the scenes — turned into instances of functional interfaces like lambdas</li> <li><code>int[]::new</code> — <code>new T[n]</code> is illegal, so libary designers use this syntax to mitigate<div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> people <span class="token operator">=</span> stream<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Person</span><span class="token punctuation">[</span><span class="token punctuation">]</span> people <span class="token operator">=</span> stream<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li></ol> <h3 id="common-functional-interfaces"><a href="#common-functional-interfaces" class="header-anchor">#</a> Common Functional Interfaces</h3> <ol><li><p><code>java.util.function</code> package, all <code>@FunctionalInterface</code></p></li> <li><p><code>java.util.function.Function&lt;T, R&gt;</code> — <code>R apply(T t)</code></p> <ul><li><code>static &lt;T&gt; Function&lt;T,T&gt; identity()</code></li> <li>chaining
<ul><li><code>default &lt;V&gt; Function&lt;T,V&gt; andThen(Function&lt;? super R,? extends V&gt; after)</code></li> <li><code>default &lt;V&gt; Function&lt;V,R&gt; compose(Function&lt;? super V,? extends T&gt; before)</code></li></ul></li> <li>variants
<ul><li><code>java.util.function.DoubleFunction&lt;R&gt;</code> — <code>R apply(double value)</code></li> <li><code>java.util.function.DoubleToIntFunction</code></li> <li><code>java.util.function.DoubleToLongFunction</code></li> <li><code>java.util.function.IntFunction&lt;R&gt;</code></li> <li><code>java.util.function.IntToDoubleFunction</code></li> <li><code>java.util.function.IntToLongFunction</code></li> <li><code>java.util.function.LongFunction&lt;R&gt;</code></li> <li><code>java.util.function.LongToDoubleFunction</code></li> <li><code>java.util.function.LongToIntFunction</code></li> <li><code>java.util.function.ToDoubleFunction&lt;T&gt;</code></li> <li><code>java.util.function.ToIntFunction&lt;T&gt;</code></li> <li><code>java.util.function.ToLongFunction&lt;T&gt;</code></li></ul></li> <li>variants with two parameters
<ul><li><code>java.util.function.BiFunction&lt;T,U,R&gt;</code> — <code>R apply(T t, U u)</code></li> <li><code>java.util.function.ToDoubleBiFunction&lt;T,U&gt;</code></li> <li><code>java.util.function.ToIntBiFunction&lt;T,U&gt;</code></li> <li><code>java.util.function.ToLongBiFunction&lt;T,U&gt;</code></li></ul></li></ul></li> <li><p>operator — <code>Function</code> with type parameters of the same primitive type</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@FunctionalInterface</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UnaryOperator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">extends</span> <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>unary
<ul><li><code>java.util.function.UnaryOperator&lt;T&gt;</code> <ul><li><code>static &lt;T&gt; UnaryOperator&lt;T&gt; identity()</code></li></ul></li> <li><code>java.util.function.DoubleUnaryOperator</code></li> <li><code>java.util.function.IntUnaryOperator</code></li> <li><code>java.util.function.LongUnaryOperator</code></li></ul></li> <li>binary
<ul><li><code>java.util.function.BinaryOperator&lt;T&gt;</code> <ul><li><code>static &lt;T&gt; BinaryOperator&lt;T&gt; maxBy(Comparator&lt;? super T&gt; comparator)</code></li> <li><code>static &lt;T&gt; BinaryOperator&lt;T&gt; minBy(Comparator&lt;? super T&gt; comparator)</code></li></ul></li> <li><code>java.util.function.DoubleBinaryOperator</code> — <code>double applyAsDouble(double left, double right)</code></li> <li><code>java.util.function.IntBinaryOperator</code></li> <li><code>java.util.function.LongBinaryOperator</code></li></ul></li></ul></li> <li><p><code>java.util.function.Supplier&lt;T&gt;</code> — <code>T get()</code></p> <ul><li>variants
<ul><li><code>java.util.function.BooleanSupplier</code> — <code>boolean getAsBoolean()</code></li> <li><code>java.util.function.DoubleSupplier</code></li> <li><code>java.util.function.IntSupplier</code></li> <li><code>java.util.function.LongSupplier</code></li></ul></li></ul></li> <li><p><code>java.util.function.Consumer&lt;T&gt;</code> — <code>void accept(T t)</code></p> <ul><li><code>default Consumer&lt;T&gt; andThen(Consumer&lt;? super T&gt; after)</code> — chaining<div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// default implementation</span>
<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">T</span> t<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span> <span class="token function">accept</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span> after<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></li> <li>variants
<ul><li><code>java.util.function.DoubleConsumer</code> — <code>void accept(double value)</code></li> <li><code>java.util.function.IntConsumer</code></li> <li><code>java.util.function.LongConsumer</code></li></ul></li> <li>variants with two parameters
<ul><li><code>java.util.function.BiConsumer&lt;T, U&gt;</code> — <code>void accept(T t, U u)</code></li> <li><code>java.util.function.ObjDoubleConsumer&lt;T&gt;</code></li> <li><code>java.util.function.ObjIntConsumer&lt;T&gt;</code></li> <li><code>java.util.function.ObjLongConsumer&lt;T&gt;</code></li></ul></li></ul></li> <li><p><code>java.util.function.Predicate&lt;T&gt;</code> — <code>boolean test(T t)</code></p> <ul><li><code>static &lt;T&gt; Predicate&lt;T&gt; isEqual(Object targetRef)</code></li> <li>chaining
<ul><li><code>default Predicate&lt;T&gt; and(Predicate&lt;? super T&gt; other)</code></li> <li><code>default Predicate&lt;T&gt; negate()</code></li> <li><code>default Predicate&lt;T&gt; or(Predicate&lt;? super T&gt; other)</code></li></ul></li> <li>variants
<ul><li><code>java.util.function.DoublePredicate</code></li> <li><code>java.util.function.IntPredicate</code></li> <li><code>java.util.function.LongPredicate</code></li> <li><code>java.util.function.BiPredicate&lt;T,U&gt;</code></li></ul></li></ul></li></ol> <h2 id="inner-class"><a href="#inner-class" class="header-anchor">#</a> Inner Class</h2> <ol><li><p>inner class</p> <ul><li>explicit reference to the outer class — outer class can be explicitly referred to as <code>OuterClass.this</code> <ul><li>passed as implicit parameter to inner class constructors</li></ul></li> <li>implicit reference — can access the data from the scope in which they are defined
<ul><li>synthesized constructor parameter for implicit reference — the compiler modifies all inner class constructors, adding a parameter for the outer class reference</li></ul></li> <li>constructing inner classes — <code>new</code> keyword changes for implicit reference
<ul><li>inside outer class — <code>this.new</code> or alternatively <code>new</code></li> <li>outside outer class — <code>outerObj.new</code></li></ul></li> <li>access control — can be hidden from other classes in the same package
<ul><li>only inner classes can be private — regular classes always have either package or public visibility</li> <li><code>private</code> accessible for each other — between the outer class and inner classes</li></ul></li> <li>refer to inner class outside the outer class — <code>OuterClass.InnerClass</code></li></ul></li> <li><p>inner class limits</p> <ul><li>static fields — must be <code>final</code></li> <li>static methods — cannot have static methods</li></ul></li> <li><p>inner class after compilation or at runtime — synthesized regular classes</p> <ul><li><code>Outer$Inner</code> class — inner classes are translated into regular class files with <code>$</code> (dollar signs) delimiting outer and inner class names
<ul><li>compared to regular classes — more access privileges to the outer class, like private fields</li></ul></li> <li>synthesized outer class reference — inner class has a <code>final</code> <code>this$0</code> field for reference to outer class generated by compiler</li> <li>private inner classes — JVM does not support private classes, so the compiler produces a package-visible class with a private constructor, and a second package-visible constructor that calls the private one<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">TalkingClock</span>$<span class="token class-name">TimePrinter</span><span class="token punctuation">(</span><span class="token class-name">TalkingClock</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">TalkingClock</span>$<span class="token class-name">TimePrinter</span><span class="token punctuation">(</span><span class="token class-name">TalkingClock</span><span class="token punctuation">,</span> <span class="token class-name">TalkingClock</span>$<span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// the last parameter type is synthesized solely to distinguish this constructor from others</span>
<span class="token keyword">new</span> <span class="token class-name">TalkingClock</span>$<span class="token class-name">TimePrinter</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// actual call in outer class</span>
</code></pre></div></li> <li>mechanism for more privileged access to outer class — synthesized outer class backdoor method
<ul><li>backdoor method — outer class generates a package accessible static <code>access$0(OuterClass outer)</code> method (method name can vary slightly), for inner class, outer class private field access is translated to backdoor method call</li> <li>vulnerability — the generated backdoor method name is not legal in source code, but can be exploited by build or modify a class file</li></ul></li> <li>JVM unaware — the virtual machine does not have any special knowledge about inner classes</li> <li>verify by inspecting class files — use <code>javap -p</code> to verify</li></ul></li> <li><p>local inner class — class locally in a single method</p> <ul><li>no access modifier — never declared with an access specifier</li> <li>restricted scope — scope is always restricted to the block being declared</li> <li>effectively final closure — can access effectively final local variables
<ul><li>as final fields — behind the scenes stored as a final field of inner class, and spawned to constructor for initialization</li> <li>access mutable data — use an array of length 1</li></ul></li> <li>anonymous inner subclass<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">new</span> <span class="token class-name">SuperType</span><span class="token punctuation">(</span>construction parameters<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// inner class methods and data</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>implement an interface — <code>SuperType</code> can be an interface, the inner class implements that interface</li> <li>extend a class — <code>SuperType</code> can also be a class, the inner class extends that class
<ul><li>a different subclass — take care that <code>equals()</code> with <code>SuperType</code> may fail</li></ul></li> <li>anonymity cannot have constructors — the name of a constructor must be the same as the name of a class</li> <li>use case
<ul><li>double brace initialization for <code>ArrayList</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token function">invite</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;Harry&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;Tony&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li>get the class from static methods, alternative to <code>T.class</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEnclosingClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li></ul></li></ul></li> <li><p>static inner class</p> <ul><li>static — do not have a outer class reference, can have static fields and methods</li> <li>use case
<ul><li>enums are static inner classes</li> <li>use in outer static methods — must be declared static if needed in a outer class static method</li> <li>return type — can be used for holder for a method to return multiple values</li></ul></li> <li>the only static classes — only inner classes can be declared static</li> <li>implicitly static
<ul><li>inner interfaces are implicitly <code>static</code></li> <li>inner classes inside interfaces are automatically <code>static public</code></li></ul></li></ul></li></ol> <h1 id="reflection"><a href="#reflection" class="header-anchor">#</a> Reflection</h1> <ol><li><p>runtime type identification — used by VM for method resolution</p> <ul><li><code>Class getClass()</code> in <code>Object</code></li> <li><code>static Class&lt;?&gt; forName(String className)</code> in <code>Class</code></li> <li><code>T.class</code> if <code>T</code> is any Java type (or <code>void.class</code>)</li> <li>type capturing — use <code>Class&lt;T&gt;</code> as a parameter for type match, when called with a class object, the type parameter <code>T</code> will be matched</li></ul></li> <li><p><code>interface java.lang.reflect.Type</code> — super interface for all types, implemented or extended by <code>Class&lt;T&gt;</code>, <code>GenericArrayType</code>, <code>ParameterizedType</code>, <code>TypeVariable&lt;D&gt;</code>, <code>WildcardType</code></p> <ul><li><code>default String getTypeName()</code></li> <li>generics reflection methods — in implementing classes or sub-Interfaces</li></ul></li> <li><p><code>interface java.lang.reflect.AnnotatedElement</code> — represents an annotated element with methods getting annotations</p></li> <li><p><code>java.lang.reflect.GenericDeclaration</code> — entities that declare type variables</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">GenericDeclaration</span>
<span class="token keyword">extends</span> <span class="token class-name">AnnotatedElement</span>
</code></pre></div><ul><li><code>TypeVariable&lt;?&gt;[] getTypeParameters()</code></li></ul></li> <li><p><code>Class</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Serializable</span><span class="token punctuation">,</span> <span class="token class-name">GenericDeclaration</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">,</span> <span class="token class-name">AnnotatedElement</span>
</code></pre></div><ul><li>reflection
<ul><li><code>String getName()</code></li> <li><code>String getTypeName()</code></li> <li><code>String toString()</code></li> <li><code>Class&lt;?&gt; getComponentType()</code> — type of elements in an array, <code>null</code> if <code>this</code> is not an array</li> <li><code>ClassLoader getClassLoader()</code></li> <li><code>T[] getEnumConstants()</code></li> <li><code>Class&lt;? super T&gt; getSuperclass()</code></li></ul></li> <li>instance creation
<ul><li><code>T newInstance()</code></li> <li><code>T cast(Object obj) throws ClassCastException</code></li></ul></li> <li>method reflection — from this class and superclasses, <code>declared-</code> only for this class
<ul><li><code>Field[] getFields()</code></li> <li><code>Field getField(String name)</code></li> <li><code>Field[] getDeclaredFields()</code></li> <li><code>Field getDeclaredField(String name)</code></li> <li><code>Method[] getMethods()</code></li> <li><code>Method getMethod(String name, Class&lt;?&gt;... parameterTypes)</code></li> <li><code>Method[] getDeclaredMethods()</code></li> <li><code>Method getDeclaredMethod(String name, Class&lt;?&gt;... parameterTypes)</code></li> <li><code>Constructor[] getConstructors()</code></li> <li><code>Constructor&lt;T&gt; getConstructor(Class&lt;?&gt;... parameterTypes)</code></li> <li><code>Constructor[] getDeclaredConstructors()</code></li> <li><code>Constructor&lt;T&gt; getDeclaredConstructor(Class&lt;?&gt;... parameterTypes)</code></li></ul></li> <li>inner class and outer class
<ul><li><code>Class&lt;?&gt;[] getClasses()</code></li> <li><code>Class&lt;?&gt; getEnclosingClass()</code></li></ul></li> <li>generics
<ul><li><code>Type[] getGenericInterfaces()</code></li> <li><code>Type getGenericSuperclass()</code></li> <li><code>TypeVariable&lt;Class&lt;T&gt;&gt;[] getTypeParameters()</code></li></ul></li> <li>get resources, delegating to class loader
<ul><li><code>URL getResource(String name)</code></li> <li><code>InputStream getResourceAsStream(String name)</code></li></ul></li></ul></li> <li><p><code>java.lang.reflect.Field</code><br> <code>java.lang.reflect.Method</code><br> <code>java.lang.reflect.Constructor</code></p> <ul><li><code>Class&lt;?&gt; getDeclaringClass()</code></li> <li><code>Class&lt;?&gt;[] getExceptionTypes()</code> (<code>Constructor</code> and <code>Method</code>)</li> <li><code>Class&lt;?&gt;[] getParameterTypes()</code> (<code>Constructor</code> and <code>Method</code>)</li> <li><code>int getModifiers()</code></li> <li><code>String getName()</code></li> <li>inherited from <code>java.lang.reflect.AccessibleObject</code> <ul><li><code>boolean isAccessible()</code></li> <li><code>void setAccessible()</code></li></ul></li></ul></li> <li><p><code>java.lang.reflect.Constructor</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">extends</span> <span class="token class-name">Executable</span>
</code></pre></div><ul><li><code>T newInstance(Object... initargs)</code></li></ul></li> <li><p><code>java.lang.reflect.Method</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Method</span>
<span class="token keyword">extends</span> <span class="token class-name">Executable</span>
</code></pre></div><ul><li><code>Object invoke(Object obj, Object... args)</code> <ul><li>For a static method, the first parameter is ignored, use <code>null</code></li> <li>slow and as last resort</li></ul></li> <li><code>Class&lt;?&gt; getReturnType()</code></li> <li>Generics
<ul><li><code>TypeVariable[] getTypeParameters()</code></li> <li><code>Type getGenericReturnType()</code></li> <li><code>Type[] getGenericParameterTypes()</code></li></ul></li></ul></li> <li><p><code>java.lang.reflect.Field</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Field</span>
<span class="token keyword">extends</span> <span class="token class-name">AccessibleObject</span>
<span class="token keyword">implements</span> <span class="token class-name">Member</span>
</code></pre></div><ul><li><code>Object get(Object obj)</code> — <code>obj.field</code><br> <code>type getType(Object obj)</code> — for primitive</li> <li><code>void set(Object obj, Object value)</code><br> <code>type setType(Object obj, type value)</code></li></ul></li> <li><p><code>java.lang.reflect.Modifier</code></p> <ul><li><code>static String toString(int mod)</code></li> <li><code>static boolean isAbstract(int mod)</code></li> <li><code>static boolean isFinal(int mod)</code></li> <li><code>static boolean isInterface(int mod)</code></li> <li><code>static boolean isNative(int mod)</code></li> <li><code>static boolean isPrivate(int mod)</code></li> <li><code>static boolean isProtected(int mod)</code></li> <li><code>static boolean isPublic(int mod)</code></li> <li><code>static boolean isStatic(int mod)</code></li> <li><code>static boolean isStrict(int mod)</code></li> <li><code>static boolean isSynchronized(int mod)</code></li> <li><code>static boolean isVolatile(int mod)</code></li></ul></li> <li><p><code>java.lang.reflect.Array</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Array</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
</code></pre></div><ul><li><code>static Object newInstance(Class&lt;?&gt; componentType, int length)</code><br> <code>static Object newInstance(Class&lt;?&gt; componentType, int... dimensions)</code> <ul><li>in coordination with <code>ClassObj.getComponentType()</code></li> <li><code>type[]</code> can be converted to an <code>Object</code>, but not <code>Object[]</code></li></ul></li> <li><code>static int getLength(Object array)</code></li> <li><code>static void set(Object array)</code></li> <li><code>static Object get(Object array)</code></li> <li><code>static type getType(Object array)</code></li></ul></li> <li><p><code>Package</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Package</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">AnnotatedElement</span>
</code></pre></div></li></ol> <h2 id="proxy"><a href="#proxy" class="header-anchor">#</a> Proxy</h2> <ol><li><p>proxies</p> <ul><li>usage — at runtime, create new classes that implement given interfaces, with a method invocation handler</li> <li>proxy class definition
<ul><li>runtime defined class — proxy objects are of classes defined at runtime with names such as <code>$Proxy0</code></li> <li>modifiers and inheritance — all proxies are <code>public final</code> and extends <code>Proxy</code></li> <li>cached — only one proxy class for a particular class loader and ordered set of interfaces</li> <li>package — default package if given interfaces all public, else belongs to the package of given non-public interfaces</li></ul></li> <li>proxying — all proxy classes override the <code>toString()</code>, <code>equals()</code>, and <code>hashCode()</code>, and given interface methods with <code>InvocationHandler::invoke</code> <ul><li>other methods in <code>Object</code> are untouched</li></ul></li></ul></li> <li><p><code>interface java.lang.reflect.InvocationHandler</code> — invocation handlers</p> <ul><li><code>public Object invoke(Object proxy, Method method, Object[] args) throws Throwable</code></li> <li>additional data is stored in the invocation handler</li></ul></li> <li><p><code>java.lang.reflect.Proxy</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Proxy</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Serializable</span>
</code></pre></div><ul><li>creation
<ul><li><code>static Object newProxyInstance(ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler h)</code></li> <li><code>static Class&lt;?&gt; getProxyClass(ClassLoader loader, Class&lt;?&gt;... interfaces)</code></li></ul></li> <li><code>static InvocationHandler getInvocationHandler(Object proxy)</code></li> <li><code>static boolean isProxyClass(Class&lt;?&gt; cl)</code></li></ul></li> <li><p>use example</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProxyTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> elems <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token number">1000</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> elems<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> —i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            elems<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span> <span class="token class-name">Comparable</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">TraceHandler</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">binarySearch</span><span class="token punctuation">(</span>elems<span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token class-name">ThreadLocalRandom</span><span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>elements<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">TraceHandler</span> <span class="token keyword">implements</span> <span class="token class-name">InvocationHandler</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span> <span class="token class-name">Object</span> target<span class="token punctuation">;</span>
   <span class="token keyword">public</span> <span class="token class-name">TraceHandler</span><span class="token punctuation">(</span><span class="token class-name">Object</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      target <span class="token operator">=</span> t<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> m<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
      <span class="token comment">// print implicit argument</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// print method name</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span> <span class="token operator">+</span> m<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;(&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// print explicit arguments</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>args <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
         <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> args<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
         <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> args<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;, &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// invoke actual method</span>
      <span class="token keyword">return</span> m<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <h1 id="utils"><a href="#utils" class="header-anchor">#</a> Utils</h1> <h2 id="arrays"><a href="#arrays" class="header-anchor">#</a> Arrays</h2> <ol><li><code>java.util.Arrays</code> <ul><li>conversion
<ul><li><code>static String toString(type[] a)</code></li> <li><code>static String deepToString(Object[] a)</code></li> <li><code>static &lt;T&gt; List&lt;T&gt; asList(T... a)</code> — <code>return new ArrayList&lt;&gt;(a);</code> <ul><li><code>ArrayList</code> here is <code>Arrays$ArrayList</code> which implements <code>List</code>, a view on the original array with fixed size</li> <li>if real <code>ArrayList</code> is desired — use this <code>Arrays$ArrayList</code> to construct</li></ul></li> <li>stream methods</li></ul></li> <li><code>static int binarySearch(type[] a, type v)</code><br> <code>static int binarySearch(type[] a, int start, int end, type v)</code> <ul><li><code>Object[]</code> actually needs to be <code>Comparable[]</code></li></ul></li> <li>copy
<ul><li><code>static type[] copyOf(type[] original, int newLength)</code> — uses <code>System::arraycopy</code> behind the scenes</li> <li><code>static type[] copyOfRange(type[] a, int start, int end)</code></li> <li><code>System::arraycopy</code></li> <li><code>T[]::clone</code></li></ul></li> <li>initialization and modifications
<ul><li><code>static void fill(type[] a, type v)</code></li> <li><code>static void setAll(double[] array, IntToDoubleFunction generator)</code> — generator takes indices as parameter<br> <code>static void setAll(int[] array, IntUnaryOperator generator)</code><br> <code>static void setAll(long[] array, IntToLongFunction generator)</code><br> <code>static &lt;T&gt; void setAll(T[] array, IntFunction&lt;? extends T&gt; generator)</code></li> <li><code>parallelSetAll</code> — parallel version of <code>setAll</code></li> <li><code>parallelPrefix</code> — prefix operators, like prefix sum</li></ul></li> <li><code>Object</code> methods
<ul><li><code>static boolean equals(type[] a, type[] b)</code></li> <li><code>static int hashCode(Object[] a)</code></li> <li><code>static boolean deepEquals(Object[] a1, Object[] a2)</code></li> <li><code>static int deepHashCode(Object[] a)</code></li> <li><code>static String deepToString(Object[] a)</code></li> <li><code>compare</code> — since JDK 9</li></ul></li> <li>sort
<ul><li><code>static void sort(type[] a)</code><br> <code>static void sort(type[] a, int fromIndex, int toIndex)</code><br> <code>static &lt;T&gt; void sort(T[] a, Comparator&lt;? super T&gt; c)</code><br> <code>static &lt;T&gt; void sort(T[] a, int fromIndex, int toIndex, Comparator&lt;? super T&gt; c)</code> <ul><li><code>Object[]</code> actually needs to be <code>Comparable[]</code></li> <li><code>java.util.DualPivotQuickSort::sort</code> for primitive type arrays</li> <li><code>java.util.TimSort::sort</code> for <code>T[]</code></li></ul></li> <li><code>static void parallelSort(type[] a)</code><br> <code>static void parallelSort(type[] a, int fromIndex, int toIndex)</code> (no <code>Object[]</code>)<br> <code>static &lt;T extends Comparable&lt;? super T&gt;&gt; void parallelSort(T[] a, int fromIndex, int toIndex)</code><br> <code>static &lt;T&gt; void parallelSort(T[] a, Comparator&lt;? super T&gt; cmp)</code><br> <code>static &lt;T&gt; void parallelSort(T[] a, int fromIndex, int toIndex, Comparator&lt;? super T&gt; cmp)</code> <ul><li>granularity — <code>private static final int MIN_ARRAY_SORT_GRAN = 1 &lt;&lt; 13;</code></li> <li>sequential sort (as <code>Arrays::sort</code>) when<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;=</span> MIN_ARRAY_SORT_GRAN <span class="token operator">||</span> <span class="token punctuation">(</span>p <span class="token operator">=</span> <span class="token class-name">ForkJoinPool</span><span class="token punctuation">.</span><span class="token function">getCommonPoolParallelism</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
</code></pre></div></li> <li>else parallel sort — uses threading (each thread gets a chunk of the list and sorts it in parallel. Later these sorted chunks are merged into a result)</li> <li><code>java.util.DualPivotQuickSort::sort</code> for primitive type arrays</li> <li><code>java.util.TimSort::sort</code> for <code>T[]</code></li></ul></li></ul></li></ul></li></ol> <h2 id="event-handling"><a href="#event-handling" class="header-anchor">#</a> Event Handling</h2> <ol><li><p><code>java.util.EventListener</code> — A tagging interface that all event listener interfaces must extend</p></li> <li><p><code>java.util.EventListenerProxy</code> — An abstract wrapper class for an EventListener class which associates a set of additional parameters with the listener</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">EventListenerProxy</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">EventListener</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">EventListener</span>
</code></pre></div></li> <li><p><code>java.util.EventObject</code> — The root class from which all event state objects shall be derived</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EventObject</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Serializable</span>
</code></pre></div></li> <li><p>MVC</p> <ul><li><code>java.util.Observable</code></li> <li><code>interface java.util.Observer</code></li></ul></li></ol> <h2 id="collections-and-maps"><a href="#collections-and-maps" class="header-anchor">#</a> Collections and Maps</h2> <ol><li><p>concurrent collections — see <a href="#Thread-Safe-Collections">Thread-Safe Collections</a>, and <a href="#Data-Exchange"><code>SynchronousQueue</code></a></p></li> <li><p><code>Iterable</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><code>default void forEach(Consumer&lt;? super T&gt; action)</code></li> <li><code>Iterator&lt;T&gt; iterator()</code></li> <li><code>default Spliterator&lt;T&gt; spliterator()</code></li> <li>foreach loop — needs to implement <code>Iterable</code> <ul><li>behind the scenes — a loop with an iterator</li></ul></li></ul></li> <li><p><code>java.util.Iterator&lt;E&gt;</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>fail fast — multiple readers, or a single reader and writer, otherwise <code>ConcurrentModificationException</code> <ul><li>detection scheme — the count of modifications is keep in both the collection and the iterator</li> <li>exception — <code>LinkedList::set</code> is not counted</li></ul></li> <li><code>E next()</code> — possibly <code>NoSuchElementException</code></li> <li><code>boolean hasNext()</code></li> <li><code>void remove()</code> — remove the element last returned by <code>next()</code></li> <li><code>default void forEachRemaining(Consumer&lt;? super E&gt; action)</code></li> <li><code>Collections::emptyIterator</code></li></ul></li> <li><p><code>java.util.Spliterator</code> — both sequential and parallel data processing, the parallel analogue of an <code>Iterator</code></p> <ul><li>fail fast</li> <li>late-binding — binds to the source of elements at the point of first traversal, first split, or first query for estimated size, rather than at the time the <code>Spliterator</code> is created</li></ul></li> <li><p><code>java.util.Collection</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">extends</span> <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>add
<ul><li><code>boolean add(E e)</code> — <code>true</code> when success</li> <li><code>boolean addAll(Collection&lt;? extends E&gt; c)</code></li></ul></li> <li>test
<ul><li><code>boolean equals(Object o)</code></li> <li><code>boolean contains(Object o)</code></li> <li><code>boolean containsAll(Collection&lt;?&gt; c)</code></li> <li><code>boolean isEmpty()</code></li></ul></li> <li>modify
<ul><li><code>void clear()</code></li> <li><code>boolean removeIf(Predicate&lt;? super E&gt; filter)</code></li> <li><code>boolean removeAll(Collection&lt;?&gt; c)</code></li> <li><code>boolean remove(Object o)</code></li> <li><code>boolean retainAll(Collection&lt;?&gt; c)</code></li></ul></li> <li>conversion
<ul><li><code>&lt;T&gt; T[] toArray(T[] a)</code> — no new array created if <code>a</code> is of the correct size</li> <li><code>default Stream&lt;E&gt; stream()</code></li> <li><code>default Stream&lt;E&gt; parallelStream()</code></li></ul></li> <li>get collection information
<ul><li><code>int size()</code></li> <li><code>Iterator&lt;E&gt; iterator()</code></li> <li><code>default Spliterator&lt;E&gt; spliterator()</code></li></ul></li> <li><code>java.util.AbstractCollection</code> — a skeletal implementation of the <code>Collection</code> interface, to minimize the effort required to implement this interface<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractCollection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>should have been replaced by default methods, but only new methods have default implementation</li> <li>extends the abstract class and simultaneously implement the interface — only make a difference to clarity and reflection</li></ul></li></ul></li> <li><p><code>java.util.Collections</code> — static helper</p> <ul><li><code>static &lt;T&gt; boolean addAll(Collection&lt;? super T&gt; c, T... elements)</code></li> <li><code>static boolean disjoint(Collection&lt;?&gt; c1, Collection&lt;?&gt; c2)</code> — <code>true</code> if the two specified collections have no elements in common</li> <li><code>static int frequency(Collection&lt;?&gt; c, Object o)</code></li> <li><code>static &lt;T extends Object &amp; Comparable&lt;? super T&gt;&gt; T max(Collection&lt;? extends T&gt; coll)</code><br> <code>static &lt;T&gt; T max(Collection&lt;? extends T&gt; coll, Comparator&lt;? super T&gt; comp)</code><br> <code>static &lt;T extends Object &amp; Comparable&lt;? super T&gt;&gt; T min(Collection&lt;? extends T&gt; coll)</code><br> <code>static &lt;T&gt; T min(Collection&lt;? extends T&gt; coll, Comparator&lt;? super T&gt; comp)</code></li> <li><code>static &lt;T&gt; Comparator&lt;T&gt; reverseOrder()</code><br> <code>static &lt;T&gt; Comparator&lt;T&gt; reverseOrder(Comparator&lt;T&gt; cmp)</code> <ul><li>called by <code>Comparator::reverseOrder</code> and <code>Comparator::reversed</code></li></ul></li> <li>list related — see <a href="#List">List</a></li> <li>views and wrappers — see <a href="#Views-and-Wrappers">Views and Wrappers</a> <ul><li><code>Collections::unmodifiableCollection</code></li> <li><code>Collections::synchronizedCollection</code></li> <li><code>Collections::checkedCollection</code></li></ul></li></ul></li></ol> <h3 id="list"><a href="#list" class="header-anchor">#</a> List</h3> <ol><li><p><code>interface java.util.RandomAccess</code> — marker interface used by <code>List</code> implementations to indicate that they support fast (generally constant time) random access</p></li> <li><p><code>java.util.List</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">extends</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><code>java.util.AbstractList&lt;E&gt;</code> — This class provides a skeletal implementation of the <code>List</code> interface to minimize the effort required to implement this interface backed by a &quot;random access&quot; data store (such as an array)<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">extends</span> <span class="token class-name">AbstractCollection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">implements</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li>add — with indexed version
<ul><li><code>void add(int index, E element)</code></li> <li><code>boolean addAll(int index, Collection&lt;? extends E&gt; c)</code></li></ul></li> <li>element
<ul><li><code>E get(int index)</code></li> <li><code>int indexOf()</code></li> <li><code>int lastIndexOf(Object o)</code></li></ul></li> <li>list information
<ul><li><code>ListIterator&lt;E&gt; listIterator()</code></li> <li><code>ListIterator&lt;E&gt; listIterator(int index)</code></li> <li><code>default Spliterator&lt;E&gt; spliterator()</code></li> <li><code>List&lt;E&gt; subList(int fromIndex, int toIndex)</code> — a view</li></ul></li> <li>modify and converse
<ul><li><code>E set(int index, E element)</code></li> <li><code>E remove(int index)</code></li> <li><code>default void sort(Comparator&lt;? super E&gt; c)</code> — uses <code>Arrays::sort</code> after <code>toArray()</code></li></ul></li></ul></li> <li><p><code>java.util.ListIterator</code> — has <code>previous</code> in addition to <code>next</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ListIterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><code>void add(E e)</code></li> <li><code>boolean hasPrevious()</code></li> <li><code>int nextIndex()</code></li> <li><code>E previous()</code></li> <li><code>int previousIndex()</code></li> <li><code>void set(E e)</code></li> <li><code>Collections::emptyListIterator</code></li></ul></li> <li><p><code>List</code> related methods in <code>Collections</code></p> <ul><li>find
<ul><li><code>static &lt;T&gt; int binarySearch(List&lt;? extends Comparable&lt;? super T&gt;&gt; list, T key)</code> — return <code>(-(insertion point) - 1)</code> if no matching<br> <code>static &lt;T&gt; int binarySearch(List&lt;? extends T&gt; list, T key, Comparator&lt;? super T&gt; c)</code> <ul><li>whether <code>indexedBinarySearch</code> or <code>iteratorBinarySearch</code> — checks <code>RandomAccess</code> or <code>BINARYSEARCH_THRESHOLD</code> to determine</li></ul></li> <li><code>static int indexOfSubList(List&lt;?&gt; source, List&lt;?&gt; target)</code></li> <li><code>static int lastIndexOfSubList(List&lt;?&gt; source, List&lt;?&gt; target)</code></li></ul></li> <li>modify
<ul><li><code>static &lt;T&gt; void copy(List&lt;? super T&gt; dest, List&lt;? extends T&gt; src)</code></li> <li><code>static &lt;T&gt; void fill(List&lt;? super T&gt; list, T obj)</code></li> <li><code>static &lt;T&gt; boolean replaceAll(List&lt;T&gt; list, T oldVal, T newVal)</code></li> <li><code>static void reverse(List&lt;?&gt; list)</code></li> <li><code>static void rotate(List&lt;?&gt; list, int distance)</code></li> <li><code>static void shuffle(List&lt;?&gt; list)</code> — checks whether <code>RandomAccess</code> otherwise <code>toArray()</code><br> <code>static void shuffle(List&lt;?&gt; list, Random rnd)</code></li> <li><code>static &lt;T extends Comparable&lt;? super T&gt;&gt; void sort(List&lt;T&gt; list)</code></li> <li><code>static &lt;T&gt; void sort(List&lt;T&gt; list, Comparator&lt;? super T&gt; c)</code> — uses <code>List::sort</code></li> <li><code>static void swap(List&lt;?&gt; list, int i, int j)</code></li></ul></li> <li>views
<ul><li><code>Arrays::asList</code></li> <li><code>nCopies</code></li> <li><code>singletonList</code></li> <li><code>emptyList</code></li> <li><code>unmodifiableList</code></li> <li><code>synchronizedList</code></li> <li><code>checkedList</code></li> <li><code>List::subList</code></li></ul></li></ul></li> <li><p><code>java.util.ArrayList</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">extends</span> <span class="token class-name">AbstractList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">implements</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">RandomAccess</span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span>
</code></pre></div><ul><li><code>private static final int DEFAULT_CAPACITY = 10</code></li> <li>constructors
<ul><li><code>ArrayList()</code> — constructs an empty list with an initial capacity of 10</li> <li><code>ArrayList(Collection&lt;? extends E&gt; c)</code></li> <li><code>ArrayList(int initialCapacity)</code></li> <li>anonymous <code>ArrayList</code> — double brace initialization, actually a inner subclass<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;Harry&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;Tony&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><code>int[]</code> to <code>ArrayList&lt;Integer&gt;</code> without loop — for large arrays with sparse access patterns<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token function">asList</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> is<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">unmodifiableList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AbstractList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> is<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> is<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul></li> <li>capacity
<ul><li><code>void ensureCapacity(int minCapacity)</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">int</span> newCapacity <span class="token operator">=</span> oldCapacity <span class="token operator">+</span> <span class="token punctuation">(</span>oldCapacity <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><code>void trimToSize()</code></li></ul></li></ul></li> <li><p><code>java.util.LinkedList</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">extends</span> <span class="token class-name">AbstractSequentialList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">implements</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Deque</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span>
</code></pre></div><ul><li>use with <code>ListIterator</code></li> <li><code>LinkedList</code> vs <code>ArrayDeque</code> — see <code>ArrayDeque</code> below</li></ul></li></ol> <h3 id="queue"><a href="#queue" class="header-anchor">#</a> Queue</h3> <ol><li><p><code>java.util.Queue</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Queue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><code>IllegalStateException</code> or <code>NoSuchElementException</code> when failure
<ul><li><code>boolean add(E e)</code> — returning <code>true</code> upon success and throwing an <code>IllegalStateException</code> if no space is currently available</li> <li><code>E remove()</code></li> <li><code>E element()</code> — peek the head</li></ul></li> <li>return <code>null</code> when failure
<ul><li><code>boolean offer(E e)</code></li> <li><code>E poll()</code></li> <li><code>E peek()</code></li></ul></li> <li><code>java.util.AbstractQueue</code> — skeletal implementations of some <code>Queue</code> operations<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractCollection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">implements</span> <span class="token class-name">Queue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ul></li> <li><p><code>java.util.Deque</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Deque</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">Queue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><table><thead><tr><th></th> <th>First Element (Head)</th> <th></th> <th>Last Element (Tail)</th> <th></th></tr></thead> <tbody><tr><td></td> <td>Throws exception</td> <td>return special value</td> <td>Throws exception</td> <td>return special value</td></tr> <tr><td>Insert</td> <td><code>addFirst(e)</code>, <code>push(e)</code></td> <td><code>offerFirst(e)</code></td> <td><code>addLast(e)</code>, <code>add(e)</code></td> <td><code>offerLast(e)</code>, <code>offer(e)</code></td></tr> <tr><td>Remove</td> <td><code>removeFirst()</code>, <code>remove()</code>, <code>pop()</code></td> <td><code>pollFirst()</code>, <code>poll()</code></td> <td><code>removeLast()</code></td> <td><code>pollLast()</code></td></tr> <tr><td>Examine</td> <td><code>getFirst()</code>, <code>element()</code></td> <td><code>peekFirst()</code>, <code>peek()</code></td> <td><code>getLast()</code></td> <td><code>peekLast()</code></td></tr></tbody></table> <ul><li>usage — double ended queue, also should be used in preference to the legacy <code>Stack</code> class</li></ul></li> <li><p><code>LinkedList</code></p></li> <li><p><code>java.util.ArrayDeque</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ArrayDeque</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractCollection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">implements</span> <span class="token class-name">Deque</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span>
</code></pre></div><ul><li>underlying implementation — circular array, no <code>null</code> elements</li> <li>not implementing <code>List</code> and extends <code>AbstractCollection</code> but not <code>AbstractQueue</code> — <a href="https://bugs.openjdk.java.net/browse/JDK-8143850" target="_blank" rel="noopener noreferrer">retrofit <code>ArrayDeque</code> to implement <code>List</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>no <code>null</code> support — <code>NullPointerException</code> for <code>null</code> elements</li> <li>capacity
<ul><li>default initial capacity — 16</li> <li>capacity grow policy — double capacity if small; else grow by 50%<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">int</span> jump <span class="token operator">=</span> <span class="token punctuation">(</span>oldCapacity <span class="token operator">&lt;</span> <span class="token number">64</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">(</span>oldCapacity <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>oldCapacity <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li> <li><code>ArrayDeque</code> vs <code>LinkedList</code> — <code>LinkedList</code>s iterate with more CPU cache miss, have the overhead of node allocations, and consume more memory, but supports <code>List</code>, <code>null</code> elements, and better remove-while-iterate</li></ul></li> <li><p><code>java.util.PriorityQueue</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PriorityQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">implements</span> <span class="token class-name">Serializable</span>
</code></pre></div><ul><li><code>private static final int DEFAULT_INITIAL_CAPACITY = 11</code></li> <li>capacity grow policy — as <code>ArrayDeque</code></li></ul></li> <li><p>views</p> <ul><li>as stack — <code>Collections::asLifoQueue</code></li></ul></li></ol> <h3 id="set"><a href="#set" class="header-anchor">#</a> Set</h3> <ol><li><p><code>java.util.Set</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><code>java.util.AbstractSet&lt;E&gt;</code></li></ul></li> <li><p><code>java.util.NavigableSet</code> — adds methods for locating and backward traversal</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">NavigableSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">SortedSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>locating
<ul><li><code>E lower(E e)</code></li> <li><code>E pollFirst()</code></li> <li><code>E pollLast()</code></li> <li><code>E higher(E e)</code></li> <li><code>E ceiling(E e)</code></li> <li><code>E floor(E e)</code></li></ul></li> <li>backward traversal
<ul><li><code>Iterator&lt;E&gt; descendingIterator()</code></li> <li><code>NavigableSet&lt;E&gt; descendingSet()</code></li></ul></li> <li><code>java.util.SortedSet</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SortedSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><code>Comparator&lt;? super E&gt; comparator()</code></li> <li><code>E first()</code></li> <li><code>E last()</code></li> <li><code>default Spliterator&lt;E&gt; spliterator()</code></li> <li><code>SortedSet&lt;E&gt; headSet(E toElement)</code></li> <li><code>SortedSet&lt;E&gt; subSet(E fromElement, E toElement)</code></li> <li><code>SortedSet&lt;E&gt; tailSet(E fromElement)</code></li></ul></li></ul></li> <li><p><code>java.util.HashSet</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">implements</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span>
</code></pre></div><ul><li>underlying data structure — <code>private transient HashMap&lt;E,Object&gt; map</code></li> <li>dummy value for the value of <code>Map.Entry</code> — <code>private static final Object PRESENT = new Object()</code></li> <li>iteration performance — proportional to capability</li></ul></li> <li><p><code>java.util.TreeSet</code> — red-black tree</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TreeSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">implements</span> <span class="token class-name">NavigableSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span>
</code></pre></div><ul><li>underlying data structure — <code>private transient NavigableMap&lt;E,Object&gt; m</code>, initialized with <code>TreeMap</code></li> <li>dummy value — see <code>HashSet</code></li></ul></li> <li><p><code>java.util.EnumSet</code> — for use with enum types</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">EnumSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span> <span class="token keyword">extends</span> <span class="token class-name">Enum</span><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">extends</span> <span class="token class-name">AbstractSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">implements</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span>
</code></pre></div><ul><li>underlying data — represented internally as bit vectors</li> <li>no <code>null</code> support — <code>NullPointerException</code> for <code>null</code> elements</li> <li>usage — a high-quality, typesafe alternative to traditional int-based &quot;bit flags&quot;</li> <li>underlying implementation — <code>RegularEnumSet</code> with a <code>long</code>, <code>JumboEnumSet</code> with a <code>long[]</code>, non-public in <code>java.util</code></li> <li>helper class — the abstract class itself acts as a static helper</li></ul></li> <li><p><code>java.util.LinkedHashSet</code> — ordered <code>HashSet</code> with underlying linked list, have no control over <code>removeEldestEntry</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LinkedHashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">implements</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span>
</code></pre></div></li> <li><p>views</p> <ul><li><code>Map::keySet</code> etc.</li> <li>set from map — <code>Collections::newSetFromMap</code> (for maps without corresponding sets, like <code>WeakHashMap</code> but not <code>HashMap</code>)</li> <li><code>Collections::singleton</code></li> <li>empty views — <code>Collections::emptySet</code>, <code>Collections::emptyNavigableSet</code>, <code>Collections::emptySortedSet</code></li> <li>unmodifiable views — <code>Collections::unmodifiableSet</code>, <code>Collections::unmodifiableNavigableSet</code>, <code>Collections::unmodifiableSortedSet</code></li> <li>synchronized views</li> <li>checked views</li> <li>subset methods</li></ul></li> <li><p><code>BitSet</code> — see <a href="#Legacy-Collections">Legacy Collections</a></p></li></ol> <h3 id="maps"><a href="#maps" class="header-anchor">#</a> Maps</h3> <ol><li><p><code>java.util.Map</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>modify
<ul><li><code>void clear()</code></li> <li>return old value if not <code>void</code> <ul><li><code>V remove(Object key)</code> — returns the previous value or <code>null</code></li> <li><code>default boolean remove(Object key, Object value)</code> — remove if <code>get(key)</code> equals <code>value</code></li> <li><code>V put(K key, V value)</code> — returns as <code>remove</code> method</li> <li><code>default V putIfAbsent(K key, V value)</code> — <code>null</code> value is also absent</li> <li><code>void putAll(Map&lt;? extends K,? extends V&gt; m)</code></li> <li><code>default V replace(K key, V value)</code></li> <li><code>default boolean replace(K key, V oldValue, V newValue)</code></li> <li><code>default void replaceAll(BiFunction&lt;? super K,? super V,? extends V&gt; function)</code></li></ul></li> <li>return new value if not <code>void</code> <ul><li><code>default V compute(K key, BiFunction&lt;? super K,? super V,? extends V&gt; remappingFunction)</code></li> <li><code>default V computeIfAbsent(K key, Function&lt;? super K,? extends V&gt; mappingFunction)</code> — <code>null</code> value is also absent</li> <li><code>default V computeIfPresent(K key, BiFunction&lt;? super K,? super V,? extends V&gt; remappingFunction)</code></li> <li><code>default V merge(K key, V value, BiFunction&lt;? super V,? super V,? extends V&gt; remappingFunction)</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">V</span> newValue <span class="token operator">=</span> <span class="token punctuation">(</span>oldValue <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> value <span class="token operator">:</span> remappingFunction<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>oldValue<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// example</span>
counts<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>word<span class="token punctuation">,</span> counts<span class="token punctuation">.</span><span class="token function">getOrDefault</span><span class="token punctuation">(</span>word<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
counts<span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>word<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token operator">::</span><span class="token function">sum</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li></ul></li> <li>test
<ul><li><code>boolean isEmpty()</code></li> <li><code>boolean containsKey(Object key)</code></li> <li><code>boolean containsValue(Object value)</code></li> <li><code>boolean equals(Object o)</code></li></ul></li> <li>loop or views
<ul><li><code>default void forEach(BiConsumer&lt;? super K,? super V&gt; action)</code></li> <li><code>Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet()</code></li> <li><code>Set&lt;K&gt; keySet()</code></li> <li><code>Collection&lt;V&gt; values()</code></li></ul></li> <li>get
<ul><li><code>V get(Object key)</code> — <code>null</code> if absent, can be confused with <code>null</code> values</li> <li><code>default V getOrDefault(Object key, V defaultValue)</code></li></ul></li> <li><code>int size()</code></li> <li><code>interface Entry&lt;K, V&gt;</code> — key-value pair</li> <li><code>java.util.AbstractMap&lt;K,V&gt;</code> — This class provides a skeletal implementation of the <code>Map</code> interface, to minimize the effort required to implement this interface<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>should have been replaced by default methods, but only new methods have default implementation</li> <li>extends the abstract class and simultaneously implement the interface — only make a difference to clarity and reflection</li> <li><code>AbstractMap.SimpleEntry</code>, <code>AbstractMap.SimpleImmutableEntry</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">AbstractMap</span><span class="token punctuation">.</span><span class="token class-name">SimpleEntry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span>
</code></pre></div></li></ul></li></ul></li> <li><p><code>java.util.NavigableMap</code> — refer to <code>NavigableSet</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">NavigableMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">SortedMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p><code>java.util.HashMap</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">implements</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span>
</code></pre></div><ul><li>schema — hash code modulo the number of buckets, or red-black tree if a hash collision</li> <li>constants
<ul><li><code>static final int DEFAULT_INITIAL_CAPACITY = 1 &lt;&lt; 4</code> — initial capacity will be converted to the power of 2</li> <li><code>static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30</code></li> <li><code>static final float DEFAULT_LOAD_FACTOR = 0.75f</code></li> <li><code>static final int TREEIFY_THRESHOLD = 8</code></li> <li><code>static final int UNTREEIFY_THRESHOLD = 6</code></li> <li><code>static final int MIN_TREEIFY_CAPACITY = 64</code> — smallest capability to permit treeify</li></ul></li> <li><code>static class Node&lt;K,V&gt; implements Map.Entry&lt;K,V&gt;</code> — permits <code>null</code> values and keys</li> <li>iteration performance — proportional to capability</li></ul></li> <li><p><code>java.util.TreeMap</code> — red-black tree</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TreeMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">implements</span> <span class="token class-name">NavigableMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span>
</code></pre></div><ul><li>do not support the <code>Entry::setValue</code> method — <code>Map.Entry</code> returned by methods in this class and its views represent snapshots of mappings at the time they were produced</li></ul></li> <li><p><code>java.util.EnumMap</code> — for use with enum types</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EnumMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span> <span class="token keyword">extends</span> <span class="token class-name">Enum</span><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">extends</span> <span class="token class-name">AbstractMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">implements</span> <span class="token class-name">Serializable</span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span>
</code></pre></div><ul><li>underlying data — represented internally as arrays, ordinals as indices</li> <li>weakly consistent iterators — never throw <code>ConcurrentModificationException</code>, may or may not show the effects of any modifications to the map that occur while the iteration is in progress</li> <li><code>null</code> support — no <code>null</code> keys but values</li></ul></li> <li><p><code>java.util.LinkedHashMap</code> — ordered <code>HashMap</code> with underlying doubly-linked list</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">implements</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><code>LinkedHashMap(int initialCapacity, float loadFactor, boolean accessOrder)</code> <ul><li><code>final boolean accessOrder</code> — <code>true</code> for access order, <code>false</code> for insertion order (default)</li></ul></li> <li>insertion order — the order is not affected if a key is re-inserted, even the value changes</li> <li>access order — get methods and modify methods make corresponding entries place at the last position: <code>put</code>, <code>putIfAbsent</code>, <code>get</code>, <code>getOrDefault</code>, <code>compute</code>, <code>computeIfAbsent</code>, <code>computeIfPresent</code>, or <code>merge</code> <ul><li><code>Map::replace</code> — results an access only when the value is replaced</li> <li>operations on views — no effect on order</li></ul></li> <li><code>protected boolean removeEldestEntry(Map.Entry&lt;K,V&gt; eldest)</code> — invoked by <code>put</code> and <code>putAll</code> after inserting a new entry into the map, returns <code>true</code> if this map should remove its eldest entry</li></ul></li> <li><p><code>java.util.WeakHashMap</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WeakHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">implements</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>underlying implementation — <code>Entry</code> extends <code>WeakReference</code> and registered to a <code>ReferenceQueue</code> upon construction</li> <li>not count for gc — the presence of a mapping for a given key will not prevent the key from being discarded by the garbage collector
<ul><li><code>private final ReferenceQueue&lt;Object&gt; queue</code> -- <code>WeakReference</code> keys are registered with a <code>queue</code> when created; when the referent of <code>WeakReference</code> is reclaimed by GC, <code>WeakReference::enqueue</code> is called at the same time or at some later time</li> <li><code>expungeStaleEntries()</code> -- private method that scan <code>WeakReference</code> keys in <code>queue</code> and set corresponding values to <code>null</code>; called every time in access methods, <code>size()</code>, and internal resize method</li></ul></li> <li><code>null</code> support — both keys and values</li> <li>values with strong reference to the keys — prevent keys from gc, can be alleviated by wrapping values with <code>new WeakReference(value)</code></li></ul></li> <li><p><code>java.util.IdentityHashMap</code> — <code>HashMap</code> with keys (and values) that are compared by <code>==</code>, not <code>equals</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IdentityHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">implements</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span>
</code></pre></div><ul><li>constant-time performance for the basic operations (<code>get</code> and <code>put</code>) — assuming the system identity hash function (<code>System.identityHashCode(Object)</code>) disperses elements properly among the buckets</li> <li>rehashing may be fairly expensive — initialize with large expected capacity</li></ul></li> <li><p>views</p> <ul><li><code>Collections::singletonMap</code></li> <li>empty views — <code>Collections::emptyMap</code>, <code>Collections::emptyNavigableMap</code>, <code>Collections::emptySortedMap</code></li> <li>unmodifiable views — <code>Collections::unmodifiableMap</code>, <code>Collections::unmodifiableNavigableMap</code>, <code>Collections::unmodifiableSortedMap</code></li> <li>synchronized views</li> <li>checked views</li> <li>sub map methods</li></ul></li></ol> <h3 id="views-and-wrappers"><a href="#views-and-wrappers" class="header-anchor">#</a> Views and Wrappers</h3> <ol><li><p><code>Map::keySet</code> etc.</p></li> <li><p><code>Arrays::asList</code></p></li> <li><p><code>Collections</code></p> <ul><li>one for n wrapper — <code>static &lt;T&gt; List&lt;T&gt; nCopies(int n, T o)</code> <ul><li>returns an immutable list consisting of n copies of the specified object, <code>o</code> is stored only once</li></ul></li> <li>stack view — <code>static &lt;T&gt; Queue&lt;T&gt; asLifoQueue(Deque&lt;T&gt; deque)</code></li> <li>set view from map, see <a href="#Set">Set</a> — <code>static &lt;E&gt; Set&lt;E&gt; newSetFromMap(Map&lt;E,Boolean&gt; map)</code></li> <li>wrappers containing only one element — immutable, instance of inner class in <code>Collections</code>, containing only one element
<ul><li><code>static &lt;T&gt; Set&lt;T&gt; singleton(T o)</code></li> <li><code>static &lt;T&gt; List&lt;T&gt; singletonList(T o)</code></li> <li><code>static &lt;K,V&gt; Map&lt;K,V&gt; singletonMap(K key, V value)</code></li></ul></li> <li>empty wrapper — immutable, instance of inner class in <code>Collections</code>, singleton
<ul><li><code>static &lt;T&gt; Iterator&lt;T&gt; emptyIterator()</code></li> <li><code>static &lt;T&gt; List&lt;T&gt; emptyList()</code></li> <li><code>static &lt;T&gt; ListIterator&lt;T&gt; emptyListIterator()</code></li> <li><code>static &lt;K,V&gt; Map&lt;K,V&gt; emptyMap()</code></li> <li><code>static &lt;K,V&gt; NavigableMap&lt;K,V&gt; emptyNavigableMap()</code></li> <li><code>static &lt;E&gt; NavigableSet&lt;E&gt; emptyNavigableSet()</code></li> <li><code>static &lt;T&gt; Set&lt;T&gt; emptySet()</code></li> <li><code>static &lt;K,V&gt; SortedMap&lt;K,V&gt; emptySortedMap()</code></li> <li><code>static &lt;E&gt; SortedSet&lt;E&gt; emptySortedSet()</code></li></ul></li> <li>unmodifiable view — <code>UnsupportedOperationException</code> when try modifying, instance of inner class in <code>Collections</code> <ul><li><code>static &lt;T&gt; Collection&lt;T&gt; unmodifiableCollection(Collection&lt;? extends T&gt; c)</code></li> <li><code>static &lt;T&gt; List&lt;T&gt; unmodifiableList(List&lt;? extends T&gt; list)</code></li> <li><code>static &lt;K,V&gt; Map&lt;K,V&gt; unmodifiableMap(Map&lt;? extends K,? extends V&gt; m)</code></li> <li><code>static &lt;K,V&gt; NavigableMap&lt;K,V&gt; unmodifiableNavigableMap(NavigableMap&lt;K,? extends V&gt; m)</code></li> <li><code>static &lt;T&gt; NavigableSet&lt;T&gt; unmodifiableNavigableSet(NavigableSet&lt;T&gt; s)</code></li> <li><code>static &lt;T&gt; Set&lt;T&gt; unmodifiableSet(Set&lt;? extends T&gt; s)</code></li> <li><code>static &lt;K,V&gt; SortedMap&lt;K,V&gt; unmodifiableSortedMap(SortedMap&lt;K,? extends V&gt; m)</code></li> <li><code>static &lt;T&gt; SortedSet&lt;T&gt; unmodifiableSortedSet(SortedSet&lt;T&gt; s)</code></li></ul></li> <li>synchronized view — synchronized with mutex, instance of inner class in <code>Collections</code> <ul><li><code>static &lt;T&gt; Collection&lt;T&gt; synchronizedCollection(Collection&lt;T&gt; c)</code></li> <li><code>static &lt;T&gt; List&lt;T&gt; synchronizedList(List&lt;T&gt; list)</code></li> <li><code>static &lt;K,V&gt; Map&lt;K,V&gt; synchronizedMap(Map&lt;K,V&gt; m)</code></li> <li><code>static &lt;K,V&gt; NavigableMap&lt;K,V&gt; synchronizedNavigableMap(NavigableMap&lt;K,V&gt; m)</code></li> <li><code>static &lt;T&gt; NavigableSet&lt;T&gt; synchronizedNavigableSet(NavigableSet&lt;T&gt; s)</code></li> <li><code>static &lt;T&gt; Set&lt;T&gt; synchronizedSet(Set&lt;T&gt; s)</code></li> <li><code>static &lt;K,V&gt; SortedMap&lt;K,V&gt; synchronizedSortedMap(SortedMap&lt;K,V&gt; m)</code></li> <li><code>static &lt;T&gt; SortedSet&lt;T&gt; synchronizedSortedSet(SortedSet&lt;T&gt; s)</code></li></ul></li> <li>checked view — throw <code>ClassCastException</code> immediately when heap pollution (detects with <code>Class::isInstance</code>), instance of inner class in <code>Collections</code>, intended as debugging support<div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> strings <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">ArrayList</span> rawList <span class="token operator">=</span> strings<span class="token punctuation">;</span> <span class="token comment">// warning only, not an error, for compatibility with legacy code</span>
rawList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// now strings contains a Date object!</span>
</code></pre></div><ul><li><code>static &lt;E&gt; Collection&lt;E&gt; checkedCollection(Collection&lt;E&gt; c, Class&lt;E&gt; type)</code></li> <li><code>static &lt;E&gt; List&lt;E&gt; checkedList(List&lt;E&gt; list, Class&lt;E&gt; type)</code></li> <li><code>static &lt;K,V&gt; Map&lt;K,V&gt; checkedMap(Map&lt;K,V&gt; m, Class&lt;K&gt; keyType, Class&lt;V&gt; valueType)</code></li> <li><code>static &lt;K,V&gt; NavigableMap&lt;K,V&gt; checkedNavigableMap(NavigableMap&lt;K,V&gt; m, Class&lt;K&gt; keyType, Class&lt;V&gt; valueType)</code></li> <li><code>static &lt;E&gt; NavigableSet&lt;E&gt; checkedNavigableSet(NavigableSet&lt;E&gt; s, Class&lt;E&gt; type)</code></li> <li><code>static &lt;E&gt; Queue&lt;E&gt; checkedQueue(Queue&lt;E&gt; queue, Class&lt;E&gt; type)</code></li> <li><code>static &lt;E&gt; Set&lt;E&gt; checkedSet(Set&lt;E&gt; s, Class&lt;E&gt; type)</code></li> <li><code>static &lt;K,V&gt; SortedMap&lt;K,V&gt; checkedSortedMap(SortedMap&lt;K,V&gt; m, Class&lt;K&gt; keyType, Class&lt;V&gt; valueType)</code></li> <li><code>static &lt;E&gt; SortedSet&lt;E&gt; checkedSortedSet(SortedSet&lt;E&gt; s, Class&lt;E&gt; type)</code></li></ul></li> <li><code>equals</code> and <code>hashCode</code> <ul><li>unmodifiable, synchronized and checked views — returns a collection whose equals method does not invoke the <code>equals</code> method of the underlying collection but <code>Object::equals</code>, same for <code>hashCode</code></li> <li>exception — <code>unmodifiableSet</code> and <code>unmodifiableList</code> methods use the <code>equals</code> and <code>hashCode</code> methods of the underlying collections</li></ul></li></ul></li> <li><p>sub-ranges — views that changes reflect to the original</p> <ul><li><code>List::subList</code></li> <li><code>SortedMap::subMap</code>, <code>SortedMap::headMap</code>, <code>SortedMap::tailMap</code> <ul><li><code>NavigableMap</code> — overrides and has new definitions with inclusion option</li> <li>also for <code>SortedSet</code> and <code>NavigableSet</code></li></ul></li></ul></li></ol> <h3 id="legacy-collections"><a href="#legacy-collections" class="header-anchor">#</a> Legacy Collections</h3> <ol><li><p><code>java.util.Hashtable</code> — synchronized <code>HashMap</code>, use <code>ConcurrentHashMap</code> instead</p></li> <li><p><code>java.util.Properties</code> — for property files</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Properties</span> <span class="token keyword">extends</span> <span class="token class-name">Hashtable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><code>String</code> keys and values</li> <li>property file syntax — <a href="https://en.wikipedia.org/wiki/.properties" target="_blank" rel="noopener noreferrer">.properties - Wikipedia<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>can be saved to a stream or loaded from a stream
<ul><li><code>void store(OutputStream out, String comments)</code></li> <li>more</li></ul></li> <li>can use a secondary <code>Properties</code> for default
<ul><li><code>Properties()</code></li> <li><code>Properties(Properties defaults)</code></li> <li><code>String getProperty(String key)</code></li> <li><code>String getProperty(String key, String defaultValue)</code> — <code>defaultValue</code> only when no secondary <code>Properties</code> and <code>key</code> absent</li></ul></li> <li>system properties — see <code>java</code> in <a href="#CLI">CLI</a>, find accessible names in <code>$JAVA_HOME/conf/security/java.policy</code><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># jshell&gt; System.getProperties().forEach((k, v) -&gt; System.out.printf(&quot;%s=%s\n&quot;, k, v))</span>
$ java -XshowSettings:properties --version
Property settings: <span class="token comment"># only a portion is available on all platforms</span>
    awt.toolkit <span class="token operator">=</span> sun.awt.windows.WToolkit
    file.encoding <span class="token operator">=</span> GBK <span class="token comment"># not an official property, use Charset.defaultCharset() instead</span>
    file.separator <span class="token operator">=</span> <span class="token punctuation">\</span>
    java.awt.graphicsenv <span class="token operator">=</span> sun.awt.Win32GraphicsEnvironment
    java.class.path <span class="token operator">=</span>
    java.class.version <span class="token operator">=</span> <span class="token number">56.0</span>
    java.home <span class="token operator">=</span> C:<span class="token punctuation">\</span>Program Files<span class="token punctuation">\</span>Java<span class="token punctuation">\</span>jdk-12.0.2
    java.io.tmpdir <span class="token operator">=</span> C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>ADMINI~1<span class="token punctuation">\</span>AppData<span class="token punctuation">\</span>Local<span class="token punctuation">\</span>Temp<span class="token punctuation">\</span>
    java.library.path <span class="token operator">=</span> <span class="token comment"># JAVA_PATH;C:\Windows\Sun\Java\bin;. for Windows</span>
    java.runtime.name <span class="token operator">=</span> OpenJDK Runtime Environment
    java.runtime.version <span class="token operator">=</span> <span class="token number">12.0</span>.2+10
    java.specification.name <span class="token operator">=</span> Java Platform API Specification
    java.specification.vendor <span class="token operator">=</span> Oracle Corporation
    java.specification.version <span class="token operator">=</span> <span class="token number">12</span>
    java.vendor <span class="token operator">=</span> Oracle Corporation
    java.vendor.url <span class="token operator">=</span> https://java.oracle.com/
    java.vendor.url.bug <span class="token operator">=</span> https://bugreport.java.com/bugreport/
    java.version <span class="token operator">=</span> <span class="token number">12.0</span>.2
    java.version.date <span class="token operator">=</span> <span class="token number">2019</span>-07-16
    java.vm.compressedOopsMode <span class="token operator">=</span> Zero based
    java.vm.info <span class="token operator">=</span> mixed mode, sharing
    java.vm.name <span class="token operator">=</span> OpenJDK <span class="token number">64</span>-Bit Server VM
    java.vm.specification.name <span class="token operator">=</span> Java Virtual Machine Specification
    java.vm.specification.vendor <span class="token operator">=</span> Oracle Corporation
    java.vm.specification.version <span class="token operator">=</span> <span class="token number">12</span>
    java.vm.vendor <span class="token operator">=</span> Oracle Corporation
    java.vm.version <span class="token operator">=</span> <span class="token number">12.0</span>.2+10
    jdk.debug <span class="token operator">=</span> release
    line.separator <span class="token operator">=</span> <span class="token punctuation">\</span>r<span class="token punctuation">\</span>n
    os.arch <span class="token operator">=</span> amd64
    os.name <span class="token operator">=</span> Windows <span class="token number">7</span>
    os.version <span class="token operator">=</span> <span class="token number">6.1</span>
    path.separator <span class="token operator">=</span> <span class="token punctuation">;</span>
    sun.arch.data.model <span class="token operator">=</span> <span class="token number">64</span>
    sun.boot.library.path <span class="token operator">=</span> C:<span class="token punctuation">\</span>Program Files<span class="token punctuation">\</span>Java<span class="token punctuation">\</span>jdk-12.0.2<span class="token punctuation">\</span>bin
    sun.cpu.endian <span class="token operator">=</span> little
    sun.cpu.isalist <span class="token operator">=</span> amd64
    sun.desktop <span class="token operator">=</span> windows
    sun.io.unicode.encoding <span class="token operator">=</span> UnicodeLittle
    sun.java.launcher <span class="token operator">=</span> SUN_STANDARD
    sun.jnu.encoding <span class="token operator">=</span> GBK
    sun.management.compiler <span class="token operator">=</span> HotSpot <span class="token number">64</span>-Bit Tiered Compilers
    sun.os.patch.level <span class="token operator">=</span> Service Pack <span class="token number">1</span>
    sun.stderr.encoding <span class="token operator">=</span> ms936
    sun.stdout.encoding <span class="token operator">=</span> ms936
    user.country <span class="token operator">=</span> CN
    user.dir <span class="token operator">=</span> <span class="token comment"># pwd</span>
    user.home <span class="token operator">=</span> <span class="token comment"># ~</span>
    user.language <span class="token operator">=</span> en
    user.name <span class="token operator">=</span> Administrator
    user.script <span class="token operator">=</span>
    user.variant <span class="token operator">=</span>
</code></pre></div></li></ul></li> <li><p><code>java.util.Enumeration</code> — legacy <code>Iterator</code></p> <ul><li>get <code>Enumeration</code> — use <code>Collections::enumeration</code>, <code>Collections::emptyEnumeration</code> to work with legacy code</li></ul></li> <li><p><code>java.util.Vector</code> — legacy synchronized <code>ArrayList</code></p></li> <li><p><code>java.util.Stack</code> — legacy</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Stack</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">Vector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p><code>java.util.BitSet</code> — bit vector, no perfect alternative, still in use</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BitSet</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span>
</code></pre></div><ul><li>no boundary check — some methods (such as <code>size()</code>) may overflow</li> <li>creation
<ul><li>constructors</li> <li><code>valueOf</code></li> <li><code>clone</code></li> <li><code>BitSet get(int fromIndex, int toIndex)</code></li></ul></li></ul></li></ol> <h2 id="preferences"><a href="#preferences" class="header-anchor">#</a> Preferences</h2> <ol><li><p>preferences — in <code>java.util.prefs</code></p> <ul><li>disadvantages of property files
<ul><li>no uniform location</li> <li>no standard naming convention, increasing the likelihood of name clashes</li></ul></li> <li>location of preferences — registry in Windows, file system for Linux, implementation hidden from user</li> <li>structure — tree structure, recommended to make the configuration node paths match the package names</li> <li>multiple users — <code>Preferences.userRoot()</code>, <code>Preferences.systemRoot()</code></li></ul></li> <li><p><code>java.util.prefs.Preferences</code> — <code>Map</code> like</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Preferences</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
</code></pre></div><ul><li>move around nodes
<ul><li><code>static Preferences userRoot()</code></li> <li><code>static Preferences userNodeForPackage(Class&lt;?&gt; c)</code></li> <li><code>static Preferences systemRoot()</code></li> <li><code>static Preferences systemNodeForPackage(Class&lt;?&gt; c)</code></li> <li><code>abstract Preferences node(String pathName)</code></li></ul></li> <li>get value from key
<ul><li><code>abstract boolean getBoolean(String key, boolean def)</code></li> <li><code>abstract byte[] getByteArray(String key, byte[] def)</code></li> <li><code>abstract double getDouble(String key, double def)</code></li> <li><code>abstract float getFloat(String key, float def)</code></li> <li><code>abstract int getInt(String key, int def)</code></li> <li><code>abstract long getLong(String key, long def)</code></li></ul></li> <li>put key-value pairs</li> <li>export and import</li> <li>more</li></ul></li></ol> <h2 id="stream"><a href="#stream" class="header-anchor">#</a> Stream</h2> <ol><li><p>stream</p> <ul><li>characteristics
<ul><li>no store — elements stored in an underlying collection or generated on demand, should not mutate upon terminal operation</li> <li>does not mutate source — new stream on every call</li> <li>lazy</li> <li>one-time — may throw <code>IllegalStateException</code> if it detects that the stream is being reused</li> <li>sequential or parallel — in parallel mode when the terminal method executes, all intermediate stream operations will be parallelized, using <code>ForkJoinPool</code></li> <li>ordered or not — streams that arise from ordered collections (arrays and lists), from ranges, generators, and iterators, or from calling <code>Stream::sorted</code> are ordered
<ul><li>order and parallelism — ordering does not preclude efficient parallelism, but some operations can be more effectively parallelized without requiring order</li></ul></li></ul></li> <li>stream creation
<ul><li>from collections and <code>Arrays</code> — <code>Collection::stream</code>, <code>Collection::parallelStream</code>, <code>Arrays::stream</code> <ul><li>under the hood — <code>StreamSupport::stream</code>, which uses <code>Spliterator</code></li></ul></li> <li>static methods in <code>Stream</code></li> <li><code>Pattern::splitAsStream</code></li> <li><code>Files::lines</code>, <code>BufferedReader::lines</code></li> <li><code>Stream.Builder</code></li> <li><code>Random::ints</code>, <code>Random::doubles</code>, <code>Random::longs</code> for primitive variants</li> <li><code>CharSequence::codepoints</code>, <code>CharSequence::chars</code></li></ul></li></ul></li> <li><p><code>java.util.stream.BaseStream</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BaseStream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span><span class="token class-name">S</span> <span class="token keyword">extends</span> <span class="token class-name">BaseStream</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">extends</span> <span class="token class-name">AutoCloseable</span>
</code></pre></div><ul><li><code>void close()</code></li> <li><code>boolean isParallel()</code></li> <li><code>Iterator &lt;T&gt; iterator()</code></li> <li><code>Spliterator &lt;T&gt; spliterator()</code></li> <li><code>S onClose(Runnable closeHandler)</code></li> <li><code>S parallel()</code></li> <li><code>S sequential()</code></li> <li><code>S unordered()</code></li></ul></li> <li><p><code>java.util.stream.StreamSupport</code> — for library writers presenting stream views of data structures</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">StreamSupport</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
</code></pre></div></li> <li><p><code>java.util.stream.IntStream</code>, <code>java.util.stream.LongStream</code>, <code>java.util.stream.DoubleStream</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IntStream</span>
<span class="token keyword">extends</span> <span class="token class-name">BaseStream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span><span class="token class-name">IntStream</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>methods like those in <code>Stream</code></li> <li>creation — partial <code>range()</code> in Python
<ul><li><code>static IntStream range(int startInclusive, int endExclusive)</code></li> <li><code>static IntStream rangeClosed(int startInclusive, int endInclusive)</code></li> <li><code>static LongStream range(long startInclusive, long endExclusive)</code></li> <li><code>static LongStream rangeClosed(long startInclusive, long endInclusive)</code></li></ul></li> <li>transformation
<ul><li><code>DoubleStream asDoubleStream()</code><br> <code>LongStream asLongStream()</code></li> <li><code>Stream&lt;Integer&gt; boxed()</code><br> <code>Stream&lt;Double&gt; boxed()</code><br> <code>Stream&lt;Long&gt; boxed()</code></li> <li><code>LongSummaryStatistics summaryStatistics()</code><br> <code>IntSummaryStatistics summaryStatistics()</code><br> <code>DoubleSummaryStatistics summaryStatistics()</code></li></ul></li></ul></li> <li><p><code>java.util.stream.Stream</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">extends</span> <span class="token class-name">BaseStream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span><span class="token class-name">Stream</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>creation
<ul><li><code>static &lt;T&gt; Stream&lt;T&gt; of(T... values)</code><br> <code>static &lt;T&gt; Stream&lt;T&gt; of(T t)</code></li> <li><code>static &lt;T&gt; Stream&lt;T&gt; empty()</code></li> <li><code>static &lt;T&gt; Stream&lt;T&gt; generate(Supplier&lt;T&gt; s)</code> — Returns an infinite sequential unordered stream where each element is generated by the provided Supplier.</li> <li><code>static &lt;T&gt; Stream&lt;T&gt; iterate(T seed, UnaryOperator&lt;T&gt; f)</code> — Returns an infinite sequential ordered Stream produced by iterative application of a function <code>f</code> to an initial element seed, producing a Stream consisting of seed, <code>f(seed)</code>, <code>f(f(seed))</code>, etc.</li> <li><code>static &lt;T&gt; Stream&lt;T&gt; concat(Stream&lt;? extends T&gt; a, Stream&lt;? extends T&gt; b)</code></li> <li><code>static &lt;T&gt; Stream.Builder&lt;T&gt; builder()</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">interface</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token class-name">Builder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">extends</span> <span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><code>void accept(T t)</code><br> <code>default Stream.Builder&lt;T&gt; add(T t)</code></li> <li><code>Stream&lt;T&gt; build()</code></li></ul></li></ul></li> <li>transformation
<ul><li><code>BaseStream</code> methods</li> <li><code>Stream&lt;T&gt; filter(Predicate&lt;? super T&gt; predicate)</code></li> <li><code>&lt;R&gt; Stream&lt;R&gt; map(Function&lt;? super T,? extends R&gt; mapper)</code><br> <code>DoubleStream mapToDouble(ToDoubleFunction&lt;? super T&gt; mapper)</code><br> <code>IntStream mapToInt(ToIntFunction&lt;? super T&gt; mapper)</code><br> <code>LongStream mapToLong(ToLongFunction&lt;? super T&gt; mapper)</code></li> <li><code>&lt;R&gt; Stream&lt;R&gt; flatMap(Function&lt;? super T,? extends Stream&lt;? extends R&gt;&gt; mapper)</code><br> <code>DoubleStream flatMapToDouble(Function&lt;? super T,? extends DoubleStream&gt; mapper)</code><br> <code>IntStream flatMapToInt(Function&lt;? super T,? extends IntStream&gt; mapper)</code><br> <code>LongStream flatMapToLong(Function&lt;? super T,? extends LongStream&gt; mapper)</code></li></ul></li> <li>query — order matters
<ul><li><code>Stream&lt;T&gt; limit(long maxSize)</code></li> <li><code>Stream&lt;T&gt; skip(long n)</code></li> <li><code>Stream&lt;T&gt; distinct()</code> — uses <code>Object::equals</code>, the first occurrence when ordered</li> <li><code>Stream&lt;T&gt; sorted()</code><br> <code>Stream&lt;T&gt; sorted(Comparator&lt;? super T&gt; comparator)</code></li></ul></li> <li>reduction (terminal operation)
<ul><li><code>Optional&lt;T&gt; max(Comparator&lt;? super T&gt; comparator)</code></li> <li><code>Optional&lt;T&gt; min(Comparator&lt;? super T&gt; comparator)</code></li> <li><code>long count()</code></li> <li><code>Optional&lt;T&gt; findAny()</code> — effective when parallel</li> <li><code>Optional&lt;T&gt; findFirst()</code></li> <li><code>boolean allMatch(Predicate&lt;? super T&gt; predicate)</code></li> <li><code>boolean anyMatch(Predicate&lt;? super T&gt; predicate)</code></li> <li><code>boolean noneMatch(Predicate&lt;? super T&gt; predicate)</code></li> <li><code>T reduce(T identity, BinaryOperator&lt;T&gt; accumulator)</code></li> <li><code>&lt;U&gt; U reduce(U identity, BiFunction&lt;U,? super T,U&gt; accumulator, BinaryOperator&lt;U&gt; combiner)</code></li> <li><code>Collectors::reducing</code></li></ul></li> <li>result (terminal operation)
<ul><li><code>Stream&lt;T&gt; peek(Consumer&lt;? super T&gt; action)</code></li> <li><code>void forEach(Consumer&lt;? super T&gt; action)</code></li> <li><code>void forEachOrdered(Consumer&lt;? super T&gt; action)</code> — when in parallel mode and order matters</li> <li><code>Object[] toArray()</code><br> <code>&lt;A&gt; A[] toArray(IntFunction&lt;A[]&gt; generator)</code></li> <li><code>&lt;R,A&gt; R collect(Collector&lt;? super T,A,R&gt; collector)</code><br> <code>&lt;R&gt; R collect(Supplier&lt;R&gt; supplier, BiConsumer&lt;R,? super T&gt; accumulator, BiConsumer&lt;R,R&gt; combiner)</code> — <code>Collector</code> shortcut<div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> asList <span class="token operator">=</span> stringStream<span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">ArrayList</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">,</span> <span class="token class-name">ArrayList</span><span class="token operator">::</span><span class="token function">add</span><span class="token punctuation">,</span>
                                           <span class="token class-name">ArrayList</span><span class="token operator">::</span><span class="token function">addAll</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> concat <span class="token operator">=</span> stringStream<span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">StringBuilder</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">,</span> <span class="token class-name">StringBuilder</span><span class="token operator">::</span><span class="token function">append</span><span class="token punctuation">,</span>
                                     <span class="token class-name">StringBuilder</span><span class="token operator">::</span><span class="token function">append</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li>iterator methods from <code>BaseStream</code></li></ul></li></ul></li> <li><p><code>java.util.stream.Collector</code> — A mutable reduction operation that accumulates input elements into a mutable result container</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Collector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span><span class="token class-name">A</span><span class="token punctuation">,</span><span class="token class-name">R</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>process
<ul><li>creation of a new result container (<code>Supplier&lt;A&gt; supplier()</code>)</li> <li>incorporating a new data element into a result container (<code>BiConsumer&lt;A,T&gt; accumulator()</code>)</li> <li>combining two result containers into one (<code>BinaryOperator&lt;A&gt; combiner()</code>)</li> <li>performing an optional final transform on the container (<code>Function&lt;A,R&gt; finisher()</code>)</li></ul></li> <li><code>Set&lt;Collector.Characteristics&gt; characteristics()</code></li> <li><code>enum Characteristics</code> <ul><li><code>CONCURRENT</code> — Indicates that this collector is concurrent, meaning that the result container can support the accumulator function being called concurrently with the same result container from multiple threads.</li> <li><code>IDENTITY_FINISH</code> — Indicates that the finisher function is the identity function and can be elided.
<ul><li><code>Function.identity()</code></li></ul></li> <li><code>UNORDERED</code> — Indicates that the collection operation does not commit to preserving the encounter order of input elements.</li></ul></li> <li>creation
<ul><li><code>static &lt;T,A,R&gt; Collector&lt;T,A,R&gt; of(Supplier&lt;A&gt; supplier, BiConsumer&lt;A,T&gt; accumulator, BinaryOperator&lt;A&gt; combiner, Function&lt;A,R&gt; finisher, Collector.Characteristics... characteristics)</code></li> <li><code>static &lt;T,R&gt; Collector&lt;T,R,R&gt; of(Supplier&lt;R&gt; supplier, BiConsumer&lt;R,T&gt; accumulator, BinaryOperator&lt;R&gt; combiner, Collector.Characteristics... characteristics)</code></li> <li>methods in <code>Collectors</code></li></ul></li></ul></li> <li><p><code>java.util.stream.Collectors</code></p> <ul><li>statics
<ul><li><code>static &lt;T&gt; Collector&lt;T,?,Double&gt; averagingDouble(ToDoubleFunction&lt;? super T&gt; mapper)</code><br> <code>static &lt;T&gt; Collector&lt;T,?,Double&gt; averagingInt(ToIntFunction&lt;? super T&gt; mapper)</code><br> <code>static &lt;T&gt; Collector&lt;T,?,Double&gt; averagingLong(ToLongFunction&lt;? super T&gt; mapper)</code></li> <li><code>static &lt;T&gt; Collector&lt;T,?,Optional&lt;T&gt;&gt; maxBy(Comparator&lt;? super T&gt; comparator)</code></li> <li><code>static &lt;T&gt; Collector&lt;T,?,Optional&lt;T&gt;&gt; minBy(Comparator&lt;? super T&gt; comparator)</code></li> <li><code>static &lt;T&gt; Collector&lt;T,?,DoubleSummaryStatistics&gt; summarizingDouble(ToDoubleFunction&lt;? super T&gt; mapper)</code><br> <code>static &lt;T&gt; Collector&lt;T,?,IntSummaryStatistics&gt; summarizingInt(ToIntFunction&lt;? super T&gt; mapper)</code><br> <code>static &lt;T&gt; Collector&lt;T,?,LongSummaryStatistics&gt; summarizingLong(ToLongFunction&lt;? super T&gt; mapper)</code></li> <li><code>static &lt;T&gt; Collector&lt;T,?,Long&gt; counting()</code></li> <li><code>static &lt;T&gt; Collector&lt;T,?,Double&gt; summingDouble(ToDoubleFunction&lt;? super T&gt; mapper)</code><br> <code>static &lt;T&gt; Collector&lt;T,?,Integer&gt; summingInt(ToIntFunction&lt;? super T&gt; mapper)</code><br> <code>static &lt;T&gt; Collector&lt;T,?,Long&gt; summingLong(ToLongFunction&lt;? super T&gt; mapper)</code></li></ul></li> <li>collector chaining
<ul><li><code>static &lt;T,A,R,RR&gt; Collector&lt;T,A,RR&gt; collectingAndThen(Collector&lt;T,A,R&gt; downstream, Function&lt;R,RR&gt; finisher)</code> — add finisher</li> <li><code>static &lt;T,U,A,R&gt; Collector&lt;T,?,R&gt; mapping(Function&lt;? super T,? extends U&gt; mapper, Collector&lt;? super U,A,R&gt; downstream)</code> — preprocess with <code>T -&gt; U</code> function for collector accepting <code>U</code></li> <li><code>groupingBy</code></li> <li><code>groupingByConcurrent</code></li> <li><code>partitioningBy</code></li></ul></li> <li>group (defaults to using <code>HashMap</code> and <code>ConcurrentHashMap</code>)
<ul><li><code>static &lt;T,K&gt; Collector&lt;T,?,Map&lt;K,List&lt;T&gt;&gt;&gt; groupingBy(Function&lt;? super T,? extends K&gt; classifier)</code><br> <code>static &lt;T,K,A,D&gt; Collector&lt;T,?,Map&lt;K,D&gt;&gt; groupingBy(Function&lt;? super T,? extends K&gt; classifier, Collector&lt;? super T,A,D&gt; downstream)</code><br> <code>static &lt;T,K,D,A,M extends Map&lt;K,D&gt;&gt; Collector&lt;T,?,M&gt; groupingBy(Function&lt;? super T,? extends K&gt; classifier, Supplier&lt;M&gt; mapFactory, Collector&lt;? super T,A,D&gt; downstream)</code></li> <li><code>static &lt;T,K&gt; Collector&lt;T,?,ConcurrentMap&lt;K,List&lt;T&gt;&gt;&gt; groupingByConcurrent(Function&lt;? super T,? extends K&gt; classifier)</code><br> <code>static &lt;T,K,A,D&gt; Collector&lt;T,?,ConcurrentMap&lt;K,D&gt;&gt; groupingByConcurrent(Function&lt;? super T,? extends K&gt; classifier, Collector&lt;? super T,A,D&gt; downstream)</code><br> <code>static &lt;T,K,A,D,M extends ConcurrentMap&lt;K,D&gt;&gt; Collector&lt;T,?,M&gt; groupingByConcurrent(Function&lt;? super T,? extends K&gt; classifier, Supplier&lt;M&gt; mapFactory, Collector&lt;? super T,A,D&gt; downstream)</code></li> <li><code>static &lt;T&gt; Collector&lt;T,?,Map&lt;Boolean,List&lt;T&gt;&gt;&gt; partitioningBy(Predicate&lt;? super T&gt; predicate)</code><br> <code>static &lt;T,D,A&gt; Collector&lt;T,?,Map&lt;Boolean,D&gt;&gt; partitioningBy(Predicate&lt;? super T&gt; predicate, Collector&lt;? super T,A,D&gt; downstream)</code></li></ul></li> <li>to map (<code>HashMap</code> and <code>ConcurrentHashMap</code>)
<ul><li><code>static &lt;T,K,U&gt; Collector&lt;T,?,ConcurrentMap&lt;K,U&gt;&gt; toConcurrentMap(Function&lt;? super T,? extends K&gt; keyMapper, Function&lt;? super T,? extends U&gt; valueMapper)</code><br> <code>static &lt;T,K,U&gt; Collector&lt;T,?,ConcurrentMap&lt;K,U&gt;&gt; toConcurrentMap(Function&lt;? super T,? extends K&gt; keyMapper, Function&lt;? super T,? extends U&gt; valueMapper, BinaryOperator&lt;U&gt; mergeFunction)</code><br> <code>static &lt;T,K,U,M extends ConcurrentMap&lt;K,U&gt;&gt; Collector&lt;T,?,M&gt; toConcurrentMap(Function&lt;? super T,? extends K&gt; keyMapper, Function&lt;? super T,? extends U&gt; valueMapper, BinaryOperator&lt;U&gt; mergeFunction, Supplier&lt;M&gt; mapSupplier)</code></li> <li><code>static &lt;T,K,U&gt; Collector&lt;T,?,Map&lt;K,U&gt;&gt; toMap(Function&lt;? super T,? extends K&gt; keyMapper, Function&lt;? super T,? extends U&gt; valueMapper)</code><br> <code>static &lt;T,K,U&gt; Collector&lt;T,?,Map&lt;K,U&gt;&gt; toMap(Function&lt;? super T,? extends K&gt; keyMapper, Function&lt;? super T,? extends U&gt; valueMapper, BinaryOperator&lt;U&gt; mergeFunction)</code><br> <code>static &lt;T,K,U,M extends Map&lt;K,U&gt;&gt; Collector&lt;T,?,M&gt; toMap(Function&lt;? super T,? extends K&gt; keyMapper, Function&lt;? super T,? extends U&gt; valueMapper, BinaryOperator&lt;U&gt; mergeFunction, Supplier&lt;M&gt; mapSupplier)</code></li></ul></li> <li>to collection
<ul><li><code>static &lt;T,C extends Collection&lt;T&gt;&gt; Collector&lt;T,?,C&gt; toCollection(Supplier&lt;C&gt; collectionFactory)</code></li> <li><code>static &lt;T&gt; Collector&lt;T,?,List&lt;T&gt;&gt; toList()</code></li> <li><code>static &lt;T&gt; Collector&lt;T,?,Set&lt;T&gt;&gt; toSet()</code></li></ul></li> <li>join
<ul><li><code>static Collector&lt;CharSequence,?,String&gt; joining()</code></li> <li><code>static Collector&lt;CharSequence,?,String&gt; joining(CharSequence delimiter)</code></li> <li><code>static Collector&lt;CharSequence,?,String&gt; joining(CharSequence delimiter, CharSequence prefix, CharSequence suffix)</code></li></ul></li> <li>reduce
<ul><li><code>static &lt;T&gt; Collector&lt;T,?,Optional&lt;T&gt;&gt; reducing(BinaryOperator&lt;T&gt; op)</code></li> <li><code>static &lt;T&gt; Collector&lt;T,?,T&gt; reducing(T identity, BinaryOperator&lt;T&gt; op)</code></li> <li><code>static &lt;T,U&gt; Collector&lt;T,?,U&gt; reducing(U identity, Function&lt;? super T,? extends U&gt; mapper, BinaryOperator&lt;U&gt; op)</code></li></ul></li></ul></li></ol> <h2 id="spi-service-loader"><a href="#spi-service-loader" class="header-anchor">#</a> SPI (Service Loader)</h2> <ol><li><p>SPI</p> <ul><li><a href="https://zhuanlan.zhihu.com/p/28909673" target="_blank" rel="noopener noreferrer">zhihu<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>define the interface / superclass, and provide its implementation, no hard code</li> <li>for <code>ServiceLoader</code>, define in <code>META-INF/services/packageName.InterfaceName</code> as a text file with fully qualified implementation name<div class="language- extra-class"><pre class="language-text"><code>implementation.package.name.ImplName1
implementation.package.name.ImplName2
...
</code></pre></div></li> <li>example for <code>ServiceLoader</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Search</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">searchDoc</span><span class="token punctuation">(</span><span class="token class-name">String</span> keyword<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// implementations and configurations omitted</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestCase</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ServiceLoader</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Search</span><span class="token punctuation">&gt;</span></span> s <span class="token operator">=</span> <span class="token class-name">ServiceLoader</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token class-name">Search</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Search</span> search <span class="token operator">:</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            search<span class="token punctuation">.</span><span class="token function">searchDoc</span><span class="token punctuation">(</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><code>java.text.spi</code></li></ul></li> <li><p><code>java.util.ServiceLoader</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">ServiceLoader</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><code>Iterator&lt;S&gt; iterator()</code> — Lazily loads the available providers of this loader's service.</li> <li><code>static &lt;S&gt; ServiceLoader&lt;S&gt; load(Class&lt;S&gt; service)</code> — Creates a new service loader for the given service type, using the current thread's context class loader.</li></ul></li></ol> <h2 id="other-utils"><a href="#other-utils" class="header-anchor">#</a> Other Utils</h2> <ol><li><p>date and time related — see <a href="#Time">Time</a></p></li> <li><p><code>java.util.PropertyPermission</code> — system property permissions</p></li> <li><p><code>java.util.UUID</code> — an immutable universally unique identifier (UUID). A UUID represents a 128-bit value.</p></li> <li><p><code>java.util.Objects</code> — null-safe</p> <ul><li><code>static &lt;T&gt; int compare(T a, T b, Comparator&lt;? super T&gt; c)</code> — <code>return (a == b) ? 0 : c.compare(a, b);</code></li> <li><code>static boolean deepEquals(Object a, Object b)</code> — Returns <code>true</code> if the arguments are deeply equal to each other and <code>false</code> otherwise.</li> <li><code>static boolean equals(Object a, Object b)</code> — <code>return (a == b) || (a != null &amp;&amp; a.equals(b));</code></li> <li><code>static int hash(Object... values)</code> — <code>return Arrays.hashCode(values);</code></li> <li><code>static int hashCode(Object o)</code> — <code>return o != null ? o.hashCode() : 0;</code></li> <li><code>static boolean isNull(Object obj)</code> — <code>return obj == null;</code></li> <li><code>static boolean nonNull(Object obj)</code> — <code>return obj != null;</code></li> <li><code>static &lt;T&gt; T requireNonNull(T obj)</code><br> <code>static &lt;T&gt; T requireNonNull(T obj, String message)</code><br> <code>static &lt;T&gt; T requireNonNull(T obj, Supplier&lt;String&gt; messageSupplier)</code> — Checks that the specified object reference is not null and throws a customized <code>NullPointerException</code> if it is.</li> <li><code>static String toString(Object o)</code> — <code>return String.valueOf(o);</code> → <code>return (obj == null) ? &quot;null&quot; : obj.toString();</code></li> <li><code>static String toString(Object o, String nullDefault)</code> — <code>return (o != null) ? o.toString() : nullDefault;</code></li> <li>index check methods — since JDK 9</li></ul></li> <li><p><code>java.util.Optional</code> — A container object which may or may not contain a non-null value, a better <code>null</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
</code></pre></div><ul><li>fallback to `null
<ul><li><code>boolean isPresent()</code></li> <li><code>T get()</code></li></ul></li> <li>transformation
<ul><li><code>void ifPresent(Consumer&lt;? super T&gt; consumer)</code></li> <li><code>&lt;U&gt; Optional&lt;U&gt; map(Function&lt;? super T,? extends U&gt; mapper)</code></li> <li><code>&lt;U&gt; Optional&lt;U&gt; flatMap(Function&lt;? super T,Optional&lt;U&gt;&gt; mapper)</code></li> <li><code>Optional&lt;T&gt; filter(Predicate&lt;? super T&gt; predicate)</code></li> <li><code>T orElse(T other)</code></li> <li><code>T orElseGet(Supplier&lt;? extends T&gt; other)</code></li> <li><code>&lt;X extends Throwable&gt; T orElseThrow(Supplier&lt;? extends X&gt; exceptionSupplier)</code></li></ul></li> <li>creation
<ul><li><code>static &lt;T&gt; Optional&lt;T&gt; empty()</code></li> <li><code>static &lt;T&gt; Optional&lt;T&gt; of(T value)</code></li> <li><code>static &lt;T&gt; Optional&lt;T&gt; ofNullable(T value)</code></li></ul></li> <li>variants
<ul><li><code>java.util.OptionalInt</code></li> <li><code>java.util.OptionalDouble</code></li> <li><code>java.util.OptionalLong</code></li></ul></li></ul></li> <li><p><code>java.util.LongSummaryStatistics</code>, <code>java.util.IntSummaryStatistics</code>, <code>java.util.DoubleSummaryStatistics</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LongSummaryStatistics</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">LongConsumer</span><span class="token punctuation">,</span> <span class="token class-name">IntConsumer</span>
</code></pre></div><ul><li>creation
<ul><li><code>Collectors::summarizingLong</code>, <code>Collectors::summarizingDouble</code>, <code>Collectors::summarizingInt</code></li> <li><code>IntSummaryStatistics(long count, int min, int max, long sum)</code></li> <li>with out collector — <code>IntSummaryStatistics()</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">LongSummaryStatistics</span> stats <span class="token operator">=</span> longStream<span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">LongSummaryStatistics</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">,</span>
                                                 <span class="token class-name">LongSummaryStatistics</span><span class="token operator">::</span><span class="token function">accept</span><span class="token punctuation">,</span>
                                                 <span class="token class-name">LongSummaryStatistics</span><span class="token operator">::</span><span class="token function">combine</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li> <li>statics
<ul><li><code>double getAverage()</code></li> <li><code>long getCount()</code></li> <li><code>long|int|double getMax()</code></li> <li><code>long|int|double getMin()</code></li> <li><code>long|double getSum()</code></li> <li><code>String toString()</code></li></ul></li></ul></li></ol> <h2 id="zip-checksum-and-encryption"><a href="#zip-checksum-and-encryption" class="header-anchor">#</a> ZIP, Checksum and Encryption</h2> <ol><li><p><code>java.util.Base64</code></p> <ul><li><code>java.util.Base64.Decoder</code></li> <li><code>java.util.Base64.Encoder</code></li></ul></li> <li><p><code>java.util.zip.CRC32</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> CRC32 <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Checksum</span>
</code></pre></div><ul><li><code>interface java.util.zip.Checksum</code></li></ul></li> <li><p>ZIP streams — see <a href="#ZIP-Streams">ZIP Streams</a></p></li> <li><p><code>java.security.MessageDigest</code> — MD5, SHA-1, SHA-256, SHA-384, and SHA-512</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token function">bytesToHex</span><span class="token punctuation">(</span><span class="token class-name">MessageDigest</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">&quot;SHA-256&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">readAllBytes</span><span class="token punctuation">(</span><span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;temp.py&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> HEX_ARRAY <span class="token operator">=</span> <span class="token string">&quot;0123456789ABCDEF&quot;</span><span class="token punctuation">.</span><span class="token function">toCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">bytesToHex</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> hexChars <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span>bytes<span class="token punctuation">.</span>length <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> bytes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> v <span class="token operator">=</span> bytes<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">;</span>
        hexChars<span class="token punctuation">[</span>j <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> HEX_ARRAY<span class="token punctuation">[</span>v <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        hexChars<span class="token punctuation">[</span><span class="token punctuation">(</span>j <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> HEX_ARRAY<span class="token punctuation">[</span>v <span class="token operator">&amp;</span> <span class="token number">0x0F</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>hexChars<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>CLI — <code>keytool</code></li></ul></li> <li><p><code>javax.crypto.Cipher</code> — AES, DES, RSA</p> <ul><li><code>java.security.KeyPairGenerator</code></li></ul></li></ol> <h1 id="error-handling"><a href="#error-handling" class="header-anchor">#</a> Error Handling</h1> <h2 id="debugging"><a href="#debugging" class="header-anchor">#</a> Debugging</h2> <ol><li><p>general</p> <ul><li>use debugger</li> <li>test with main method, or unit test tools</li></ul></li> <li><p>print or log</p> <ul><li>debug by print concatenated or formatted string</li> <li>logging proxy — anonymous inner class overriding methods of interest with logger</li> <li>stack trace — <code>Throwable::printStackTrace</code> and rethrow, or <code>Thread.dumpStack()</code> <ul><li>capture string instead of printing to <code>System.err</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">StringWriter</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">Throwable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PrintWriter</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> description <span class="token operator">=</span> out<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li>change handler for uncaught exceptions<div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">setDefaultUncaughtExceptionHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token class-name">UncaughtExceptionHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">uncaughtException</span><span class="token punctuation">(</span><span class="token class-name">Thread</span> t<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* logging... */</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li></ul></li> <li><p>CLI options related to debugging</p> <ul><li><code>ctrl</code> + <code>\</code> — get thread dump when the program hangs??</li> <li><code>java</code> <ul><li>use <code>-verbose</code> when launching JVM for diagnosing class path problems</li> <li>use <code>Xprof</code> for profiling, note that support was removed in 10.0</li> <li><code>-XX:+HeapDumpOnOutOfMemoryError</code></li></ul></li> <li>use <code>-Xlint:all</code> when <code>javac</code></li> <li>use <code>jconsole</code> to track memory consumption, thread usage, class loading</li> <li><code>jmap</code> and <code>jhat</code> (<code>jhat</code> removed in JDK 9) — <code>jmap</code> to get a heap dump and <code>jhat</code> to examine<div class="language-java extra-class"><pre class="language-java"><code>jmap <span class="token operator">-</span>dump<span class="token operator">:</span>format<span class="token operator">=</span>b<span class="token punctuation">,</span>file<span class="token operator">=</span>dumpFileName processID
jhat dumpFileName
</code></pre></div><ul><li>at <code>localhost:7000</code></li></ul></li> <li><code>jstat</code></li> <li><code>jcmd</code></li> <li><code>hprof</code></li> <li><code>jps</code></li> <li><code>jstack</code></li> <li><code>syslog</code></li></ul></li></ol> <h2 id="exceptions"><a href="#exceptions" class="header-anchor">#</a> Exceptions</h2> <ol><li><p>unchecked exceptions and checked exceptions</p> <ul><li>unchecked — any exception that derives from the class <code>Error</code> or the class <code>RuntimeException</code> an unchecked exception</li> <li>checked — All other exceptions are called checked exceptions, including <code>Exception</code></li> <li>why called checked — The compiler checks that you provide exception handlers for all checked exceptions</li></ul></li> <li><p><code>Throwable</code> — the superclass of all errors and exceptions, other objects cannot be thrown</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Throwable</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span>
</code></pre></div><ul><li>constructors
<ul><li><code>Throwable()</code></li> <li><code>Throwable(String message)</code></li> <li><code>Throwable(String message, Throwable cause)</code></li> <li><code>protected Throwable(String message, Throwable cause, boolean enableSuppression, boolean writableStackTrace)</code></li> <li><code>Throwable(Throwable cause)</code></li></ul></li> <li>stack trace
<ul><li><code>void printStackTrace()</code><br> <code>void printStackTrace(PrintStream s)</code><br> <code>void printStackTrace(PrintWriter s)</code></li> <li><code>void setStackTrace(StackTraceElement[] stackTrace)</code></li> <li><code>StackTraceElement[] getStackTrace()</code></li> <li><code>Throwable fillInStackTrace()</code></li></ul></li> <li>error message
<ul><li><code>String getMessage()</code></li> <li><code>String getLocalizedMessage()</code> — for overriding, defaults to <code>getMessage()</code></li> <li><code>String toString()</code> — class name, and message if applicable</li></ul></li> <li>wrapping
<ul><li><code>Throwable initCause(Throwable cause)</code></li> <li><code>Throwable getCause()</code></li></ul></li> <li>suppress
<ul><li><code>void addSuppressed(Throwable exception)</code></li> <li><code>Throwable[] getSuppressed()</code></li></ul></li> <li>subclasses
<ul><li><code>Error</code></li> <li><code>Exception</code></li></ul></li></ul></li> <li><p><code>Error</code> — internal errors and resource exhaustion situations, not expected to throw by user</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Error</span> <span class="token keyword">extends</span> <span class="token class-name">Throwable</span>
</code></pre></div></li> <li><p><code>Exception</code> and its hierarchy</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Exception</span> <span class="token keyword">extends</span> <span class="token class-name">Throwable</span>
</code></pre></div><ul><li><code>CloneNotSupportedException</code></li> <li><code>InterruptedException</code></li> <li><code>ReflectiveOperationException</code> <ul><li><code>ClassNotFoundException</code></li> <li><code>IllegalAccessException</code></li> <li><code>InstantiationException</code></li> <li><code>NoSuchFieldException</code></li> <li><code>NoSuchMethodException</code></li></ul></li> <li><code>RuntimeException</code> <ul><li><code>ArithmeticException</code></li> <li><code>ArrayStoreException</code></li> <li><code>ClassCastException</code></li> <li><code>EnumConstantNotPresentException</code></li> <li><code>IllegalArgumentException</code> <ul><li><code>IllegalThreadStateException</code></li> <li><code>NumberFormatException</code></li></ul></li> <li><code>IllegalMonitorStateException</code></li> <li><code>IllegalStateException</code></li> <li><code>IndexOutOfBoundsException</code> <ul><li><code>ArrayIndexOutOfBoundsException</code></li> <li><code>StringIndexOutOfBoundsException</code></li></ul></li> <li><code>NegativeArraySizeException</code></li> <li><code>NullPointerException</code></li> <li><code>SecurityException</code></li> <li><code>TypeNotPresentException</code></li> <li><code>UnsupportedOperationException</code></li></ul></li></ul></li> <li><p><code>StackTraceElement</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">StackTraceElement</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Serializable</span>
</code></pre></div><ul><li>creation
<ul><li><code>StackTraceElement(String declaringClass, String methodName, String fileName, int lineNumber)</code></li> <li><code>Throwable::getStackTrace</code></li> <li><code>Thread::getStackTrace</code></li> <li><code>Thread.getAllStackTraces()</code></li></ul></li> <li>stack info
<ul><li><code>String getClassName()</code></li> <li><code>String getFileName()</code></li> <li><code>int getLineNumber()</code></li> <li><code>String getMethodName()</code></li></ul></li></ul></li></ol> <h2 id="exception-handling"><a href="#exception-handling" class="header-anchor">#</a> Exception Handling</h2> <ol><li><p>exception specification — declare checked exceptions</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// modifiers return_type method_name(parameters) throws Exception1, Exception2</span>
<span class="token comment">// java.io.FileInputStream</span>
<span class="token keyword">public</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">FileNotFoundException</span>
</code></pre></div><ul><li>when to declare
<ul><li>nested method call — when calling a method that threatens to throw a checked exception</li> <li><code>throw</code> checked exceptions spontaneously — check exceptions can be thrown only when declared by the method</li></ul></li> <li>if not declared — compiling error if a method fails to faithfully declare all checked exceptions or handle them</li> <li>if caught — no need for <code>throws</code></li> <li>when overriding a method
<ul><li>more specific exceptions or not at all — exception specification cannot be more general; OK to throw more specific exceptions, or not to throw any exceptions in the subclass method</li> <li>none if none in superclass — if the superclass method throws no checked exception at all, neither can the subclass</li></ul></li></ul></li> <li><p><code>try catch</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// statements that might throw exceptions</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">FileNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// optionally final in parameter</span>
    <span class="token comment">// emergency action for missing files</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UnknownHostException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// emergency action for unknown hosts</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// emergency action for all other I/O problems</span>
<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    <span class="token comment">// close resources</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>multiple exception types — only needed when catching exception types that are not subclasses of one another<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">FileNotFoundException</span> <span class="token operator">|</span> <span class="token class-name">UnknownHostException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// emergency action for missing files and unknown hosts</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>implicit <code>final</code> — the exception variable is implicitly <code>final</code> when multiple exception types</li></ul></li> <li>rethrow — <code>throw</code> in <code>catch</code> block
<ul><li>exception wrapping — use <code>Throwable::initCause</code> to throw as another wrapped type and <code>Throwable::getCause</code> for original failure</li> <li>bypass exception specification limit — rethrow a wrapped <code>RuntimeException</code> if a method cannot throw checked exception
<ul><li>for <code>IOException</code> — for example, <code>java.io.UncheckedIOException</code> is designed to wrap <code>IOException</code></li></ul></li> <li>use generics to make checked exceptions unchecked, see <a href="#Generics">Generics</a></li></ul></li> <li>smart narrowing — when rethrow any exception<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateRecord</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// access the database</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>level<span class="token punctuation">,</span> message<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span> e<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>example above — compiler now tracks the fact that <code>e</code> originates from the <code>try</code> block, it is valid to declare the enclosing method as throws <code>SQLException</code></li> <li>smart narrowing conditions
<ul><li>only checked exceptions — provided that the only checked exceptions in that block are <code>SQLException</code> instances</li> <li><code>final</code> <code>e</code> — and provided that <code>e</code> is not changed in the catch block</li></ul></li></ul></li></ul></li> <li><p><code>finally</code> — always executed, can be used without <code>catch</code></p> <ul><li>order — executes before the method return, if <code>return</code> used before <code>finally</code></li> <li>mask <code>return</code> and exceptions
<ul><li><code>return</code> in <code>finally</code> will mask previous <code>return</code></li> <li>exceptions in <code>finally</code> will mask exceptions previously thrown</li></ul></li> <li>handle exceptions in <code>finally</code> <ul><li>wrap a <code>try catch</code> block to handle possible exception thrown by <code>finally</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">InputStream</span> in <span class="token operator">=</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// code that might throw exceptions</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token comment">// in.close();</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// show error message</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li>rethrow the original, suppress exception thrown by <code>finally</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">InputStream</span> in <span class="token operator">=</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">;</span>
<span class="token class-name">Exception</span> ex <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// code that might throw exceptions</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ex <span class="token operator">=</span> e<span class="token punctuation">;</span>
        <span class="token keyword">throw</span> e<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
     <span class="token keyword">try</span> <span class="token punctuation">{</span>
         in<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>ex <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> e<span class="token punctuation">;</span>
         <span class="token keyword">else</span> ex<span class="token punctuation">.</span><span class="token function">addSuppressed</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul></li></ul></li> <li><p><code>try (resources)</code> — auto close when exiting the block</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Resource</span> res <span class="token operator">=</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// work with res</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>the resource needs to implement <code>AutoCloseable</code> which has a single method<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AutoCloseable</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li>multiple resources — use semicolon as delimiter</li> <li>when both <code>try</code> block and <code>AutoCloseable::close</code> throw exception — any exceptions thrown by <code>close</code> methods are suppressed</li> <li>can have <code>catch</code> and <code>finally</code> blocks, but not recommended</li></ul></li></ol> <h2 id="assertion"><a href="#assertion" class="header-anchor">#</a> Assertion</h2> <ol><li><p>assert</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">assert</span> condition<span class="token punctuation">;</span>
<span class="token keyword">assert</span> condition <span class="token operator">:</span> expression<span class="token punctuation">;</span>
</code></pre></div><ul><li><code>condition</code> — throw an <code>AssertionError</code> if the assertion fails</li> <li><code>expression</code> — passed to <code>AssertionError::new</code> to produce a message string, using <code>String::valueOf</code> when converting</li> <li>enabling and disabling
<ul><li>disabled — disabled by default, <code>-da</code> or <code>-disableassertions</code> to explicitly disable certain classes</li> <li>enable — by <code>-ea</code> or <code>-enableassertions</code><div class="language-shell extra-class"><pre class="language-shell"><code>java -enableassertions MyApp
java -ea:MyClass -ea:com.mycompany.mylib<span class="token punctuation">..</span>. MyApp <span class="token comment"># for specific classes</span>
</code></pre></div><ul><li>enabling mechanism — when enabled, no recompiling, but the class loader stops stripping out the assertion code</li></ul></li> <li>also for JVM loaded classes — some classes are not loaded by a class loader but directly by the virtual machine, but above switches still work</li> <li>enable for system classes — <code>-enablesystemassertions</code> / <code>-esa</code> for system classes</li></ul></li></ul></li> <li><p>assert use</p> <ul><li>fatal errors — assertion failures are intended to be fatal, unrecoverable errors</li> <li>for development and testing — assertion checks are turned on only during development and testing</li> <li>use for precondition — parameter checking</li> <li>use for documenting assumptions<div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// use comments to document underlying assumptions</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span>
<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span>
<span class="token keyword">else</span> <span class="token comment">// (i % 3 == 2)</span>
<span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// use assertion instead</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span>
<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span>
<span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">assert</span> i <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// even better assertion</span>
<span class="token keyword">assert</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span>
<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span>
<span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre></div></li></ul></li> <li><p><code>AssertionError</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AssertionError</span> <span class="token keyword">extends</span> <span class="token class-name">Error</span>
</code></pre></div></li></ol> <h2 id="logging"><a href="#logging" class="header-anchor">#</a> Logging</h2> <ol><li>log4j2 with slf4j<div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
   <span class="token comment">&lt;!-- 使用log4j2要排除logBack依赖 --&gt;</span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-logging<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- Spring已经写好了一个log4j2-starter但缺少桥接包 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-log4j2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 引入缺少的桥接包 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jcl-over-slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><code>org.apache.logging.log4j.ThreadContext</code> -- stores properties in the current thread</li></ul></li></ol> <h3 id="logger"><a href="#logger" class="header-anchor">#</a> Logger</h3> <ol><li><p>use logger</p> <ul><li>prevent gc — A logger that is not referenced by any variable can be garbage collected<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> myLogger <span class="token operator">=</span> <span class="token class-name">Logger</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token string">&quot;com.mycompany.myapp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li>hierarchy — child loggers inherit certain properties from parent loggers</li> <li>levels — <code>Level</code> <ul><li><code>Level.INFO</code> by default</li></ul></li> <li>stack info — default log record shows the name of the class and method that contain the logging call, as inferred from the call stack
<ul><li>call info and optimization — the virtual machine optimizes execution, accurate call information may not be available</li> <li><code>Logger::logp</code> to set calling point explicitly</li></ul></li> <li>log configuration — processed by <code>LogManager</code> <ul><li>manager object property — <code>java.util.logging.manager</code>, if <code>null</code> the no-arg protected constructor is used</li> <li>configuration class property — <code>java.util.logging.config.class</code>, take precedence over config files</li> <li>configuration file — <code>java.util.logging.config.file</code> <ul><li>default config file — <code>$JAVA_HOME/lib/logging.properties</code>, or <code>$JAVA_HOME/conf/logging.properties</code> for JDK &gt;= 9</li> <li><code>.level=INFO</code> — default global logging level</li> <li><code>java.util.logging.ConsoleHandler.level=INFO</code> — log level for <code>ConsoleHandler</code></li> <li>hierarchy — <code>foo.level</code> defines a log level for the logger called &quot;foo&quot; and (recursively) for any of its children in the naming hierarchy</li> <li>children after parents — level settings for child nodes in the tree should come after settings for their parents</li></ul></li></ul></li> <li>localization — use resource bundle<div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">Logger</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span>loggerName<span class="token punctuation">,</span> <span class="token string">&quot;com.mycompany.logmessages&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Level</span><span class="token punctuation">.</span>INFO<span class="token punctuation">,</span> <span class="token string">&quot;readingFile&quot;</span><span class="token punctuation">,</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// fill placeholder</span>
</code></pre></div><ul><li>resource bundles
<ul><li>such as <code>com/mycompany/logmessages_de.properties</code></li> <li>property with placeholder — <code>readingFile=Achtung! Datei {0} wird eingelesen</code></li></ul></li> <li>log with explicit resource bundle — <code>Logger::logrb</code></li> <li>get and set resource bundle — <code>Logger::getResourceBundle</code>, <code>Logger::setResourceBundle</code></li></ul></li></ul></li> <li><p><code>java.util.logging.Logger</code></p> <ul><li>creation — uses <code>LogManager</code> behind the scenes
<ul><li><code>static Logger getGlobal()</code></li> <li><code>static Logger getAnonymousLogger()</code></li> <li><code>static Logger getAnonymousLogger(String resourceBundleName)</code></li> <li><code>static Logger getLogger(String name)</code></li> <li><code>static Logger getLogger(String name, String resourceBundleName)</code></li></ul></li> <li>settings
<ul><li><code>void setLevel(Level newLevel)</code></li> <li><code>void setFilter(Filter newFilter)</code></li></ul></li> <li>handler
<ul><li><code>void setUseParentHandlers(boolean useParentHandlers)</code></li> <li><code>void addHandler(Handler handler)</code></li></ul></li> <li>hierarchy
<ul><li><code>void setParent(Logger parent)</code></li> <li><code>Logger getParent()</code></li></ul></li> <li>log — uses <code>Handler::publish</code> behind the scenes
<ul><li><code>void info(String msg)</code><br> <code>void info(Supplier&lt;String&gt; msgSupplier)</code> <ul><li>all levels have methods, except <code>Level.ALL</code> and <code>Level.OFF</code></li></ul></li> <li><code>void log(Level level, String msg)</code><br> <code>void log(Level level, Supplier&lt;String&gt; msgSupplier)</code></li> <li><code>void logp(Level level, String sourceClass, String sourceMethod, String msg)</code> — give the precise location of the calling class and method</li></ul></li> <li>log errors
<ul><li><code>void throwing(String sourceClass, String sourceMethod, Throwable thrown)</code> <ul><li><code>FINER</code> level</li> <li>message starts with <code>THROW</code></li></ul></li> <li><code>void log(Level level, String msg, Throwable thrown)</code></li> <li><code>void logp(Level level, String sourceClass, String sourceMethod, String msg, Throwable thrown)</code></li></ul></li> <li>pass values into placeholders (in property files)
<ul><li><code>void log(Level level, String msg, Object param1)</code></li> <li><code>void log(Level level, String msg, Object[] params)</code></li></ul></li> <li>log execution flow — place at the start and the end of methods, level is <code>FINER</code> <ul><li><code>void entering(String sourceClass, String sourceMethod)</code><br> <code>void entering(String sourceClass, String sourceMethod, Object param1)</code><br> <code>void entering(String sourceClass, String sourceMethod, Object[] params)</code> <ul><li>log records start with <code>ENTRY</code></li></ul></li> <li><code>void exiting(String sourceClass, String sourceMethod)</code><br> <code>void exiting(String sourceClass, String sourceMethod, Object result)</code> <ul><li>log records start with <code>RETURN</code></li></ul></li></ul></li></ul></li> <li><p><code>java.util.logging.LogManager</code> — singleton to maintain a set of shared state about loggers and log services</p></li></ol> <h3 id="log-levels-and-records"><a href="#log-levels-and-records" class="header-anchor">#</a> Log Levels and Records</h3> <ol><li><p><code>java.util.logging.Level</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Level</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Serializable</span>
</code></pre></div><ul><li>levels
<ul><li><code>static Level OFF</code> — <code>Integer.MAX_VALUE</code></li> <li><code>static Level SEVERE</code> — 1000, <code>error</code> for <code>slf4j</code></li> <li><code>static Level WARNING</code> — 900, <code>warn</code> for <code>slf4j</code></li> <li><code>static Level INFO</code> — 800</li> <li><code>static Level CONFIG</code> — 700</li> <li><code>static Level FINE</code> — 500, <code>debug</code>, <code>trace</code> for <code>slf4j</code></li> <li><code>static Level FINER</code> — 400</li> <li><code>static Level FINEST</code> — 300</li> <li><code>static Level ALL</code> — <code>Integer.MIN_VALUE</code></li></ul></li></ul></li> <li><p><code>java.util.logging.LogRecord</code> — used to pass logging requests between the logging framework and individual log Handlers</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogRecord</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Serializable</span>
</code></pre></div><ul><li><code>Level getLevel()</code></li> <li><code>String getMessage()</code></li> <li><code>Object[] getParameters()</code></li> <li><code>Throwable getThrown()</code></li> <li>more</li></ul></li></ol> <h3 id="handlers"><a href="#handlers" class="header-anchor">#</a> Handlers</h3> <ol><li><p>handler — all handlers extends <code>Handler</code>, used by <code>Logger::log</code></p> <ul><li>also has level — <code>INFO</code> by default, configurable via configuration file
<ul><li><code>java.util.logging.ConsoleHandler.level=INFO</code></li></ul></li> <li>hierarchy — a logger sends records both to its own handlers and the handlers of the parent
<ul><li>the primordial logger (with name <code>&quot;&quot;</code> ) handler — <code>ConsoleHandler</code></li> <li><code>Logger::setUseParentHandlers</code></li></ul></li> <li>custom handlers can be used — <code>Logger::addHandler</code></li> <li><code>java.util.logging.StreamHandler</code> <ul><li><code>ConsoleHandler</code> — print records to <code>System.err</code></li> <li><code>FileHandler</code> — send records to a file <code>java&lt;number&gt;.log</code> in homedir, or some default dir in Windows, <code>XMLFormatter</code> by default
<ul><li>supports <code>append</code> flag</li> <li>supports file rotation</li> <li>use platform encoding by default — set via property <code>java.util.logging.FileHandler.encoding=UTF-8</code></li></ul></li> <li><code>SocketHandler</code> — sends records to a specified host and port, <code>XMLFormatter</code> by default</li></ul></li> <li><code>java.util.logging.MemoryHandler</code> — Handler that buffers requests in a circular buffer in memory.</li></ul></li> <li><p><code>java.util.logging.Handler</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Handler</span>
</code></pre></div><ul><li><code>abstract void close()</code></li> <li><code>abstract void flush()</code></li> <li><code>abstract void publish(LogRecord record)</code></li> <li>settings
<ul><li><code>void setFilter(Filter newFilter)</code></li> <li><code>void setFormatter(Formatter newFormatter)</code></li> <li><code>void setLevel(Level newLevel)</code></li></ul></li> <li>more</li></ul></li></ol> <h4 id="filters"><a href="#filters" class="header-anchor">#</a> Filters</h4> <ol><li><p>filters — implements <code>Filter</code>, used by handlers</p> <ul><li>in addition to level filtering, logger and handler can have an optional filter</li> <li><code>Logger::setFilter</code>, <code>Handler::setFilter</code> <ul><li>both at most one filter at a time</li></ul></li></ul></li> <li><p><code>java.util.logging.Filter</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@FunctionalInterface</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Filter</span>
</code></pre></div><ul><li><code>boolean isLoggable(LogRecord record)</code></li></ul></li></ol> <h4 id="formatters"><a href="#formatters" class="header-anchor">#</a> Formatters</h4> <ol><li><p>formatters — extends <code>Formatter</code>, used by handlers</p> <ul><li><code>Handler::setFormatter</code></li></ul></li> <li><p><code>java.util.logging.Formatter</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Formatter</span>
</code></pre></div><ul><li><code>abstract String format(LogRecord record)</code></li> <li>more</li></ul></li></ol> <h1 id="generics"><a href="#generics" class="header-anchor">#</a> Generics</h1> <ol><li><p>Generics</p> <ul><li><a href="http://angelikalanger.com/GenericsFAQ/JavaGenericsFAQ.html" target="_blank" rel="noopener noreferrer">further reading<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>diamond syntax</li> <li>raw and typed
<ul><li>typed are subtypes — typed ones are subtypes of the raw one</li> <li>warning when using raw types</li> <li>raw at runtime — types only checked when compiling, all are raw without type at runtime</li></ul></li> <li>differently parallelized, different type — no relationship between <code>Generic&lt;Type_2&gt;</code> and <code>Generic&lt;Type_2&gt;</code>, regardless of the relationship between the type variables</li> <li>at runtime in JVM
<ul><li>erased to bound — type variables are erased and replaced by first bound, or <code>Object</code></li> <li>cast when needed — compiler inserts casts to other bounds when necessary
<ul><li>place the predominant interface at the first one for performance</li></ul></li> <li>bridge methods are synthesized when necessary (when overriding)
<ul><li>override method can have a different signature — due to type erasure of generics or different return type</li> <li>bridge method — the same signature of super type method, calls actual method</li></ul></li></ul></li></ul></li> <li><p>generic syntax</p> <ul><li>name conventions
<ul><li><code>E</code> — for the element type of a collection</li> <li><code>K</code> and <code>V</code> — for key and value types of a table</li> <li><code>T</code> (and the neighboring <code>U</code> and <code>S</code>) — for “any type at all”</li></ul></li> <li>generic class syntax<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Pair</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre></div></li> <li>generic methods inside ordinary classes<div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@SafeVarargs</span> <span class="token comment">// to suppress Warning: Possible heap pollution from parameterized vararg type</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">getMiddle</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> a<span class="token punctuation">[</span>a<span class="token punctuation">.</span>length <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>call — type parameter before method name, <code>className.&lt;type&gt;method(params)</code> <ul><li>avoid parsing ambiguities in C++ — <code>g(f&lt;a,b&gt;(c))</code></li></ul></li> <li>type inference — type can be inferred from parameters, but can be problematic when multiple super types</li></ul></li> <li>generic bounds — <code>extends</code>, including<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Comparable</span> <span class="token operator">&amp;</span> <span class="token class-name">Serializable</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">min</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a<span class="token punctuation">)</span>
</code></pre></div><ul><li>class bound — must be the first one in the bounds list</li> <li>interface bound and class bound — arbitrary number of interfaces, but at most one class</li></ul></li> <li>wildcards — <code>?</code> <ul><li><code>?</code> — for a variable of type <code>?</code>, can only assign when left value is <code>Object</code>, or right value is <code>null</code></li> <li><code>? extends SomeType</code> — including; a variable of this type can only be right value<div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Pair</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Manager</span><span class="token punctuation">&gt;</span></span> managerBuddies <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Pair</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>ceo<span class="token punctuation">,</span> cfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Pair</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> wildcardBuddies <span class="token operator">=</span> managerBuddies<span class="token punctuation">;</span> <span class="token comment">// OK</span>
<span class="token class-name">Employee</span> e <span class="token operator">=</span> wildcardBuddies<span class="token punctuation">.</span><span class="token function">getFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// function signature is `? extends Employee getFirst()`, OK</span>
wildcardBuddies<span class="token punctuation">.</span><span class="token function">setFirst</span><span class="token punctuation">(</span>lowlyEmployee<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// function signature is `void setFirst(? extends Employee)`, compile-time error</span>
</code></pre></div></li> <li><code>? super SomeType</code> — including; the contrary of <code>? extends SomeType</code> (left value can only be <code>Object</code>)
<ul><li>example — <code>&lt;T extends Comparable&lt;? super T&gt;&gt;</code>, a rescue when <code>T</code> does not implement <code>Comparable</code> but its super class does</li></ul></li> <li>wildcard capture — when the wildcard represents a single, definite type, it can be captured by type parameter<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">void</span> <span class="token function">swapHelper</span><span class="token punctuation">(</span><span class="token class-name">Pair</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">T</span> t <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">getFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    p<span class="token punctuation">.</span><span class="token function">setFirst</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">getSecond</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    p<span class="token punctuation">.</span><span class="token function">setSecond</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span><span class="token class-name">Pair</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> p<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">swapHelper</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div></li></ul></li></ul></li> <li><p>use generics to make checked exceptions unchecked</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;unchecked&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Throwable</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">void</span> <span class="token function">throwAs</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">T</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> e<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// do work</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// the compiler will believe that t becomes an unchecked exception</span>
    <span class="token class-name">Block</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RuntimeException</span><span class="token punctuation">&gt;</span></span><span class="token function">throwAs</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// alternatively, see https://stackoverflow.com/questions/31316581/a-peculiar-feature-of-exception-type-inference-in-java-8</span>
    <span class="token comment">// Block.throwAs(t);</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>limits of generics</p> <ul><li>type parameters cannot be primitive types — not compatible with <code>Object</code> when type erased at runtime</li> <li>not in static context — type variables not valid in static context (parameterized types are available)<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">T</span> singleInstance<span class="token punctuation">;</span> <span class="token comment">// Error</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">T</span> <span class="token function">getSingleInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// Error</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>singleInstance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">// ... construct new instance of T</span>
        <span class="token keyword">return</span> singleInstance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li>not when <code>throw</code> or <code>catch</code> — cannot throw or catch instances of a generic class</li> <li>not when cast and <code>instanceof</code> — compile warning when cast (<code>(Pair&lt;String&gt;) a</code>), compile error when <code>instanceof</code> (<code>a instanceof Pair&lt;T&gt;</code>)</li> <li>name clash
<ul><li>name clash with methods in <code>Object</code> — error by clash with <code>Object::equals</code> when defining <code>equals(T other)</code></li> <li>error when generic interfaces implemented more than once with different arguments — will be a conflict with the synthesized bridge methods<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Employee</span> <span class="token keyword">implements</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Manager</span> <span class="token keyword">extends</span> <span class="token class-name">Employee</span> <span class="token keyword">implements</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Manager</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span> <span class="token punctuation">}</span> <span class="token comment">// Error</span>
<span class="token comment">// bridge method for Comparable&lt;X&gt;</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token class-name">Object</span> other<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">X</span><span class="token punctuation">)</span> other<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div></li></ul></li> <li>heap pollution, cannot initialize arrays of parameterized types, but can be declared — error when <code>new Pair&lt;String&gt;[10]</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// legal but not safe workaround, possible heap pollution</span>
<span class="token class-name">Pair</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> table <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Pair</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">new</span> <span class="token class-name">Pair</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// heap pollution</span>
<span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> objArray <span class="token operator">=</span> table<span class="token punctuation">;</span> <span class="token comment">// defined above</span>
objArray<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Pair</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li>cannot instantiate type variable — error when <code>new T()</code> <ul><li>workaround — provide the constructor using lambda<div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Pair</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> p <span class="token operator">=</span> <span class="token class-name">Pair</span><span class="token punctuation">.</span><span class="token function">makePair</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Pair</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">makePair</span><span class="token punctuation">(</span><span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> constr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Pair</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>constr<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> constr<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li>workaround — use reflection<div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Pair</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> p <span class="token operator">=</span> <span class="token class-name">Pair</span><span class="token punctuation">.</span><span class="token function">makePair</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Pair</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">makePair</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> cl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Pair</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>cl<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cl<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul></li> <li>cannot construct generic array — error when <code>new T[n]</code> <ul><li>parameterized vararg type (<code>T...</code>) — against the rule, but can use <code>@SafeVarargs</code> to suppress warning</li> <li>workaround — use <code>Object[]</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> elements<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;unchecked&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">E</span><span class="token punctuation">)</span> elements<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">,</span> <span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> elements<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// no cast needed</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li>workaround — use cast from <code>Object[]</code>, type erasure makes the cast undetectable at runtime<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">E</span><span class="token punctuation">[</span><span class="token punctuation">]</span> elements<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> elements <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">E</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>not work when assigning to actual type — <code>ArrayList::toArray</code> either return <code>Object[]</code> or take a <code>T[]</code> parameter to return <code>T[]</code></li></ul></li> <li>workaround — provide constructor or use reflection, see above</li></ul></li></ul></li></ol> <h1 id="annotations"><a href="#annotations" class="header-anchor">#</a> Annotations</h1> <ol><li><p>annotations</p> <ul><li>syntax — each annotation is preceded by an <code>@</code> symbol, used like a modifier and is placed before the annotated item without a semicolon
<ul><li>an item can have multiple annotations</li> <li>one annotation can be used multiple times on one item if <code>@Repeatable</code></li></ul></li> <li>annotation interfaces — define annotations, creates actual Java interfaces, implicitly extend <code>Annotation</code><div class="language-java extra-class"><pre class="language-java"><code>modifiers <span class="token annotation punctuation">@interface</span> <span class="token class-name">AnnotationName</span> <span class="token punctuation">{</span>
  type <span class="token function">elementName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  type <span class="token function">elementName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>cannot be extended or implemented explicitly</li> <li>when being processed — tools that process annotations receive objects implementing annotation interfaces, and call methods to retrieve elements</li> <li><code>java.lang.annotation.Annotation</code> — The common interface extended by all annotation types. Note that an interface that manually extends this one does not define an annotation type.<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Annotation</span>
</code></pre></div><ul><li><code>Class&lt;? extends Annotation&gt; annotationType()</code></li></ul></li></ul></li> <li>annotation places
<ul><li>declarations</li> <li>type uses</li></ul></li></ul></li> <li><p>annotation elements</p> <ul><li>elements of annotations — parameters when annotating, all element values must be compile-time constants, correspond to methods of annotation interfaces<div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@AnnotationName</span><span class="token punctuation">(</span>elementName1<span class="token operator">=</span>value1<span class="token punctuation">,</span> elementName2<span class="token operator">=</span>value2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@AnnotationName</span>
<span class="token annotation punctuation">@AnnotationName</span><span class="token punctuation">(</span>valueForSingleElement<span class="token punctuation">)</span>
</code></pre></div><ul><li>marker annotation — annotations no elements need to be specified when annotating</li> <li>single value annotation — only one element called <code>value</code></li></ul></li> <li>annotation element types — non-null, usually <code>&quot;&quot;</code> or <code>Void.class</code> as substitution
<ul><li>primitive types</li> <li><code>String</code></li> <li><code>Class</code></li> <li><code>Enum</code></li> <li>annotation types, error to introduce circular dependencies<div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Reference</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token annotation punctuation">@Reference</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// an annotation type</span>
<span class="token annotation punctuation">@BugReport</span><span class="token punctuation">(</span>ref<span class="token operator">=</span><span class="token annotation punctuation">@Reference</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">&quot;3352627&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token comment">// when annotating</span>
</code></pre></div></li> <li>arrays of the preceding types (flat), enclosed in braces when annotating<div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@BugReport</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> reportedBy<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;Harry&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Carl&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@BugReport</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> reportedBy<span class="token operator">=</span><span class="token string">&quot;Joe&quot;</span><span class="token punctuation">)</span> <span class="token comment">// OK, same as {&quot;Joe&quot;}</span>
</code></pre></div></li></ul></li></ul></li> <li><p>declaration annotations</p> <ul><li>annotation target — implementing classes of <code>AnnotatedElement</code>: <code>Class</code> (also interfaces), <code>Constructor</code>, <code>Executable</code>, <code>Field</code>, <code>Method</code>, <code>Package</code>, <code>Parameter</code>; sub-interface <code>TypeVariable</code> and local variables
<ul><li>package annotations — in <code>package-info.java</code>, can only be processed at the source level<div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * Package-level javadoc
 */</span>
<span class="token annotation punctuation">@GPL</span><span class="token punctuation">(</span>version<span class="token operator">=</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>a<span class="token punctuation">.</span>b</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>gnu<span class="token punctuation">.</span></span>GPL<span class="token punctuation">;</span>
</code></pre></div></li> <li>parameter annotations — explicitly declare <code>this</code> if necessary</li></ul></li> <li>local variable annotations — can only be processed at the source level</li> <li>an annotation can annotate itself</li></ul></li> <li><p>type use (<code>ElementType.TYPE_USE</code>) annotations — annotate types, as sub-interfaces of <code>AnnotatedElement</code></p> <ul><li>type arguments — <code>List&lt;@NonNull String&gt;</code>, <code>List&lt;@Localized ? extends Message&gt;</code>, <code>List&lt;? extends @Localized Message&gt;</code></li> <li>arrays — <code>@NonNull String[][] words</code> (<code>words[i][j]</code> is not <code>null</code>), <code>String @NonNull [][] words</code> (<code>words</code> is not <code>null</code>), <code>String[] @NonNull [] words</code> (<code>words[i]</code> is not <code>null</code>)</li> <li>when inheriting — <code>class Warning extends @Localized Message</code></li> <li>when <code>new</code> — <code>new @Localized String(...)</code></li> <li>casts and <code>instanceof</code> — <code>(@Localized String) text</code>, <code>if (text instanceof @Localized String)</code></li> <li>exception specifications — <code>public String read() throws @Localized IOException</code></li> <li>method references — <code>@Localized Message::getText</code></li> <li>cannot<div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token comment">// ERROR: Cannot annotate class literal</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>@<span class="token class-name">NonNull</span> <span class="token class-name">String</span><span class="token punctuation">;</span> <span class="token comment">// ERROR: Cannot annotate import</span>
</code></pre></div></li></ul></li></ol> <h2 id="standard-annotations"><a href="#standard-annotations" class="header-anchor">#</a> Standard Annotations</h2> <ol><li><p>for compilation</p> <ul><li><code>@Deprecated</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Documented</span>
 <span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span>value<span class="token operator">=</span>RUNTIME<span class="token punctuation">)</span>
 <span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token punctuation">{</span>CONSTRUCTOR<span class="token punctuation">,</span>FIELD<span class="token punctuation">,</span>LOCAL_VARIABLE<span class="token punctuation">,</span>METHOD<span class="token punctuation">,</span>PACKAGE<span class="token punctuation">,</span>PARAMETER<span class="token punctuation">,</span>TYPE<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Deprecated</span>
</code></pre></div></li> <li><code>@SuppressWarnings</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token punctuation">{</span>TYPE<span class="token punctuation">,</span>FIELD<span class="token punctuation">,</span>METHOD<span class="token punctuation">,</span>PARAMETER<span class="token punctuation">,</span>CONSTRUCTOR<span class="token punctuation">,</span>LOCAL_VARIABLE<span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span>value<span class="token operator">=</span>SOURCE<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">SuppressWarnings</span>
</code></pre></div><ul><li><code>@SuppressWarnings(&quot;fallthrough&quot;)</code></li></ul></li> <li><code>@Override</code> — error when not overriding but define a new method<div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span>value<span class="token operator">=</span>METHOD<span class="token punctuation">)</span>
 <span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span>value<span class="token operator">=</span>SOURCE<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Override</span>
</code></pre></div></li> <li><code>@javax.annotation.Generated</code> — mark source code that has been generated. It can also be used to differentiate user written code from generated code in a single file (in <code>javax.annotation.processing</code> for post JDK 8)<div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Documented</span>
 <span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span>value<span class="token operator">=</span>SOURCE<span class="token punctuation">)</span>
 <span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token punctuation">{</span>PACKAGE<span class="token punctuation">,</span>TYPE<span class="token punctuation">,</span>ANNOTATION_TYPE<span class="token punctuation">,</span>METHOD<span class="token punctuation">,</span>CONSTRUCTOR<span class="token punctuation">,</span>FIELD<span class="token punctuation">,</span>LOCAL_VARIABLE<span class="token punctuation">,</span>PARAMETER<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Generated</span>
</code></pre></div></li> <li><code>@FunctionalInterface</code> — error if conditions of functional interfaces not meet<div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Documented</span>
 <span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span>value<span class="token operator">=</span>RUNTIME<span class="token punctuation">)</span>
 <span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span>value<span class="token operator">=</span>TYPE<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">FunctionalInterface</span>
</code></pre></div></li> <li><code>@SafeVarargs</code> — assertion that the body of the annotated method or constructor does not perform potentially unsafe operations on its varargs parameter<div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Documented</span>
 <span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span>value<span class="token operator">=</span>RUNTIME<span class="token punctuation">)</span>
 <span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token punctuation">{</span>CONSTRUCTOR<span class="token punctuation">,</span>METHOD<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">SafeVarargs</span>
</code></pre></div></li></ul></li> <li><p>meta</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Documented</span>
 <span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span>value<span class="token operator">=</span>RUNTIME<span class="token punctuation">)</span>
 <span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span>value<span class="token operator">=</span>ANNOTATION_TYPE<span class="token punctuation">)</span>
</code></pre></div><ul><li><code>@java.lang.annotation.Target</code> — the contexts in which an annotation type is applicable, any declaration except a type parameter declaration if absent
<ul><li><code>ElementType[] value</code></li> <li><code>enum java.lang.annotation.ElementType</code> — <code>ANNOTATION_TYPE</code>, <code>CONSTRUCTOR</code>, <code>FIELD</code>, <code>LOCAL_VARIABLE</code>, <code>METHOD</code>, <code>PACKAGE</code>, <code>PARAMETER</code>, <code>TYPE</code>, <code>TYPE_PARAMETER</code>, <code>TYPE_USE</code> <ul><li><code>TYPE</code> -- class, interface (including annotation type), or enum declaration</li></ul></li></ul></li> <li><code>@java.lang.annotation.Retention</code> — how long annotations with the annotated type are to be retained, defaults to <code>RetentionPolicy.CLASS</code> if absent
<ul><li><code>RetentionPolicy value</code></li> <li><code>enum java.lang.annotation.RetentionPolicy</code> <ul><li><code>CLASS</code> — in class files but not the VM</li> <li><code>RUNTIME</code></li> <li><code>SOURCE</code></li></ul></li></ul></li> <li><code>@java.lang.annotation.Documented</code> — indicates that annotations with a type are to be documented by javadoc and similar tools by default</li> <li><code>@java.lang.annotation.Inherited</code> — indicates that an annotation type is automatically inherited, has no effect if the annotated type is used to annotate anything other than a class</li> <li><code>@java.lang.annotation.Repeatable</code> — indicates the annotation type is repeatable, with the containing annotation type to hold repeated annotations<div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Repeatable</span><span class="token punctuation">(</span><span class="token class-name">TestCases</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@interface</span> <span class="token class-name">TestCase</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> <span class="token function">params</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> <span class="token function">expected</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@interface</span> <span class="token class-name">TestCases</span> <span class="token punctuation">{</span> <span class="token class-name">TestCase</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div><ul><li><code>Class&lt;? extends Annotation&gt; value</code> — a container annotation that holds the repeated annotations in an array</li></ul></li></ul></li> <li><p>for java EE resource managing (deprecated from JDK 9 and removed from JDK 11, available in Maven)</p> <ul><li><code>@javax.annotation.PostConstruct</code> — used on a method that needs to be executed after dependency injection is done<div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Documented</span>
 <span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span>value<span class="token operator">=</span>RUNTIME<span class="token punctuation">)</span>
 <span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span>value<span class="token operator">=</span>METHOD<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">PostConstruct</span>
</code></pre></div><ul><li>Only one method can be annotated with this annotation</li> <li>annotated method signature — see javadoc</li></ul></li> <li><code>@javax.annotation.PreDestroy</code> — used on methods as a callback notification to signal that the instance is in the process of being removed by the container<div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Documented</span>
 <span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span>value<span class="token operator">=</span>RUNTIME<span class="token punctuation">)</span>
 <span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span>value<span class="token operator">=</span>METHOD<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">PreDestroy</span>
</code></pre></div><ul><li>annotated method requirements — see javadoc</li></ul></li> <li><code>@javax.annotation.Resource</code> — marks a resource that is needed by the application<div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token punctuation">{</span>TYPE<span class="token punctuation">,</span>FIELD<span class="token punctuation">,</span>METHOD<span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span>value<span class="token operator">=</span>RUNTIME<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Resource</span>
</code></pre></div><ul><li>example<div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Resource</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;jdbc/mydb&quot;</span><span class="token punctuation">)</span> <span class="token keyword">private</span> <span class="token class-name">DataSource</span> source<span class="token punctuation">;</span>
</code></pre></div></li></ul></li> <li><code>@javax.annotation.Resources</code> — multiple resources</li></ul></li></ol> <h2 id="source-level-annotation-processing"><a href="#source-level-annotation-processing" class="header-anchor">#</a> Source-Level Annotation Processing</h2> <ol><li><p>CLI</p> <div class="language- extra-class"><pre class="language-text"><code>javac -processor &lt;class1&gt;[,&lt;class2&gt;,&lt;class3&gt;...] sourceFiles
</code></pre></div><ul><li>also other alternatives</li> <li>produce new source files until no more — Each annotation processor is executed in turn and given the annotations in which it expressed an interest. If an annotation processor creates a new source file, the process is repeated. Once a processing round yields no further source files, all source files are compiled.
<ul><li><code>-XprintRounds</code> — show rounds</li> <li>cannot modify source files — use with agents or bytecode engineering tools</li></ul></li></ul></li> <li><p><code>javax.annotation.processing</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@SupportedAnnotationTypes</span><span class="token punctuation">(</span><span class="token string">&quot;com.example.annotations.ToString&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SupportedSourceVersion</span><span class="token punctuation">(</span><span class="token class-name">SourceVersion</span><span class="token punctuation">.</span>RELEASE_8<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ToStringAnnotationProcessor</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractProcessor</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">TypeElement</span><span class="token punctuation">&gt;</span></span> annotations<span class="token punctuation">,</span> <span class="token class-name">RoundEnvironment</span> currentRound<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><code>javax.annotation.processing.AbstractProcessor</code> — for processors to extend<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractProcessor</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Processor</span>
</code></pre></div></li> <li><code>interface</code> <code>javax.annotation.processing.RoundEnvironment</code></li> <li><code>@javax.annotation.processing.SupportedAnnotationTypes</code></li> <li><code>@javax.annotation.processing.SupportedOptions</code></li> <li><code>@javax.annotation.processing.SupportedSourceVersion</code></li></ul></li> <li><p>language model (AST) — <code>javax.lang.model</code></p> <ul><li><code>javax.lang.model.element.Element</code> — AST nodes</li></ul></li></ol> <h1 id="concurrency"><a href="#concurrency" class="header-anchor">#</a> Concurrency</h1> <h2 id="thread"><a href="#thread" class="header-anchor">#</a> Thread</h2> <ol><li><p>multithread</p> <ul><li>construct a runnable thread
<ul><li>construct with a <code>Runnable</code> target</li> <li>subclass <code>Thread</code> and override <code>run</code> method — recommended only when customizing <code>run</code> is not enough</li></ul></li> <li>start a thread — <code>Thread::run</code> <ul><li><a href="https://zhuanlan.zhihu.com/p/34414549" target="_blank" rel="noopener noreferrer">zhihu<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li> <li>thread scheduling — depends on the services the OS provides</li></ul></li> <li><p>properties of threads</p> <ul><li>priority — whenever the scheduler wants to pick a new thread, threads with higher priorities are preferred
<ul><li>inherit — initially set equal to the priority of the creating thread</li> <li>mapped constants — <code>Thread.MIN_PRIORITY</code> 1, <code>Thread.NORM_PRIORITY</code> 5, <code>Thread.MAX_PRIORITY</code> 10, mapped to priority levels of the host platform</li> <li>Windows has seven priority levels, priorities are ignored in Linux??</li> <li>caveat — few scenarios there to ever tweak priorities. If you have several threads with a high priority that don’t become inactive, the lower-priority threads may never execute</li></ul></li> <li>daemon — serves other threads, JVM exits when only daemon threads remain
<ul><li>inherit — is a daemon thread if and only if the creating thread is a daemon</li> <li>no persistence access — should never access a persistent resource such as a file or database since it can terminate at any time</li></ul></li> <li>state — enum <code>Thread.State</code>, see below</li> <li><code>Thread.UncaughtExceptionHandler</code> — method to be invoked from when the given thread terminates due to the given uncaught exception<div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@FunctionalInterface</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UncaughtExceptionHandler</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">uncaughtException</span><span class="token punctuation">(</span><span class="token class-name">Thread</span> t<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>exceptions in <code>uncaughtException</code> — any exception thrown by this method will be ignored by JVM</li> <li>handler defaults — default handler defaults to <code>null</code>, individual handler defaults to <code>ThreadGroup</code></li></ul></li> <li><code>ThreadGroup</code> — represents a set of threads. In addition, a thread group can also include other thread groups
<ul><li>not recommended, use alternatives instead</li> <li>action orders of <code>ThreadGroup::uncaughtException</code> when an uncaught exception
<ul><li>the <code>uncaughtException</code> method of the parent thread group</li> <li>otherwise, default handler if non-<code>null</code></li> <li>otherwise, nothing happens if the <code>Throwable</code> is an instance of <code>ThreadDeath</code></li> <li>otherwise, print the name of the thread and the stack trace to <code>System.err</code></li></ul></li></ul></li> <li><code>ThreadLocal</code>, <code>ThreadLocalRandom</code> — thread-local variables<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SimpleDateFormat</span><span class="token punctuation">&gt;</span></span> dateFormat <span class="token operator">=</span>
    <span class="token class-name">ThreadLocal</span><span class="token punctuation">.</span><span class="token function">withInitial</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>motivations — avoid synchronization and blocking and boost performance
<ul><li>the internal data structures used by <code>SimpleDateFormat</code> can be corrupted by concurrent access, and synchronization is expensive</li> <li><code>Random</code> is thread safe using <code>AtomicLong::compareAndSet</code>, but inefficient if multiple threads need to wait for a single shared generator</li></ul></li></ul></li></ul></li> <li><p><code>Runnable</code> — should be implemented by any class whose instances are intended to be executed by a thread</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@FunctionalInterface</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>see <a href="#Callable-and-Future">Callable and Future</a> for more</li> <li>conversion to <code>Callable</code> -- <code>Executors::callable</code></li></ul></li> <li><p><code>Thread</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Thread</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Runnable</span>
</code></pre></div><ul><li>constructors
<ul><li><code>Thread(Runnable target)</code></li> <li><code>Thread(Runnable target, String name)</code></li></ul></li> <li>lifecycle
<ul><li><code>void start()</code></li> <li><code>void run()</code> — called by <code>start()</code>, generally should not be called explicitly</li> <li><code>void interrupt()</code> — set the interrupted status, if the thread is blocked, throw <code>InterruptedException</code> inside the thread
<ul><li>used by blocking methods — typically blocking methods (those related to <code>Thread.State.WAITING</code> and <code>Thread.State.TIMED_WAITING</code>) threaten to throw <code>InterruptedException</code></li></ul></li></ul></li> <li>wait
<ul><li><code>static void yield()</code> — rarely appropriate to use, see javadoc</li> <li><code>static void sleep(long millis)</code> — for current thread<br> <code>static void sleep(long millis, int nanos)</code></li> <li><code>void join()</code> — waits for this thread to die<br> <code>void join(long millis)</code><br> <code>void join(long millis, int nanos)</code></li></ul></li> <li>get information
<ul><li><code>static Thread currentThread()</code></li> <li><code>boolean isAlive()</code></li> <li><code>boolean isInterrupted()</code> — can be used for check in <code>while</code></li> <li><code>static boolean interrupted()</code> — for current thread, also clears interrupted status</li> <li><code>int getPriority()</code></li> <li><code>boolean isDaemon()</code></li> <li><code>Thread.State getState()</code></li></ul></li> <li>get handler
<ul><li><code>Thread.UncaughtExceptionHandler getUncaughtExceptionHandler()</code></li> <li><code>static Thread.UncaughtExceptionHandler getDefaultUncaughtExceptionHandler()</code></li></ul></li> <li>set
<ul><li><code>void setPriority(int newPriority)</code></li> <li><code>void setDaemon(boolean on)</code></li> <li><code>void setUncaughtExceptionHandler(Thread.UncaughtExceptionHandler eh)</code></li> <li><code>static void setDefaultUncaughtExceptionHandler(Thread.UncaughtExceptionHandler eh)</code></li></ul></li></ul></li> <li><p><code>enum Thread.State</code></p> <ul><li><code>NEW</code> — after <code>new</code>, a thread that has not yet started is in this state.</li> <li><code>RUNNABLE</code> — after <code>start()</code>, a thread executing in the Java virtual machine is in this state, may not be running due to CPU time slicing</li> <li><code>BLOCKED</code> — intrinsic object lock, a thread that is blocked waiting for a monitor lock is in this state.</li> <li><code>WAITING</code> — after <code>Object::wait</code>, <code>Thread::join</code>, or by <code>Lock</code> or <code>Condition</code>, a thread that is waiting indefinitely for another thread to perform a particular action is in this state.</li> <li><code>TIMED_WAITING</code> — after <code>Thread::sleep</code>, or methods for <code>WAITING</code> with a time parameter, a thread that is waiting for another thread to perform an action for up to a specified waiting time is in this state.</li> <li><code>TERMINATED</code> — A thread that has exited is in this state.</li></ul></li> <li><p><code>ThreadGroup</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadGroup</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token class-name">UncaughtExceptionHandler</span>
</code></pre></div><ul><li>share some APIs of <code>Thread</code></li></ul></li> <li><p><code>ThreadLocal</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><code>T get()</code></li> <li><code>void remove()</code> -- can prevent possible memory leak</li> <li><code>void set(T value)</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">T</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ThreadLocalMap</span> map <span class="token operator">=</span> <span class="token function">getMap</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>map <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">createMap</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><code>static &lt;S&gt; ThreadLocal&lt;S&gt; withInitial(Supplier&lt;? extends S&gt; supplier)</code></li> <li><code>ThreadLocal.ThreadLocalMap</code>, referenced by <code>Thread.threadLocals</code> field -- open addressing hash table
<ul><li>entry -- <code>WeakReference&lt;ThreadLocal&lt;?&gt;&gt;</code> as key, whose hash value managed by a static <code>AtomicInteger</code>, <code>getAndAdd</code> for every <code>ThreadLocal</code> instance</li> <li>memory leak -- referent of <code>WeakReference&lt;ThreadLocal&lt;?&gt;&gt;</code> keys can be reclaimed by GC, but no <code>ReferenceQueue</code> like in <code>WeakHashMap</code>, <code>expungeStaleEntries()</code> called only when rehash, and single entry expunge method called only when a stale entry encountered, possibly leaving stale entries not expunged</li></ul></li></ul></li> <li><p><code>java.util.concurrent.ThreadLocalRandom</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadLocalRandom</span> <span class="token keyword">extends</span> <span class="token class-name">Random</span>
</code></pre></div><ul><li><code>static ThreadLocalRandom current()</code></li></ul></li></ol> <h2 id="synchronization-and-locks"><a href="#synchronization-and-locks" class="header-anchor">#</a> Synchronization and Locks</h2> <ol><li><p>synchronization</p> <ul><li>race condition — when a system's substantive behavior is dependent on the sequence or timing of other uncontrollable events</li> <li>atomic</li> <li>preference — concurrent collections with non-blocking mechanism, synchronizers &gt; underlying locks in <code>java.util.concurrent</code> &gt; <code>synchronized</code> &gt; <code>Lock</code> <ul><li>avoid client-side locking — discouraged to use the lock of an object to implement additional atomic operations, e.g. use the lock of a <code>Vector</code> object to implement something like <code>AtomicLong::getAndAdd</code> for given index</li></ul></li> <li>when to use
<blockquote><p>If you write a variable which may next be read by another thread, or you read a variable which may have last been written by another thread, you must use synchronization.</p></blockquote></li></ul></li> <li><p>lock — when the lock object is locked, no other thread can <code>lock()</code> (being blocked)</p> <div class="language-java extra-class"><pre class="language-java"><code>myLock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// a ReentrantLock object</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// critical section</span>
<span class="token punctuation">}</span>
<span class="token keyword">finally</span> <span class="token punctuation">{</span>
    myLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// make sure the lock is unlocked even if an exception is thrown</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>conditions, condition queues or condition variables — a means for one thread to suspend execution (to &quot;wait&quot;) until notified by another thread that some state condition may now be true</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">BoundedBuffer</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> <span class="token class-name">Lock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">final</span> <span class="token class-name">Condition</span> notFull  <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">final</span> <span class="token class-name">Condition</span> notEmpty <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">final</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> items <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> putptr<span class="token punctuation">,</span> takeptr<span class="token punctuation">,</span> count<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">Object</span> x<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span>count <span class="token operator">==</span> items<span class="token punctuation">.</span>length<span class="token punctuation">)</span> notFull<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      items<span class="token punctuation">[</span>putptr<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>putptr <span class="token operator">==</span> items<span class="token punctuation">.</span>length<span class="token punctuation">)</span> putptr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token operator">++</span>count<span class="token punctuation">;</span>
      notEmpty<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
      lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span>count <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> notEmpty<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">Object</span> x <span class="token operator">=</span> items<span class="token punctuation">[</span>takeptr<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>takeptr <span class="token operator">==</span> items<span class="token punctuation">.</span>length<span class="token punctuation">)</span> takeptr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token operator">--</span>count<span class="token punctuation">;</span>
      notFull<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> x<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
      lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>atomic lock release when calling <code>await()</code> — atomically releases the associated lock and suspends the current thread, just like <code>Object::wait</code></li> <li>re-acquire the lock when <code>signal()</code> — a thread must then re-acquire the lock before returning from <code>await()</code></li> <li>intrinsically bound to a lock
<ul><li><code>Lock::newCondition</code> to get instances</li> <li><code>await</code> and <code>signal</code> methods can only be called if the thread owns the <code>Lock</code> of the <code>Condition</code></li></ul></li> <li>wait set — a thread enters wait set and stays deactivated after the call to <code>await</code>, until <code>signal</code>ed by other threads</li> <li>deadlock — when all threads are in wait set</li></ul></li> <li><p><code>synchronized</code> — use intrinsic lock, a method or code block that is atomic to a thread, reentrant</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token keyword">int</span> from<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token keyword">to</span><span class="token punctuation">,</span> <span class="token keyword">int</span> amount<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>accounts<span class="token punctuation">[</span>from<span class="token punctuation">]</span> <span class="token operator">&lt;</span> amount<span class="token punctuation">)</span> <span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// wait on intrinsic object lock's single condition</span>
    accounts<span class="token punctuation">[</span>from<span class="token punctuation">]</span> <span class="token operator">-=</span> amount<span class="token punctuation">;</span>
    accounts<span class="token punctuation">[</span><span class="token keyword">to</span><span class="token punctuation">]</span> <span class="token operator">+=</span> amount<span class="token punctuation">;</span>
    <span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// notify all threads waiting on the condition</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">synchronized</span> <span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token generics"><span class="token punctuation">&lt;</span>condition does not hold<span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span>
        obj<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span>timeout<span class="token punctuation">,</span> nanos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Perform action appropriate to condition</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>intrinsic lock — every object has an intrinsic lock, used if declared with <code>synchronized</code> <ul><li>static methods — the intrinsic lock of associated <code>Class&lt;?&gt;</code> is used</li></ul></li> <li>equivalent conditions in <code>Object</code> — see <a href="#Inheritance">Inheritance</a> for other <code>Object</code> APIs
<ul><li><code>void notify()</code></li> <li><code>void notifyAll()</code></li> <li><code>void wait()</code></li> <li><code>void wait(long timeout)</code></li> <li><code>void wait(long timeout, int nanos)</code></li></ul></li> <li>monitor — intrinsic lock is the loose adaption of the monitor concept
<ul><li><a href="https://en.wikipedia.org/wiki/Monitor_(synchronization)" target="_blank" rel="noopener noreferrer">Monitor (synchronization) - Wikipedia<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li> <li>JVM optimization -- see <a href="https://zhuanlan.zhihu.com/p/75880892" target="_blank" rel="noopener noreferrer">zhihu<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/Java%20%E5%B9%B6%E5%8F%91.md#%E5%8D%81%E4%BA%8C%E9%94%81%E4%BC%98%E5%8C%96" target="_blank" rel="noopener noreferrer">CS-Notes/Java 并发.md at master · CyC2018/CS-Notes<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li> <li><p><code>interface java.util.concurrent.locks.Lock</code></p> <ul><li><code>void lock()</code> — other threads are blocked if the lock cannot be acquired, cannot be interrupted</li> <li><code>void lockInterruptibly()</code> — <code>lock()</code> that can be interrupted, equivalent to <code>tryLock()</code> with an infinite timeout</li> <li><code>Condition newCondition()</code></li> <li><code>boolean tryLock()</code> — return <code>false</code> rather than being blocked</li> <li><code>boolean tryLock(long time, TimeUnit unit)</code> — can be interrupted</li> <li><code>void unlock()</code></li></ul></li> <li><p><code>interface java.util.concurrent.locks.Condition</code> — renamed API as counterpart methods in <code>Object</code> are <code>final</code></p> <ul><li><code>void await()</code></li> <li><code>boolean await(long time, TimeUnit unit)</code></li> <li><code>long awaitNanos(long nanosTimeout)</code></li> <li><code>void awaitUninterruptibly()</code></li> <li><code>boolean awaitUntil(Date deadline)</code></li> <li><code>void signal()</code> — choose one random thread to unblock, more likely to deadlock compared to <code>signalAll()</code></li> <li><code>void signalAll()</code></li></ul></li> <li><p><code>java.util.concurrent.locks.ReentrantLock</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReentrantLock</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Lock</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span>
</code></pre></div><ul><li>reentrant — has a hold count, can be repeatedly acquired by a thread, <code>lock()</code> will return immediately if the current thread already owns the lock, every <code>lock()</code> needs <code>unlock()</code> in order to relinquish the lock
<ul><li><code>int getHoldCount()</code></li></ul></li> <li>fair — a lot slower, a fair lock can still be unfair if the thread scheduler is unfair
<ul><li><code>ReentrantLock()</code></li> <li><code>ReentrantLock(boolean fair)</code></li></ul></li> <li>underlying implementation -- <code>AbstractQueuedSynchronizer::compareAndSetState</code></li></ul></li> <li><p><code>java.util.concurrent.locks.ReentrantReadWriteLock</code> — read lock for accessors, write lock for mutators</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReentrantReadWriteLock</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">ReadWriteLock</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span>
</code></pre></div><ul><li><code>ReentrantReadWriteLock.ReadLock readLock()</code> <ul><li>read lock can be acquired if — the write lock is not held by another thread</li></ul></li> <li><code>ReentrantReadWriteLock.WriteLock writeLock()</code> <ul><li>write lock can be acquired if — neither the read nor write lock are held by another thread</li></ul></li> <li><code>interface java.util.concurrent.locks.ReadWriteLock</code> <ul><li>scenarios — while only a single thread at a time (a writer thread) can modify the shared data, in many cases any number of threads can concurrently read the data</li> <li>mutual exclusive or not — the read lock may be held simultaneously by multiple reader threads, so long as there are no writers. The write lock is exclusive</li> <li><code>writeLock</code> happen-before — must guarantee that the memory synchronization effects of <code>writeLock</code> operations: a thread successfully acquiring the read lock will see all updates made upon previous release of the write lock</li> <li>simultaneous read and write lock — a writer can acquire the read lock, but not vice-versa</li> <li>overhead — the read-write lock implementation (which is inherently more complex than a mutual exclusion lock) can dominate the execution cost if the read operations are too short</li></ul></li> <li>underlying implementation -- <code>AbstractQueuedSynchronizer::compareAndSetState</code></li></ul></li> <li><p><code>java.util.concurrent.locks.StampedLock</code> — a capability-based lock, not reentrant, lock acquisition methods return a stamp that represents and controls access with respect to a lock state; lock release and conversion methods require stamps as arguments</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StampedLock</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span>
</code></pre></div><ul><li>stamp -- zero value for failure, the state of a <code>StampedLock</code> consists of a version and mode</li> <li>three modes
<ul><li>write -- blocks waiting for exclusive access
<ul><li><code>long writeLock()</code></li> <li><code>void unlockWrite(long stamp)</code></li></ul></li> <li>read -- blocks waiting for non-exclusive access
<ul><li><code>long readLock()</code></li> <li><code>void unlockRead(long stamp)</code></li> <li><code>int getReadLockCount()</code></li></ul></li> <li>optimistic read -- an extremely weak version of a read-lock, that can be broken by a writer at any time, for short read-only code segments
<ul><li><code>long tryOptimisticRead()</code> -- returns a non-zero stamp only if the lock is not currently held in write mode</li> <li><code>boolean validate(long stamp)</code> -- returns true if the lock has not been acquired in write mode since obtaining a given stamp</li></ul></li> <li><code>void unlock(long stamp)</code></li></ul></li> <li>mode conversion methods</li> <li><code>Lock</code> conversion
<ul><li><code>Lock asReadLock()</code></li> <li><code>Lock asWriteLock()</code></li> <li><code>ReadWriteLock asReadWriteLock()</code></li></ul></li> <li>underlying implementation -- memory fence methods in <code>VarHandle</code>, and <code>VarHandle::compareAndSet</code></li> <li>example<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span> <span class="token keyword">double</span> x<span class="token punctuation">,</span> y<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">StampedLock</span> sl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StampedLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">void</span> <span class="token function">move</span><span class="token punctuation">(</span><span class="token keyword">double</span> deltaX<span class="token punctuation">,</span> <span class="token keyword">double</span> deltaY<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// an exclusively locked method</span>
     <span class="token keyword">long</span> stamp <span class="token operator">=</span> sl<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">try</span> <span class="token punctuation">{</span>
       x <span class="token operator">+=</span> deltaX<span class="token punctuation">;</span>
       y <span class="token operator">+=</span> deltaY<span class="token punctuation">;</span>
     <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
       sl<span class="token punctuation">.</span><span class="token function">unlockWrite</span><span class="token punctuation">(</span>stamp<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">double</span> <span class="token function">distanceFromOrigin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// A read-only method</span>
     <span class="token keyword">long</span> stamp <span class="token operator">=</span> sl<span class="token punctuation">.</span><span class="token function">tryOptimisticRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">double</span> currentX <span class="token operator">=</span> x<span class="token punctuation">,</span> currentY <span class="token operator">=</span> y<span class="token punctuation">;</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>sl<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>stamp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        stamp <span class="token operator">=</span> sl<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          currentX <span class="token operator">=</span> x<span class="token punctuation">;</span>
          currentY <span class="token operator">=</span> y<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
           sl<span class="token punctuation">.</span><span class="token function">unlockRead</span><span class="token punctuation">(</span>stamp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
     <span class="token keyword">return</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>currentX <span class="token operator">*</span> currentX <span class="token operator">+</span> currentY <span class="token operator">*</span> currentY<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">void</span> <span class="token function">moveIfAtOrigin</span><span class="token punctuation">(</span><span class="token keyword">double</span> newX<span class="token punctuation">,</span> <span class="token keyword">double</span> newY<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// upgrade</span>
     <span class="token comment">// Could instead start with optimistic, not read mode</span>
     <span class="token keyword">long</span> stamp <span class="token operator">=</span> sl<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">try</span> <span class="token punctuation">{</span>
       <span class="token keyword">while</span> <span class="token punctuation">(</span>x <span class="token operator">==</span> <span class="token number">0.0</span> <span class="token operator">&amp;&amp;</span> y <span class="token operator">==</span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">long</span> ws <span class="token operator">=</span> sl<span class="token punctuation">.</span><span class="token function">tryConvertToWriteLock</span><span class="token punctuation">(</span>stamp<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>ws <span class="token operator">!=</span> <span class="token number">0L</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           stamp <span class="token operator">=</span> ws<span class="token punctuation">;</span>
           x <span class="token operator">=</span> newX<span class="token punctuation">;</span>
           y <span class="token operator">=</span> newY<span class="token punctuation">;</span>
           <span class="token keyword">break</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">else</span> <span class="token punctuation">{</span>
           sl<span class="token punctuation">.</span><span class="token function">unlockRead</span><span class="token punctuation">(</span>stamp<span class="token punctuation">)</span><span class="token punctuation">;</span>
           stamp <span class="token operator">=</span> sl<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
       sl<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span>stamp<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre></div></li></ul></li></ol> <h2 id="volatile-and-atomics"><a href="#volatile-and-atomics" class="header-anchor">#</a> volatile and Atomics</h2> <ol><li><p><code>volatile</code> — ensures that a field is coherently accessed by multiple threads</p> <ul><li>problems of concurrent write and read to instance fields
<ul><li>cache coherence — threads running in different processors may see different values for the same memory location</li> <li>reorder — a memory value can be changed by another thread, but compilers assume memory values are only changed with explicit instructions, and compilers reorder instructions to maximize throughput</li> <li>memory barrier, membar, memory fence or fence instruction -- a type of barrier instruction that causes a CPU or compiler to enforce an ordering constraint on memory operations issued before and after the barrier instruction. This typically means that operations issued prior to the barrier are guaranteed to be performed before operations issued after the barrier</li> <li>barrier -- a barrier for a group of threads or processes in the source code means any thread/process must stop at this point and cannot proceed until all other threads/processes reach this barrier</li></ul></li> <li>ensure changes visible — compiler will insert the appropriate code to ensure that a change to the a variable in one thread is visible from any other thread that reads the variable
<ul><li><a href="https://docs.oracle.com/javase/specs/jls/se11/html/jls-17.html#jls-17.4.5" target="_blank" rel="noopener noreferrer">happen-before order<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> — a write to a volatile field is visible to and ordered before every subsequent read of that field</li></ul></li> <li>atomicity — volatile variables do not provide any atomicity, but makes read and write to <code>long</code> and <code>double</code> atomic
<ul><li><a href="https://docs.oracle.com/javase/specs/jls/se8/html/jls-17.html#jls-17.7" target="_blank" rel="noopener noreferrer">JLS 17.7. Non-Atomic Treatment of double and long<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <blockquote><p>For the purposes of the Java programming language memory model, a single write to a non-volatile <code>long</code> or <code>double</code> value is treated as two separate writes: one to each 32-bit half. This can result in a situation where a thread sees the first 32 bits of a 64-bit value from one write, and the second 32 bits from another write.</p></blockquote></li></ul></li> <li>also <code>synchronized</code> -- changes visible before a variable is unlocked</li></ul></li> <li><p><code>java.util.concurrent.atomic</code> — use efficient machine-level instructions to guarantee atomicity without using locks</p> <ul><li>optimistic update — <code>compareAndSet</code> method, or use lambda like <code>accumulateAndGet</code> method<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">AtomicLong</span> largest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// In some thread...</span>
<span class="token comment">// largest.set(Math.max(largest.get(), observed)); // Error--race condition!</span>
<span class="token keyword">do</span> <span class="token punctuation">{</span>
    oldValue <span class="token operator">=</span> largest<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    newValue <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>oldValue<span class="token punctuation">,</span> observed<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>largest<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span>oldValue<span class="token punctuation">,</span> newValue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>CAS, <a href="https://en.wikipedia.org/wiki/Compare-and-swap" target="_blank" rel="noopener noreferrer">Compare-and-swap - Wikipedia<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <ul><li>ABA problem -- use <code>AtomicStampedReference</code>, or traditional synchronization</li></ul></li></ul></li> <li>delayed computation — <code>LongAdder</code>, <code>LongAccumulator</code>, <code>DoubleAdder</code>, <code>DoubleAccumulator</code> <ul><li>under high contention, performance suffers because the optimistic updates require too many retries</li> <li>the computation must be associative and commutative</li> <li><code>identity</code> — initial value, also used when <code>accumulate()</code></li></ul></li></ul></li> <li><p><code>java.util.concurrent.atomic</code> classes</p> <ul><li><code>java.util.concurrent.atomic.AtomicBoolean</code> (implements <code>Serializable</code>)</li> <li><code>java.util.concurrent.atomic.AtomicIntegerArray</code> (implements <code>Serializable</code>)</li> <li><code>java.util.concurrent.atomic.AtomicIntegerFieldUpdater&lt;T&gt;</code></li> <li><code>java.util.concurrent.atomic.AtomicLongArray</code> (implements <code>Serializable</code>)</li> <li><code>java.util.concurrent.atomic.AtomicLongFieldUpdater&lt;T&gt;</code></li> <li><code>java.util.concurrent.atomic.AtomicMarkableReference&lt;V&gt;</code></li> <li><code>java.util.concurrent.atomic.AtomicReference&lt;V&gt;</code> (implements <code>Serializable</code>)</li> <li><code>java.util.concurrent.atomic.AtomicReferenceArray&lt;E&gt;</code> (implements <code>Serializable</code>)</li> <li><code>java.util.concurrent.atomic.AtomicReferenceFieldUpdater&lt;T,V&gt;</code></li> <li><code>java.util.concurrent.atomic.AtomicStampedReference&lt;V&gt;</code></li> <li><code>java.lang.Number</code> <ul><li><code>java.util.concurrent.atomic.AtomicInteger</code></li> <li><code>java.util.concurrent.atomic.AtomicLong</code></li> <li><code>java.util.concurrent.atomic.Striped64</code> — a package-local class holding common representation and mechanics for classes supporting dynamic striping on 64 bit values
<ul><li><code>java.util.concurrent.atomic.DoubleAccumulator</code></li> <li><code>java.util.concurrent.atomic.DoubleAdder</code></li> <li><code>java.util.concurrent.atomic.LongAccumulator</code></li> <li><code>java.util.concurrent.atomic.LongAdder</code></li></ul></li></ul></li></ul></li></ol> <h2 id="thread-safe-collections"><a href="#thread-safe-collections" class="header-anchor">#</a> Thread-Safe Collections</h2> <ol><li><code>java.util.concurrent</code> exceptions
<ul><li><code>java.util.concurrent.BrokenBarrierException</code></li> <li><code>java.util.concurrent.ExecutionException</code></li> <li><code>java.util.concurrent.TimeoutException</code></li> <li><code>RuntimeException</code> <ul><li><code>java.util.concurrent.CompletionException</code></li> <li><code>IllegalStateException</code> <ul><li><code>java.util.concurrent.CancellationException</code></li></ul></li> <li><code>java.util.concurrent.RejectedExecutionException</code></li></ul></li></ul></li></ol> <h3 id="blocking-queues"><a href="#blocking-queues" class="header-anchor">#</a> Blocking Queues</h3> <ol><li><p>Blocking Queues</p> <ul><li>producer consumer model</li> <li>no synchronization needed — instead of synchronization and locks, queue the instructions and let only the access of one thread</li> <li>the queue needs to be thread-safe — blocking queue blocks a thread when no slot for producer or no provision for consumer</li> <li>timeout — some methods have versions with timeout</li></ul></li> <li><p><code>java.util.concurrent.BlockingQueue</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">Queue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>non-null</li> <li>blocking
<ul><li><code>E put(E e)</code></li> <li><code>E take()</code></li></ul></li> <li>timeout
<ul><li><code>boolean offer(E e, long timeout, TimeUnit unit)</code><br> <code>boolean offer(E e)</code> — 0 timeout</li> <li><code>E poll(long timeout, TimeUnit unit)</code></li></ul></li></ul></li> <li><p><code>java.util.concurrent.BlockingDeque</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BlockingDeque</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">extends</span> <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Deque</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p><code>java.util.concurrent.LinkedBlockingQueue</code> — optionally-bounded blocking queue based on linked nodes</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">implements</span> <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span>
</code></pre></div></li> <li><p><code>java.util.concurrent.LinkedBlockingDeque</code> — deque version of <code>LinkedBlockingQueue</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LinkedBlockingDeque</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">implements</span> <span class="token class-name">BlockingDeque</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span>
</code></pre></div></li> <li><p><code>java.util.concurrent.ArrayBlockingQueue</code> — optionally-fair bounded blocking queue backed by an array</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ArrayBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">implements</span> <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span>
</code></pre></div></li> <li><p><code>java.util.concurrent.PriorityBlockingQueue</code> — unbounded blocking queue that uses the same ordering rules as <code>PriorityQueue</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PriorityBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">implements</span> <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span>
</code></pre></div></li> <li><p><code>java.util.concurrent.DelayQueue</code> — unbounded blocking queue of <code>Delayed</code> elements backed by <code>PriorityQueue</code>, in which an element can only be taken when its delay has expired</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DelayQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span> <span class="token keyword">extends</span> <span class="token class-name">Delayed</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">implements</span> <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>The head of the queue is that <code>Delayed</code> element whose delay expired furthest in the past</li> <li><code>java.util.concurrent.Delay</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Delayed</span> <span class="token keyword">extends</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Delayed</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">long</span> <span class="token function">getDelay</span><span class="token punctuation">(</span><span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>consistency between <code>compareTo</code> and <code>getDelay</code> — a <code>compareTo</code> method needs to provide an ordering consistent with its <code>getDelay</code> method, which violates the consistency between <code>compareTo</code> and <code>equals</code></li></ul></li></ul></li> <li><p><code>java.util.concurrent.LinkedTransferQueue</code> — unbounded <code>TransferQueue</code> backed by dual queues of slack (refer to source code) based on linked nodes</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LinkedTransferQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">implements</span> <span class="token class-name">TransferQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span>
</code></pre></div><ul><li><code>java.util.concurrent.TransferQueue</code> — A <code>BlockingQueue</code> in which producers may wait for consumers to receive elements<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TransferQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><code>void transfer(E e)</code> — transfers the specified element immediately if there exists a consumer already waiting, else waits until the element is received by a consumer</li></ul></li> <li>inaccurate <code>size()</code> — <code>size()</code> is O(n) and maybe inaccurate, due to non-data nodes and concurrency</li> <li>atomicity for bulk operations — bulk operations <code>addAll</code>, <code>removeAll</code>, <code>retainAll</code>, <code>containsAll</code>, <code>equals</code>, and <code>toArray</code> are not guaranteed to be performed atomically</li></ul></li></ol> <h3 id="concurrent-collections"><a href="#concurrent-collections" class="header-anchor">#</a> Concurrent Collections</h3> <ol><li><p>concurrent collections</p> <ul><li>generally non-blocking algorithm</li> <li>some are non-null</li> <li>inaccurate <code>size()</code> — <code>size()</code> is O(n) and maybe inaccurate, due to non-data nodes and concurrency</li> <li>atomicity for bulk operations — bulk operations <code>addAll</code>, <code>removeAll</code>, <code>retainAll</code>, <code>containsAll</code>, <code>equals</code>, and <code>toArray</code> are not guaranteed to be performed atomically</li> <li>iterators are weakly consistent — may or may not reflect all modifications after construction, but will not return a value twice</li></ul></li> <li><p><code>java.util.concurrent.ConcurrentLinkedQueue</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcurrentLinkedQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">implements</span> <span class="token class-name">Queue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span>
</code></pre></div><ul><li><a href="http://www.cs.rochester.edu/~scott/papers/1996_PODC_queues.pdf" target="_blank" rel="noopener noreferrer">Simple, Fast, and Practical Non-Blocking and Blocking Concurrent Queue Algorithms<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li> <li><p><code>java.util.concurrent.ConcurrentLinkedDeque</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcurrentLinkedDeque</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractCollection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">implements</span> <span class="token class-name">Deque</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span>
</code></pre></div></li> <li><p><code>java.util.concurrent.ConcurrentSkipListSet</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcurrentSkipListSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">implements</span> <span class="token class-name">NavigableSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span>
</code></pre></div></li> <li><p><code>java.util.concurrent.ConcurrentSkipListMap</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcurrentSkipListMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">implements</span> <span class="token class-name">ConcurrentNavigableMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span>
</code></pre></div></li> <li><p><code>java.util.concurrent.ConcurrentHashMap</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">implements</span> <span class="token class-name">ConcurrentMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span>
</code></pre></div><ul><li>fully interoperable with <code>Hashtable</code></li> <li><code>concurrencyLevel</code> — the estimated number of concurrently updating threads, defaults to 16, other write threads will be blocked if the number exceeded</li> <li><code>long mappingCount()</code> — used in lieu of <code>size()</code> for <code>long</code>; an estimate, the actual count may differ if there are concurrent insertions or removals</li> <li>atomicity
<ul><li>value non-null -- <code>null</code> is for absent; if also for value, incompatible with the operation that use <code>synchronized</code> on the old value</li> <li>put -- <code>synchronized</code> on the old value, CAS if <code>null</code></li> <li>replace -- <code>synchronized</code> on the old value</li> <li>lambda -- <code>synchronized</code> on the old value, if <code>null</code>, CAS a dummy value and <code>synchronized</code> on the dummy value, compute lambda, set computed value, exit lock block</li> <li>use <code>ConcurrentHashMap&lt;String, LongAdder&gt;</code> with <code>putIfAbsent</code><div class="language-java extra-class"><pre class="language-java"><code>map<span class="token punctuation">.</span><span class="token function">putIfAbsent</span><span class="token punctuation">(</span>word<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LongAdder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">computeIfAbsent</span><span class="token punctuation">(</span>word<span class="token punctuation">,</span> k <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">LongAdder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// better</span>
</code></pre></div></li></ul></li> <li><code>parallelismThreshold</code> of bulk operations — if the map contains more elements than the threshold, the bulk operation is parallelized, fully utilize the <code>ForkJoinPool.commonPool()</code> if set to 1</li> <li><code>java.util.concurrent.ConcurrentMap</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ConcurrentMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li>concurrent set views
<ul><li><code>ConcurrentHashMap.KeySetView&lt;K,V&gt; keySet()</code><br> <code>ConcurrentHashMap.KeySetView&lt;K,V&gt; keySet(V mappedValue)</code></li> <li><code>static &lt;K&gt; ConcurrentHashMap.KeySetView&lt;K,Boolean&gt; newKeySet()</code><br> <code>static &lt;K&gt; ConcurrentHashMap.KeySetView&lt;K,Boolean&gt; newKeySet(int initialCapacity)</code></li></ul></li></ul></li></ol> <h3 id="copy-on-write-collections"><a href="#copy-on-write-collections" class="header-anchor">#</a> Copy on Write Collections</h3> <ol><li><p><code>java.util.concurrent.CopyOnWriteArrayList</code> — all mutative operations (add, set, and so on) are implemented by making a fresh copy of the underlying array</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CopyOnWriteArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">RandomAccess</span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span>
</code></pre></div><ul><li>tradeoff — efficient when traversal operations vastly outnumber mutations, and is useful when you cannot or don't want to synchronize traversals
<ul><li>comparaison to synchronized view — when frequent mutation is needed, synchronized view of <code>ArrayList</code> can outperform a <code>CopyOnWriteArrayList</code></li></ul></li> <li>snapshot iterator — iterator method uses a reference to the state of the array at the point that the iterator was created</li> <li>thread-safe — memory consistency</li></ul></li> <li><p><code>java.util.concurrent.CopyOnWriteArraySet</code> — a <code>Set</code> that uses an internal <code>CopyOnWriteArrayList</code> for all of its operations</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CopyOnWriteArraySet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">implements</span> <span class="token class-name">Serializable</span>
</code></pre></div></li></ol> <h2 id="callable-and-future"><a href="#callable-and-future" class="header-anchor">#</a> Callable and Future</h2> <ol><li><p><code>java.util.concurrent.Callable</code> — <code>Runnable</code> that can return a result and throw a checked exception</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@FunctionalInterface</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token class-name">V</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>methods for converting to <code>Callable</code> in <code>Executors</code></li></ul></li> <li><p><code>java.util.concurrent.Future</code> — result-bearing action that can be cancelled</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><code>V get()</code> — block until finish or exception
<ul><li>throws <code>InterruptedException</code>, <code>ExecutionException</code></li></ul></li> <li><code>V get(long timeout, TimeUnit unit)</code> — <code>TimeoutException</code> when timeout</li> <li><code>boolean cancel(boolean mayInterruptIfRunning)</code></li> <li><code>boolean isCancelled()</code></li> <li><code>boolean isDone()</code></li></ul></li> <li><p><code>java.util.concurrent.ScheduledFuture</code> — delayed <code>Future</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ScheduledFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">extends</span> <span class="token class-name">Delayed</span><span class="token punctuation">,</span> <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p><code>java.util.concurrent.FutureTask</code> — A cancellable asynchronous computation, or wrapper for <code>Callable</code> or <code>Runnable</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">RunnableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><code>java.util.concurrent.RunnableFuture</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">RunnableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">extends</span> <span class="token class-name">Runnable</span><span class="token punctuation">,</span> <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li>constructors
<ul><li><code>FutureTask(Callable&lt;V&gt; callable)</code></li> <li><code>FutureTask(Runnable runnable, V result)</code></li></ul></li></ul></li> <li><p><code>java.util.concurrent.ForkJoinTask</code> — see <a href="#Fork-Join">Fork-Join</a></p></li> <li><p><code>java.util.concurrent.CompletableFuture</code> — A <code>Future</code> that may be explicitly completed (setting its value and status), and may be used as a <code>CompletionStage</code>, supporting dependent functions and actions that trigger upon its completion (<code>Promise.then</code> in JS), can be async</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><code>async</code> suffixed methods — use <code>ForkJoinPool.commonPool</code>, or the <code>Executor</code> argument, all generated asynchronous tasks are instances of the marker interface <code>CompletableFuture.AsynchronousCompletionTask</code></li> <li>non-<code>async</code> methods — actions performed by the thread that completes the current <code>CompletableFuture</code>, or by any other caller of a completion method</li> <li>static methods
<ul><li><code>static CompletableFuture&lt;Void&gt; allOf(CompletableFuture&lt;?&gt;... cfs)</code></li> <li><code>static CompletableFuture&lt;Object&gt; anyOf(CompletableFuture&lt;?&gt;... cfs)</code></li> <li><code>static &lt;U&gt; CompletableFuture&lt;U&gt; completedFuture(U value)</code> — <code>Promise.resolve</code></li> <li><code>static &lt;U&gt; CompletableFuture&lt;U&gt; supplyAsync(Supplier&lt;U&gt; supplier)</code></li></ul></li> <li>explicitly complete
<ul><li><code>boolean cancel(boolean mayInterruptIfRunning)</code></li> <li><code>boolean complete(T value)</code></li> <li><code>boolean completeExceptionally(Throwable ex)</code></li> <li><code>void obtrudeException(Throwable ex)</code></li> <li><code>void obtrudeValue(T value)</code></li></ul></li> <li><code>Promise.prototype.then</code> <ul><li><code>CompletableFuture&lt;Void&gt; thenAccept(Consumer&lt;? super T&gt; action)</code> <ul><li><code>acceptEither</code></li> <li><code>thenAcceptBoth</code></li></ul></li> <li><code>&lt;U&gt; CompletableFuture&lt;U&gt; thenApply(Function&lt;? super T,? extends U&gt; fn)</code> <ul><li><code>applyToEither</code></li></ul></li> <li><code>CompletableFuture&lt;Void&gt; thenRun(Runnable action)</code> <ul><li><code>runAfterBoth</code></li> <li><code>runAfterEither</code></li></ul></li> <li><code>&lt;U,V&gt; CompletableFuture&lt;V&gt; thenCombine(CompletionStage&lt;? extends U&gt; other, BiFunction&lt;? super T,? super U,? extends V&gt; fn)</code></li> <li><code>&lt;U&gt; CompletableFuture&lt;U&gt; thenCompose(Function&lt;? super T,? extends CompletionStage&lt;U&gt;&gt; fn)</code></li></ul></li> <li><code>Promise.prototype.catch</code> <ul><li><code>CompletableFuture&lt;T&gt; exceptionally(Function&lt;Throwable,? extends T&gt; fn)</code></li></ul></li> <li><code>catch</code> and <code>then</code> <ul><li><code>&lt;U&gt; CompletableFuture&lt;U&gt; handle(BiFunction&lt;? super T,Throwable,? extends U&gt; fn)</code></li> <li><code>CompletableFuture&lt;T&gt; whenComplete(BiConsumer&lt;? super T,? super Throwable&gt; action)</code></li></ul></li> <li>get
<ul><li><code>T get()</code></li> <li><code>T get(long timeout, TimeUnit unit)</code></li> <li><code>T getNow(T valueIfAbsent)</code></li> <li><code>T join()</code></li></ul></li> <li>manage
<ul><li><code>int getNumberOfDependents()</code> — estimated</li> <li><code>boolean isCancelled()</code></li> <li><code>boolean isCompletedExceptionally()</code></li> <li><code>boolean isDone()</code></li></ul></li> <li>more</li></ul></li></ol> <h2 id="executors"><a href="#executors" class="header-anchor">#</a> Executors</h2> <ol><li><p>thread pool</p> <ul><li>constructing a new thread is expensive</li> <li>throttle the number of concurrent threads — huge number of threads can greatly degrade performance and even crash the virtual machine</li></ul></li> <li><p><code>java.util.concurrent.Executor</code> — decoupling task submission from the mechanics of how each task will be run</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Executor</span>
</code></pre></div><ul><li><code>void execute(Runnable command)</code></li></ul></li> <li><p><code>java.util.concurrent.ExecutorService</code> — <code>Executor</code> with methods to manage termination and produce <code>Future</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ExecutorService</span> <span class="token keyword">extends</span> <span class="token class-name">Executor</span>
</code></pre></div><ul><li><code>&lt;T&gt; Future&lt;T&gt; submit(Callable&lt;T&gt; task)</code><br> <code>Future&lt;?&gt; submit(Runnable task)</code><br> <code>&lt;T&gt; Future&lt;T&gt; submit(Runnable task, T result)</code></li> <li><code>boolean awaitTermination(long timeout, TimeUnit unit)</code></li> <li><code>invokeAll</code>, <code>invokeAny</code>, with timeout version
<ul><li><code>&lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)</code><br> <code>&lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks, long timeout, TimeUnit unit)</code></li> <li><code>&lt;T&gt; T invokeAny(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)</code><br> <code>&lt;T&gt; T invokeAny(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks, long timeout, TimeUnit unit)</code></li></ul></li> <li><code>void shutdown()</code><br> <code>List&lt;Runnable&gt; shutdownNow()</code></li> <li><code>java.util.concurrent.AbstractExecutorService</code> — default implementations of <code>ExecutorService</code> execution methods<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractExecutorService</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">ExecutorService</span>
</code></pre></div></li></ul></li> <li><p><code>java.util.concurrent.ExecutorCompletionService</code> — lightweight blocking queue that decouples the production of new asynchronous tasks from the consumption of the results of completed tasks</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExecutorCompletionService</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">CompletionService</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>constructors
<ul><li><code>ExecutorCompletionService(Executor executor)</code></li> <li><code>ExecutorCompletionService(Executor executor, BlockingQueue&lt;Future&lt;V&gt;&gt; completionQueue)</code></li></ul></li> <li><code>Future&lt;V&gt; poll()</code> — <code>null</code> if none are present<br> <code>Future&lt;V&gt; poll(long timeout, TimeUnit unit)</code></li> <li><code>Future&lt;V&gt; submit(Callable&lt;V&gt; task)</code><br> <code>Future&lt;V&gt; submit(Runnable task, V result)</code></li> <li><code>Future&lt;V&gt; take()</code> — wait if none are present</li></ul></li> <li><p><code>java.util.concurrent.ScheduledExecutorService</code> — <code>ExecutorService</code> that can schedule commands to run after a given delay, or to execute periodically</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ScheduledExecutorService</span> <span class="token keyword">extends</span> <span class="token class-name">ExecutorService</span>
</code></pre></div><ul><li><code>&lt;V&gt; ScheduledFuture&lt;V&gt; schedule(Callable&lt;V&gt; callable, long delay, TimeUnit unit)</code></li> <li><code>ScheduledFuture&lt;?&gt; schedule(Runnable command, long delay, TimeUnit unit)</code></li> <li><code>ScheduledFuture&lt;?&gt; scheduleAtFixedRate(Runnable command, long initialDelay, long period, TimeUnit unit)</code></li> <li><code>ScheduledFuture&lt;?&gt; scheduleWithFixedDelay(Runnable command, long initialDelay, long delay, TimeUnit unit)</code></li></ul></li> <li><p><code>java.util.concurrent.ThreadPoolExecutor</code> — <code>ExecutorService</code> that executes each submitted task using one of possibly several pooled threads</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadPoolExecutor</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractExecutorService</span>
</code></pre></div><ul><li>creation — returned by <code>Executors.newCachedThreadPool()</code>, <code>Executors.newFixedThreadPool(int)</code>, <code>Executors.newSingleThreadExecutor()</code></li> <li>reject policies when task queue overflow, as static inner classes
<ul><li><code>ThreadPoolExecutor.AbortPolicy</code> -- <code>RejectedExecutionException</code></li> <li><code>ThreadPoolExecutor.CallerRunsPolicy</code></li> <li><code>ThreadPoolExecutor.DiscardOldestPolicy</code></li> <li><code>ThreadPoolExecutor.DiscardPolicy</code></li></ul></li> <li>more</li></ul></li> <li><p><code>java.util.concurrent.ScheduledThreadPoolExecutor</code> — <code>ThreadPoolExecutor</code> that can additionally schedule commands to run after a given delay, or to execute periodically, preferable to <code>java.util.Timer</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ScheduledThreadPoolExecutor</span> <span class="token keyword">extends</span> <span class="token class-name">ThreadPoolExecutor</span>
<span class="token keyword">implements</span> <span class="token class-name">ScheduledExecutorService</span>
</code></pre></div><ul><li>creation — returned by <code>Executors.newScheduledThreadPool(int)</code>, <code>Executors.newSingleThreadScheduledExecutor()</code></li></ul></li> <li><p><code>java.util.concurrent.ForkJoinPool</code> — see <a href="#Fork-Join">Fork-Join</a></p></li> <li><p><code>java.util.concurrent.Executors</code> — factory and utility methods</p> <ul><li>thread pools
<ul><li><code>static ExecutorService newCachedThreadPool()</code> — new threads are created as needed; idle threads are kept for 60 seconds<br> <code>static ExecutorService newCachedThreadPool(ThreadFactory threadFactory)</code></li> <li><code>static ExecutorService newFixedThreadPool(int nThreads)</code> — contains a fixed set of threads; tasks kept in a queue when overloaded; idle threads are kept indefinitely<br> <code>static ExecutorService newFixedThreadPool(int nThreads, ThreadFactory threadFactory)</code></li> <li><code>static ScheduledExecutorService newScheduledThreadPool(int corePoolSize)</code> — fixed-thread pool for scheduled execution; a replacement for <code>java.util.Timer</code><br> <code>static ScheduledExecutorService newScheduledThreadPool(int corePoolSize, ThreadFactory threadFactory)</code></li> <li><code>static ExecutorService newSingleThreadExecutor()</code> — a “pool” with a single thread that executes the submitted tasks sequentially<br> <code>static ExecutorService newSingleThreadExecutor(ThreadFactory threadFactory)</code></li> <li><code>static ScheduledExecutorService newSingleThreadScheduledExecutor()</code> — scheduled version of <code>newSingleThreadExecutor</code> <code>static ScheduledExecutorService newSingleThreadScheduledExecutor(ThreadFactory threadFactory)</code></li> <li><code>static ExecutorService newWorkStealingPool()</code>-- <code>ForkJoinPool</code><br> <code>static ExecutorService newWorkStealingPool(int parallelism)</code></li> <li><code>java.util.concurrent.ThreadFactory</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ThreadFactory</span> <span class="token punctuation">{</span>
    <span class="token class-name">Thread</span> <span class="token function">newThread</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul></li> <li>methods for conversion to <code>Callable</code> -- from <code>Runnable</code>, <code>PrivilegedAction</code>, <code>PrivilegedExceptionAction</code></li> <li>more</li></ul></li></ol> <h3 id="fork-join"><a href="#fork-join" class="header-anchor">#</a> Fork-Join</h3> <ol><li><p>fork-join framework</p> <ul><li>work stealing
<ul><li>task queue — each thread has a deque for tasks, and pushes subtasks onto the head, LIFO</li> <li>work stealing — when a worker thread is idle, it “steals” a task from the tail of another deque
<ul><li>stealing is rare -- since large subtasks are at the tail, such stealing is rare</li> <li>stealing is expensive -- context switch between threads, even between CPUs if not the same core</li> <li>only steal from adjacent thread to mitigate contention</li></ul></li> <li><code>ForkJoinPool</code> employing work stealing — efficient for recursive tasks, and event-style tasks (especially <code>asyncMode</code> for the latter)</li></ul></li> <li>use and limitations
<ul><li>high volume — Huge numbers of tasks and subtasks may be hosted by a small number of actual threads in a <code>ForkJoinPool</code>. The pool attempts to maintain enough active (or available) threads by dynamically adding, suspending, or resuming internal worker threads, even if some tasks are stalled waiting to join others</li> <li>no side effect — main use as computational tasks calculating pure functions or operating on purely isolated objects</li> <li>avoid <code>synchronized</code> methods or blocks — should minimize other blocking synchronization apart from joining other tasks or using synchronizers such as Phasers. Subdividable tasks should also not perform blocking I/O, and should ideally access variables that are completely independent of those accessed by other running tasks</li> <li>define and use <code>ForkJoinTasks</code> that may block — three further considerations
<ul><li>independent — completion of few other tasks should be dependent on a task that blocks on external synchronization or I/O</li> <li>small blocking tasks — to minimize resource impact, tasks should be small; ideally performing only the (possibly) blocking action</li> <li>ensure progress — ensure the number of possibly blocked tasks fewer than <code>ForkJoinPool.getParallelism()</code>, or use <code>ForkJoinPool.ManagedBlocker</code></li></ul></li> <li>loosely enforced guideline — by not permitting checked exceptions such as <code>IOException</code> to be thrown</li> <li>like a call (fork) and return (join) from a parallel recursive function — <code>a.fork(); b.fork(); b.join(); a.join();</code> is likely to be substantially more efficient than <code>a.join(); b.join()</code></li> <li>task size rule of thumb — a task should perform more than 100 and less than 10000 basic computational steps</li></ul></li> <li>dependency
<ul><li>who fork who join -- parent thread must join all its forks</li> <li>unordered join -- forks from the same parent thread can be joined in arbitrary order</li> <li>join all before being joined -- a thread can be joined only when all its forks joined</li></ul></li></ul></li> <li><p><code>java.util.concurrent.ForkJoinTask</code> — tasks that run within a <code>ForkJoinPool</code>, a thread-like entity but much lighter, lightweight form of <code>Future</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">ForkJoinTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span>
</code></pre></div><ul><li>constructors (adaptors)
<ul><li><code>static &lt;T&gt; ForkJoinTask&lt;T&gt; adapt(Callable&lt;? extends T&gt; callable)</code></li> <li><code>static ForkJoinTask&lt;?&gt; adapt(Runnable runnable)</code></li> <li><code>static &lt;T&gt; ForkJoinTask&lt;T&gt; adapt(Runnable runnable, T result)</code></li></ul></li> <li>exceptions — may still encounter unchecked exceptions, which are rethrown to callers join them
<ul><li><code>java.util.concurrent.RejectedExecutionException</code> — internal resource exhaustion</li></ul></li> <li>awaiting completion and extracting results
<ul><li><code>ForkJoinTask&lt;V&gt; fork()</code> — Arranges to asynchronously execute this task in the pool the current task is running in, if applicable, or using the <code>ForkJoinPool.commonPool()</code> if not <code>inForkJoinPool()</code>.</li> <li><code>V join()</code> — Returns the result of the computation when it is done</li> <li>inherited <code>Future::get</code>, but throws checked exception</li> <li><code>V invoke()</code> — semantically equivalent to <code>fork(); join()</code> but always attempts to begin execution in the current thread</li> <li><code>invokeAll</code> <ul><li><code>static &lt;T extends ForkJoinTask&lt;?&gt;&gt; Collection&lt;T&gt; invokeAll(Collection&lt;T&gt; tasks)</code> — forking a set of tasks and joining them all</li> <li><code>static void invokeAll(ForkJoinTask&lt;?&gt;... tasks)</code></li> <li><code>static void invokeAll(ForkJoinTask&lt;?&gt; t1, ForkJoinTask&lt;?&gt; t2)</code></li></ul></li> <li>quietly — do not extract results or report exceptions, useful when expecting delayed processing of results or exceptions until all complete
<ul><li><code>void quietlyComplete()</code></li> <li><code>void quietlyInvoke()</code></li> <li><code>void quietlyJoin()</code></li></ul></li></ul></li> <li>execution status
<ul><li><code>boolean isCancelled()</code> — in which case <code>getException()</code> returns a <code>CancellationException</code></li> <li><code>boolean isCompletedAbnormally()</code></li> <li><code>boolean isCompletedNormally()</code></li> <li><code>boolean isDone()</code> — normally, abnormally or cancelled</li></ul></li> <li>manage circular dependency
<ul><li><code>void complete(V value)</code><br> <code>void completeExceptionally(Throwable ex)</code></li> <li><code>static void helpQuiesce()</code> — Possibly executes tasks until the pool hosting the current task is quiescent.</li></ul></li> <li>extending — extend one of the abstract classes that support a particular style of fork/join processing, defines a <code>compute</code> method that somehow uses the control methods supplied by this base class
<ul><li>tags — for use of specialized subclasses</li> <li>base <code>final</code> support methods — should minimally implement protected methods</li> <li><code>java.util.concurrent.RecursiveAction</code> — A recursive resultless <code>ForkJoinTask</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">RecursiveAction</span> <span class="token keyword">extends</span> <span class="token class-name">ForkJoinTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><code>java.util.concurrent.RecursiveTask</code> — A recursive result-bearing <code>ForkJoinTask</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">RecursiveTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">ForkJoinTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><code>java.util.concurrent.CountedCompleter</code> — completed actions trigger other actions<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">CountedCompleter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">ForkJoinTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>tbd</li></ul></li></ul></li></ul></li> <li><p><code>java.util.concurrent.ForkJoinPool</code> — provides the entry point for submissions from non-<code>ForkJoinTask</code> clients, as well as management and monitoring operations</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ForkJoinPool</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractExecutorService</span>
</code></pre></div><ul><li><code>static ForkJoinPool commonPool()</code> — used by any <code>ForkJoinTask</code> that is not explicitly submitted to a specified pool, threads are slowly reclaimed during periods of non-use, and reinstated upon subsequent use</li> <li><code>static void managedBlock(ForkJoinPool.ManagedBlocker blocker)</code></li> <li><code>ForkJoinPool.ManagedBlocker</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">interface</span> <span class="token class-name">ManagedBlocker</span> <span class="token punctuation">{</span>
    <span class="token keyword">boolean</span> <span class="token function">block</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> <span class="token function">isReleasable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul></li></ol> <h2 id="synchronizers"><a href="#synchronizers" class="header-anchor">#</a> Synchronizers</h2> <ol><li><p>Memory consistency effects — happen-before, see <a href="#volatile-and-Atomics">volatile</a></p></li> <li><p><code>AbstractQueuedSynchronizer::compareAndSetState</code> -- uses <code>VarHandle::compareAndSet</code></p> <ul><li>CLH lock queue -- the thread appends itself to the waiting queue and spins on the variable that can be updated only by the thread preceding it in the queue
<ul><li>Java uses CLH locks for blocking synchronizers, but with the same tactic, see javadoc for <code>AbstractQueuedSynchronizer.Node</code></li></ul></li> <li><code>java.util.concurrent.locks.LockSupport</code> -- basic thread blocking primitives for creating locks and other synchronization classes
<ul><li>underlying -- <code>jdk.internal.misc.Unsafe::park</code>, <code>Unsafe::unpark</code></li> <li><code>static void park(Object blocker)</code> -- park current thread, wrapped by set and unset <code>Thread.parkBlocker</code></li> <li><code>static void unpark(Thread thread)</code></li></ul></li></ul></li></ol> <h3 id="count-synchronizers"><a href="#count-synchronizers" class="header-anchor">#</a> Count Synchronizers</h3> <ol><li><p><code>java.util.concurrent.Semaphore</code> — Allows a set of threads to wait until permits are available for proceeding, often used to restrict the number of threads than can access some (physical or logical) resource</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Semaphore</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span>
</code></pre></div><ul><li>use
<ul><li>permit — a count, can be acquired or released, by any caller</li> <li>binary semaphore — mutex lock, but without ownership</li> <li>multiple permits methods — increased risk of indefinite postponement when used without fairness</li> <li>fairness — FIFO by the order of executing of specific internal points in <code>acquire</code> methods</li></ul></li> <li>constructors
<ul><li><code>Semaphore(int permits)</code></li> <li><code>Semaphore(int permits, boolean fair)</code></li></ul></li> <li>release — Releases a permit, returning it to the semaphore
<ul><li><code>void release()</code></li> <li><code>void release(int permits)</code></li></ul></li> <li>acquire — Acquires a permit from this semaphore, blocking until one is available, or the thread is interrupted
<ul><li><code>void acquire()</code></li> <li><code>void acquire(int permits)</code></li> <li><code>boolean tryAcquire()</code> — return immediately, regardless of fairness</li> <li><code>boolean tryAcquire(int permits)</code></li> <li><code>boolean tryAcquire(int permits, long timeout, TimeUnit unit)</code></li> <li><code>boolean tryAcquire(long timeout, TimeUnit unit)</code></li></ul></li> <li>underlying implementation -- <code>AbstractQueuedSynchronizer::compareAndSetState</code></li></ul></li> <li><p><code>java.util.concurrent.CountDownLatch</code> — Allows a set of threads to wait until a count has been decremented to 0, and the count cannot be increased</p> <ul><li>constructor — <code>CountDownLatch(int count)</code></li> <li><code>void await()</code> — Causes the current thread to wait until the latch has counted down to zero and return immediately upon subsequent call, unless the thread is interrupted<br> <code>boolean await(long timeout, TimeUnit unit)</code></li> <li><code>void countDown()</code> — decrements the count of the latch, releasing all waiting threads if the count reaches zero</li> <li><code>long getCount()</code></li> <li>underlying implementation -- <code>AbstractQueuedSynchronizer::compareAndSetState</code></li></ul></li> <li><p><code>java.util.concurrent.CyclicBarrier</code> — Allows a set of threads to wait until a predefined count of them has reached a common barrier, and then optionally executes a barrier action, and the count is reset</p> <ul><li>all-or-none — If a thread leaves a barrier point prematurely and exceptionally, all other threads waiting at that barrier point will also leave abnormally via <code>BrokenBarrierException</code> (or <code>InterruptedException</code> if they too were interrupted at about the same time)</li> <li>constructors
<ul><li><code>CyclicBarrier(int parties)</code></li> <li><code>CyclicBarrier(int parties, Runnable barrierAction)</code></li></ul></li> <li><code>int await()</code> — Waits until all parties have invoked <code>await</code> on this barrier, returns the arrival index of that thread at the barrier<br> <code>int await(long timeout, TimeUnit unit)</code></li> <li><code>int getNumberWaiting()</code></li> <li><code>int getParties()</code> — the number of parties required to trip this barrier</li> <li><code>boolean isBroken()</code> — Queries if this barrier is in a broken state</li> <li><code>void reset()</code></li> <li>underlying implementation -- <code>ReentrantLock</code></li></ul></li> <li><p><code>java.util.concurrent.Phaser</code> — Like a cyclic barrier, but with a mutable party count, and can have multiple phases with phase number cycling from 0 to <code>Integer.MAX_VALUE</code></p> <ul><li>constructors
<ul><li><code>Phaser()</code> — 0 parties, phase number 0</li> <li><code>Phaser(int parties)</code></li> <li><code>Phaser(Phaser parent)</code></li> <li><code>Phaser(Phaser parent, int parties)</code></li></ul></li> <li>registration — change number of parties
<ul><li><code>int register()</code> — Adds a new unarrived party to this phaser</li> <li><code>int bulkRegister(int parties)</code> — Adds the given number of new unarrived parties to this phaser</li></ul></li> <li>tree tiering — children automatically register with and deregister from their parents according to the their numbers of registered parties
<ul><li><code>Phaser getParent()</code> — Returns the parent of this phaser, or null if none</li> <li><code>Phaser getRoot()</code> — Returns the root ancestor of this phaser, which is the same as this phaser if it has no parent</li></ul></li> <li>arrive — When the final party for a given phase arrives, an optional <code>onAdvance</code> is performed and the phase advances (phase number +1)
<ul><li><code>int arrive()</code> — Arrives at this phaser, without waiting for others to arrive</li> <li><code>int arriveAndAwaitAdvance()</code> — Arrives at this phaser and awaits others</li> <li><code>int arriveAndDeregister()</code> — Arrives at this phaser and deregisters from it without waiting for others to arrive</li></ul></li> <li>await — wait at a specific phase, returns when the phaser advances to (or is already at) a different phase
<ul><li><code>int awaitAdvance(int phase)</code> — Awaits the phase of this phaser to advance from the given phase value, returning immediately if the current phase is not equal to the given phase value or this phaser is terminated</li> <li><code>int awaitAdvanceInterruptibly(int phase)</code></li> <li><code>int awaitAdvanceInterruptibly(int phase, long timeout, TimeUnit unit)</code></li></ul></li> <li>termination — triggered when <code>onAdvance</code> returns <code>true</code>. Upon termination, all synchronization methods immediately return a negative integer and registration takes no effect
<ul><li><code>void forceTermination()</code> — Forces this phaser to enter termination state</li> <li><code>boolean isTerminated()</code> — Returns true if this phaser has been terminated</li></ul></li> <li>monitoring
<ul><li><code>int getArrivedParties()</code> — Returns the number of registered parties that have arrived at the current phase of this phaser</li> <li><code>int getPhase()</code> — Returns the current phase number</li> <li><code>int getRegisteredParties()</code> — Returns the number of parties registered at this phaser</li> <li><code>int getUnarrivedParties()</code> — Returns the number of registered parties that have not yet arrived at the current phase of this phaser</li></ul></li> <li><code>protected boolean onAdvance(int phase, int registeredParties)</code> — Overridable method to perform an action upon impending phase advance, and to control termination<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">return</span> registeredParties <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// default implementation</span>
</code></pre></div></li> <li>underlying implementation -- <code>VarHandle::compareAndSetState</code></li></ul></li></ol> <h3 id="data-exchange-synchronizers"><a href="#data-exchange-synchronizers" class="header-anchor">#</a> Data Exchange Synchronizers</h3> <ol><li><p><code>java.util.concurrent.Exchanger</code> — Allows two threads to exchange objects when both are ready for the exchange, a bidirectional form of a <code>SynchronousQueue</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Exchanger</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
</code></pre></div><ul><li><code>V exchange(V x)</code> — Waits for another thread to arrive at this exchange point (unless the current thread is interrupted), and then transfers the given object to it, receiving its object in return</li> <li><code>V exchange(V x, long timeout, TimeUnit unit)</code></li></ul></li> <li><p><code>java.util.concurrent.SynchronousQueue</code> — a mechanism that pairs up producer and consumer threads, a blocking queue in which each insert operation must wait for a corresponding remove operation by another thread, and vice versa</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SynchronousQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">extends</span> <span class="token class-name">AbstractQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">implements</span> <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span>
</code></pre></div><ul><li>empty queue — no internal capacity</li> <li>non-null</li> <li>constructors
<ul><li><code>SynchronousQueue()</code> — LIFO for non-fair mode</li> <li><code>SynchronousQueue(boolean fair)</code> — FIFO for fairness, performance is similar for this collection</li></ul></li> <li><code>E poll()</code> — 0 timeout</li> <li>other inherited methods</li></ul></li></ol> <h1 id="text"><a href="#text" class="header-anchor">#</a> Text</h1> <ol><li><p><code>String</code> — see <a href="#String"><code>String</code></a></p></li> <li><p><code>Character</code> — see also <a href="#primitive-types">char</a></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Character</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Serializable</span><span class="token punctuation">,</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Character</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>general category in the <a href="http://unicode.org/reports/tr44/#General_Category_Values" target="_blank" rel="noopener noreferrer">Unicode specification<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <ul><li>defined in static fields as <code>byte</code></li> <li><code>static int getType(char ch)</code></li> <li><code>static int getType(int codePoint)</code></li></ul></li> <li>wrapping and outboxing
<ul><li><code>Character(char value)</code></li> <li><code>static Character valueOf(char c)</code></li> <li><code>char charValue()</code></li></ul></li> <li>conversion between code points
<ul><li>casts and <code>0 + 'a'</code></li> <li><code>static char[] toChars(int codePoint)</code></li> <li><code>static int toChars(int codePoint, char[] dst, int dstIndex)</code></li> <li><code>static int toCodePoint(char high, char low)</code></li> <li><code>codePointAt</code></li> <li><code>codePointBefore</code></li> <li><code>codePointCount</code></li> <li><code>static char forDigit(int digit, int radix)</code> — 1 to <code>'1'</code>, 10 to <code>'a'</code> etc.</li> <li><code>static int getNumericValue(char ch)</code> — also for characters like <code>Ⅺ</code> (Roman number)<br> <code>static int getNumericValue(int codePoint)</code></li></ul></li> <li><code>Character.UnicodeScript</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">enum</span> <span class="token class-name">UnicodeScript</span>
</code></pre></div><ul><li>script names — enum constants</li> <li><code>static Character.UnicodeScript forName(String scriptName)</code></li> <li><code>static Character.UnicodeScript of(int codePoint)</code></li></ul></li> <li><code>Character.UnicodeBlock</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Character</span><span class="token punctuation">.</span><span class="token class-name">UnicodeBlock</span>
<span class="token keyword">extends</span> <span class="token class-name">Character</span><span class="token punctuation">.</span><span class="token class-name">Subset</span>
</code></pre></div><ul><li>Unicode character block names — static fields</li> <li><code>static Character.UnicodeBlock forName(String blockName)</code></li> <li><code>static Character.UnicodeBlock of(char c)</code></li> <li><code>static Character.UnicodeBlock of(int codePoint)</code></li></ul></li> <li><code>Character.Subset</code> — for extending, represents particular subsets of the Unicode character set</li> <li>more</li></ul></li> <li><p><code>java.nio.charset.Charset</code> — A named mapping between sequences of sixteen-bit Unicode code units and sequences of byte</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Charset</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Charset</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><code>static Charset defaultCharset()</code></li></ul></li> <li><p><code>java.text.StringCharacterIterator</code></p></li></ol> <h2 id="regex"><a href="#regex" class="header-anchor">#</a> Regex</h2> <h3 id="regex-syntax"><a href="#regex-syntax" class="header-anchor">#</a> Regex Syntax</h3> <h4 id="characters-and-character-classes"><a href="#characters-and-character-classes" class="header-anchor">#</a> Characters and Character Classes</h4> <ol><li><p>characters</p> <ul><li><code>\0n</code>, <code>\0nn</code>, <code>\0mnn</code> — ASCII (0~255 or 0~0o377) in octal</li> <li><code>\xhh</code>, <code>\uhhhh</code>, <code>\x{h...h}</code> — hexadecimal unicode</li> <li><code>\t</code>, <code>\n</code>, <code>\r</code></li> <li><code>\f</code> — form feed <code>\x0c</code></li> <li><code>\a</code> — alert (bell), <code>\x07</code></li> <li><code>\e</code> — escape, <code>\x1b</code></li> <li><code>\cx</code> — control character, <code>\ch</code> for <code>ctrl-h</code> (backspace, <code>\x08</code>)</li> <li><code>\R</code> (matcher) — any Unicode line break sequence, is equivalent to <code>\r\n|[\n\u000B\f\r\u0085\u2028\u2029]</code></li></ul></li> <li><p>character classes</p> <ul><li><code>[a-zA-Z]</code> — a through z or A through Z, inclusive (range)</li> <li><code>[a-d[m-p]]</code> — a through d, or m through p: <code>[a-dm-p]</code> (union)</li> <li><code>[a-z&amp;&amp;[def]]</code> — d, e, or f (intersection)</li> <li><code>[a-z&amp;&amp;[^bc]]</code> — a through z, except for b and c: <code>[ad-z]</code> (subtraction)</li> <li><code>[a-z&amp;&amp;[^m-p]]</code> — a through z, and not m through p: <code>[a-lq-z]</code> (subtraction)</li> <li><code>[\p{L}&amp;&amp;[^\p{Lu}]]</code> — any letter except an uppercase letter (subtraction)</li> <li>predefined non <code>\p</code> <ul><li><code>.</code> — any character, including line terminators if <code>DOTALL</code></li> <li><code>\d</code> — a digit: <code>[0-9]</code><br> <code>\D</code> — a non-digit: <code>[^0-9]</code></li> <li><code>\h</code> — a horizontal whitespace character: <code>[ \t\xA0\u1680\u180e\u2000-\u200a\u202f\u205f\u3000]</code><br> <code>\H</code> — a non-horizontal whitespace character: <code>[^\h]</code></li> <li><code>\s</code> — a whitespace character: <code>[ \t\n\x0B\f\r]</code><br> <code>\S</code> — a non-whitespace character: <code>[^\s]</code></li> <li><code>\v</code> — a vertical whitespace character: <code>[\n\x0B\f\r\x85\u2028\u2029]</code><br> <code>\V</code> — a non-vertical whitespace character: <code>[^\v]</code></li> <li><code>\w</code> — a word character: <code>[a-zA-Z_0-9]</code><br> <code>\W</code> — a non-word character: <code>[^\w]</code></li></ul></li></ul></li> <li><p>predefined character classes — <code>\p{prop}</code>, <code>\P{prop}</code> for negation, can be <code>\pX</code> if <code>prop</code> only takes one letter</p> <ul><li><a href="https://www.regular-expressions.info/unicode.html" target="_blank" rel="noopener noreferrer">Regex Tutorial - Unicode Characters and Properties<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>predefined POSIX ASCII, <code>\p{ASCII}</code> — all ASCII:<code>[\x00-\x7F]</code> <ul><li><code>\p{Print}</code> — a printable character: <code>[\p{Graph}\x20]</code> <ul><li><code>\p{Graph}</code> — a visible character: <code>[\p{Alnum}\p{Punct}]</code> <ul><li><code>\p{Punct}</code> — punctuation: One of <code>!&quot;#$%&amp;'()*+,-./:;&lt;=&gt;?@[\]^_{|}~</code> and backtick</li> <li><code>\p{Alnum}</code> — an alphanumeric character:<code>[\p{Alpha}\p{Digit}]</code> <ul><li><code>\p{Digit}</code> — a decimal digit: <code>[0-9]</code> or <code>\d</code></li> <li><code>\p{XDigit}</code> — a hexadecimal digit: <code>[0-9a-fA-F]</code></li> <li><code>\p{Alpha}</code> — an alphabetic character:<code>[\p{Lower}\p{Upper}]</code> <ul><li><code>\p{Lower}</code> — a lower-case alphabetic character: <code>[a-z]</code></li> <li><code>\p{Upper}</code> — an upper-case alphabetic character:<code>[A-Z]</code></li></ul></li></ul></li></ul></li></ul></li> <li><code>\p{Blank}</code> — a space or a tab: <code>[ \t]</code></li> <li><code>\p{Cntrl}</code> — a control character: <code>[\x00-\x1F\x7F]</code></li> <li><code>\p{Space}</code> — a whitespace character: <code>[ \t\n\x0B\f\r]</code></li></ul></li> <li>predefined by <code>Character</code> methods
<ul><li><code>\p{javaLowerCase}</code> — Equivalent to <code>Character.isLowerCase()</code></li> <li><code>\p{javaUpperCase}</code> — Equivalent to <code>Character.isUpperCase()</code></li> <li><code>\p{javaWhitespace}</code> — Equivalent to <code>Character.isWhitespace()</code></li> <li><code>\p{javaMirrored}</code> — Equivalent to <code>Character.isMirrored()</code></li> <li>more</li></ul></li> <li>predefined Unicode properties
<ul><li><code>\p{IsLatin}</code> — a Latin script character (prefix <code>Is</code> with <code>Character.UnicodeScript</code> enum value)</li> <li><code>\p{InGreek}</code> — a character in the Greek block (prefix <code>In</code> with <code>Character.UnicodeBlock</code> static fields)</li> <li><code>\p{Lu}</code>, <code>\p{gc=Lu}</code> — an uppercase letter (<a href="http://unicode.org/reports/tr44/#General_Category_Values" target="_blank" rel="noopener noreferrer">general category<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, also partially documented in the javadoc of static fields in <code>Character</code>)</li> <li><code>\P{InGreek}</code> — any character except one in the Greek block (negation)</li> <li><code>\p{IsAlphabetic}</code> — an alphabetic character (binary property, <code>Is</code> prefix with below), conform with POSIX character classes when <code>UNICODE_CHARACTER_CLASS</code> <ul><li><code>Alphabetic</code></li> <li><code>Ideographic</code></li> <li><code>Letter</code></li> <li><code>Lowercase</code> — granted to conform with <code>\p{Lower}</code> when <code>UNICODE_CHARACTER_CLASS</code></li> <li><code>Uppercase</code></li> <li><code>Titlecase</code></li> <li><code>Punctuation</code></li> <li><code>Control</code></li> <li><code>White_Space</code></li> <li><code>Digit</code></li> <li><code>Hex_Digit</code></li> <li><code>Join_Control</code></li> <li><code>Noncharacter_Code_Point</code></li> <li><code>Assigned</code></li></ul></li></ul></li></ul></li></ol> <h4 id="matchers-quantifiers-and-others"><a href="#matchers-quantifiers-and-others" class="header-anchor">#</a> Matchers, Quantifiers and Others</h4> <ol><li><p>line break matcher <code>\R</code> — any Unicode line break sequence, is equivalent to <code>\r\n|[\n\u000B\f\r\u0085\u2028\u2029]</code></p> <ul><li><code>\u000B</code> — a vertical tab</li> <li><code>\u0085</code> — a next-line character</li> <li><code>\u2028</code> — a line-separator character</li> <li><code>\u2029</code> — a paragraph-separator character</li> <li>line terminator
<ul><li><code>\n</code>, <code>\r</code>, <code>\r\n</code></li> <li><code>\u0085</code>, <code>\u2028</code>, <code>\u2029</code></li></ul></li> <li>line terminator when <code>UNIX_LINES</code> — <code>\n</code></li></ul></li> <li><p>Boundary matchers</p> <ul><li><code>^</code> <code>$</code> — ignore line terminators and only match at the beginning and the end, respectively, of the entire input sequence; respect line terminators when <code>MULTILINE</code></li> <li><code>\b</code> — A word boundary</li> <li><code>\B</code> — A non-word boundary</li> <li><code>\A</code> — The beginning of the input</li> <li><code>\G</code> — The end of the previous match</li> <li><code>\Z</code> — The end of the input but for the final terminator, if any</li> <li><code>\z</code> — The end of the input</li></ul></li> <li><p>quantifiers</p> <ul><li>Greedy quantifiers</li> <li>Reluctant quantifiers — non-greedy</li> <li>Possessive quantifiers — greedy quantifiers that do not backtrack (no turning back to accommodate other parts of the pattern once matched)<div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Pattern</span><span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token string">&quot;.*+foo&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;xfooxxxxxxfoo&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// $1 ==&gt; false</span>
<span class="token class-name">Pattern</span><span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token string">&quot;.*foo&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;xfooxxxxxxfoo&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// $2 ==&gt; true</span>
</code></pre></div><ul><li><code>X?+</code></li> <li><code>X*+</code></li> <li><code>X++</code></li> <li><code>X{n}+</code></li> <li><code>X{n,}+</code></li> <li><code>X{n,m}+</code></li></ul></li></ul></li> <li><p>Logical operators</p> <ul><li><code>XY</code> — X followed by Y</li> <li><code>X|Y</code> — Either X or Y</li> <li><code>(X)</code> — X, as a capturing group</li></ul></li> <li><p>Back references</p> <ul><li><code>\n</code> — Whatever the nth capturing group matched</li> <li><code>\k&lt;name&gt;</code> — Whatever the named-capturing group &quot;name&quot; matched</li></ul></li> <li><p>capturing group and flags</p> <ul><li><code>((A)(B(C)))</code> — numbered by counting their opening parentheses from left to right<div class="language- extra-class"><pre class="language-text"><code>1    ((A)(B(C)))
2    (A)
3    (B(C))
4    (C)
</code></pre></div><ul><li><code>\0</code> — stands for the entire expression</li> <li>if quantification — most recently matched</li></ul></li> <li><code>(?&lt;name&gt;X)</code> — X, as a named-capturing group, name matches <code>\p{Alpha}\p{Alnum}*</code></li> <li><code>(?idmsuxU-idmsuxU)</code> — Nothing, but turns match flags <code>i</code> <code>d</code> <code>m</code> <code>s</code> <code>u</code> <code>x</code> <code>U</code> on - off</li> <li><code>(?:X)</code> — X, as a non-capturing group
<ul><li><code>(?idmsux-idmsux:X)</code> — X, as a non-capturing group with the given flags i d m s u x on - off</li></ul></li> <li><code>(?&gt;X)</code> — X, as an independent, non-capturing group, similar to possessive quantifiers<div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Pattern</span><span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token string">&quot;a(?&gt;bc|b)c&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;abc&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// $1 ==&gt; false</span>
<span class="token class-name">Pattern</span><span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token string">&quot;a(?&gt;bc|b)c&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;abcc&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// $2 ==&gt; true</span>
</code></pre></div><ul><li>optimization — more performance for patterns like <code>(?&gt;.*\/)(.*)</code>, <code>\b(integer|insert|in)\b</code></li> <li>order — for &quot;insert&quot;, <code>\b(?&gt;integer|insert|in)\b</code> matches but <code>\b(?&gt;in|integer|insert)\b</code> does not match</li></ul></li></ul></li> <li><p>Quotation</p> <ul><li><code>\</code> — Nothing, but quotes the following character</li> <li><code>\Q...\E</code> — Nothing, but quotes all characters until \E</li></ul></li> <li><p>assertion</p> <ul><li><code>(?=X)</code> — X, via zero-width positive lookahead</li> <li><code>(?!X)</code> — X, via zero-width negative lookahead</li> <li><code>(?&lt;=X)</code> — X, via zero-width positive lookbehind</li> <li><code>(?&lt;!X)</code> — X, via zero-width negative lookbehind</li></ul></li></ol> <h3 id="regex-classes"><a href="#regex-classes" class="header-anchor">#</a> Regex Classes</h3> <ol><li><p><code>java.util.regex.Pattern</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Pattern</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Serializable</span>
</code></pre></div><ul><li>flags — bit vector
<ul><li>encoding and case
<ul><li><code>static int CANON_EQ</code> — canonical equivalence, e.g. <code>a\u030A</code> and <code>å</code></li> <li><code>static int CASE_INSENSITIVE</code> — <code>(?i)</code>, only for US ASCII</li> <li><code>static int UNICODE_CASE</code> - <code>(?u)</code>, also Unicode-aware case folding when <code>i</code></li> <li><code>static int UNICODE_CHARACTER_CLASS</code> — <code>(?U)</code>, implies <code>u</code>, select Unicode character classes instead of POSIX, see before</li></ul></li> <li>line terminator
<ul><li><code>static int DOTALL</code> — <code>(?s)</code>, make <code>.</code> match line terminators</li> <li><code>static int MULTILINE</code> — <code>(?m)</code>, make <code>^</code> and <code>$</code> match multiple lines</li> <li><code>static int UNIX_LINES</code> — <code>(?d)</code>, only <code>\n</code> as line terminator for <code>.</code>, <code>^</code>, <code>$</code></li></ul></li> <li>literal and comments
<ul><li><code>static int LITERAL</code> — literal parsing of meta characters or escape sequences, only <code>u</code> and <code>i</code> flag work in this mode</li> <li><code>static int COMMENTS</code> — <code>(?x)</code>, ignore white spaces and comments which start with <code>#</code></li></ul></li></ul></li> <li>creation
<ul><li><code>static Pattern compile(String regex)</code></li> <li><code>static Pattern compile(String regex, int flags)</code></li> <li><code>static String quote(String s)</code> — quote with <code>\Q...\E</code></li></ul></li> <li>use
<ul><li><code>static boolean matches(String regex, CharSequence input)</code></li> <li><code>String::split</code></li> <li><code>String[] split(CharSequence input)</code></li> <li><code>String[] split(CharSequence input, int limit)</code></li> <li><code>Stream&lt;String&gt; splitAsStream(CharSequence input)</code></li> <li><code>Matcher matcher(CharSequence input)</code></li> <li><code>Predicate&lt;String&gt; asPredicate()</code></li></ul></li> <li>get info
<ul><li><code>int flags()</code></li> <li><code>String pattern()</code></li> <li><code>String toString()</code></li></ul></li></ul></li> <li><p><code>interface java.util.regex.MatchResult</code> — group related, defaults to using group 0, available if match succeeds</p> <ul><li>starting index and the past-the-end index
<ul><li><code>int end()</code></li> <li><code>int end(int group)</code></li> <li><code>int start()</code></li> <li><code>int start(int group)</code></li></ul></li> <li>group
<ul><li><code>String group()</code></li> <li><code>String group(int group)</code></li> <li><code>int groupCount()</code></li></ul></li></ul></li> <li><p><code>java.util.regex.Matcher</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Matcher</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">MatchResult</span>
</code></pre></div><ul><li>match operation — <code>MatchResult</code> available if succeeds
<ul><li><code>boolean matches()</code> — match the entire region</li> <li><code>boolean lookingAt()</code> — <code>matches()</code> but does not require the entire region be matched</li> <li><code>boolean find()</code> — find from the first character not matched by the previous match</li> <li><code>boolean find(int start)</code> — reset and find from <code>start</code></li> <li>replace methods</li></ul></li> <li>reset — discards its explicit state information and sets the append position to zero
<ul><li><code>boolean find(int start)</code> — reset and find from <code>start</code></li> <li><code>Matcher reset()</code></li> <li><code>Matcher reset(CharSequence input)</code> — reset with a new input sequence</li></ul></li> <li><code>MatchResult</code> <ul><li>methods in <code>MatchResult</code></li> <li><code>int end(String name)</code></li> <li><code>String group(String name)</code></li> <li><code>int start(String name)</code></li> <li><code>MatchResult toMatchResult()</code> — result unaffected by subsequent operations</li> <li><code>boolean requireEnd()</code> — whether more input could change a positive match into a negative one</li></ul></li> <li>region — the region of input to match against
<ul><li><code>Matcher region(int start, int end)</code></li> <li><code>int regionEnd()</code></li> <li><code>int regionStart()</code></li> <li><code>Matcher useAnchoringBounds(boolean b)</code> — defaults to using anchoring bounds, the boundaries of the region match anchors such as <code>^</code> and <code>$</code></li> <li><code>boolean hasAnchoringBounds()</code></li> <li><code>Matcher useTransparentBounds(boolean b)</code> — defaults to using opaque bounds, the boundaries of the region are opaque, to lookahead, lookbehind, and boundary matching constructs that may try to see beyond them</li> <li><code>boolean hasTransparentBounds()</code></li></ul></li> <li>replace
<ul><li><code>Matcher appendReplacement(StringBuffer sb, String replacement)</code> — used by <code>replaceAll</code> and <code>replaceFirst</code>, <code>IllegalStateException</code> if no match available<br> <code>StringBuffer appendTail(StringBuffer sb)</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Pattern</span> p <span class="token operator">=</span> <span class="token class-name">Pattern</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token string">&quot;cat&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Matcher</span> m <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">matcher</span><span class="token punctuation">(</span><span class="token string">&quot;one cat two cats in the yard&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">StringBuffer</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    m<span class="token punctuation">.</span><span class="token function">appendReplacement</span><span class="token punctuation">(</span>sb<span class="token punctuation">,</span> <span class="token string">&quot;dog&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
m<span class="token punctuation">.</span><span class="token function">appendTail</span><span class="token punctuation">(</span>sb<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// one dog</span>
<span class="token comment">// one dog two dog</span>
<span class="token comment">// one dog two dogs in the yard</span>
</code></pre></div></li> <li><code>String replaceAll(String replacement)</code></li> <li><code>String replaceFirst(String replacement)</code></li> <li><code>static String quoteReplacement(String s)</code> — quote <code>\</code> and <code>$</code>: otherwise <code>\</code> for escape, <code>${name}</code> for named groups, <code>$0</code> to <code>$9</code> for group number</li></ul></li> <li>get, set info
<ul><li><code>Pattern pattern()</code></li> <li><code>Matcher usePattern(Pattern newPattern)</code> — position in the input and last append position are unaffected</li> <li><code>String toString()</code></li> <li><code>boolean hitEnd()</code></li></ul></li></ul></li></ol> <h2 id="format"><a href="#format" class="header-anchor">#</a> Format</h2> <ol><li><p><code>java.util.Formatter</code></p> <ul><li><code>String::format</code></li></ul></li> <li><p><code>java.text.MessageFormat</code> — partially similar to <code>str.format</code> in Python</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MessageFormat</span>
<span class="token keyword">extends</span> <span class="token class-name">Format</span>
</code></pre></div><ul><li>creation
<ul><li><code>MessageFormat(String pattern)</code></li></ul></li> <li><code>static String format(String pattern, Object... arguments)</code> — uses the current locale</li> <li><code>public final String format(Object obj)</code></li> <li>choice formatting — <code>{1,choice,0#no houses|1#one house|2#{1} houses}</code>, see javadoc for more</li></ul></li></ol> <h1 id="io"><a href="#io" class="header-anchor">#</a> IO</h1> <ol><li><code>java.io</code> exceptions
<ul><li><code>java.io.IOException</code> extends <code>Exception</code> <ul><li><code>java.io.CharConversionException</code></li> <li><code>java.io.EOFException</code></li> <li><code>java.io.FileNotFoundException</code></li> <li><code>java.io.InterruptedIOException</code></li> <li><code>java.io.ObjectStreamException</code></li> <li><code>java.io.InvalidClassException</code></li> <li><code>java.io.InvalidObjectException</code></li> <li><code>java.io.NotActiveException</code></li> <li><code>java.io.NotSerializableException</code></li> <li><code>java.io.OptionalDataException</code></li> <li><code>java.io.StreamCorruptedException</code></li> <li><code>java.io.WriteAbortedException</code></li> <li><code>java.io.SyncFailedException</code></li> <li><code>java.io.UnsupportedEncodingException</code></li> <li><code>java.io.UTFDataFormatException</code></li></ul></li> <li><code>java.io.UncheckedIOException</code> extends <code>RuntimeException</code></li></ul></li></ol> <h2 id="console"><a href="#console" class="header-anchor">#</a> Console</h2> <ol><li><p><code>java.io.Console</code> — synchronized</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Console</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Flushable</span>
</code></pre></div><ul><li>creation
<ul><li><code>System.console()</code></li></ul></li> <li>write
<ul><li><code>void flush()</code></li> <li><code>Console format(String fmt, Object... args)</code></li> <li><code>Console printf(String format, Object... args)</code></li></ul></li> <li>read
<ul><li><code>String readLine()</code><br> <code>String readLine(String fmt, Object... args)</code></li> <li><code>char[] readPassword()</code><br> <code>char[] readPassword(String fmt, Object... args)</code></li></ul></li> <li>get underlying stream
<ul><li><code>Reader reader()</code></li> <li><code>PrintWriter writer()</code></li></ul></li></ul></li> <li><p><code>java.util.Scanner</code> — not synchronized</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Scanner</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Closeable</span>
</code></pre></div><ul><li>constructors
<ul><li><code>Scanner(File source)</code></li> <li><code>Scanner(File source, String charsetName)</code></li> <li><code>Scanner(InputStream source)</code> — uses <code>InputStreamReader</code> behind the scenes
<ul><li><code>System.in</code> for stdin</li></ul></li> <li><code>Scanner(InputStream source, String charsetName)</code></li> <li><code>Scanner(Path source)</code></li> <li><code>Scanner(Path source, String charsetName)</code></li> <li><code>Scanner(String source)</code></li> <li><code>Scanner(Readable source)</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Scanner</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><code>Scanner(ReadableByteChannel source)</code></li> <li><code>Scanner(ReadableByteChannel source, String charsetName)</code></li></ul></li> <li>settings — delimiter, locale, regex
<ul><li><code>Scanner reset()</code></li> <li><code>Scanner useDelimiter(Pattern pattern)</code></li> <li><code>Scanner useDelimiter(String pattern)</code></li> <li><code>Pattern delimiter()</code></li> <li><code>Scanner useLocale(Locale locale)</code></li> <li><code>Locale locale()</code></li> <li><code>Scanner useRadix(int radix)</code></li> <li><code>int radix()</code></li></ul></li> <li>read
<ul><li><code>String next()</code></li> <li><code>String next(Pattern pattern)</code></li> <li><code>String next(String pattern)</code></li> <li><code>String nextLine()</code></li> <li><code>BigDecimal nextBigDecimal()</code></li> <li><code>BigInteger nextBigInteger()</code></li> <li><code>BigInteger nextBigInteger(int radix)</code></li> <li><code>boolean nextBoolean()</code></li> <li><code>byte nextByte()</code></li> <li><code>byte nextByte(int radix)</code></li> <li><code>double nextDouble()</code></li> <li><code>float nextFloat()</code></li> <li><code>int nextInt()</code></li> <li><code>int nextInt(int radix)</code></li> <li><code>long nextLong()</code></li> <li><code>long nextLong(int radix)</code></li> <li><code>short nextShort()</code></li> <li><code>short nextShort(int radix)</code></li> <li><code>MatchResult match()</code> — the match result of the last scanning operation
<ul><li>peek<div class="language-java extra-class"><pre class="language-java"><code>s<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token string">&quot;.*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;.*&quot; matches anything, similar to hasNext(), but updates the scanner's internal match variable</span>
s<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>​<span class="token punctuation">;</span>​
</code></pre></div></li></ul></li></ul></li> <li>test — <code>has-</code> prefixed version of read methods, <code>hasNext</code></li> <li>find — ignoring delimiters, the scanner returns and advances past the match if found, else returns <code>null</code> with position unchanged
<ul><li><code>String findInLine(Pattern pattern)</code></li> <li><code>String findInLine(String pattern)</code></li> <li><code>String findWithinHorizon(Pattern pattern, int horizon)</code> — will never search more than <code>horizon</code> code points beyond its current position, <code>horizon</code> ignored if it is 0</li> <li><code>String findWithinHorizon(String pattern, int horizon)</code></li></ul></li> <li>skip — ignoring delimiters
<ul><li><code>Scanner skip(Pattern pattern)</code></li> <li><code>Scanner skip(String pattern)</code></li></ul></li> <li><code>IOException ioException()</code> — Returns the <code>IOException</code> last thrown by this Scanner's underlying <code>Readable</code>.</li></ul></li> <li><p><code>java.io.BufferedReader</code> — synchronized</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BufferedReader</span>
<span class="token keyword">extends</span> <span class="token class-name">Reader</span>
</code></pre></div><ul><li><code>Stream&lt;String&gt; lines()</code></li> <li><code>String readLine()</code></li> <li><code>Reader</code> methods</li></ul></li> <li><p>stdin, stdout, stderr</p> <ul><li>see <a href="#System"><code>System</code></a></li> <li>see <code>InputStream</code> (<code>BufferedInputStream</code>) and <code>PrintStream</code></li></ul></li></ol> <h2 id="basic-io-stream"><a href="#basic-io-stream" class="header-anchor">#</a> Basic IO Stream</h2> <ol><li><p>IO streams</p> <ul><li>byte streams, byte oriented — <code>InputStream</code>, <code>OutputStream</code> <ul><li>deal with bytes — <code>FilterInputStream</code>, <code>FilterOutputStream</code> and their derivatives</li> <li>buffer — use <code>BufferedInputStream</code> and <code>BufferedOutputStream</code> as an intermediate stream</li></ul></li> <li><code>char</code> streams, two-byte <code>char</code> values (UTF-16 codepoints) oriented — <code>Reader</code>, <code>Writer</code>, can be converted from byte streams, both have a protected <code>Object</code> field <code>lock</code> for synchronization</li> <li>usage — combination, filter streams as wrappers<div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataInputStream</span> din <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token class-name">BufferedInputStream</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">&quot;employee.dat&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li> <li><p>IO interfaces</p> <ul><li><code>java.io.Closeable</code> — idempotent variant with <code>IOException</code> compared to <code>AutoCloseable</code> with <code>Exception</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Closeable</span>
<span class="token keyword">extends</span> <span class="token class-name">AutoCloseable</span>
</code></pre></div><ul><li><code>close()</code> when already closed — no effect if already closed, whereas <code>AutoCloseable::close</code> may have side effects</li></ul></li> <li><code>java.io.Flushable</code> — write any buffered output to the underlying stream<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Flushable</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><code>Readable</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Readable</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">read</span><span class="token punctuation">(</span>java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span><span class="token class-name">CharBuffer</span> cb<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><code>Appendable</code> — to which char sequences and values can be appended, must be implemented by any class whose instances are intended to receive formatted output from a <code>java.util.Formatter</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Appendable</span> <span class="token punctuation">{</span>
    <span class="token class-name">Appendable</span> <span class="token function">append</span><span class="token punctuation">(</span><span class="token keyword">char</span> c<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">;</span>
    <span class="token class-name">Appendable</span> <span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">CharSequence</span> csq<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">;</span>
    <span class="token class-name">Appendable</span> <span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">CharSequence</span> csq<span class="token punctuation">,</span> <span class="token keyword">int</span> start<span class="token punctuation">,</span> <span class="token keyword">int</span> end<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul></li> <li><p><code>java.io.InputStream</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">InputStream</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Closeable</span>
</code></pre></div><ul><li>lifecycle
<ul><li><code>int available()</code> — an estimate of the number of bytes that can be read (or skipped over) without blocking</li> <li><code>abstract int read()</code> — block if necessary, read next byte (0 ~ 255), <code>-1</code> if at end, used by some other methods so only one method to implementing when inheriting<br> <code>int read(byte[] b)</code><br> <code>int read(byte[] b, int off, int len)</code> — reads up to <code>len</code> bytes of data from the offset into byte buffer <code>b</code></li> <li><code>long skip(long n)</code> — returns the actual number of bytes skipped</li> <li><code>void close()</code></li></ul></li> <li>mark — the stream somehow remembers all the bytes read after the call to <code>mark</code> and stands ready to supply those same bytes again if and whenever the method <code>reset</code> is called, as long as within <code>readlimit</code> <ul><li><code>boolean markSupported()</code></li> <li><code>void mark(int readlimit)</code></li> <li><code>void reset()</code></li></ul></li> <li>read all to <code>String</code> — see <a href="https://stackoverflow.com/questions/309424/how-do-i-read-convert-an-inputstream-into-a-string-in-java" target="_blank" rel="noopener noreferrer">stack overflow<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">inputStreamToString</span><span class="token punctuation">(</span><span class="token class-name">InputStream</span> inputStream<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">ByteArrayOutputStream</span> bos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    inputStream<span class="token punctuation">.</span><span class="token function">transferTo</span><span class="token punctuation">(</span>bos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> bos<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><code>public long transferTo(OutputStream out)</code> — since JDK 9<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">transferTo</span><span class="token punctuation">(</span><span class="token class-name">OutputStream</span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">requireNonNull</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span> <span class="token string">&quot;out&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> transferred <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>DEFAULT_BUFFER_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 8192</span>
    <span class="token keyword">int</span> read<span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>read <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> DEFAULT_BUFFER_SIZE<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> read<span class="token punctuation">)</span><span class="token punctuation">;</span>
        transferred <span class="token operator">+=</span> read<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> transferred<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul></li></ul></li> <li><p><code>java.io.OutputStream</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">OutputStream</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Closeable</span><span class="token punctuation">,</span> <span class="token class-name">Flushable</span>
</code></pre></div><ul><li><code>abstract void write(int b)</code> — block if necessary<br> <code>void write(byte[] b)</code><br> <code>void write(byte[] b, int off, int len)</code></li> <li><code>void flush()</code></li> <li><code>void close()</code> — automatically <code>flush()</code> before close</li></ul></li> <li><p><code>java.io.Reader</code> — see <code>InputStream</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Reader</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Readable</span><span class="token punctuation">,</span> <span class="token class-name">Closeable</span>
</code></pre></div><ul><li>lifecycle
<ul><li><code>boolean ready()</code></li> <li><code>abstract int read(char[] cbuf, int off, int len)</code> — 0 ~ 65535 or -1<br> <code>int read()</code><br> <code>int read(char[] cbuf)</code><br> <code>int read(CharBuffer target)</code></li> <li><code>long skip(long n)</code></li> <li><code>abstract void close()</code></li></ul></li> <li>mark
<ul><li><code>boolean markSupported()</code></li> <li><code>void mark(int readAheadLimit)</code></li> <li><code>void reset()</code></li></ul></li></ul></li> <li><p><code>java.io.Writer</code> — see <code>OutputStream</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Writer</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Appendable</span><span class="token punctuation">,</span> <span class="token class-name">Closeable</span><span class="token punctuation">,</span> <span class="token class-name">Flushable</span>
</code></pre></div><ul><li><code>Writer append(char c)</code><br> <code>Writer append(CharSequence csq)</code><br> <code>Writer append(CharSequence csq, int start, int end)</code></li> <li><code>abstract void write(char[] cbuf, int off, int len)</code><br> <code>void write(char[] cbuf)</code><br> <code>void write(int c)</code><br> <code>void write(String str)</code><br> <code>void write(String str, int off, int len)</code></li> <li><code>abstract void flush()</code></li> <li><code>abstract void close()</code></li></ul></li> <li><p>convert stream to reader or writer, uses <code>Charset.defaultCharset()</code> if not specified</p> <ul><li><code>java.io.InputStreamReader</code> — used by <code>Scanner</code> behind the scenes<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InputStreamReader</span>
<span class="token keyword">extends</span> <span class="token class-name">Reader</span>
</code></pre></div><ul><li>constructors
<ul><li><code>InputStreamReader(InputStream in)</code></li> <li><code>InputStreamReader(InputStream in, Charset cs)</code></li> <li><code>InputStreamReader(InputStream in, CharsetDecoder dec)</code></li> <li><code>InputStreamReader(InputStream in, String charsetName)</code></li></ul></li> <li><code>String getEncoding()</code></li></ul></li> <li><code>java.io.OutputStreamWriter</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OutputStreamWriter</span>
<span class="token keyword">extends</span> <span class="token class-name">Writer</span>
</code></pre></div><ul><li>constructors
<ul><li><code>OutputStreamWriter(OutputStream out)</code></li> <li><code>OutputStreamWriter(OutputStream out, Charset cs)</code></li> <li><code>OutputStreamWriter(OutputStream out, CharsetEncoder enc)</code></li> <li><code>OutputStreamWriter(OutputStream out, String charsetName)</code></li></ul></li> <li><code>String getEncoding()</code></li></ul></li></ul></li></ol> <h2 id="filter-stream"><a href="#filter-stream" class="header-anchor">#</a> Filter Stream</h2> <ol><li><p>filter stream — contains some other stream, which it uses as its basic source or sink of data, possibly transforming the data along the way or providing additional functionality</p> <ul><li><code>java.io.FilterInputStream</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FilterInputStream</span>
<span class="token keyword">extends</span> <span class="token class-name">InputStream</span>
</code></pre></div><ul><li>constructor — <code>protected FilterInputStream(InputStream in)</code></li></ul></li> <li><code>java.io.FilterOutputStream</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FilterOutputStream</span>
<span class="token keyword">extends</span> <span class="token class-name">OutputStream</span>
</code></pre></div><ul><li>constructor — <code>FilterOutputStream(OutputStream out)</code></li></ul></li> <li><code>java.io.FilterReader</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">FilterReader</span>
<span class="token keyword">extends</span> <span class="token class-name">Reader</span>
</code></pre></div></li> <li><code>java.io.FilterWriter</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">FilterWriter</span>
<span class="token keyword">extends</span> <span class="token class-name">Writer</span>
</code></pre></div></li></ul></li> <li><p>buffer streams — the ability to buffer the input and to support the mark and reset methods</p> <ul><li><code>java.io.BufferedInputStream</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BufferedInputStream</span>
<span class="token keyword">extends</span> <span class="token class-name">FilterInputStream</span>
</code></pre></div><ul><li>constructors
<ul><li><code>BufferedInputStream(InputStream in)</code></li> <li><code>BufferedInputStream(InputStream in, int size)</code></li></ul></li></ul></li> <li><code>java.io.BufferedOutputStream</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BufferedOutputStream</span>
<span class="token keyword">extends</span> <span class="token class-name">FilterOutputStream</span>
</code></pre></div><ul><li>constructors
<ul><li><code>BufferedOutputStream(OutputStream out)</code></li> <li><code>BufferedOutputStream(OutputStream out, int size)</code></li></ul></li></ul></li> <li><code>java.io.BufferedReader</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BufferedReader</span>
<span class="token keyword">extends</span> <span class="token class-name">Reader</span>
</code></pre></div></li> <li><code>java.io.BufferedWriter</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BufferedWriter</span>
<span class="token keyword">extends</span> <span class="token class-name">Writer</span>
</code></pre></div></li></ul></li> <li><p>data input — conversion between bytes from a binary stream and Java data types, big endian</p> <ul><li><a href="https://docs.oracle.com/javase/8/docs/api/java/io/DataInput.html#modified-utf-8" target="_blank" rel="noopener noreferrer">modified UTF-8<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> — UTF-8 encoded UTF-16</li> <li><code>java.io.DataInput</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">DataInput</span>
</code></pre></div><ul><li><code>void readFully(byte[] b)</code></li> <li><code>void readFully(byte[] b, int off, int len)</code></li> <li><code>boolean readBoolean()</code></li> <li><code>byte readByte()</code></li> <li><code>char readChar()</code></li> <li><code>double readDouble()</code></li> <li><code>float readFloat()</code></li> <li><code>int readInt()</code></li> <li><code>String readLine()</code></li> <li><code>long readLong()</code></li> <li><code>short readShort()</code></li> <li><code>int readUnsignedByte()</code> — 0 ~ 255</li> <li><code>int readUnsignedShort()</code> — 0 ~ 65535</li> <li><code>String readUTF()</code> — modified UTF-8 encoded string</li> <li><code>int skipBytes(int n)</code></li></ul></li> <li><code>java.io.DataOutput</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">DataOutput</span>
</code></pre></div></li> <li><code>java.io.DataInputStream</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataInputStream</span>
<span class="token keyword">extends</span> <span class="token class-name">FilterInputStream</span>
<span class="token keyword">implements</span> <span class="token class-name">DataInput</span>
</code></pre></div><ul><li>constructor — <code>DataInputStream(InputStream in)</code></li></ul></li> <li><code>java.io.DataOutputStream</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataOutputStream</span>
<span class="token keyword">extends</span> <span class="token class-name">FilterOutputStream</span>
<span class="token keyword">implements</span> <span class="token class-name">DataOutput</span>
</code></pre></div><ul><li>constructor — <code>DataOutputStream(OutputStream out)</code></li></ul></li></ul></li> <li><p>peek — push back stream</p> <ul><li><code>java.io.PushbackInputStream</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PushbackInputStream</span>
<span class="token keyword">extends</span> <span class="token class-name">FilterInputStream</span>
</code></pre></div><ul><li>constructors
<ul><li><code>PushbackInputStream(InputStream in)</code></li> <li><code>PushbackInputStream(InputStream in, int size)</code></li></ul></li> <li>push back
<ul><li><code>void unread(byte[] b)</code></li> <li><code>void unread(byte[] b, int off, int len)</code></li> <li><code>void unread(int b)</code></li></ul></li></ul></li> <li><code>java.io.PushbackReader</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PushbackReader</span>
<span class="token keyword">extends</span> <span class="token class-name">FilterReader</span>
</code></pre></div></li></ul></li></ol> <h3 id="zip-streams"><a href="#zip-streams" class="header-anchor">#</a> ZIP Streams</h3> <ol><li><p>inflate and deflate</p> <ul><li><code>java.util.zip.InflaterInputStream</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InflaterInputStream</span>
<span class="token keyword">extends</span> <span class="token class-name">FilterInputStream</span>
</code></pre></div></li> <li><code>java.util.zip.DeflaterOutputStream</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DeflaterOutputStream</span>
<span class="token keyword">extends</span> <span class="token class-name">FilterOutputStream</span>
</code></pre></div></li></ul></li> <li><p>ZIP stream</p> <ul><li><code>java.util.zip.ZipInputStream</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ZipInputStream</span>
<span class="token keyword">extends</span> <span class="token class-name">InflaterInputStream</span>
</code></pre></div></li> <li><code>java.util.zip.ZipOutputStream</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ZipOutputStream</span>
<span class="token keyword">extends</span> <span class="token class-name">DeflaterOutputStream</span>
</code></pre></div></li></ul></li> <li><p>ZIP file system — <code>FileSystems.newFileSystem(Paths.get(zipname), null)</code></p></li></ol> <h2 id="print-stream"><a href="#print-stream" class="header-anchor">#</a> Print Stream</h2> <ol><li><p>print streams — add the ability to print representations of various data values conveniently</p> <ul><li>never throws an <code>IOException</code> — only <code>checkError()</code></li> <li>auto flush — support auto flush, defaults to <code>false</code> <ul><li>for <code>PrintStream</code> — after a byte array is written, or a <code>\n</code> is written</li> <li>for <code>PrintWriter</code> — after the invoke of <code>println</code>, <code>printf</code>, or <code>format</code></li></ul></li> <li><code>printf</code> — <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Formatter.html#syntax" target="_blank" rel="noopener noreferrer">formats<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li> <li><p><code>java.io.PrintStream</code> — print into bytes</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PrintStream</span>
<span class="token keyword">extends</span> <span class="token class-name">FilterOutputStream</span>
<span class="token keyword">implements</span> <span class="token class-name">Appendable</span><span class="token punctuation">,</span> <span class="token class-name">Closeable</span>
</code></pre></div><ul><li>constructors
<ul><li><code>PrintStream(File file)</code></li> <li><code>PrintStream(File file, String csn)</code></li> <li><code>PrintStream(OutputStream out)</code></li> <li><code>PrintStream(OutputStream out, boolean autoFlush)</code></li> <li><code>PrintStream(OutputStream out, boolean autoFlush, String encoding)</code></li> <li><code>PrintStream(String fileName)</code></li> <li><code>PrintStream(String fileName, String csn)</code></li></ul></li> <li><code>print</code> and <code>println</code> methods — <code>void</code>, supports primitive types, <code>char[]</code> and <code>Object</code></li> <li><code>printf</code> <ul><li><code>PrintStream printf(Locale l, String format, Object... args)</code></li> <li><code>PrintStream printf(String format, Object... args)</code></li></ul></li> <li><code>boolean checkError()</code></li></ul></li> <li><p><code>java.io.PrintWriter</code> — print into text (chars)</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PrintWriter</span>
<span class="token keyword">extends</span> <span class="token class-name">Writer</span>
</code></pre></div><ul><li>constructors
<ul><li><code>PrintWriter(File file)</code></li> <li><code>PrintWriter(File file, String csn)</code></li> <li><code>PrintWriter(OutputStream out)</code></li> <li><code>PrintWriter(OutputStream out, boolean autoFlush)</code></li> <li><code>PrintWriter(String fileName)</code></li> <li><code>PrintWriter(String fileName, String csn)</code></li> <li><code>PrintWriter(Writer out)</code></li> <li><code>PrintWriter(Writer out, boolean autoFlush)</code></li></ul></li> <li>methods — see <code>PrintStream</code> <ul><li>difference — <code>PrintStream::write</code> methods allow <code>int</code> and <code>byte[]</code></li></ul></li></ul></li></ol> <h2 id="other-streams"><a href="#other-streams" class="header-anchor">#</a> Other Streams</h2> <ol><li>externally buffered streams — save the data in an internal buffer (byte array, etc.), no effect for <code>close()</code> and no <code>IOException</code> afterwards
<ul><li><code>java.io.ByteArrayInputStream</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ByteArrayInputStream</span>
<span class="token keyword">extends</span> <span class="token class-name">InputStream</span>
</code></pre></div></li> <li><code>java.io.ByteArrayOutputStream</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ByteArrayOutputStream</span>
<span class="token keyword">extends</span> <span class="token class-name">OutputStream</span>
</code></pre></div></li> <li><code>java.io.StringReader</code> — read from <code>String</code>: <code>StringReader(String s)</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StringReader</span>
<span class="token keyword">extends</span> <span class="token class-name">Reader</span>
</code></pre></div></li> <li><code>java.io.StringWriter</code> — uses <code>StringBuffer</code> as buffer<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StringWriter</span>
<span class="token keyword">extends</span> <span class="token class-name">Writer</span>
</code></pre></div></li></ul></li></ol> <h2 id="serialization"><a href="#serialization" class="header-anchor">#</a> Serialization</h2> <ol><li><p><code>transient</code> — mark fields not part of the persistent state, which is skipped in serialization</p></li> <li><p><code>interface java.io.Serializable</code> — mark only data fields serializable, superclass data or any other class information not included</p> <ul><li>deserialize fields of classes not <code>Serializable</code> — initialized using the public or protected no-arg constructor</li> <li>serialize subclasses whose parents are not <code>Serializable</code> — serialize the super types only when they have accessible no-arg constructor</li> <li>serialization and deserialization control — override default read and write behavior, special handling during the serialization and deserialization, by implementing methods below<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">writeObject</span><span class="token punctuation">(</span>java<span class="token punctuation">.</span>io<span class="token punctuation">.</span><span class="token class-name">ObjectOutputStream</span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">readObject</span><span class="token punctuation">(</span>java<span class="token punctuation">.</span>io<span class="token punctuation">.</span><span class="token class-name">ObjectInputStream</span> in<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">readObjectNoData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ObjectStreamException</span>
</code></pre></div></li> <li>version ID — used during deserialization to verify that the sender and receiver of a serialized object have loaded classes compatible with serialization, <code>InvalidClassException</code> if no match
<ul><li>declare explicitly<div class="language-java extra-class"><pre class="language-java"><code>MODIFIER <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">42L</span><span class="token punctuation">;</span> <span class="token comment">// private is recommended</span>
</code></pre></div></li> <li>generate by default, not recommended — the serialization runtime will calculate a default <code>serialVersionUID</code> value for that class based on various aspects of the class (fingerprint), which may vary depending on compiler implementations</li> <li>not applicable to array classes — cannot declare explicitly, and the requirement for matching <code>serialVersionUID</code> values is waived for array classes</li> <li>get version ID via CLI — <code>serialver ClassName</code></li> <li>auto conversion when version ID match — for data fields, skip when type is different, ignore additional, set absent to default</li></ul></li> <li>write or read with another object
<ul><li>when writing to stream — implement <code>writeReplace</code><div class="language-java extra-class"><pre class="language-java"><code>MODIFIER <span class="token class-name">Object</span> <span class="token function">writeReplace</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ObjectStreamException</span><span class="token punctuation">;</span>
</code></pre></div></li> <li>when reading from stream — implement <code>readResolve</code><div class="language-java extra-class"><pre class="language-java"><code>MODIFIER <span class="token class-name">Object</span> <span class="token function">readResolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ObjectStreamException</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li> <li>serial number — associate the object a number in encounter order and save or read the object data when first encounter, only save the serial number or read the object reference when encountered afterwards</li> <li>file structure
<ul><li>magic number — <code>ACED</code></li> <li>version number of the object serialization format — <code>0005</code> for JDK 8</li> <li>object sequences
<ul><li>strings saved in modified UTF-8</li> <li>fingerprint stored in class — first 8 bytes of SHA</li></ul></li> <li>more</li></ul></li></ul></li> <li><p><code>java.io.Externalizable</code> — complete control over the format and contents of the stream for an object and its superclasses</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Externalizable</span>
<span class="token keyword">extends</span> <span class="token class-name">Serializable</span>
</code></pre></div><ul><li>taking precedence and mechanism — If the object supports <code>Externalizable</code>, the <code>writeExternal</code> method is called. If the object does not support <code>Externalizable</code> and does implement <code>Serializable</code>, the object is saved using <code>ObjectOutputStream</code></li> <li>no-arg constructor when reconstructing — when reading, creates an object with the no-argument constructor and then calls the <code>readExternal</code> method</li> <li>use another object — support <code>writeReplace</code> and <code>readResolve</code> methods</li> <li><code>void readExternal(ObjectInputStream in) throws IOException, ClassNotFoundException</code></li> <li><code>void writeExternal(ObjectOutputStream out) throws IOException</code></li></ul></li> <li><p>interfaces for object streams</p> <ul><li><code>interface java.io.ObjectStreamConstants</code> — Constants written into the Object Serialization Stream</li> <li><code>java.io.ObjectOutput</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ObjectOutput</span>
<span class="token keyword">extends</span> <span class="token class-name">DataOutput</span><span class="token punctuation">,</span> <span class="token class-name">AutoCloseable</span>
</code></pre></div><ul><li>inherited methods</li> <li><code>void flush()</code></li> <li><code>void writeObject(Object obj)</code></li></ul></li> <li><code>java.io.ObjectInput</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ObjectInput</span>
<span class="token keyword">extends</span> <span class="token class-name">DataInput</span><span class="token punctuation">,</span> <span class="token class-name">AutoCloseable</span>
</code></pre></div><ul><li>inherited methods</li> <li><code>int available()</code></li> <li><code>int read()</code><br> <code>int read(byte[] b)</code><br> <code>int read(byte[] b, int off, int len)</code></li> <li><code>Object readObject()</code></li> <li><code>long skip(long n)</code></li></ul></li></ul></li> <li><p><code>java.io.ObjectInputStream</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ObjectInputStream</span>
<span class="token keyword">extends</span> <span class="token class-name">InputStream</span>
<span class="token keyword">implements</span> <span class="token class-name">ObjectInput</span><span class="token punctuation">,</span> <span class="token class-name">ObjectStreamConstants</span>
</code></pre></div><ul><li>constructor — <code>ObjectInputStream(InputStream in)</code></li> <li><code>void defaultReadObject()</code></li></ul></li> <li><p><code>java.io.ObjectOutputStream</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ObjectOutputStream</span>
<span class="token keyword">extends</span> <span class="token class-name">OutputStream</span>
<span class="token keyword">implements</span> <span class="token class-name">ObjectOutput</span><span class="token punctuation">,</span> <span class="token class-name">ObjectStreamConstants</span>
</code></pre></div><ul><li>constructor — <code>ObjectOutputStream(OutputStream out)</code></li> <li><code>void defaultWriteObject()</code></li></ul></li></ol> <h2 id="files"><a href="#files" class="header-anchor">#</a> Files</h2> <h3 id="file-classes"><a href="#file-classes" class="header-anchor">#</a> File Classes</h3> <ol><li><p><code>java.io.File</code> — an abstract representation of file and directory pathnames, the old school way</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">File</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Serializable</span><span class="token punctuation">,</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">File</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>separators — <code>System.getProperty(&quot;file.separator&quot;)</code>, <code>System.getProperty(&quot;path.separator&quot;)</code> <ul><li><code>static String separator</code></li> <li><code>static char separatorChar</code></li> <li><code>static String pathSeparator</code></li> <li><code>static char pathSeparatorChar</code></li></ul></li> <li>permissions
<ul><li><code>boolean canExecute()</code></li> <li><code>boolean canRead()</code></li> <li><code>boolean canWrite()</code></li> <li><code>boolean isHidden()</code></li> <li>`boolean setExecutable(boolean executable)</li> <li>`boolean setExecutable(boolean executable, boolean ownerOnly)</li> <li>`boolean setReadable(boolean readable)</li> <li>`boolean setReadable(boolean readable, boolean ownerOnly)</li> <li>`boolean setReadOnly()</li> <li>`boolean setWritable(boolean writable)</li> <li>`boolean setWritable(boolean writable, boolean ownerOnly)</li></ul></li> <li>inherited
<ul><li><code>int compareTo(File pathname)</code> — lexicographically</li></ul></li> <li>CRUD
<ul><li><code>static File createTempFile(String prefix, String suffix)</code></li> <li><code>static File createTempFile(String prefix, String suffix, File directory)</code></li> <li><code>boolean createNewFile()</code></li> <li><code>boolean mkdir()</code></li> <li><code>boolean mkdirs()</code></li> <li><code>boolean delete()</code></li> <li><code>void deleteOnExit()</code></li> <li><code>boolean exists()</code></li> <li><code>boolean renameTo(File dest)</code></li></ul></li> <li>metadata and list
<ul><li><code>boolean isDirectory()</code></li> <li><code>boolean isFile()</code></li> <li><code>long lastModified()</code></li> <li><code>boolean setLastModified(long time)</code></li> <li><code>long length()</code></li> <li><code>String[] list()</code><br> <code>String[] list(FilenameFilter filter)</code></li> <li><code>File[] listFiles()</code><br> <code>File[] listFiles(FileFilter filter)</code><br> <code>File[] listFiles(FilenameFilter filter)</code></li> <li><code>static File[] listRoots()</code></li></ul></li> <li>path
<ul><li><code>File getAbsoluteFile()</code></li> <li><code>String getAbsolutePath()</code></li> <li><code>File getCanonicalFile()</code></li> <li><code>String getCanonicalPath()</code></li> <li><code>String getName()</code></li> <li><code>String getParent()</code></li> <li><code>File getParentFile()</code></li> <li><code>String getPath()</code></li> <li><code>boolean isAbsolute()</code></li> <li><code>String toString()</code></li> <li><code>Path toPath()</code></li> <li><code>URI toURI()</code></li></ul></li> <li>space — the partition named by this abstract pathname
<ul><li><code>long getFreeSpace()</code></li> <li><code>long getTotalSpace()</code></li> <li><code>long getUsableSpace()</code></li></ul></li> <li>file filters
<ul><li><code>java.io.FilenameFilter</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@FunctionalInterface</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">FilenameFilter</span> <span class="token punctuation">{</span>
    <span class="token keyword">boolean</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">File</span> dir<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><code>java.io.FileFilter</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@FunctionalInterface</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">FileFilter</span> <span class="token punctuation">{</span>
    <span class="token keyword">boolean</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">File</span> pathname<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul></li> <li><code>java.io.FileDescriptor</code> — used in file streams<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">FileDescriptor</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
``

</code></pre></div></li></ul></li> <li><p><code>java.nio.file.Path</code> — represents a system dependent file path, immutable</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Path</span>
<span class="token keyword">extends</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Path</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Path</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Watchable</span>
</code></pre></div><ul><li>creation
<ul><li><code>java.nio.file.Paths</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Paths</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
</code></pre></div><ul><li><code>static Path get(String first, String... more)</code> — join</li> <li><code>static Path get(URI uri)</code></li></ul></li> <li><code>File::toPath</code></li></ul></li> <li>components methods</li> <li>relative, absolute, real path methods</li> <li><code>File toFile()</code></li> <li><code>URI toUri()</code></li> <li>inherited methods</li> <li>example: three ways to <code>pwd</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">new</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span><span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCanonicalPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;user.dir&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li> <li><p><code>java.nio.file.Files</code> — static methods take <code>Path</code> as arguments, operate its underlying files, usually atomically</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Files</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
</code></pre></div><ul><li>limit — some read / write methods are intended for text files of moderate length, use stream methods such as <code>newInputStream</code> for large or binary files</li> <li>glop pattern — extended syntax, extended <code>**</code>, see <a href="https://docs.oracle.com/javase/tutorial/essential/io/fileOps.html#glob" target="_blank" rel="noopener noreferrer">File Operations (The Java™ Tutorials &gt; Essential Classes &gt; Basic I/O)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, and <a href="https://docs.oracle.com/javase/8/docs/api/java/nio/file/FileSystem.html#getPathMatcher-java.lang.String-" target="_blank" rel="noopener noreferrer"><code>FileSystem::getPathMatcher</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><code>readAllBytes</code>, <code>readAllLines</code>, etc.</li></ul></li> <li><p>utility classes</p> <ul><li><code>java.nio.file.DirectoryStream</code> — an object to iterate over the entries in a directory, supports only a single <code>Iterator</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">DirectoryStream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">extends</span> <span class="token class-name">Closeable</span><span class="token punctuation">,</span> <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><code>java.nio.file.SimpleFileVisitor</code> — a simple visitor of files with default behavior to visit all files and to re-throw I/O errors<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleFileVisitor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">FileVisitor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><code>public interface java.nio.file.FileVisitor&lt;T&gt;</code></li> <li>prevent termination by exceptions — override <code>postVisitDirectory</code> to return <code>FileVisitResult.CONTINUE</code> and <code>visitFileFailed</code> to return <code>FileVisitResult.SKIP_SUBTREE</code></li></ul></li> <li><code>java.nio.file.PathMatcher</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@FunctionalInterface</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PathMatcher</span>
</code></pre></div></li></ul></li> <li><p><code>java.nio.file.FileStore</code> — a storage pool, device, partition, volume, concrete file system or other implementation specific means of file storage</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">FileStore</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
</code></pre></div></li> <li><p><code>java.nio.file.FileSystem</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">FileSystem</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Closeable</span>
</code></pre></div><ul><li><code>abstract Path getPath(String first, String... more)</code></li> <li><code>abstract Iterable&lt;Path&gt; getRootDirectories()</code></li> <li><code>abstract boolean isOpen()</code></li> <li><code>abstract boolean isReadOnly()</code></li> <li><code>abstract Iterable&lt;FileStore&gt; getFileStores()</code></li> <li><code>abstract PathMatcher getPathMatcher(String syntaxAndPattern)</code></li> <li><code>abstract String getSeparator()</code></li> <li><code>abstract UserPrincipalLookupService getUserPrincipalLookupService()</code></li> <li><code>abstract WatchService newWatchService()</code></li> <li><code>abstract FileSystemProvider provider()</code></li> <li><code>abstract Set&lt;String&gt; supportedFileAttributeViews()</code></li> <li>creation — <code>FileSystems</code></li></ul></li> <li><p><code>java.nio.file.FileSystems</code> — factory methods for file systems</p> <ul><li>initialization — The first invocation of any of the methods defined by this class causes the default <code>FileSystemProvider</code> to be loaded. The default provider, identified by the URI scheme &quot;file&quot;, creates the <code>FileSystem</code> that provides access to the file systems accessible to the JVM</li> <li><code>static FileSystem getDefault()</code></li> <li><code>static FileSystem getFileSystem(URI uri)</code></li> <li><code>static FileSystem newFileSystem(Path path, ClassLoader loader)</code> — constructs a new <code>FileSystem</code> to access the contents of a file as a file system, supports ZIP files</li> <li><code>static FileSystem newFileSystem(URI uri, Map&lt;String,?&gt; env)</code></li> <li><code>static FileSystem newFileSystem(URI uri, Map&lt;String,?&gt; env, ClassLoader loader)</code></li></ul></li> <li><p><code>java.nio.file.spi.FileSystemProvider</code> — file system service provider, methods in <code>Files</code> under the hood</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">FileSystemProvider</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
</code></pre></div></li> <li><p><code>java.nio.channels.FileChannel</code> — reading, writing, mapping, locking, transferring and manipulating a file</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">FileChannel</span>
<span class="token keyword">extends</span> <span class="token class-name">AbstractInterruptibleChannel</span>
<span class="token keyword">implements</span> <span class="token class-name">SeekableByteChannel</span><span class="token punctuation">,</span> <span class="token class-name">GatheringByteChannel</span><span class="token punctuation">,</span> <span class="token class-name">ScatteringByteChannel</span>
</code></pre></div><ul><li>creation
<ul><li><code>static FileChannel open(Path path, OpenOption... options)</code></li> <li><code>static FileChannel open(Path path, Set&lt;? extends OpenOption&gt; options, FileAttribute&lt;?&gt;... attrs)</code></li> <li><code>FileInputStream::getChannel</code>, <code>FileOutputStream::getChannel</code>, <code>RandomAccessFile::getChannel</code></li></ul></li> <li><code>abstract MappedByteBuffer map(FileChannel.MapMode mode, long position, long size)</code> — maps a region of this channel's file directly into memory, recommended only for large files</li> <li>lock — lock the given region of this channel's file
<ul><li><code>FileLock lock()</code> — blocks, equivalent to <code>lock(0L, Long.MAX_VALUE, false)</code><br> <code>abstract FileLock lock(long position, long size, boolean shared)</code></li> <li><code>FileLock tryLock()</code> — <code>null</code> if not available, equivalent to <code>tryLock(0L, Long.MAX_VALUE, false)</code><br> <code>abstract FileLock tryLock(long position, long size, boolean shared)</code></li></ul></li> <li>AIO -- <code>java.nio.channels.AsynchronousFileChannel</code></li></ul></li> <li><p><code>java.nio.channels.FileLock</code> — a lock on a region of a file, on behalf of the JVM</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">FileLock</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">AutoCloseable</span>
</code></pre></div><ul><li>region is fixed — the region stays fixed, the file can have uncovered portion or can grow beyond the region
<ul><li><code>boolean overlaps(long position, long size)</code></li> <li><code>long position()</code></li> <li><code>long size()</code></li></ul></li> <li>lock on behalf of the JVM — not for multithreading, but for multiprocessing</li> <li>shared lock — allow other programs to acquire overlapping shared locks while not allowing exclusive locks
<ul><li><code>shared</code> for read, exclusive for write — <code>true</code> to request a shared lock, in which case this channel must be open for reading (and possibly writing); <code>false</code> to request an exclusive lock, in which case this channel must be open for writing (and possibly reading)</li></ul></li> <li>OS dependent
<ul><li>lock support — On some systems, file locking is merely advisory</li> <li>shared support — a request for a shared lock is automatically converted into a request for an exclusive lock if not supported</li> <li>memory map support — on some systems, you cannot simultaneously lock a file and map it into memory</li> <li>avoid multiple channels on the same locked file — on some systems, closing a channel releases all locks on the underlying file</li> <li>avoid locking files on a networked file system</li></ul></li> <li><code>abstract void release()</code><br> <code>void close()</code></li></ul></li></ol> <h3 id="file-options-and-attributes"><a href="#file-options-and-attributes" class="header-anchor">#</a> File Options and Attributes</h3> <ol><li><p>options</p> <ul><li><code>interface java.nio.file.OpenOption</code> — mark interface</li> <li><code>interface java.nio.file.CopyOption</code> — mark interface</li> <li><code>java.nio.file.LinkOption.NOFOLLOW_LINKS</code> — Do not follow symbolic links<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">LinkOption</span> <span class="token keyword">extends</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LinkOption</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">implements</span> <span class="token class-name">OpenOption</span><span class="token punctuation">,</span> <span class="token class-name">CopyOption</span>
</code></pre></div></li> <li><code>java.nio.file.StandardOpenOption</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">StandardOpenOption</span> <span class="token keyword">extends</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">StandardOpenOption</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">implements</span> <span class="token class-name">OpenOption</span>
</code></pre></div><ul><li><code>READ</code></li> <li><code>CREATE</code></li> <li><code>CREATE_NEW</code></li> <li><code>DELETE_ON_CLOSE</code></li> <li><code>SPARSE</code> — a hint to the file system that this file will be sparse</li> <li><code>SYNC</code>, <code>DSYNC</code></li> <li><code>WRITE</code></li> <li><code>APPEND</code></li> <li><code>TRUNCATE_EXISTING</code></li></ul></li> <li><code>java.nio.file.StandardCopyOption</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">StandardCopyOption</span> <span class="token keyword">extends</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">StandardCopyOption</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">implements</span> <span class="token class-name">CopyOption</span>
</code></pre></div><ul><li><code>ATOMIC_MOVE</code></li> <li><code>COPY_ATTRIBUTES</code></li> <li><code>REPLACE_EXISTING</code></li></ul></li> <li><code>java.nio.file.FileVisitOption.FOLLOW_LINKS</code> — Follow symbolic links, neither <code>OpenOption</code> nor <code>CopyOption</code></li></ul></li> <li><p>file attributes — <code>java.nio.file.attribute</code></p> <ul><li><code>java.nio.file.attribute.UserPrincipal</code> — a Principal representing an identity used to determine access rights to objects in a file system<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserPrincipal</span> <span class="token keyword">extends</span> <span class="token class-name">Principal</span>
</code></pre></div></li> <li><code>interface java.nio.file.attribute.BasicFileAttributes</code> — basic file attributes, including times, file or dir or link, size, file key
<ul><li>file key — an object of some class, specific to the file system, that may or may not uniquely identify a file</li> <li>read attributes — <code>Files::readAttributes</code></li> <li>sub-interfaces
<ul><li><code>java.nio.file.attribute.DosFileAttributes</code></li> <li><code>java.nio.file.attribute.PosixFileAttributes</code></li></ul></li></ul></li> <li><code>java.nio.file.attribute.FileTime</code> — a file's time stamp attribute<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">FileTime</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FileTime</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ul></li></ol> <h3 id="file-stream"><a href="#file-stream" class="header-anchor">#</a> File Stream</h3> <ol><li><p>file streams</p> <ul><li><code>java.io.FileInputStream</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileInputStream</span>
<span class="token keyword">extends</span> <span class="token class-name">InputStream</span>
</code></pre></div><ul><li>constructors
<ul><li><code>FileInputStream(File file)</code></li> <li><code>FileInputStream(FileDescriptor fdObj)</code></li> <li><code>FileInputStream(String name)</code></li></ul></li> <li>methods beyond <code>InputStream</code> <ul><li><code>protected void finalize()</code> — ensures that the close method of this file input stream is called when there are no more references to it</li> <li><code>FileChannel getChannel()</code></li> <li><code>FileDescriptor getFD()</code></li></ul></li></ul></li> <li><code>java.io.FileOutputStream</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileOutputStream</span>
<span class="token keyword">extends</span> <span class="token class-name">OutputStream</span>
</code></pre></div><ul><li>constructors
<ul><li><code>FileOutputStream(File file)</code></li> <li><code>FileOutputStream(File file, boolean append)</code></li> <li><code>FileOutputStream(FileDescriptor fdObj)</code></li> <li><code>FileOutputStream(String name)</code></li> <li><code>FileOutputStream(String name, boolean append)</code></li></ul></li> <li>see <code>FileInputStream</code></li></ul></li> <li>print streams</li> <li><code>Scanner</code>, <code>BufferedReader</code></li> <li><code>java.io.RandomAccessFile</code> — both reading and writing to a random access file, which has a file pointer, suitable for small and moderate files<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RandomAccessFile</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">DataOutput</span><span class="token punctuation">,</span> <span class="token class-name">DataInput</span><span class="token punctuation">,</span> <span class="token class-name">Closeable</span>
</code></pre></div><ul><li>mode — <code>&quot;r&quot;</code>, <code>&quot;rw&quot;</code>, <code>&quot;rws&quot;</code> (file content or metadata synchronized with storage), or <code>&quot;rwd&quot;</code> (only file content synchronized)</li> <li>constructors
<ul><li><code>RandomAccessFile(File file, String mode)</code></li> <li><code>RandomAccessFile(String name, String mode)</code></li></ul></li> <li>file info
<ul><li><code>FileChannel getChannel()</code></li> <li><code>FileDescriptor getFD()</code></li> <li><code>long length()</code></li></ul></li> <li>file pointer — cursor for read / write
<ul><li><code>long getFilePointer()</code></li> <li><code>void seek(long pos)</code> — Sets the file-pointer offset, measured from the beginning of this file, at which the next read or write occurs.</li> <li><code>void setLength(long newLength)</code></li> <li><code>int skipBytes(int n)</code></li></ul></li> <li>read
<ul><li><code>int read()</code></li> <li><code>int read(byte[] b)</code></li> <li><code>int read(byte[] b, int off, int len)</code></li> <li><code>DataInput</code> methods</li></ul></li> <li>write — <code>DataOutput</code> methods</li></ul></li></ul></li> <li><p>char based file streams — default encoding as <code>InputStreamReader</code>, <code>OutputStreamWriter</code></p> <ul><li><code>java.io.FileReader</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileReader</span>
<span class="token keyword">extends</span> <span class="token class-name">InputStreamReader</span>
</code></pre></div><ul><li>constructors
<ul><li><code>FileReader(File file)</code></li> <li><code>FileReader(FileDescriptor fd)</code></li> <li><code>FileReader(String fileName)</code></li></ul></li></ul></li> <li><code>java.io.FileWriter</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileWriter</span>
<span class="token keyword">extends</span> <span class="token class-name">OutputStreamWriter</span>
</code></pre></div><ul><li>constructors
<ul><li><code>FileWriter(File file)</code></li> <li><code>FileWriter(File file, boolean append)</code></li> <li><code>FileWriter(FileDescriptor fd)</code></li> <li><code>FileWriter(String fileName)</code></li> <li><code>FileWriter(String fileName, boolean append)</code></li></ul></li></ul></li> <li>print streams</li></ul></li></ol> <h1 id="nio"><a href="#nio" class="header-anchor">#</a> NIO</h1> <ol><li>file related — see <a href="#File-Classes">File Classes</a></li></ol> <h2 id="nio-buffers"><a href="#nio-buffers" class="header-anchor">#</a> NIO Buffers</h2> <ol><li><p><code>java.nio</code></p> <ul><li><code>ByteOrder</code></li> <li><code>Buffer</code> — a container for a fixed amount of data of a specific primitive type
<ul><li><code>ByteBuffer</code> — can be direct, can be mapped to memory, content can be heterogeneous or homogeneous, big-endian or little-endian
<ul><li><code>MappedByteBuffer</code></li></ul></li> <li><code>CharBuffer</code></li> <li><code>DoubleBuffer</code>, <code>FloatBuffer</code>, <code>IntBuffer</code>, <code>LongBuffer</code>, <code>ShortBuffer</code></li></ul></li> <li>runtime exceptions
<ul><li><code>java.nio.BufferOverflowException</code></li> <li><code>java.nio.BufferUnderflowException</code></li> <li><code>java.lang.IllegalStateException</code> <ul><li><code>java.nio.InvalidMarkException</code></li></ul></li> <li><code>java.lang.UnsupportedOperationException</code> <ul><li><code>java.nio.ReadOnlyBufferException</code></li></ul></li></ul></li></ul></li> <li><p><code>java.nio.ByteOrder</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">ByteOrder</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
</code></pre></div><ul><li><code>static ByteOrder BIG_ENDIAN</code></li> <li><code>static ByteOrder LITTLE_ENDIAN</code></li> <li><code>static ByteOrder nativeOrder()</code> — the native byte order of the underlying platform</li> <li>for buffers — <code>ByteBuffer::order</code></li></ul></li> <li><p><code>java.nio.Buffer</code> — finite sequence of elements, not thread-safe</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Buffer</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
</code></pre></div><ul><li>underlying array
<ul><li><code>abstract Object array()</code> — Returns the array that backs this buffer (optional operation)</li> <li><code>abstract int arrayOffset()</code> — Returns the offset within this buffer's backing array of the first element of the buffer (optional operation)</li> <li><code>abstract boolean hasArray()</code></li></ul></li> <li>indices
<ul><li><code>int capacity()</code></li> <li><code>int limit()</code> — the index of the first element that should not be read or written</li> <li><code>int position()</code> — the index of the next element to be read or written</li> <li>relative operations — from position</li> <li>absolute operations — from explicit index</li></ul></li> <li>change indices
<ul><li><code>Buffer clear()</code> — for <code>put</code> or related, sets the limit to the capacity and the position to zero</li> <li><code>Buffer flip()</code> — for <code>get</code> or related, sets the limit to the current position and then sets the position to zero</li> <li><code>Buffer rewind()</code> — for re-read, sets the position to zero</li> <li><code>Buffer limit(int newLimit)</code></li> <li><code>Buffer position(int newPosition)</code></li> <li>mark and reset
<ul><li><code>Buffer mark()</code> — set the current as the index to which its position will be set when <code>reset()</code>, otherwise <code>InvalidMarkException</code></li> <li><code>Buffer reset()</code></li></ul></li></ul></li> <li>remaining
<ul><li><code>int remaining()</code> — from position to limit</li> <li><code>boolean hasRemaining()</code></li></ul></li> <li>attributes
<ul><li><code>abstract boolean isDirect()</code></li> <li><code>abstract boolean isReadOnly()</code></li></ul></li></ul></li> <li><p><code>java.nio.ByteBuffer</code> — byte buffer with absolute and relative, bulk and not bulk <code>get</code> and <code>put</code>, not bulk <code>get</code> and <code>put</code> with other types, as well as views and other manipulating</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">ByteBuffer</span>
<span class="token keyword">extends</span> <span class="token class-name">Buffer</span>
<span class="token keyword">implements</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ByteBuffer</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>view buffers — another buffer whose content is backed by the byte buffer, changes on either one will be reflected on both</li> <li>get and put methods — content can be heterogeneous or homogeneous, big-endian or little-endian</li> <li>creation
<ul><li><code>static ByteBuffer allocate(int capacity)</code></li> <li><code>static ByteBuffer allocateDirect(int capacity)</code></li> <li><code>static ByteBuffer wrap(byte[] array)</code></li> <li><code>static ByteBuffer wrap(byte[] array, int offset, int length)</code></li></ul></li> <li>manipulate
<ul><li><code>abstract ByteBuffer compact()</code></li> <li><code>abstract ByteBuffer duplicate()</code></li> <li><code>abstract ByteBuffer slice()</code></li></ul></li> <li><code>java.nio.MappedByteBuffer</code> — a direct byte buffer whose content is a memory-mapped region of a file<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">MappedByteBuffer</span>
<span class="token keyword">extends</span> <span class="token class-name">ByteBuffer</span>
</code></pre></div><ul><li><code>FileChannel::map</code></li></ul></li> <li>attributes
<ul><li>direct buffers
<ul><li>no intermediate buffer — JVM will attempt to avoid copying the buffer's content to (or from) an intermediate buffer before (or after) each invocation of one of the underlying operating system's native I/O operations</li> <li>higher overhead — have somewhat higher allocation and deallocation costs than non-direct buffers</li> <li>gc problems — the contents of direct buffers may reside outside of the normal garbage-collected heap</li> <li>usage — best to allocate direct buffers only when they yield a measurable gain in program performance</li> <li>creation — <code>ByteBuffer::allocateDirect</code>, <code>FileChannel::map</code>, view buffers on direct buffers</li></ul></li> <li><code>abstract boolean isDirect()</code></li> <li><code>abstract boolean isReadOnly()</code></li></ul></li></ul></li> <li><p><code>java.nio.CharBuffer</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">CharBuffer</span>
<span class="token keyword">extends</span> <span class="token class-name">Buffer</span>
<span class="token keyword">implements</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CharBuffer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Appendable</span><span class="token punctuation">,</span> <span class="token class-name">CharSequence</span><span class="token punctuation">,</span> <span class="token class-name">Readable</span>
</code></pre></div></li> <li><p><code>java.nio.ShortBuffer</code>, <code>java.nio.LongBuffer</code>, <code>java.nio.IntBuffer</code>, <code>java.nio.FloatBuffer</code>, <code>java.nio.DoubleBuffer</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">DoubleBuffer</span>
<span class="token keyword">extends</span> <span class="token class-name">Buffer</span>
<span class="token keyword">implements</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DoubleBuffer</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ol> <h2 id="nio-channels"><a href="#nio-channels" class="header-anchor">#</a> NIO Channels</h2> <ol><li><p>exceptions in <code>java.nio.channels</code></p> <ul><li><code>IOException</code> <ul><li><code>java.nio.channels.ClosedChannelException</code> <ul><li><code>java.nio.channels.AsynchronousCloseException</code> <ul><li><code>java.nio.channels.ClosedByInterruptException</code></li></ul></li></ul></li> <li><code>java.nio.channels.FileLockInterruptionException</code></li> <li><code>java.nio.channels.InterruptedByTimeoutException</code></li></ul></li> <li><code>RuntimeException</code> <ul><li><code>IllegalArgumentException</code> <ul><li><code>java.nio.channels.IllegalChannelGroupException</code></li> <li><code>java.nio.channels.IllegalSelectorException</code></li> <li><code>java.nio.channels.UnresolvedAddressException</code></li> <li><code>java.nio.channels.UnsupportedAddressTypeException</code></li></ul></li> <li><code>IllegalStateException</code> <ul><li><code>java.nio.channels.AcceptPendingException</code></li> <li><code>java.nio.channels.AlreadyBoundException</code></li> <li><code>java.nio.channels.AlreadyConnectedException</code></li> <li><code>java.nio.channels.CancelledKeyException</code></li> <li><code>java.nio.channels.ClosedSelectorException</code></li> <li><code>java.nio.channels.ConnectionPendingException</code></li> <li><code>java.nio.channels.IllegalBlockingModeException</code></li> <li><code>java.nio.channels.NoConnectionPendingException</code></li> <li><code>java.nio.channels.NonReadableChannelException</code></li> <li><code>java.nio.channels.NonWritableChannelException</code></li> <li><code>java.nio.channels.NotYetBoundException</code></li> <li><code>java.nio.channels.NotYetConnectedException</code></li> <li><code>java.nio.channels.OverlappingFileLockException</code></li> <li><code>java.nio.channels.ReadPendingException</code></li> <li><code>java.nio.channels.ShutdownChannelGroupException</code></li> <li><code>java.nio.channels.WritePendingException</code></li></ul></li></ul></li></ul></li> <li><p>conversion between stream and channel -- constructors of stream based classes and <code>java.nio.channels.Channels</code> methods</p> <ul><li>channel to stream
<ul><li><code>Scanner(ReadableByteChannel source)</code><br> <code>Scanner(ReadableByteChannel source, String charsetName)</code></li> <li><code>Channels::newOutputStream</code></li> <li>more</li></ul></li> <li>stream to channel
<ul><li><code>Channels::newChannel</code></li> <li><code>getChannel</code> methods in stream based classes</li></ul></li></ul></li> <li><p><code>java.nio.channels.Pipe</code> -- a pair of channels that implements a unidirectional pipe</p></li></ol> <h3 id="channel-interfaces"><a href="#channel-interfaces" class="header-anchor">#</a> Channel Interfaces</h3> <ol><li><p><code>java.nio.channels</code></p> <ul><li><code>Channel</code> <ul><li>read and write channels</li> <li><code>AsynchronousChannel</code> — supports asynchronous I/O operations</li> <li><code>NetworkChannel</code> — to a network socket</li></ul></li> <li><code>Channels</code> — utility methods for channel/stream interoperation</li></ul></li> <li><p><code>java.nio.channels.Channel</code> — a nexus for I/O operations</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Channel</span> <span class="token keyword">extends</span> <span class="token class-name">Closeable</span>
</code></pre></div><ul><li><code>void close()</code></li> <li><code>boolean isOpen()</code> — avoid <code>ClosedChannelException</code></li></ul></li> <li><p>read and write channels</p> <ul><li><code>java.nio.channels.ReadableByteChannel</code> -- only one read operation upon a readable channel may be in progress at any given time
<ul><li><code>int read(ByteBuffer dst)</code> -- read into given buffer</li> <li><code>java.nio.channels.ScatteringByteChannel</code> <ul><li><code>long read(ByteBuffer[] dsts)</code></li> <li><code>long read(ByteBuffer[] dsts, int offset, int length)</code></li></ul></li></ul></li> <li><code>java.nio.channels.WritableByteChannel</code> -- only one write operation upon a writable channel may be in progress at any given time
<ul><li><code>int write(ByteBuffer src)</code></li> <li><code>java.nio.channels.GatheringByteChannel</code> -- write version of <code>ScatteringByteChannel</code></li></ul></li> <li><code>java.nio.channels.ByteChannel</code> -- read and write bytes<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ByteChannel</span>
<span class="token keyword">extends</span> <span class="token class-name">ReadableByteChannel</span><span class="token punctuation">,</span> <span class="token class-name">WritableByteChannel</span>
</code></pre></div><ul><li><code>java.nio.channels.SeekableByteChannel</code> -- a byte channel that maintains a current position and allows the position to be changed</li></ul></li> <li><code>java.nio.channels.InterruptibleChannel</code> -- a channel that can be asynchronously closed and interrupted</li></ul></li> <li><p>network channels</p> <ul><li><code>java.nio.channels.NetworkChannel</code> -- <code>NetworkChannel bind(SocketAddress local)</code> <ul><li><code>java.nio.channels.MulticastChannel</code> -- a network channel that supports Internet Protocol (IP) multicasting</li></ul></li></ul></li> <li><p>async channels -- <code>java.nio.channels.AsynchronousChannel</code></p> <ul><li><code>java.nio.channels.AsynchronousByteChannel</code> <ul><li>read
<ul><li><code>Future&lt;Integer&gt; read(ByteBuffer dst)</code></li> <li><code>&lt;A&gt; void read(ByteBuffer dst, A attachment, CompletionHandler&lt;Integer,? super A&gt; handler)</code></li></ul></li> <li>write
<ul><li><code>Future&lt;Integer&gt; write(ByteBuffer src)</code></li> <li><code>&lt;A&gt; void write(ByteBuffer src, A attachment, CompletionHandler&lt;Integer,? super A&gt; handler)</code></li></ul></li> <li><code>java.nio.channels.CompletionHandler</code> -- callback when <code>completed</code> or <code>failed</code></li> <li><code>java.nio.channels.AsynchronousSocketChannel</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AsynchronousSocketChannel</span>
<span class="token keyword">implements</span> <span class="token class-name">AsynchronousByteChannel</span><span class="token punctuation">,</span> <span class="token class-name">NetworkChannel</span>
</code></pre></div></li></ul></li> <li><code>java.nio.channels.AsynchronousServerSocketChannel</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AsynchronousServerSocketChannel</span>
<span class="token keyword">implements</span> <span class="token class-name">AsynchronousChannel</span><span class="token punctuation">,</span> <span class="token class-name">NetworkChannel</span>
</code></pre></div></li> <li><code>AsynchronousFileChannel</code></li></ul></li></ol> <h3 id="selector"><a href="#selector" class="header-anchor">#</a> Selector</h3> <ol><li><p><code>java.nio.channels.spi.AbstractInterruptibleChannel</code> -- base implementation class for interruptible channels</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractInterruptibleChannel</span>
<span class="token keyword">implements</span> <span class="token class-name">Channel</span><span class="token punctuation">,</span> <span class="token class-name">InterruptibleChannel</span>
</code></pre></div></li> <li><p><code>java.nio.channels.SelectableChannel</code> -- a channel that can be multiplexed via a <code>Selector</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">SelectableChannel</span>
<span class="token keyword">extends</span> <span class="token class-name">AbstractInterruptibleChannel</span>
<span class="token keyword">implements</span> <span class="token class-name">Channel</span>
</code></pre></div><ul><li>blocking mode or in non-blocking mode -- defaults to blocking mode, must be placed into non-blocking mode before being registered and when registered
<ul><li><code>abstract SelectableChannel configureBlocking(boolean block)</code></li> <li><code>abstract boolean isBlocking()</code></li></ul></li> <li>register -- one or more selectors, at most once for each
<ul><li><code>SelectionKey register(Selector sel, int ops)</code></li> <li><code>abstract SelectionKey register(Selector sel, int ops, Object att)</code></li> <li><code>abstract boolean isRegistered()</code></li> <li><code>abstract SelectionKey keyFor(Selector sel)</code></li> <li><code>abstract int validOps()</code></li></ul></li> <li>deregister -- <code>SelectionKey::cancel</code>, <code>close()</code> or interrupted</li></ul></li> <li><p><code>java.nio.channels.Selector</code> -- a multiplexer of <code>SelectableChannel</code> objects</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Selector</span> <span class="token keyword">implements</span> <span class="token class-name">Closeable</span>
</code></pre></div><ul><li>creation
<ul><li><code>static Selector open()</code> -- created by <code>SelectorProvider::openSelector</code></li> <li><code>abstract boolean isOpen()</code></li> <li><code>abstract SelectorProvider provider()</code></li></ul></li> <li>registration key sets
<ul><li><code>abstract Set&lt;SelectionKey&gt; keys()</code> -- channel registrations</li> <li><code>abstract Set&lt;SelectionKey&gt; selectedKeys()</code> -- keys such that each key's channel was detected to be ready for at least one of the operations identified in the key's interest set during a prior selection operation; keys are removed by the <code>Set</code> removal methods</li> <li>cancelled-key set -- the set of keys that have been cancelled (<code>SelectableChannel::close</code> or <code>SelectionKey::cancel</code>) but whose channels have not yet been deregistered, not directly accessible; removed from the key set during selection operations</li></ul></li> <li>selection -- during which keys may be added to and removed from a selector's selected-key set and may be removed from its key and cancelled-key sets
<ul><li>step
<ol><li>empty cancelled-key set itself and from key set</li> <li>OS queried for an update as to the readiness of each remaining channel, if ready, add to selected-key set and its ready-operation set overwritten if newly add otherwise merged</li> <li>keys added to the cancelled-key set during the process are as step 1</li></ol></li> <li><code>abstract int select()</code> -- blocking</li> <li><code>abstract int select(long timeout)</code></li> <li><code>abstract int selectNow()</code> -- non-blocking, clears <code>wakeup()</code></li> <li><code>abstract Selector wakeup()</code> -- blocked <code>select</code> will return immediately, or next <code>select</code> will return immediately if none currently; also invoked after <code>Thread::interrupt</code></li></ul></li> <li>concurrency -- thread-safe, but not the key sets</li></ul></li> <li><p><code>java.nio.channels.SelectionKey</code> -- a token representing the registration of a <code>SelectableChannel</code> with a <code>Selector</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">SelectionKey</span>
</code></pre></div><ul><li>operation bit vector, support depends on the underlying channel
<ul><li><code>static int OP_ACCEPT</code> -- operation-set bit for socket-accept operations</li> <li><code>static int OP_CONNECT</code> -- operation-set bit for socket-connect operations</li> <li><code>static int OP_READ</code></li> <li><code>static int OP_WRITE</code></li></ul></li> <li>cancel
<ul><li><code>abstract void cancel()</code></li> <li><code>abstract boolean isValid()</code></li></ul></li> <li><code>abstract int interestOps()</code> -- the interest set, which operation categories will be tested for readiness
<ul><li><code>abstract SelectionKey interestOps(int ops)</code> -- set to given value</li></ul></li> <li><code>abstract int readyOps()</code> -- the ready set, the operation categories for which the key's channel has been detected to be ready by the key's selector
<ul><li><code>boolean isAcceptable()</code></li> <li><code>boolean isConnectable()</code></li> <li><code>boolean isReadable()</code></li> <li><code>boolean isWritable()</code></li></ul></li> <li>binding
<ul><li><code>abstract SelectableChannel channel()</code></li> <li><code>abstract Selector selector()</code></li></ul></li> <li>concurrency -- thread-safe</li></ul></li> <li><p>Reactor 模型 -- 一个线程 Thread 使用一个选择器 Selector 通过轮询的方式去监听多个通道 Channel 上的事件，从而让一个线程就可以处理多个事件</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> keys <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> keyIterator <span class="token operator">=</span> keys<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>keyIterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SelectionKey</span> key <span class="token operator">=</span> keyIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isAcceptable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">ServerSocketChannel</span> ssChannel1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ServerSocketChannel</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 服务器会为每个新连接创建一个 SocketChannel</span>
            <span class="token class-name">SocketChannel</span> sChannel <span class="token operator">=</span> ssChannel1<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sChannel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 这个新连接主要用于从客户端读取数据</span>
            sChannel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span>OP_READ<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isReadable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">SocketChannel</span> sChannel <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">readDataFromSocketChannel</span><span class="token punctuation">(</span>sChannel<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sChannel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        keyIterator<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <h3 id="channel-implementations"><a href="#channel-implementations" class="header-anchor">#</a> Channel Implementations</h3> <ol><li><p><code>FileChannel</code> -- see <a href="#File-Classes">File Classes</a>, extends <code>AbstractInterruptibleChannel</code> but not <code>AbstractSelectableChannel</code></p></li> <li><p><code>java.nio.channels.SocketChannel</code> — like <code>Socket</code>, but a selectable channel</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">SocketChannel</span>
<span class="token keyword">extends</span> <span class="token class-name">AbstractSelectableChannel</span>
<span class="token keyword">implements</span> <span class="token class-name">ByteChannel</span><span class="token punctuation">,</span> <span class="token class-name">ScatteringByteChannel</span><span class="token punctuation">,</span> <span class="token class-name">GatheringByteChannel</span><span class="token punctuation">,</span> <span class="token class-name">NetworkChannel</span>
</code></pre></div><ul><li>creation
<ul><li><code>static SocketChannel open()</code></li> <li><code>static SocketChannel open(SocketAddress remote)</code></li></ul></li></ul></li> <li><p><code>java.nio.channels.DatagramChannel</code> -- like <code>DatagramSocket</code>, but a selectable channel</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">DatagramChannel</span>
<span class="token keyword">extends</span> <span class="token class-name">AbstractSelectableChannel</span>
<span class="token keyword">implements</span> <span class="token class-name">ByteChannel</span><span class="token punctuation">,</span> <span class="token class-name">ScatteringByteChannel</span><span class="token punctuation">,</span> <span class="token class-name">GatheringByteChannel</span><span class="token punctuation">,</span> <span class="token class-name">MulticastChannel</span>
</code></pre></div></li> <li><p><code>java.nio.channels.ServerSocketChannel</code> -- like <code>ServerSocket</code>, but a selectable channel</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">ServerSocketChannel</span>
<span class="token keyword">extends</span> <span class="token class-name">AbstractSelectableChannel</span>
<span class="token keyword">implements</span> <span class="token class-name">NetworkChannel</span>
</code></pre></div></li> <li><p>more</p></li></ol> <h1 id="network"><a href="#network" class="header-anchor">#</a> Network</h1> <ol><li><p><code>java.net</code> — networking like working with files</p> <ul><li>low level API
<ul><li>addresses — <code>Inet4Address</code>, <code>Inet6Address</code>, <code>InetSocketAddress</code></li> <li>sockets
<ul><li><code>Socket</code> — a TCP client</li> <li><code>ServerSocket</code> — a TCP server</li> <li><code>DatagramSocket</code> — a UDP endpoint API and is used to send and receive <code>DatagramPacket</code> <ul><li><code>MulticastSocket</code> — a subclass of <code>DatagramSocket</code> used when dealing with multicast groups</li></ul></li></ul></li> <li>interfaces
<ul><li><code>NetworkInterface</code> — a network interface (e.g. ethernet connection or PPP endpoint) made up of a name, and a list of IP addresses assigned to this interface</li></ul></li></ul></li> <li>high level API
<ul><li>URI</li> <li>URL</li> <li>connections</li></ul></li></ul></li> <li><p>network exceptions</p> <ul><li><code>IOException</code> <ul><li><code>java.net.HttpRetryException</code></li> <li><code>java.io.InterruptedIOException</code> <ul><li><code>java.net.SocketTimeoutException</code></li></ul></li> <li><code>java.net.MalformedURLException</code></li> <li><code>java.net.ProtocolException</code></li> <li><code>java.net.SocketException</code> <ul><li><code>java.net.BindException</code></li> <li><code>java.net.ConnectException</code></li> <li><code>java.net.NoRouteToHostException</code></li> <li><code>java.net.PortUnreachableException</code></li></ul></li> <li><code>java.net.UnknownHostException</code> — <code>String host</code></li> <li><code>java.net.UnknownServiceException</code></li></ul></li> <li><code>java.net.URISyntaxException</code></li></ul></li></ol> <h2 id="address"><a href="#address" class="header-anchor">#</a> Address</h2> <ol><li><p><code>java.net.InetAddress</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InetAddress</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Serializable</span>
</code></pre></div><ul><li>address types — unicast, multicast</li> <li>IP address scope
<ul><li>Link-local addresses — designed to be used for addressing on a single link for purposes such as auto-address configuration, neighbor discovery, or when no routers are present.</li> <li>Site-local addresses — designed to be used for addressing inside of a site without the need for a global prefix.</li> <li>Global addresses — unique across the internet.</li></ul></li> <li>host name resolution — a combination of local configuration and network naming services such as, DNS and NIS</li> <li>caching — <code>InetAddress</code> stores successful as well as unsuccessful host name resolutions
<ul><li>property <code>networkaddress.cache.ttl</code> — TTL for successful name lookups</li> <li>property <code>networkaddress.cache.negative.ttl</code> — TTL for unsuccessful name lookups</li></ul></li> <li>creation
<ul><li><code>static InetAddress[] getAllByName(String host)</code></li> <li><code>static InetAddress getByAddress(byte[] addr)</code></li> <li><code>static InetAddress getByAddress(String host, byte[] addr)</code></li> <li><code>static InetAddress getByName(String host)</code></li> <li><code>static InetAddress getLocalHost()</code></li> <li><code>static InetAddress getLoopbackAddress()</code></li></ul></li></ul></li> <li><p><code>java.net.Inet4Address</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Inet4Address</span>
<span class="token keyword">extends</span> <span class="token class-name">InetAddress</span>
</code></pre></div></li> <li><p><code>java.net.Inet6Address</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Inet6Address</span>
<span class="token keyword">extends</span> <span class="token class-name">InetAddress</span>
</code></pre></div></li> <li><p><code>java.net.InetSocketAddress</code> — IP Socket Address (IP address + port number), can also be a pair (hostname + port number)</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InetSocketAddress</span>
<span class="token keyword">extends</span> <span class="token class-name">SocketAddress</span>
</code></pre></div><ul><li>wildcard address — means &quot;any&quot; and can only be used for <code>bind</code> operations, created with <code>null</code> or omitted <code>InetAddress</code></li> <li><code>java.net.SocketAddress</code> — for extending<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">SocketAddress</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Serializable</span>
</code></pre></div></li></ul></li></ol> <h2 id="sockets"><a href="#sockets" class="header-anchor">#</a> Sockets</h2> <ol><li><p><code>java.net.SocketImplFactory</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">interface</span> <span class="token class-name">SocketImplFactory</span> <span class="token punctuation">{</span>
    <span class="token class-name">SocketImpl</span> <span class="token function">createSocketImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p><code>java.net.SocketImpl</code> — a common superclass for socket implementations</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">SocketImpl</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">SocketOptions</span>
</code></pre></div></li> <li><p><code>interface java.net.SocketOptions</code> — socket options and get/set methods</p></li> <li><p><code>java.net.Socket</code> — TCP client</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Socket</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Closeable</span>
</code></pre></div><ul><li>use — read/write is blocking and can not be interrupted
<ul><li><code>SocketChannel getChannel()</code> — a socket will have a channel iff the channel itself was created via the <code>SocketChannel::open</code> or <code>ServerSocketChannel::accept</code> methods</li> <li><code>InputStream getInputStream()</code></li> <li><code>OutputStream getOutputStream()</code></li></ul></li> <li>timeout
<ul><li><code>int getSoTimeout()</code></li> <li><code>void setSoTimeout(int timeout)</code></li></ul></li> <li>connect
<ul><li>blocking constructors</li> <li><code>void connect(SocketAddress endpoint)</code> — blocking and cannot be interrupted</li> <li><code>void connect(SocketAddress endpoint, int timeout)</code></li> <li><code>boolean isConnected()</code></li></ul></li> <li>half-close — one end of a socket connection to terminate its output while still receiving data from the other end
<ul><li><code>void shutdownInput()</code></li> <li><code>void shutdownOutput()</code></li> <li><code>boolean isInputShutdown()</code></li> <li><code>boolean isOutputShutdown()</code></li></ul></li> <li>implementation — defaults to an instance of package-visible class inheriting <code>SocketImpl</code> <ul><li><code>static void setSocketImplFactory(SocketImplFactory fac)</code></li></ul></li> <li>more</li></ul></li> <li><p><code>java.net.ServerSocket</code> — TCP server</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServerSocket</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Closeable</span>
</code></pre></div><ul><li>similar methods in <code>Socket</code></li> <li><code>Socket accept()</code> — wait indefinitely until a client connects to that port and then return the connection as <code>Socket</code></li> <li><code>void setSoTimeout(int timeout)</code></li> <li>bind to local port
<ul><li>constructors</li> <li><code>void bind(SocketAddress endpoint)</code></li> <li><code>void bind(SocketAddress endpoint, int backlog)</code></li></ul></li></ul></li></ol> <h2 id="uri-and-url"><a href="#uri-and-url" class="header-anchor">#</a> URI and URL</h2> <ol><li><p><code>java.net.URI</code> — uniform resource identifiers, to parsing, stringify, componentize, and process</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> URI <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span>URI<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span>
</code></pre></div><ul><li><code>URL toURL()</code></li></ul></li> <li><p>encoder and decoder — for <code>application/x-www-form-urlencoded</code></p> <ul><li><code>java.net.URLEncoder</code> — <code>static String encode(String s, String enc)</code></li> <li><code>java.net.URLDecoder</code> — <code>static String decode(String s, String enc)</code></li></ul></li> <li><p><code>java.net.URLStreamHandler</code> — the common superclass for all stream protocol handlers, for making a connection for a particular protocol type</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">URLStreamHandler</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
</code></pre></div><ul><li>cache — automatically loaded when first encounter, and stored in a hash table</li> <li>protected methods for interacting with <code>URL</code> and open connection</li></ul></li> <li><p><code>java.net.URL</code> — uniform resource locators, can open connections (locate resource), a special kind of URI, which is not URN (uniform resource name); supports common protocols (schemas) and <code>jar:</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> URL <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Serializable</span>
</code></pre></div><ul><li>URL escaping — not handled, it is the responsibility of the caller to encode and decode, recommended to use <code>URI</code> to manage</li> <li>creation
<ul><li>constructors — take string URL, string URL components, or <code>URL</code>, and optionally <code>URLStreamHandler</code> as arguments</li></ul></li> <li>URL component get methods</li> <li>use
<ul><li><code>URLConnection openConnection()</code> — uses <code>URLStreamHandler::openConnection</code>, establishes connection only after <code>URLConnection::connect</code> or <code>URLConnection::getInputStream</code>, etc.</li> <li><code>URLConnection openConnection(Proxy proxy)</code></li> <li><code>InputStream openStream()</code> — <code>openConnection().getInputStream()</code></li> <li><code>Object getContent()</code> — <code>openConnection().getContent()</code>, see blow<br> <code>Object getContent(Class[] classes)</code></li></ul></li> <li>conversion
<ul><li><code>String toExternalForm()</code> — uses underlying <code>URLStreamHandler::toExternalForm</code></li> <li><code>String toString()</code></li> <li><code>URI toURI()</code></li></ul></li></ul></li> <li><p><code>java.net.URLConnection</code> — URL connection</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">URLConnection</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
</code></pre></div><ul><li>establish connections
<ul><li><code>abstract void connect()</code></li> <li>get methods</li></ul></li> <li>get methods — get settings and results, some will open connections implicitly
<ul><li><code>static void setContentHandlerFactory(ContentHandlerFactory fac)</code></li> <li><code>Object getContent()</code> — not very useful, <code>sun.net.www.content.&lt;contentType&gt;</code> is used if no custom content handler by <code>ContentHandlerFactory</code><br> <code>Object getContent(Class[] classes)</code> — <code>null</code> if all <code>Class::isInstance</code> fails</li> <li><code>InputStream getInputStream()</code></li> <li>more</li></ul></li> <li>set methods
<ul><li><code>void addRequestProperty(String key, String value)</code></li> <li><code>void setDoOutput(boolean dooutput)</code> — set <code>doOutput</code> (defaults to <code>false</code>) field to <code>true</code> to write to the URL connection
<ul><li><code>doInput</code> defaults to <code>true</code></li></ul></li> <li><code>OutputStream getOutputStream()</code></li> <li>set methods for applets only</li> <li>more</li></ul></li> <li><code>java.net.JarURLConnection</code> — use cast from <code>URLConnection</code> for creation, for URLs like <code>jar:&lt;url&gt;!/{entry}</code>, for example<div class="language- extra-class"><pre class="language-text"><code>jar:http://www.foo.com/bar/baz.jar!/COM/foo/Quux.class
jar:file:/home/duke/duke.jar!/
</code></pre></div></li> <li><code>java.net.HttpURLConnection</code> — use cast from <code>URLConnection</code> for creation<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">HttpURLConnection</span>
<span class="token keyword">extends</span> <span class="token class-name">URLConnection</span>
</code></pre></div><ul><li><code>static int</code> HTTP status codes</li> <li><code>InputStream getErrorStream()</code> — 404 will throw <code>FileNotFoundException</code>, but response data can be also useful</li> <li>cookies — see <a href="#HTTP-Cookie">HTTP Cookie</a></li></ul></li></ul></li></ol> <h3 id="http-cookie"><a href="#http-cookie" class="header-anchor">#</a> HTTP Cookie</h3> <ol><li><p>hierarchy of HTTP cookie classes</p> <div class="language- extra-class"><pre class="language-text"><code>                 use
CookieHandler &lt;------- HttpURLConnection
      ^
      | impl
      |         use
CookieManager -------&gt; CookiePolicy
            |   use
            |--------&gt; HttpCookie
            |              ^
            |              | use
            |   use        |
            |--------&gt; CookieStore
                           ^
                           | impl
                           |
                 Internal in-memory implementation
</code></pre></div></li> <li><p><code>java.net.CookieHandler</code> — provides a callback mechanism to hook up a HTTP state management policy implementation into the HTTP protocol handler</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">CookieHandler</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
</code></pre></div><ul><li><code>static void setDefault(CookieHandler cHandler)</code></li></ul></li> <li><p><code>java.net.CookieManager</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CookieManager</span>
<span class="token keyword">extends</span> <span class="token class-name">CookieHandler</span>
</code></pre></div><ul><li>creation
<ul><li><code>CookieManager(CookieStore store, CookiePolicy cookiePolicy)</code> — <code>null</code> parameters means default value</li></ul></li></ul></li> <li><p><code>interface java.net.CookieStore</code> — store and retrieve cookies, and remove when expired</p></li> <li><p><code>interface java.net.CookiePolicy</code></p> <ul><li>predefined
<ul><li><code>static CookiePolicy ACCEPT_ALL</code></li> <li><code>static CookiePolicy ACCEPT_NONE</code></li> <li><code>static CookiePolicy ACCEPT_ORIGINAL_SERVER</code></li></ul></li> <li><code>boolean shouldAccept(URI uri, HttpCookie cookie)</code></li></ul></li> <li><p><code>java.net.HttpCookie</code> — key-value pair with information like <code>isHttpOnly()</code>, <code>getMaxAge()</code></p></li></ol> <h1 id="jdbc"><a href="#jdbc" class="header-anchor">#</a> JDBC</h1> <ol><li><code>java.sql.SQLException</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SQLException</span>
<span class="token keyword">extends</span> <span class="token class-name">Exception</span>
<span class="token keyword">implements</span> <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Throwable</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><code>java.sql.BatchUpdateException</code></li> <li><code>java.sql.SQLClientInfoException</code></li> <li><code>java.sql.SQLNonTransientException</code> <ul><li><code>java.sql.SQLDataException</code></li> <li><code>java.sql.SQLFeatureNotSupportedException</code></li> <li><code>java.sql.SQLIntegrityConstraintViolationException</code></li> <li><code>java.sql.SQLInvalidAuthorizationSpecException</code></li> <li><code>java.sql.SQLNonTransientConnectionException</code></li> <li><code>java.sql.SQLSyntaxErrorException</code></li></ul></li> <li><code>java.sql.SQLRecoverableException</code></li> <li><code>java.sql.SQLTransientException</code> <ul><li><code>java.sql.SQLTimeoutException</code></li> <li><code>java.sql.SQLTransactionRollbackException</code></li> <li><code>java.sql.SQLTransientConnectionException</code></li></ul></li> <li><code>java.sql.SQLWarning</code> <ul><li><code>java.sql.DataTruncation</code></li></ul></li></ul></li></ol> <h2 id="jdbc-properties"><a href="#jdbc-properties" class="header-anchor">#</a> JDBC Properties</h2> <ol><li><p>JDBC system properties</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">jdbc.drivers</span><span class="token punctuation">=</span><span class="token attr-value">org.postgresql.Driver</span>
<span class="token attr-name">jdbc.url</span><span class="token punctuation">=</span><span class="token attr-value">jdbc:postgresql:example</span>
<span class="token attr-name">jdbc.username</span><span class="token punctuation">=</span><span class="token attr-value">dbuser</span>
<span class="token attr-name">jdbc.password</span><span class="token punctuation">=</span><span class="token attr-value">secret</span>
</code></pre></div></li> <li><p>JDBC driver</p> <ul><li>types
<ul><li>type 1 driver, no in use anymore — translates JDBC to ODBC and relies on an ODBC driver to communicate with the database</li> <li>type 2 driver, deprecated — written partly in Java and partly in native code; it communicates with the client API of a database, platform-specific code required</li> <li>type 3 driver — a pure Java client library that uses a database-independent protocol to communicate database requests to a server component, which then translates the requests into a database-specific protocol</li> <li>type 4 driver — a pure Java library that translates JDBC requests directly to a database-specific protocol</li></ul></li> <li>driver class register — the driver manager iterates through the registered drivers to find a driver that can use the subprotocol specified in the database URL
<ul><li>automatic register as service provider — a jar file is automatically registered if it contains the file <code>META-INF/services/java.sql.Driver</code></li> <li>hard code — load a class and its static initializers executed<div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;org.postgresql.Driver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li>system property — <code>jdbc.drivers</code>, separated by colons</li></ul></li> <li>debug
<ul><li><code>DriverManager::setLogWriter</code></li> <li>some drivers support trace file parameter in url</li></ul></li></ul></li> <li><p>JDBC url</p> <div class="language- extra-class"><pre class="language-text"><code>jdbc:subprotocol:others
jdbc:derby://localhost:1527/example;create=true
jdbc:postgresql:example
</code></pre></div></li> <li><p>JDBC escape syntax -- translate to database-specific syntax variations, see <a href="https://docs.oracle.com/en/database/oracle/oracle-database/18/jjdbc/JDBC-reference-information.html#GUID-DFF83C4A-D0F8-420C-BA66-8681B939B787" target="_blank" rel="noopener noreferrer">JDBC Reference Information<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li>control -- <code>Statement::setEscapeProcessing</code></li> <li>temporal<div class="language- extra-class"><pre class="language-text"><code>{d '2008-01-24'}
{t '23:59:59'}
{ts '2008-01-24 23:59:59.999'}
</code></pre></div></li> <li>scalar function<div class="language- extra-class"><pre class="language-text"><code>{fn left(?, 20)}
{fn user()}
</code></pre></div></li> <li>calling stored procedures</li> <li>outer joins -- <code>oj</code></li> <li>the escape character in <code>LIKE</code> clauses</li></ul></li></ol> <h2 id="jdbc-classes"><a href="#jdbc-classes" class="header-anchor">#</a> JDBC Classes</h2> <ol><li><p>example: establish a connection and execute statements</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">runTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token class-name">Statement</span> stat <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        stat<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token string">&quot;CREATE TABLE Greetings (Message CHAR(20))&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        stat<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token string">&quot;INSERT INTO Greetings VALUES ('Hello, World!')&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">ResultSet</span> result <span class="token operator">=</span> stat<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM Greetings&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        stat<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token string">&quot;DROP TABLE Greetings&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Connection</span> <span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Properties</span> props <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">InputStream</span> in <span class="token operator">=</span> <span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">newInputStream</span><span class="token punctuation">(</span><span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;database.properties&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        props<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">String</span> drivers <span class="token operator">=</span> props<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc.drivers&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>drivers <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc.drivers&quot;</span><span class="token punctuation">,</span> drivers<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> url <span class="token operator">=</span> props<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc.url&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> username <span class="token operator">=</span> props<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc.username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> password <span class="token operator">=</span> props<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc.password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p><code>java.sql.DriverManager</code> — for managing a set of JDBC drivers</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DriverManager</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
</code></pre></div><ul><li><code>static Connection getConnection(String url)</code> — the driver manager iterates through the registered drivers to find a driver that can use the subprotocol specified in the database URL<br> <code>static Connection getConnection(String url, Properties info)</code><br> <code>static Connection getConnection(String url, String user, String password)</code></li> <li><code>static void setLogWriter(PrintWriter out)</code></li> <li>more</li></ul></li> <li><p><code>interface java.sql.Wrapper</code> — retrieve the delegate instance when the instance in question is in fact a proxy class</p> <ul><li><code>boolean isWrapperFor(Class&lt;?&gt; iface)</code></li> <li><code>&lt;T&gt; T unwrap(Class&lt;T&gt; iface)</code></li></ul></li> <li><p><code>java.sql.Connection</code> — A connection (session) with a specific database. SQL statements are executed and results are returned within the context of a connection</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Connection</span>
<span class="token keyword">extends</span> <span class="token class-name">Wrapper</span><span class="token punctuation">,</span> <span class="token class-name">AutoCloseable</span>
</code></pre></div><ul><li>metadata
<ul><li><code>DatabaseMetaData getMetaData()</code> -- information about the database's tables, its supported SQL grammar, its stored procedures, the capabilities of this connection, and so on</li></ul></li> <li>configuration -- should not use a SQL statements to configure if a JDBC method available
<ul><li><code>void abort(Executor executor)</code></li> <li><code>void close()</code></li> <li><code>SQLWarning getWarnings()</code>, <code>void clearWarnings()</code></li> <li><code>String getSchema()</code>, <code>void setSchema(String schema)</code></li> <li><code>getClientInfo</code>, <code>setClientInfo</code></li></ul></li> <li>transaction -- should not use a SQL statements to configure if a JDBC method available
<ul><li><code>void setAutoCommit(boolean autoCommit)</code> — defaults to <code>true</code></li> <li><code>boolean getAutoCommit()</code></li> <li><code>void setTransactionIsolation(int level)</code> <ul><li>isolation levels as <code>static int</code> fields -- <code>TRANSACTION_NONE</code>, <code>TRANSACTION_READ_COMMITTED</code>, <code>TRANSACTION_READ_UNCOMMITTED</code>, <code>TRANSACTION_REPEATABLE_READ</code>, <code>TRANSACTION_SERIALIZABLE</code></li></ul></li> <li><code>int getTransactionIsolation()</code></li> <li><code>void commit()</code></li> <li><code>Savepoint setSavepoint()</code><br> <code>Savepoint setSavepoint(String name)</code></li> <li><code>void releaseSavepoint(Savepoint savepoint)</code></li> <li><code>void rollback()</code><br> <code>void rollback(Savepoint savepoint)</code></li></ul></li> <li>statements -- one or more, according to <code>DatabaseMetaData::getMaxStatements</code> <ul><li><code>Statement createStatement()</code><br> <code>Statement createStatement(int resultSetType, int resultSetConcurrency)</code><br> <code>Statement createStatement(int resultSetType, int resultSetConcurrency, int resultSetHoldability)</code> <ul><li><code>resultSetType</code> -- <code>ResultSet.TYPE_FORWARD_ONLY</code>, <code>ResultSet.TYPE_SCROLL_INSENSITIVE</code>, <code>ResultSet.TYPE_SCROLL_SENSITIVE</code></li> <li><code>resultSetConcurrency</code> -- <code>ResultSet.CONCUR_READ_ONLY</code>, <code>ResultSet.CONCUR_UPDATABLE</code></li> <li><code>resultSetHoldability</code> -- <code>ResultSet.HOLD_CURSORS_OVER_COMMIT</code>, <code>ResultSet.CLOSE_CURSORS_AT_COMMIT</code></li></ul></li> <li><code>prepareCall</code> -- for <code>CALL</code> stored procedures</li> <li><code>prepareStatement</code> -- <code>PREPARE</code> and <code>EXECUTE</code></li></ul></li> <li><code>java.sql.DatabaseMetaData</code> -- information about the DBMS, the driver, and the results of some <code>SHOW</code> statements<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">DatabaseMetaData</span> <span class="token keyword">extends</span> <span class="token class-name">Wrapper</span>
</code></pre></div><ul><li><code>ResultSet getTables(String catalog, String schemaPattern, String tableNamePattern, String[] types)</code></li></ul></li></ul></li> <li><p><code>java.sql.Statement</code> — executing a static SQL statement and returning the results</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Statement</span>
<span class="token keyword">extends</span> <span class="token class-name">Wrapper</span><span class="token punctuation">,</span> <span class="token class-name">AutoCloseable</span>
</code></pre></div><ul><li>one <code>ResultSet</code> a time — all execution methods in the <code>Statement</code> interface implicitly close a current <code>ResultSet</code> object of the statement if an open one exists</li> <li><code>ResultSet getResultSet()</code></li> <li><code>getMoreResults</code> -- for databases that also allow submission of multiple SELECT statements in a single query</li> <li><code>void setEscapeProcessing(boolean enable)</code> -- defaults to <code>true</code></li> <li>autogenerated keys -- whether retrieve autogenerated keys, often the primary key
<ul><li><code>int executeUpdate(String sql, int autoGeneratedKeys)</code> and other methods
<ul><li><code>static int RETURN_GENERATED_KEYS</code></li> <li><code>static int NO_GENERATED_KEYS</code></li></ul></li></ul></li> <li>batch -- no <code>SELECT</code> <ul><li><code>void addBatch(String sql)</code></li> <li><code>int[] executeBatch()</code></li></ul></li> <li>execute
<ul><li><code>execute</code></li> <li><code>int[] executeBatch()</code></li> <li><code>default long[] executeLargeBatch()</code></li> <li><code>executeLargeUpdate</code></li> <li><code>ResultSet executeQuery(String sql)</code></li> <li><code>executeUpdate</code> — returns count for rows affected or 0</li></ul></li></ul></li> <li><p><code>java.sql.PreparedStatement</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PreparedStatement</span> <span class="token keyword">extends</span> <span class="token class-name">Statement</span>
</code></pre></div><ul><li><code>void clearParameters()</code></li> <li>example<div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">PreparedStatement</span> pSt <span class="token operator">=</span> con<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>&quot;UPDATE EMPLOYEES
                                  <span class="token class-name">SET</span> SALARY <span class="token operator">=</span> <span class="token operator">?</span> <span class="token class-name">WHERE</span> ID <span class="token operator">=</span> <span class="token operator">?</span>&quot;<span class="token punctuation">)</span><span class="token punctuation">;</span>
pSt<span class="token punctuation">.</span><span class="token function">setBigDecimal</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">153833.00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
pSt<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">110592</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
pSt<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li> <li><p><code>java.sql.ResultSet</code> — a table of data representing a database result set</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ResultSet</span>
<span class="token keyword">extends</span> <span class="token class-name">Wrapper</span><span class="token punctuation">,</span> <span class="token class-name">AutoCloseable</span>
</code></pre></div><ul><li>cursor — initially positioned before the first row; no <code>hasNext</code>, keep calling <code>next</code> until <code>false</code> <ul><li><code>boolean next()</code> — moves the cursor forward one row from its current position, initially positioned before the first row, <code>false</code> when at last row<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">while</span> <span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
</code></pre></div></li> <li>scrollable cursor
<ul><li><code>boolean absolute(int row)</code></li> <li><code>boolean relative(int rows)</code></li> <li><code>boolean previous()</code></li> <li><code>first</code>, <code>last</code>, <code>beforeFirst</code>, and <code>afterLast</code></li> <li><code>isFirst</code>, <code>isLast</code>, <code>isBeforeFirst</code>, and <code>isAfterLast</code></li></ul></li></ul></li> <li><code>ResultSetMetaData getMetaData()</code> <ul><li><code>ResultSetMetaData::getColumnTypeName</code></li></ul></li> <li><code>get-</code> prefixed methods — get results as a certain type from the current row, two forms of parameters, for types like <code>Array</code>, <code>Blob</code>, <code>Clob</code>, <code>int</code>, <code>String</code> etc.
<ul><li><code>__ get__(int columnIndex)</code> — index starts from 1</li> <li><code>__ get__(String columnLabel)</code></li></ul></li> <li><code>update-</code> prefixed methods — like <code>get-</code> methods, for interactive update
<ul><li><code>void updateRow()</code> -- updates the underlying database with the new contents of the current row, changes will be discarded if not called</li> <li><code>void cancelRowUpdates()</code></li></ul></li> <li>insert -- for interactive scenarios
<ol><li><code>void moveToInsertRow()</code></li> <li><code>update-</code> methods</li> <li><code>void insertRow()</code></li> <li><code>void moveToCurrentRow()</code></li></ol></li> <li><code>void deleteRow()</code> -- for interactive scenarios</li></ul></li> <li><p>JDBC type interfaces</p> <ul><li><code>java.lang</code> type classes, <code>String</code> and stream type classes, <code>java.math</code> type classes, primitive types</li> <li><code>java.net.URL</code> type class</li> <li><code>java.sql.Array</code></li> <li><code>java.sql.Blob</code></li> <li><code>java.sql.Clob</code></li> <li><code>java.sql.Ref</code></li> <li><code>java.sql.RowId</code></li> <li><code>java.sql.SQLData</code> -- SQL user-defined type (UDT)</li> <li><code>java.sql.SQLType</code> -- a generic SQL type, called a JDBC type or a vendor specific data type</li> <li><code>java.sql.Date</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Date</span> <span class="token keyword">extends</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token class-name">Date</span>
</code></pre></div></li> <li><code>java.sql.Time</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Time</span> <span class="token keyword">extends</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token class-name">Date</span>
</code></pre></div></li> <li><code>java.sql.Timestamp</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Timestamp</span> <span class="token keyword">extends</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token class-name">Date</span>
</code></pre></div></li> <li><code>java.sql.Types</code> -- <code>static int</code> constants that are used to identify generic SQL types
<ul><li><code>ARRAY</code>, <code>BIGINT</code>, <code>BINARY</code>, <code>BIT</code>, <code>BLOB</code>, <code>BOOLEAN</code>, <code>TINYINT</code>, <code>VARBINARY</code>, <code>VARCHAR</code></li> <li>more</li></ul></li></ul></li></ol> <h3 id="row-sets"><a href="#row-sets" class="header-anchor">#</a> Row Sets</h3> <ol><li><p><code>javax.sql.RowSet</code> -- a connected rowset or more commonly, a disconnected rowset</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">RowSet</span> <span class="token keyword">extends</span> <span class="token class-name">ResultSet</span>
</code></pre></div><ul><li>`javax.sql.rowset.JdbcRowSet -- added functionality of connections, like transaction</li> <li><code>javax.sql.rowset.CachedRowSet</code> -- a disconnected rowset<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CachedRowSet</span> <span class="token keyword">extends</span> <span class="token class-name">RowSet</span><span class="token punctuation">,</span> <span class="token class-name">Joinable</span>
</code></pre></div><ul><li><code>javax.sql.rowset.WebRowSet</code> -- a cached row set that can be saved to an XML file
<ul><li><code>javax.sql.rowset.FilteredRowSet</code> -- for filtering</li> <li><code>javax.sql.rowset.JoinRowSet</code> -- for <code>JOIN</code></li></ul></li></ul></li></ul></li> <li><p><code>interface javax.sql.rowset.RowSetFactory</code></p> <ul><li><code>__RowSet create__RowSet()</code></li></ul></li> <li><p><code>javax.sql.rowset.RowSetProvider</code></p> <ul><li><code>static RowSetFactory newFactory()</code></li> <li><code>static RowSetFactory newFactory(String factoryClassName, ClassLoader cl)</code></li></ul></li></ol> <h1 id="time"><a href="#time" class="header-anchor">#</a> Time</h1> <ol><li><p>current timestamps</p> <ul><li><code>System</code> <ul><li><code>static long nanoTime()</code></li> <li><code>static long currentTimeMillis()</code></li></ul></li></ul></li> <li><p>SQL and legacy classes</p> <ul><li>timestamps (<code>Instant</code>) — <code>java.util.Date</code>: represents a specific instant in time, with millisecond precision<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Date</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Serializable</span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Date</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><code>java.sql.Date</code> — interoperable with SQL <code>DATE</code></li> <li><code>java.sql.Time</code> — interoperable with SQL <code>TIME</code> without a timezone</li> <li><code>java.sql.Timestamp</code> — interoperable with SQL <code>TIMESTAMP</code>, adds the ability to hold the SQL <code>TIMESTAMP</code> fractional seconds value, by allowing the specification of fractional seconds to a precision of nanoseconds</li></ul></li> <li>calendars — <code>java.util.Calendar</code>: for converting between a specific instant in time and a set of calendar fields, and for manipulating the calendar fields<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Calendar</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Serializable</span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Calendar</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><code>java.util.GregorianCalendar</code> — a concrete subclass of <code>Calendar</code> and provides the standard calendar system used by most of the world</li></ul></li> <li>timezones — <code>java.util.TimeZone</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">TimeZone</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Serializable</span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span>
</code></pre></div><ul><li><code>java.util.SimpleTimeZone</code></li></ul></li> <li>formats
<ul><li><code>java.text.DateFormat</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">DateFormat</span>
<span class="token keyword">extends</span> <span class="token class-name">Format</span>
</code></pre></div><ul><li><code>java.text.SimpleDateFormat</code></li></ul></li></ul></li></ul></li> <li><p><code>java.time</code> — dates, times, instants, and durations</p> <ul><li><code>java.time.temporal</code> — lower level access to the fields</li> <li><code>java.time.format</code> — printing and parsing all manner of dates and times</li> <li><code>java.time.chrono</code> — calendar neutral APIs, localized calendars, for interactions with users</li> <li>non-null — non-null constructors and methods, except checking and validating methods</li> <li>API convention
<ul><li><code>of</code> — static factory method</li> <li><code>parse</code> — static factory method focussed on parsing</li> <li><code>get</code> — gets the value of something</li> <li><code>is</code> — checks if something is true</li> <li><code>with</code> — the immutable equivalent of a setter</li> <li><code>plus</code> — adds an amount to an object</li> <li><code>minus</code> — subtracts an amount from an object</li> <li><code>to</code> — converts this object to another type</li> <li><code>at</code> — combines this object with another, such as <code>date.atTime(time)</code></li> <li><code>from</code></li></ul></li> <li>enums
<ul><li><code>java.time.Month</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">Month</span> <span class="token keyword">extends</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Month</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">implements</span> <span class="token class-name">TemporalAccessor</span><span class="token punctuation">,</span> <span class="token class-name">TemporalAdjuster</span>
</code></pre></div></li> <li><code>java.time.DayOfWeek</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">DayOfWeek</span> <span class="token keyword">extends</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DayOfWeek</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">implements</span> <span class="token class-name">TemporalAccessor</span><span class="token punctuation">,</span> <span class="token class-name">TemporalAdjuster</span>
</code></pre></div></li></ul></li></ul></li> <li><p><code>java.time.Instant</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Instant</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Temporal</span><span class="token punctuation">,</span> <span class="token class-name">TemporalAdjuster</span><span class="token punctuation">,</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Instant</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span>
</code></pre></div><ul><li>SQL type — <code>TIMESTAMP</code> with a timezone</li> <li>epoch
<ul><li><code>static Instant EPOCH</code> — Constant for the 1970-01-01T00:00:00Z epoch instant.</li> <li><code>static Instant MAX</code> — The maximum supported Instant, '1000000000-12-31T23:59:59.999999999Z'.</li> <li><code>static Instant MIN</code> — The minimum supported Instant, '-1000000000-01-01T00:00Z'.</li></ul></li> <li>creation
<ul><li><code>now</code></li> <li><code>of-</code> prefixed methods</li> <li><code>static Instant parse(CharSequence text)</code></li></ul></li> <li>conversion
<ul><li><code>long toEpochMilli()</code></li> <li><code>String toString()</code></li> <li><code>int getNano()</code></li> <li><code>getLong</code></li></ul></li></ul></li> <li><p><code>java.time.Duration</code> — amount of time, kept in several <code>long</code> for seconds, an <code>int</code> for nanoseconds</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Duration</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">TemporalAmount</span><span class="token punctuation">,</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Duration</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span>
</code></pre></div><ul><li>creation
<ul><li><code>static Duration between(Temporal startInclusive, Temporal endExclusive)</code></li> <li>more</li></ul></li></ul></li> <li><p><code>java.time.OffsetDateTime</code> -- A date-time with an offset from UTC/Greenwich in the ISO-8601 calendar system, such as <code>2007-12-03T10:15:30+01:00</code></p> <ul><li>SQL type — <code>TIMESTAMP</code> with a timezone</li></ul></li> <li><p><code>java.time.ZonedDateTime</code> -- <code>OffsetDateTime</code> with <code>ZoneId</code>, such as <code>2007-12-03T10:15:30+01:00 Europe/Paris</code></p> <ul><li>SQL type — <code>TIMESTAMP</code> with a timezone</li> <li>The Internet Assigned Numbers Authority (IANA) <a href="www.iana.org/time-zones">database</a></li> <li><code>ZoneId getZone()</code></li> <li><code>OffsetDateTime toOffsetDateTime()</code></li></ul></li> <li><p><code>java.time.LocalDateTime</code></p> <ul><li>SQL type — <code>DATETIME</code></li></ul></li> <li><p><code>java.time.LocalDate</code> — A date without a time-zone in the ISO-8601 calendar system</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">LocalDate</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Temporal</span><span class="token punctuation">,</span> <span class="token class-name">TemporalAdjuster</span><span class="token punctuation">,</span> <span class="token class-name">ChronoLocalDate</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span>
</code></pre></div><ul><li>SQL type — <code>DATE</code></li> <li>overflow when <code>plusMonth</code> or <code>minusMonth</code> — return the last valid day of the month</li></ul></li> <li><p><code>java.time.Period</code> — A date-based amount of time in the ISO-8601 calendar system, counterpart of <code>Duration</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Period</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">ChronoPeriod</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span>
</code></pre></div></li> <li><p><code>java.time.OffsetTime</code></p> <ul><li>SQL type — <code>TIME</code> with a timezone</li></ul></li> <li><p><code>java.time.LocalTime</code></p> <ul><li>SQL type — <code>TIME</code> without a timezone</li></ul></li> <li><p><code>java.time.format.DateTimeFormatter</code> — Formatter for printing and parsing date-time objects</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">DateTimeFormatter</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
</code></pre></div><ul><li>creation
<ul><li>predefined — see javadoc</li> <li><code>ofLocalized-</code> prefixed methods to create from <code>FormatStyle</code></li> <li>patterns — see javadoc for patterns like <code>&quot;E yyyy-MM-dd HH:mm&quot;</code> <ul><li><code>static DateTimeFormatter ofPattern(String pattern)</code></li> <li><code>static DateTimeFormatter ofPattern(String pattern, Locale locale)</code></li></ul></li></ul></li> <li>localized
<ul><li><code>DateTimeFormatter withLocale(Locale locale)</code></li></ul></li> <li>conversion
<ul><li><code>toFormat</code></li></ul></li> <li>format
<ul><li><code>String format(TemporalAccessor temporal)</code></li> <li><code>void formatTo(TemporalAccessor temporal, Appendable appendable)</code></li></ul></li> <li>parse methods
<ul><li><code>LocalDate::parse</code>, <code>LocalDateTime::parse</code>, <code>LocalTime::parse</code>, or <code>ZonedDateTime::parse</code>, not suitable for parsing human input</li> <li>other parse methods</li></ul></li> <li><code>enum java.time.format.FormatStyle</code> — <code>FULL</code>, <code>LONG</code>, <code>MEDIUM</code>, <code>SHORT</code></li> <li><code>java.time.format.TextStyle</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">TextStyle</span> <span class="token keyword">extends</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TextStyle</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><code>FULL</code> / <code>FULL_STANDALONE</code></li> <li><code>SHORT</code> / <code>SHORT_STANDALONE</code></li> <li><code>NARROW</code> / <code>NARROW_STANDALONE</code></li> <li><code>Month::getDisplayName</code> — <code>String getDisplayName(TextStyle style, Locale locale)</code></li></ul></li></ul></li></ol> <h1 id="i18n"><a href="#i18n" class="header-anchor">#</a> i18n</h1> <ol><li><p>locale — language code and optionally other codes; language tag like <code>en-US</code></p> <div class="language- extra-class"><pre class="language-text"><code>lang-script-region-extension
</code></pre></div><ul><li>language code — two or three lowercase letters, such as <code>en</code></li> <li>script code — four letters with an initial uppercase, such as <code>Latn</code> (Latin), <code>Cyrl</code> (Cyrillic), or <code>Hant</code> (traditional Chinese characters)</li> <li>country (region) code — two uppercase letters or three digits such as US (United States) or CH (Switzerland)</li> <li>variant: miscellaneous (such as dialects or spelling rules) codes — rarely used or made into extension</li> <li>extension — start with <code>u-</code> and a two-letter code specifying whether the extension deals with the calendar (<code>ca</code>), numbers (<code>nu</code>), and so on; Other extensions are entirely arbitrary and start with <code>x-</code>, such as <code>x-java</code> <ul><li>describe local preferences — calendars (such as the Japanese calendar), numbers (<code>u-nu-thai</code> Thai instead of Western digits), and so on</li></ul></li> <li>example
<ul><li><code>&quot;zh-Hans-CN&quot;</code> — Chinese written in simplified characters as used in China (primary language with script and country codes)</li> <li><code>&quot;ja-JP-u-ca-japanese&quot;</code> — Use the Japanese calendar in date and time formatting, so that 2013 is expressed as the year 25 of the Heisei period, or 平成25</li></ul></li> <li>reference
<ul><li><a href="https://tools.ietf.org/html/bcp47" target="_blank" rel="noopener noreferrer">“Best Current Practices” BCP 47 - Tags for Identifying Languages<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.w3.org/International/articles/language-tags/" target="_blank" rel="noopener noreferrer">Language tags in HTML and XML<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></li> <li><p><code>java.util.Locale</code></p> <ul><li>creation
<ul><li>constructors
<ul><li><code>Locale(String language)</code></li> <li><code>Locale(String language, String country)</code></li> <li><code>Locale(String language, String country, String variant)</code></li></ul></li> <li><code>static Locale forLanguageTag(String languageTag)</code></li> <li><code>static Locale[] getAvailableLocales()</code></li> <li>predefined
<ul><li><code>static char PRIVATE_USE_EXTENSION</code> — The key for the private use extension ('x').</li> <li><code>static char UNICODE_LOCALE_EXTENSION</code> — <code>'u'</code></li> <li><code>static Locale ROOT</code></li> <li><code>static Locale SIMPLIFIED_CHINESE</code></li> <li><code>static Locale US</code></li> <li><code>static Locale UK</code></li> <li>more</li></ul></li> <li>from locale-dependent utility classes — <code>NumberFormat.getAvailableLocales()</code></li> <li><code>Locale.Builder</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Locale</span><span class="token punctuation">.</span><span class="token class-name">Builder</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Locale</span> aLocale <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setLanguage</span><span class="token punctuation">(</span><span class="token string">&quot;sr&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setScript</span><span class="token punctuation">(</span><span class="token string">&quot;Latn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setRegion</span><span class="token punctuation">(</span><span class="token string">&quot;RS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li> <li>default — <code>System.getProperty(&quot;user.language&quot;)</code>, <code>System.getProperty(&quot;user.region&quot;)</code> <ul><li><code>static Locale getDefault()</code></li> <li><code>static Locale getDefault(Locale.Category category)</code></li> <li><code>static void setDefault(Locale.Category category, Locale newLocale)</code></li> <li><code>static void setDefault(Locale newLocale)</code></li></ul></li> <li>get methods — show info about this locale</li> <li>transformation
<ul><li><code>Locale stripExtensions()</code></li> <li><code>String toLanguageTag()</code></li></ul></li></ul></li> <li><p><code>java.text.Format</code> — abstract base class for formatting locale-sensitive information such as dates, messages, and numbers</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Format</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Serializable</span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span>
</code></pre></div><ul><li>format
<ul><li><code>String format(Object obj)</code></li> <li><code>abstract StringBuffer format(Object obj, StringBuffer toAppendTo, FieldPosition pos)</code></li> <li><code>AttributedCharacterIterator formatToCharacterIterator(Object obj)</code></li></ul></li> <li>parse
<ul><li><code>Object parseObject(String source)</code></li> <li><code>abstract Object parseObject(String source, ParsePosition pos)</code></li> <li>use a Scanner to read localized integers and floating-point numbers — <code>Scanner::useLocale</code></li></ul></li></ul></li> <li><p><code>MessageFormat</code></p> <ul><li>creation
<ul><li><code>MessageFormat(String pattern, Locale locale)</code></li></ul></li> <li>public final String format(Object obj)</li></ul></li></ol> <h2 id="number-format"><a href="#number-format" class="header-anchor">#</a> Number Format</h2> <ol><li><p><code>java.text.NumberFormat</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">NumberFormat</span>
<span class="token keyword">extends</span> <span class="token class-name">Format</span>
</code></pre></div><ul><li>creation
<ul><li><code>static Locale[] getAvailableLocales()</code></li> <li><code>static NumberFormat getCurrencyInstance()</code></li> <li><code>static NumberFormat getCurrencyInstance(Locale inLocale)</code></li> <li><code>static NumberFormat getInstance()</code></li> <li><code>static NumberFormat getInstance(Locale inLocale)</code></li> <li><code>static NumberFormat getIntegerInstance()</code></li> <li><code>static NumberFormat getIntegerInstance(Locale inLocale)</code></li> <li><code>static NumberFormat getNumberInstance()</code></li> <li><code>static NumberFormat getNumberInstance(Locale inLocale)</code></li> <li><code>static NumberFormat getPercentInstance()</code></li> <li><code>static NumberFormat getPercentInstance(Locale inLocale)</code></li></ul></li> <li>settings — get, set methods</li></ul></li> <li><p><code>java.util.Currency</code> — control the currency used by the formatters</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Currency</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Serializable</span>
</code></pre></div><ul><li><code>NumberFormat::serCurrency</code> — <code>void setCurrency(Currency currency)</code></li> <li>creation
<ul><li><code>static Set&lt;Currency&gt; getAvailableCurrencies()</code></li> <li><code>static Currency getInstance(Locale locale)</code></li> <li><code>static Currency getInstance(String currencyCode)</code></li></ul></li> <li>display
<ul><li><code>String getCurrencyCode()</code></li> <li><code>int getDefaultFractionDigits()</code></li> <li><code>String getDisplayName()</code></li> <li><code>String getDisplayName(Locale locale)</code></li> <li><code>int getNumericCode()</code></li> <li><code>String getSymbol()</code></li> <li><code>String getSymbol(Locale locale)</code></li> <li><code>String toString()</code></li></ul></li></ul></li> <li><p><code>java.time.format.DateTimeFormatter</code> — see <a href="#Time">Time</a></p></li></ol> <h2 id="collator-and-normalizer"><a href="#collator-and-normalizer" class="header-anchor">#</a> Collator and Normalizer</h2> <ol><li><p><code>java.text.Collator</code> — locale-sensitive String comparison</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Collator</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span>
</code></pre></div><ul><li>decomposition — four normalization forms (D, KD, C, and KC)
<ul><li>normalization forms
<ul><li>In the normalization form C, accented characters are always composed. For example, a sequence of A and a combining ring above ° is combined into a single character Å (recommended by W3C)</li> <li>In form D, accented characters are always decomposed into their base letters and combining accents: Å is turned into A followed by °</li> <li>Forms KC and KD also decompose characters such as ligatures or the trademark symbol</li></ul></li> <li><code>static int NO_DECOMPOSITION</code></li> <li><code>static int CANONICAL_DECOMPOSITION</code></li> <li><code>static int FULL_DECOMPOSITION</code></li></ul></li> <li>strength — in Czech, &quot;e&quot; and &quot;f&quot; are considered primary differences, while &quot;e&quot; and &quot;ě&quot; are secondary differences, &quot;e&quot; and &quot;E&quot; are tertiary differences and &quot;e&quot; and &quot;e&quot; are identical
<ul><li><code>PRIMARY</code>, <code>SECONDARY</code>, <code>TERTIARY</code>, and <code>IDENTICAL</code></li> <li><code>int getStrength()</code></li> <li><code>void setStrength(int newStrength)</code></li></ul></li> <li>creation
<ul><li><code>static Locale[] getAvailableLocales()</code></li> <li><code>static Collator getInstance()</code></li> <li><code>static Collator getInstance(Locale desiredLocale)</code></li></ul></li> <li>compare
<ul><li><code>int compare(Object o1, Object o2)</code></li> <li><code>abstract int compare(String source, String target)</code></li></ul></li> <li>sort — <code>abstract CollationKey getCollationKey(String source)</code> for better performance</li> <li><code>java.text.CollationKey</code> — a series of bits that can be compared bitwise against other <code>CollationKeys</code> of the same <code>Collator</code> object<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">CollationKey</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
<span class="token keyword">implements</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CollationKey</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><code>abstract int compareTo(CollationKey target)</code></li> <li><code>String getSourceString()</code></li> <li><code>abstract byte[] toByteArray()</code></li></ul></li> <li>example<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">var</span> ss <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token string">&quot;Peter Öhlund&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Peter Ohlin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Peter Olsdal&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Peter Zorn&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>ss<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>ss<span class="token punctuation">,</span> <span class="token class-name">Collator</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token class-name">Locale</span><span class="token punctuation">.</span>GERMANY<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>ss<span class="token punctuation">,</span> <span class="token class-name">Collator</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token class-name">Locale</span><span class="token punctuation">.</span><span class="token function">forLanguageTag</span><span class="token punctuation">(</span><span class="token string">&quot;sv&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span>ss<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> collator<span class="token punctuation">.</span><span class="token function">getCollationKey</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> k<span class="token punctuation">.</span><span class="token function">getSourceString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li> <li><p><code>java.text.Normalizer</code> — decomposition in <code>Collator</code>, see <a href="http://www.unicode.org/reports/tr15/tr15-23.html" target="_blank" rel="noopener noreferrer">Unicode Standard Annex #15 — Unicode Normalization Forms<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Normalizer</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
</code></pre></div><ul><li><code>static boolean isNormalized(CharSequence src, Normalizer.Form form)</code></li> <li><code>static String normalize(CharSequence src, Normalizer.Form form)</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token string">&quot;Ångström&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> normalized <span class="token operator">=</span> <span class="token class-name">Normalizer</span><span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token class-name">Normalizer</span><span class="token punctuation">.</span><span class="token class-name">Form</span><span class="token punctuation">.</span>NFD<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><code>Normalizer.Form</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">enum</span> <span class="token class-name">Normalizer</span><span class="token punctuation">.</span><span class="token class-name">Form</span> <span class="token keyword">extends</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Normalizer</span><span class="token punctuation">.</span><span class="token class-name">Form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><code>NFC</code></li> <li><code>NFD</code></li> <li><code>NFKC</code></li> <li><code>NFKD</code></li></ul></li></ul></li></ol> <h2 id="resource-bundles"><a href="#resource-bundles" class="header-anchor">#</a> Resource Bundles</h2> <ol><li><p>resource bundles — locale-specific items</p> <ul><li>naming convention
<ul><li>country specific — <code>bundleName_language_country</code></li> <li>language specific — <code>bundleName_language</code></li></ul></li> <li>load order
<ul><li><code>bundleName_currentLocaleLanguage_currentLocaleCountry</code></li> <li><code>bundleName_currentLocaleLanguage</code></li> <li><code>bundleName_currentLocaleLanguage_defaultLocaleCountry</code></li> <li><code>bundleName_defaultLocaleLanguage</code></li> <li><code>bundleName</code></li></ul></li> <li>resource hierarchy — the parents are searched if a lookup was not successful in the current bundle
<ul><li>load — parents are looked up when a bundle is already located</li> <li>order — <code>bundleName_de_DE</code>, then the <code>bundleName_de</code> and <code>bundleName</code></li></ul></li> <li>property files
<ul><li>supported by <code>ResourceBundle::getBundle</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// MyProgramStrings.properties</span>
<span class="token comment">// MyProgramStrings_en.properties</span>
<span class="token comment">// MyProgramStrings_de_DE.properties</span>
<span class="token class-name">ResourceBundle</span> bundle <span class="token operator">=</span> <span class="token class-name">ResourceBundle</span><span class="token punctuation">.</span><span class="token function">getBundle</span><span class="token punctuation">(</span><span class="token string">&quot;MyProgramStrings&quot;</span><span class="token punctuation">,</span> locale<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li>only ASCII in property files — use <code>\uxxxx</code> for unicode</li> <li>property with placeholder — <code>readingFile=Achtung! Datei {0} wird eingelesen</code></li></ul></li> <li>bundle classes — to provide resources that are not strings
<ul><li>priority — more prior than property files</li> <li>supported by <code>ResourceBundle::getBundle</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// MyProgramResources.java</span>
<span class="token comment">// MyProgramResources_en.java</span>
<span class="token comment">// MyProgramResources_de_DE.java</span>
<span class="token class-name">ResourceBundle</span> bundle <span class="token operator">=</span> <span class="token class-name">ResourceBundle</span><span class="token punctuation">.</span><span class="token function">getBundle</span><span class="token punctuation">(</span><span class="token string">&quot;MyProgramResources&quot;</span><span class="token punctuation">,</span> locale<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li>define bundle classes
<ul><li>extend <code>ListResourceBundle</code><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyProgramResources_de_DE</span> <span class="token keyword">extends</span> <span class="token class-name">ListResourceBundle</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> contents <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token punctuation">{</span> <span class="token string">&quot;backgroundColor&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Color</span><span class="token punctuation">.</span>black <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> <span class="token string">&quot;defaultPaperSize&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token keyword">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token number">210</span><span class="token punctuation">,</span> <span class="token number">297</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getContents</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> contents<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li>extend <code>ResourceBundle</code> and override below methods<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">abstract</span> <span class="token class-name">Enumeration</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">protected</span> <span class="token keyword">abstract</span> <span class="token class-name">Object</span> <span class="token function">handleGetObject</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span>
</code></pre></div></li></ul></li></ul></li></ul></li> <li><p><code>java.util.ResourceBundle</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">ResourceBundle</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
</code></pre></div><ul><li>load
<ul><li><code>static ResourceBundle getBundle(String baseName)</code></li> <li><code>static ResourceBundle getBundle(String baseName, Locale locale)</code></li> <li><code>static ResourceBundle getBundle(String baseName, Locale locale, ClassLoader loader)</code></li> <li><code>static ResourceBundle getBundle(String baseName, Locale targetLocale, ClassLoader loader, ResourceBundle.Control control)</code></li> <li><code>static ResourceBundle getBundle(String baseName, Locale targetLocale, ResourceBundle.Control control)</code></li> <li><code>static ResourceBundle getBundle(String baseName, ResourceBundle.Control control)</code></li></ul></li> <li>get
<ul><li><code>Object getObject(String key)</code></li> <li><code>String getString(String key)</code></li> <li><code>String[] getStringArray(String key)</code></li></ul></li></ul></li></ol> <h1 id="other-java-apis"><a href="#other-java-apis" class="header-anchor">#</a> Other Java APIs</h1> <ol><li><p>agents — bytecode engineering at load time</p> <ul><li>bytecode engineering compiled classes — <a href="https://asm.ow2.io/" target="_blank" rel="noopener noreferrer">ASM<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>CLI
<ul><li><code>-agentlib:&lt;libname&gt;[=&lt;options&gt;]</code></li> <li><code>-agentpath:&lt;pathname&gt;[=&lt;options&gt;]</code></li> <li><code>-javaagent:&lt;jarpath&gt;[=&lt;options&gt;]</code></li></ul></li> <li><code>java.lang.instrument</code> — allow agents to instrument programs running on the JVM. The mechanism for instrumentation is modification of the byte-codes of methods.
<ul><li>more in package javadoc</li></ul></li> <li>build an agent when launching JVM
<ul><li>write an agent class with <code>premain</code>, called when the agent is loaded, before <code>main</code> of programs<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">premain</span><span class="token punctuation">(</span><span class="token class-name">String</span> arg<span class="token punctuation">,</span> <span class="token class-name">Instrumentation</span> instr<span class="token punctuation">)</span>
</code></pre></div><ul><li>CLI options (args) — can get a single one</li> <li><code>agentmain</code> method for agents starting sometime after JVM launched</li></ul></li> <li>write a manifest setting <code>Premain-Class</code><div class="language- extra-class"><pre class="language-text"><code>Premain-Class: bytecodeAnnotations.EntryLoggingAgent
</code></pre></div></li> <li>package the agent class and the manifest<div class="language-shell extra-class"><pre class="language-shell"><code>jar cvfm EntryLoggingAgent.jar bytecodeAnnotations/EntryLoggingAgent.mf <span class="token punctuation">\</span>
    bytecodeAnnotations/Entry*.class
</code></pre></div></li></ul></li></ul></li> <li><p>scripting</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">var</span> $<span class="token number">1</span> <span class="token operator">=</span> <span class="token keyword">new</span> javax<span class="token punctuation">.</span>script<span class="token punctuation">.</span><span class="token class-name">ScriptEngineManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEngineByName</span><span class="token punctuation">(</span><span class="token string">&quot;nashorn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> json <span class="token operator">=</span> <span class="token string">&quot;{\&quot;a\&quot;: 5}&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> $<span class="token number">7</span> <span class="token operator">=</span> <span class="token punctuation">(</span>jdk<span class="token punctuation">.</span>nashorn<span class="token punctuation">.</span>api<span class="token punctuation">.</span>scripting<span class="token punctuation">.</span><span class="token class-name">ScriptObjectMirror</span><span class="token punctuation">)</span> $<span class="token number">1.</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">&quot;JSON.parse('&quot;</span> <span class="token operator">+</span> json <span class="token operator">+</span> <span class="token string">&quot;')&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
$<span class="token number">7.</span><span class="token function">getMember</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5, Integer</span>
</code></pre></div><ul><li>engines
<ul><li>nashorn — JavaScript engine, included from JDK 8, deprecated from JDK 11</li> <li>groovy</li> <li>Renjin — R language</li> <li>sisc</li></ul></li> <li>bindings — variable contexts</li> <li>new polyglot solution: GraalVM — a Java VM and JDK based on HotSpot/OpenJDK, for running applications written in JavaScript, Python, Ruby, R, JVM-based languages like Java, Scala, Groovy, Kotlin, Clojure, and LLVM-based languages such as C and C++</li></ul></li> <li><p>compiling — <code>javax.tools.JavaCompiler</code> and more</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">JavaCompiler</span> compiler <span class="token operator">=</span> <span class="token class-name">ToolProvider</span><span class="token punctuation">.</span><span class="token function">getSystemJavaCompiler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">OutputStream</span> outStream <span class="token operator">=</span> <span class="token punctuation">;</span> <span class="token comment">// null for System.out</span>
<span class="token class-name">OutputStream</span> errStream <span class="token operator">=</span> <span class="token punctuation">;</span> <span class="token comment">// null for System.err</span>
<span class="token keyword">int</span> result <span class="token operator">=</span> compiler<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> outStream<span class="token punctuation">,</span> errStream<span class="token punctuation">,</span> <span class="token string">&quot;-sourcepath&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;src&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Test.java&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ol> <h1 id="jvm"><a href="#jvm" class="header-anchor">#</a> JVM</h1> <ol><li><p>JVM in <code>System</code></p> <ul><li><code>static void exit(int status)</code></li> <li><code>static void gc()</code> — run garbage collector</li> <li><code>static SecurityManager getSecurityManager()</code></li> <li><code>static Channel inheritedChannel()</code> — the channel inherited from the entity that created this Java virtual machine</li> <li><code>static void load(String filename)</code></li> <li><code>static void loadLibrary(String libname)</code></li> <li><code>static String mapLibraryName(String libname)</code></li> <li><code>static void runFinalization()</code></li> <li><code>static void setSecurityManager(SecurityManager s)</code></li></ul></li> <li><p>security manager — <code>SecurityManager</code></p> <ul><li>usage — no security manager installed by default, use by <code>System::setSecurityManager</code>, or CLI option <code>-Djava.security.manager</code></li> <li>permission checking — <code>SecurityException</code></li> <li>security policy, <code>java.security.Policy</code> — code sources to permission sets, <code>java.security.Permission</code> <ul><li>protection domain — tbd</li> <li>policy files — tbd
<ul><li>system property — <code>java.security.policy</code>, double equals sign (<code>==</code>) to exclude other standard policy files</li></ul></li></ul></li> <li>Java Authentication and Authorization Service (JAAS) — <code>javax.security.auth.login.LoginContext</code>, tbd
<ul><li>login policies</li></ul></li> <li>tbd</li></ul></li></ol> <h2 id="reference"><a href="#reference" class="header-anchor">#</a> Reference</h2> <ol><li><p><code>java.lang.ref.Reference</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Reference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><code>T get()</code></li> <li><code>void clear()</code></li> <li><code>boolean enqueue()</code> -- Adds this reference object to the queue with which it is registered, if any, by the program or by the garbage collector</li> <li><code>boolean isEnqueued()</code></li> <li>notification of changes in an object's reachability -- by registering an appropriate reference object with a reference queue at the time the reference object is created</li> <li>package private constructor for override
<ul><li><code>Reference(T referent)</code></li> <li><code>Reference(T referent, ReferenceQueue&lt;? super T&gt; queue)</code> -- registered with the given queue</li></ul></li> <li>subclasses
<ul><li><code>SoftReference</code></li> <li><code>WeakReference</code></li> <li><code>PhantomReference</code></li></ul></li></ul></li> <li><p>strong reference</p></li> <li><p><code>java.lang.ref.SoftReference&lt;T&gt;</code> -- cleared at the discretion of the garbage collector in response to memory demand, guaranteed to have been cleared before <code>OutOfMemoryError</code></p> <ul><li>use -- for implementing memory-sensitive caches</li></ul></li> <li><p><code>java.lang.ref.WeakReference&lt;T&gt;</code> — weak reference objects, which do not prevent their referents from being made finalizable, finalized, and then reclaimed; next GC</p> <ul><li>use -- weak references are for implementing canonicalizing mappings that do not prevent their keys (or values) from being reclaimed</li></ul></li> <li><p><code>java.lang.ref.PhantomReference&lt;T&gt;</code> -- phantom references are not automatically cleared by GC as they are enqueued. An object that is reachable via phantom references will remain so until all such references are cleared or themselves become unreachable</p> <ul><li>use -- for scheduling pre-mortem cleanup actions in a more flexible way than is possible with the Java finalization mechanism</li> <li><code>get()</code> -- always return <code>null</code> to ensure that a reclaimable object remains so</li></ul></li> <li><p><code>java.lang.ref.ReferenceQueue&lt;T&gt;</code> -- to which registered reference objects are appended by GC, at the same time or at some later time after the appropriate reachability changes are detected</p> <ul><li><code>Reference&lt;? extends T&gt; poll()</code> -- non-block</li> <li><code>Reference&lt;? extends T&gt; remove()</code> -- block</li> <li><code>Reference&lt;? extends T&gt; remove(long timeout)</code></li></ul></li></ol> <h2 id="class-loading"><a href="#class-loading" class="header-anchor">#</a> Class Loading</h2> <ol><li><p>class loading</p> <ul><li>class loading process — only classes needed for execution loaded, using the class loader of the method caller
<ul><li>load main program from disk or web</li> <li>resolving — load fields or superclasses of another class type of the main program class</li> <li>load classes required as the <code>main</code> method executes</li></ul></li> <li>class loaders
<ul><li>The bootstrap class loader — loads the system classes (typically, from the JAR file <code>rt.jar</code>, modules from JDK 9)
<ul><li>usually implemented in C — as an integral part of the virtual machine, no <code>ClassLoader</code> object involved, <code>String.class.getClassLoader()</code> is <code>null</code></li></ul></li> <li>The extension class loader — loads “standard extensions” from the <code>jre/lib/ext</code> directory, the loader does not use the class path
<ul><li>no more <code>jre/lib/ext</code> from JDK 9 — The javac compiler and java launcher will exit if the <code>java.ext.dirs</code> system property is set, or if the <code>lib/ext</code> directory exists</li> <li>the platform class loader — the extension class loader is retained from JDK 9 and is specified as the platform class loader, see <code>ClassLoader::getPlatformClassLoader</code></li></ul></li> <li>The system class loader (jdk internal <code>AppClassLoader</code>) — loads the application classes</li></ul></li> <li>class loader hierarchy
<ul><li>cosmic root — the bootstrap class loader</li> <li>parents first — load only if the parent has failed</li> <li>default parent when constructing <code>ClassLoader</code> — system class loader</li></ul></li> <li>break parents first
<ul><li>use customized <code>ClassLoader</code> -- overloading <code>ClassLoader::loadClass</code></li> <li>use SPI -- <code>Thread::getContextClassLoader</code> under the hood, so built-in classes can use user classes</li> <li>OSGi hot deployment</li> <li>module from JDK 9 -- defaults to using the class loader of the module if in a module</li></ul></li> <li>context class loader — each thread has a reference to a class loader
<ul><li><code>Thread::getContextClassLoader</code>, <code>Thread::setContextClassLoader</code></li> <li>class loader inversion — the phenomenon when loading classes programmatically, classes to load are not visible to default class loaders, can be solved by using context class loader</li></ul></li> <li>class loaders as namespaces — in JVM, a class is determined by its full name <strong>and</strong> the class loader
<ul><li>useful for loading code from multiple sources, hot deployment etc.</li></ul></li> <li>bytecode verification — bytecode, except system classes, verified for safety before loaded into JVM
<ul><li>turn off on CLI — <code>-noverify</code> (or <code>-Xverify:none</code>)</li></ul></li></ul></li> <li><p><code>ClassLoader</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">ClassLoader</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span>
</code></pre></div><ul><li>creation
<ul><li><code>Class::getClassLoader</code></li></ul></li> <li>assertion
<ul><li><code>void clearAssertionStatus()</code></li> <li><code>void setClassAssertionStatus(String className, boolean enabled)</code></li> <li><code>void setDefaultAssertionStatus(boolean enabled)</code></li> <li><code>void setPackageAssertionStatus(String packageName, boolean enabled)</code></li></ul></li> <li>load classes
<ul><li><code>protected Class&lt;?&gt; loadClass(String name, boolean resolve)</code> — Loads the class with the specified binary name, in below order
<ol><li><code>protected final Class&lt;?&gt; findLoadedClass(String name)</code></li> <li><code>loadClass</code> of the parent class loader or the build-in JVM class loader if the parent is <code>null</code></li> <li><code>protected Class&lt;?&gt; findClass​(String name)</code> — for overloading with own implementation</li></ol></li> <li><code>protected final Class&lt;?&gt; defineClass(...)</code> — convert bytes to classes, typically used by <code>findClass</code></li></ul></li></ul></li> <li><p><code>java.net.URLClassLoader</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">URLClassLoader</span>
<span class="token keyword">extends</span> <span class="token class-name">SecureClassLoader</span>
<span class="token keyword">implements</span> <span class="token class-name">Closeable</span>
</code></pre></div><ul><li>example usage<div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">URL</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">URL</span><span class="token punctuation">(</span><span class="token string">&quot;file:///path/to/plugin.jar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">URLClassLoader</span> pluginLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLClassLoader</span><span class="token punctuation">(</span><span class="token keyword">new</span> URL<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> url <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> cl <span class="token operator">=</span> pluginLoader<span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token string">&quot;mypackage.MyClass&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li></ol></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/tangentyh/notes-of-tan/edit/master/docs/javaNotes.md" target="_blank" rel="noopener noreferrer">See This Page On GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">10/30/2020, 1:43:45 AM</span></div></footer> <!----> </main></div><div class="global-ui"><!----><div class="vuepress-eqn"></div><span class="vuepress-eq"></span></div></div>
    <script src="/notes-of-tan/assets/js/app.e6faf742.js" defer></script><script src="/notes-of-tan/assets/js/2.82b804b0.js" defer></script><script src="/notes-of-tan/assets/js/30.17337f4d.js" defer></script>
  </body>
</html>
